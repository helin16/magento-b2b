var LastMemoPanelJs=new Class.create;
LastMemoPanelJs.prototype={_pageJs:null,_entityName:null,_entityId:null,_canEdit:!1,_panelHTMLID:"",initialize:function(a,b,c,d){this._pageJs=a;this._panelHTMLID="LastMemoPanelJs_"+String.fromCharCode(65+Math.floor(26*Math.random()))+Date.now();this._entityName=b;this._entityId=c;this._canEdit=d||this._canEdit},setAfterAddFunc:function(a){this._afterAddFunc=a;return this},_getPanel:function(){return new Element("div",{"class":"memo-wrapper",id:this._panelHTMLID})},_submitMemo:function(a){var b,c,
d,e,f;b=this;c=$(a).up(".new-memo-div");d=b._pageJs._collectFormData(c,"new-memo");if(null===d)return b;if((e=c.retrieve("data"))&&e.id&&e.comments===d.comments)return $(b._panelHTMLID).update(b._getMemoDiv(e)),b;b._pageJs.postAjax(LastMemoPanelJs.callbackIds.addMemo,{entity:b._entityName,entityId:b._entityId,data:d},{onCreate:function(){c.hide()},onSuccess:function(a,d){try{(f=b._pageJs.getResp(d,!1,!0))&&f.item&&($(b._panelHTMLID).update(b._getMemoDiv(f.item)),"function"===typeof b._afterAddFunc&&
b._afterAddFunc(f.item))}catch(e){c.insert({top:b._pageJs.getAlertBox("",e).addClassName("alert-danger").addClassName(".msg")}),c.show()}},onComplete:function(){$(a).up(".new-memo-div")&&$(a).up(".new-memo-div").show()}});return b},_getAddMemoDiv:function(a){var b,c;b=this;return(new Element("div",{"class":"panel-body new-memo-div"})).store("data",a).insert({bottom:(new Element("div",{"class":"form-group"})).insert({bottom:b._entityId&&!b._entityId.blank()?"":(new Element("small",{"class":"pull-right"})).update("Please click the save btn down to save this memo")}).insert({bottom:(new Element("label",
{"class":"control-label"})).update("Memo :")}).insert({bottom:(new Element("div",{"class":"input-group"})).insert({bottom:(new Element("input",{"new-memo":"comments",required:!0,"class":"form-control",value:a&&a.comments?a.comments:""})).observe("keydown",function(a){c=$(this).up(".new-memo-div").down(".submit-btn");b._pageJs.keydown(a,function(){c.click()})})}).insert({bottom:b._entityId.blank()?"":(new Element("div",{"class":"input-group-btn"})).insert({bottom:(new Element("div",{"class":"btn btn-primary submit-btn"})).update("Save").observe("click",
function(){b._submitMemo(this)})})}).insert({bottom:(new Element("div",{"class":"input-group-btn"})).insert({bottom:(new Element("div",{"class":"btn btn-default"})).update("Cancel").observe("click",function(){$(b._panelHTMLID).update(b._getMemoDiv(a))})})})})})},_getAddMemoBtn:function(){var a;a=this;return!0!==a._canEdit?"":(new Element("div")).insert({bottom:(new Element("div",{"class":"btn btn-success btn-xs",title:"Click here to create a memo."})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus"})}).insert({bottom:(new Element("span")).update(" Create a Memo")}).observe("click",
function(){$(a._panelHTMLID).update(a._getAddMemoDiv())})})},_getMemoDiv:function(a){var b,c;b=this;if(!a||!a.id||!a.comments)return b._getAddMemoBtn();c=(new Element("div",{"class":"panel-body"})).insert({bottom:(new Element("h4",{"class":"memo-content"})).update(b._pageJs.getAlertBox("Memo: ",a.comments).addClassName("alert-danger"))});!0===b._canEdit&&c.writeAttribute("title","Double click the memo text to edit change it").down(".memo-content").setStyle("cursor: pointer").observe("dblclick",function(){$(b._panelHTMLID).update(b._getAddMemoDiv(a))});
return c},_showMemo:function(){var a,b,c;a=this;if(!a._entityId||a._entityId.blank())return $(a._panelHTMLID).update(a._getMemoDiv({})),a;b=(new Element("div")).insert({bottom:a._pageJs.getLoadingImg().removeClassName("fa-5x")}).insert({bottom:(new Element("span")).update(" Loading Memo...")});new Ajax.Request("/ajax/getComments",{method:"get",parameters:{entity:a._entityName,entityId:a._entityId,orderBy:{id:"desc"},pageNo:1,pageSize:1,type:"MEMO"},onLoading:function(){$(a._panelHTMLID)&&$(a._panelHTMLID).update(b)},
onSuccess:function(b){try{(c=a._pageJs.getResp(b.responseText,!1,!0))&&c.items&&$(a._panelHTMLID).update(a._getMemoDiv(0===c.items.size()?void 0:c.items[0]))}catch(e){$(a._panelHTMLID).update(a.getAlertBox("ERROR: ",e).addClassName("alert-danger"))}},onComplete:function(){b.remove()}});return a},load:function(){$(this._panelHTMLID)&&this._showMemo();return this}};