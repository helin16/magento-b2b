var LastMemoPanelJs=new Class.create;LastMemoPanelJs.prototype={_pageJs:null,_entityName:null,_entityId:null,_canEdit:!1,_panelHTMLID:"",initialize:function(e,t,n,m){this._pageJs=e,this._panelHTMLID="LastMemoPanelJs_"+String.fromCharCode(65+Math.floor(26*Math.random()))+Date.now(),this._entityName=t,this._entityId=n,this._canEdit=m||this._canEdit},setAfterAddFunc:function(e){var t={};return t.me=this,t.me._afterAddFunc=e,t.me},_getPanel:function(){var e={};return e.me=this,e.newDiv=new Element("div",{"class":"memo-wrapper",id:e.me._panelHTMLID}),e.newDiv},_submitMemo:function(e){var t={};return t.me=this,t.newMemoDiv=$(e).up(".new-memo-div"),t.data=t.me._pageJs._collectFormData(t.newMemoDiv,"new-memo"),null===t.data?t.me:(t.oldData=t.newMemoDiv.retrieve("data"),t.oldData&&t.oldData.id&&t.oldData.comments===t.data.comments?($(t.me._panelHTMLID).update(t.me._getMemoDiv(t.oldData)),t.me):(t.me._pageJs.postAjax(LastMemoPanelJs.callbackIds.addMemo,{entity:t.me._entityName,entityId:t.me._entityId,data:t.data},{onLoading:function(){t.newMemoDiv.hide()},onSuccess:function(e,n){try{if(t.result=t.me._pageJs.getResp(n,!1,!0),!t.result||!t.result.item)return;$(t.me._panelHTMLID).update(t.me._getMemoDiv(t.result.item)),"function"==typeof t.me._afterAddFunc&&t.me._afterAddFunc(t.result.item)}catch(m){t.newMemoDiv.insert({top:t.me._pageJs.getAlertBox("",m).addClassName("alert-danger").addClassName(".msg")}),t.newMemoDiv.show()}},onComplete:function(){$(e).up(".new-memo-div")&&$(e).up(".new-memo-div").show()}}),t.me))},_getAddMemoDiv:function(e){var t={};return t.me=this,t.newDiv=new Element("div",{"class":"panel-body new-memo-div"}).store("data",e).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:t.me._entityId&&!t.me._entityId.blank()?"":new Element("small",{"class":"pull-right"}).update("Please click the save btn down to save this memo")}).insert({bottom:new Element("label",{"class":"control-label"}).update("Memo :")}).insert({bottom:new Element("div",{"class":"input-group"}).insert({bottom:new Element("input",{"new-memo":"comments",required:!0,"class":"form-control",value:e&&e.comments?e.comments:""}).observe("keydown",function(e){t.btn=$(this).up(".new-memo-div").down(".submit-btn"),t.me._pageJs.keydown(e,function(){t.btn.click()})})}).insert({bottom:t.me._entityId.blank()?"":new Element("div",{"class":"input-group-btn"}).insert({bottom:new Element("div",{"class":"btn btn-primary submit-btn"}).update("Save").observe("click",function(){t.me._submitMemo(this)})})}).insert({bottom:new Element("div",{"class":"input-group-btn"}).insert({bottom:new Element("div",{"class":"btn btn-default"}).update("Cancel").observe("click",function(){$(t.me._panelHTMLID).update(t.me._getMemoDiv(e))})})})})}),t.newDiv},_getAddMemoBtn:function(){var e={};return e.me=this,e.me._canEdit!==!0?"":(e.newDiv=new Element("div").insert({bottom:new Element("div",{"class":"btn btn-success btn-xs",title:"Click here to create a memo."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus"})}).insert({bottom:new Element("span").update(" Create a Memo")}).observe("click",function(){$(e.me._panelHTMLID).update(e.me._getAddMemoDiv())})}),e.newDiv)},_getMemoDiv:function(e){var t={};return t.me=this,e&&e.id&&e.comments?(t.newDiv=new Element("div",{"class":"panel-body"}).insert({bottom:new Element("h4",{"class":"memo-content"}).update(t.me._pageJs.getAlertBox("Memo: ",e.comments).addClassName("alert-danger"))}),t.me._canEdit===!0&&t.newDiv.writeAttribute("title","Double click the memo text to edit change it").down(".memo-content").setStyle("cursor: pointer").observe("dblclick",function(){$(t.me._panelHTMLID).update(t.me._getAddMemoDiv(e))}),t.newDiv):t.me._getAddMemoBtn()},_showMemo:function(){var e={};return e.me=this,!e.me._entityId||e.me._entityId.blank()?($(e.me._panelHTMLID).update(e.me._getMemoDiv({})),e.me):(e.loadingDiv=new Element("div").insert({bottom:e.me._pageJs.getLoadingImg().removeClassName("fa-5x")}).insert({bottom:new Element("span").update(" Loading Memo...")}),e.ajax=new Ajax.Request("/ajax/getComments",{method:"get",parameters:{entity:e.me._entityName,entityId:e.me._entityId,orderBy:{id:"desc"},pageNo:1,pageSize:1,type:"MEMO"},onLoading:function(){$(e.me._panelHTMLID)&&$(e.me._panelHTMLID).update(e.loadingDiv)},onSuccess:function(t){try{if(e.result=e.me._pageJs.getResp(t.responseText,!1,!0),!e.result||!e.result.items)return;$(e.me._panelHTMLID).update(e.me._getMemoDiv(0===e.result.items.size()?void 0:e.result.items[0]))}catch(n){$(e.me._panelHTMLID).update(e.me.getAlertBox("ERROR: ",n).addClassName("alert-danger"))}},onComplete:function(){e.loadingDiv.remove()}}),e.me)},load:function(){var e={};return e.me=this,$(e.me._panelHTMLID)&&e.me._showMemo(),e.me}};