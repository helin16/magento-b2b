var PageJs=new Class.create;
PageJs.prototype=Object.extend(new BPCPageJs,{resultDivId:"",init:function(){this.initProductSelect2();this._bindDownloadBtn();return this},_bindDownloadBtn:function(){var a,b;a=this;jQuery("#"+a.downloadBtnId).click(function(){b=[];jQuery("#"+pageJs.resultDivId+" input.select2").select2("data").each(function(a){b.push({sku:a.data.sku,price:0<a.data.prices.length?a.data.prices[0].price:"N/A"})});a._genTemplate(b)})},_genTemplate:function(a){var b;0<a.length&&(a=Papa.unparse({quotes:!1,delimiter:",",
newline:"\r\n",data:a}),b=new Date,b="system_build_"+b.getFullYear()+"_"+b.getMonth()+"_"+b.getDate()+"_"+b.getHours()+"_"+b.getMinutes()+"_"+b.getSeconds()+".csv",a=new Blob([a],{type:"text/csv;charset=utf-8"}),saveAs(a,b));return this},_updateSetting:function(a){var b,c,d;b=this;jQuery("#"+pageJs.resultDivId+" input.select2").prop("disabled",!0);b.postAjax(b.getCallbackId("updateSetting"),a,{onSuccess:function(a,f){try{if(c=b.getResp(f,!1,!0))b.productIds&&(d=[],c.each(function(a){d.push({id:a.id,
text:"["+a.sku+"] "+a.name,data:a})}),jQuery("#"+pageJs.resultDivId+" input.select2").select2("data",d)),jQuery("#"+pageJs.resultDivId+" input.select2").prop("disabled",!1)}catch(g){$(resultDiv).update(b.getAlertBox("Error:",g).addClassName("alert-danger"))}}});return b},initProductSelect2:function(){var a={me:this};a.select2=jQuery("#"+pageJs.resultDivId+" .select2");a.select2.select2({placeholder:"Search a product",multiple:!0,minimumInputLength:3,data:[],ajax:{url:"/ajax/getProducts",dataType:"json",
quietMillis:250,data:function(b,c){return{entityName:"Product",searchTxt:b,isKit:a.select2.attr("isKit"),pageNo:c,pageSize:a.pageSize}},results:function(b,c){a.result=[];b.resultData.items.each(function(b){a.result.push({id:b.id,text:"["+b.sku+"] "+b.name,data:b})});return{results:a.result,more:c*a.pageSize<b.resultData.pagination.totalRows}}},formatResult:function(b){return b?a.me._getProductDetailsDiv(b.data):""},escapeMarkup:function(a){return a}});a.select2.on("select2-selecting",function(b){a.txtBox=
$(b.target);a.onSelectFunc=a.txtBox.readAttribute("onSelectFunc");if("function"===typeof a.me[a.onSelectFunc])a.me[a.onSelectFunc](b.object.data)});a.select2.on("change",function(b){a.me._updateSetting(b.val)});a.me.productIds&&(a.data=[],a.me.productIds.each(function(b){a.data.push({id:b.id,text:"["+b.sku+"] "+b.name,data:b})}),a.select2.select2("data",a.data));return a.me},_getProductDetailsDiv:function(a,b){var c,d,e,f;c=this;d=!0===b?!1:!0;e=new Element("div",{"class":"row"});if(!a||!a.id)return e;
f=new Element("img",{"data-src":"holder.js/100%x64",src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+"});e.store("data",a).insert({bottom:(new Element("div",
{"class":"col-xs-4 col-sm-3 col-md-2 col-lg-1"})).update(f)}).insert({bottom:(new Element("div",{"class":"col-xs-8 col-sm-9 col-md-10 col-lg-11"})).insert({bottom:(new Element("div")).insert({bottom:(new Element("div",{"class":"col-md-3 truncate"})).setStyle("max-width:none;").insert({bottom:(new Element("span",{"class":"btn btn-warning btn-xs",title:"SKU: "+a.sku})).update(a.sku).observe("click",function(){c._openURL("/product/"+a.id+".html?blanklayout=1")})})}).insert({bottom:(new Element("div",
{"class":"col-md-3"})).insert({bottom:(new Element("div",{"class":"col-xs-4 text-right"})).update("<strong>Brand</strong>:")}).insert({bottom:(new Element("div",{"class":"col-xs-8 truncate"})).update(a.manufacturer?a.manufacturer.name:"")})}).insert({bottom:(new Element("div",{"class":"col-md-6 truncate",title:a.name})).setStyle("max-width:none;").update((new Element("small")).update(a.name))}).insert({bottom:(new Element("small",{"class":"col-md-12"})).update("<em>"+a.shortDescription+"</em>")})}).insert({bottom:!0!==
d?"":(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-3 col-md-2"})).insert({bottom:(new Element("div",{"class":"input-group input-group-sm"})).insert({bottom:(new Element("div",{"class":"input-group-addon"})).update("SOH:")}).insert({bottom:(new Element("div",{"class":"form-control"})).update(a.stockOnHand)})})}).insert({bottom:(new Element("div",{"class":"col-sm-4 col-md-3"})).insert({bottom:(new Element("div",{"class":"input-group input-group-sm"})).insert({bottom:(new Element("div",
{"class":"input-group-addon"})).update("Unit Price (inc GST):")}).insert({bottom:(new Element("div",{"class":"form-control"})).update(c.getCurrency(c._getUnitPrice(a)))})})})})});return e},_getUnitPrice:function(a){var b;b=0;a&&a.prices&&0<a.prices.size()&&a.prices.each(function(a){a.type&&1===parseInt(a.type.id)&&(b=a.price)});return b}});