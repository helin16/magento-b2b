var PageJs=new Class.create();PageJs.prototype=Object.extend(new DetailsPageJs(),{_htmlIds:{paymentPanel:"payment_panel",itemDiv:"",searchPanel:"search_panel",totalPriceExcludeGST:"total_price_exclude_gst",totalPriceGST:"total_price_gst",totalPriceIncludeGST:"total_price_include_gst",totalPaidAmount:"total-paid-amount",totalShippingCost:"total-shipping-cost"},_supplier:null,_purchaseorder:{},_newDiv:null,setHTMLIDs:function(a){var b={};b.me=this;b.me._htmlIds.itemDiv=a;return b.me},setPreData:function(b){var a={};a.me=this;a.me._purchaseorder=b;a.me._supplier=b.supplier;return a.me},setStatusOptions:function(b){var a={};a.me=this;a.me._statusOptions=b;return a.me},setComment:function(b){var a={};a.me=this;a.me._comments=b;return a.me},setPurchaseOrderItems:function(a){var b={};b.me=this;b.me._purchaseOrderItems=a;return b.me},_getCommentsRow:function(b,a){return new Element("tr",{"class":a?"comments_row header":"comments_row"}).store("data",b).insert({bottom:new Element("td",{"class":"created",width:"15%"}).update(new Element("small").update(!a?b.created:"Created"))}).insert({bottom:new Element("td",{"class":"creator",width:"15%"}).update(new Element("small").update(!a?b.createdBy.person.fullname:"Who"))}).insert({bottom:new Element("td",{"class":"type",width:"10%"}).update(new Element("small").update(!a?b.type:"Type"))}).insert({bottom:new Element("td",{"class":"comments",width:"auto"}).update(!a?b.comments:"")})},_openOrderPrintPage:function(){var a={};a.me=this;a.newWindow=window.open("/print/purchase/"+a.me._purchaseorder.id+".html?pdf=1",a.me._purchaseorder.status+" PO "+a.me._purchaseorder.purchaseOrderNo,"width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no");a.newWindow.onload=function(){a.newWindow.document.title=a.me._purchaseorder.status+" Order "+a.me._purchaseorder.purchaseOrderNo;a.newWindow.focus();a.newWindow.print();a.newWindow.close()};return a.me},_getItemDiv:function(){var a={};a.me=this;a.me._newDiv=new Element("div").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-6"}).update(a.me._getSupplierInfoPanel())}).insert({bottom:new Element("div",{"class":"col-sm-6"}).update(a.me._getPaymentPanel())})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(a.me._getInvoiceNoPanel())})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(a.me._getPartsTable())})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(a.me._getCommentsPanel())})});a.me._purchaseOrderItems.each(function(b){a.me._addNewProductRow(a.me._newDiv.down(".glyphicon.glyphicon-floppy-saved"),b)});a.me._newDiv.getElementsBySelector(".order-item-row").each(function(b){b.addClassName("order-item-row-old")});return a.me._newDiv},_getInvoiceNoPanel:function(){var a={};a.me=this;a.newDiv=new Element("div",{"class":"panel panel-info"}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("strong").update("Invoice Number(s)")})}).insert({bottom:new Element("table",{"class":"table"}).insert({bottom:a.tr=new Element("tr")})});a.me._purchaseorder.supplierInvoices.each(function(b){a.tr.insert({bottom:new Element("td").update(b)})});return a.newDiv},_getSupplierInfoPanel:function(){var a={};a.me=this;a.supplier=a.me._purchaseorder.supplier;a.purchaseOrder=a.me._purchaseorder;a.newDiv=new Element("div",{"class":"panel panel-info"}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("strong").update("Editing PO "+a.purchaseOrder.purchaseOrderNo+" for "+a.supplier.name+" ")}).insert({bottom:new Element("div",{"class":"pull-right"}).insert({bottom:new Element("strong",{style:"padding-left: 10px"}).update("ETA: ")}).insert({bottom:new Element("input",{style:"max-height:19px","class":"datepicker","save-order":"ETA",type:"date",value:a.purchaseOrder.eta?a.purchaseOrder.eta:""})})}).insert({bottom:new Element("div",{"class":"pull-right"}).insert({bottom:new Element("strong").update("Status: ")}).insert({bottom:a.me._getOrderStatus()})})}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-3"}).update(a.me._getFormGroup("Contact Name",new Element("input",{"save-order":"contactName",type:"text",value:a.supplier.contactName?a.supplier.contactName:""})))}).insert({bottom:new Element("div",{"class":"col-sm-3"}).update(a.me._getFormGroup("Contact Number",new Element("input",{"save-order":"contactNo",type:"value",value:a.supplier.contactNo?a.supplier.contactNo:""})))}).insert({bottom:new Element("div",{"class":"col-sm-3"}).update(a.me._getFormGroup("Contact Email",new Element("input",{"save-order":"contactEmail",type:"email",value:a.supplier.email?a.supplier.email:""})))}).insert({bottom:new Element("div",{"class":"col-sm-3"}).update(a.me._getFormGroup("PO Ref Num",new Element("input",{required:"required","save-order":"supplierRefNum",type:"text",value:a.purchaseOrder.supplierRefNo?a.purchaseOrder.supplierRefNo:""})))})})});return a.newDiv},_loadDataPicker:function(){$$(".datepicker").each(function(a){new Prado.WebUI.TDatePicker({ID:a,InputMode:"TextBox",Format:"yyyy-MM-dd 00:00:00",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,PositionMode:"Bottom",ClassName:"datepicker-layer-fixer"})});return this},_getCommentsPanel:function(){var a={};a.me=this;a.comments=a.me._comments;a.newDiv=new Element("div",{"class":"panel panel-info"}).insert({bottom:new Element("div",{"class":"panel-heading"}).update("Comment History")}).insert({bottom:new Element("div",{"class":"table-responsive"}).insert({bottom:new Element("table",{id:"comments_result_div","class":"table table-hover table-condensed"}).insert({bottom:new Element("thead")}).insert({bottom:new Element("tbody")})})});a.row=a.me._getCommentsRow("",true);a.newDiv.down("#comments_result_div thead").insert({bottom:a.row});a.comments.each(function(b){if(b.comments!==""){a.row=a.me._getCommentsRow(b,false);a.newDiv.down("#comments_result_div tbody").insert({bottom:a.row})}});return a.newDiv},_getOrderStatus:function(){var a={};a.me=this;a.selBox=new Element("select",{"save-order":"status"});a.selBox.insert({bottom:new Element("option").update(a.me._purchaseorder.status)});a.me._statusOptions.each(function(b){if(a.me._purchaseorder.status!==b){a.selBox.insert({bottom:new Element("option").update(b)})}});return a.selBox},_getPaymentPanel:function(){var a={};a.me=this;a.supplier=a.me._supplier;a.totalShippingCost=a.me._purchaseorder.shippingCost?a.me._purchaseorder.shippingCost:0;a.totalHandlingCost=a.me._purchaseorder.handlingCost?a.me._purchaseorder.handlingCost:0;a.totalExcGST=a.me._purchaseorder.totalAmount?a.me._purchaseorder.totalAmount:0;a.totalPaidAmount=a.me._purchaseorder.totalPaid?a.me._purchaseorder.totalPaid:0;a.totalPaymentDue=a.totalExcGST*1+a.totalShippingCost*1+a.totalHandlingCost*1-a.totalPaidAmount*1;a.shippingCostEl=new Element("input",{"class":"text-right",id:"shipping_cost","save-order":"shippingCost",value:a.me._purchaseorder.shippingCost?a.me.getCurrency(a.me._purchaseorder.shippingCost):a.me.getCurrency(0)}).observe("keyup",function(){a.shippingCost=this.value===""?0:a.me.getValueFromCurrency(this.value);if(jQuery.isNumeric(a.shippingCost)){a.totalPaidAmount=a.me.getValueFromCurrency($$('[save-order="totalPaid"]').first().value)*1;a.handlingCost=a.me.getValueFromCurrency($$('[save-order="handlingCost"]').first().value)*1;a.totalExcGST=a.me.getValueFromCurrency($(a.me._htmlIds.totalPriceExcludeGST).innerHTML)*1;a.totalPaymentDue=a.totalExcGST*1+a.shippingCost*1+a.handlingCost*1-a.totalPaidAmount*1;$$(".total-payment-due").each(function(b){a.newEl=new Element("strong",{"class":"label"}).update(a.me.getCurrency(a.totalPaymentDue)+" ");if(a.totalPaymentDue*1>0){a.newEl.addClassName("label-info").writeAttribute("title","Need to pay supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-import"})})}else{if(a.totalPaymentDue*1===0){a.newEl.addClassName("label-success").insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok"})})}else{a.newEl.addClassName("label-danger").writeAttribute("title","Over paid to supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-export"})})}}b.update(a.newEl)})}}).observe("click",function(){$(this).select()});a.handlingCostEl=new Element("input",{"class":"text-right",id:"handling_cost","save-order":"handlingCost",value:a.me._purchaseorder.handlingCost?a.me.getCurrency(a.me._purchaseorder.handlingCost):a.me.getCurrency(0)}).observe("keyup",function(){a.handlingCost=this.value===""?0:a.me.getValueFromCurrency(this.value);if(jQuery.isNumeric(a.handlingCost)){a.totalPaidAmount=a.me.getValueFromCurrency($$('[save-order="totalPaid"]').first().value)*1;a.shippingCost=a.me.getValueFromCurrency($$('[save-order="shippingCost"]').first().value)*1;a.totalExcGST=a.me.getValueFromCurrency($(a.me._htmlIds.totalPriceExcludeGST).innerHTML)*1;a.totalPaymentDue=a.totalExcGST*1+a.shippingCost*1+a.handlingCost*1-a.totalPaidAmount*1;$$(".total-payment-due").each(function(b){a.newEl=new Element("strong",{"class":"label"}).update(a.me.getCurrency(a.totalPaymentDue)+" ");if(a.totalPaymentDue*1>0){a.newEl.addClassName("label-info").writeAttribute("title","Need to pay supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-import"})})}else{if(a.totalPaymentDue*1===0){a.newEl.addClassName("label-success").insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok"})})}else{a.newEl.addClassName("label-danger").writeAttribute("title","Over paid to supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-export"})})}}b.update(a.newEl)})}}).observe("click",function(){$(this).select()});a.totalAmountExGstEl=new Element("input",{"class":"text-right",disabled:"disabled","save-order":"totalAmount"});a.totalPaidEl=new Element("input",{"class":"text-right",id:a.me._htmlIds.totalPaidAmount,"save-order":"totalPaid",value:a.me._purchaseorder.totalPaid?a.me.getCurrency(a.me._purchaseorder.totalPaid):a.me.getCurrency(0)}).observe("keyup",function(){a.totalPaidAmount=this.value===""?0:a.me.getValueFromCurrency(this.value);if(jQuery.isNumeric(a.totalPaidAmount)){a.shippingCost=a.me.getValueFromCurrency($$('[save-order="shippingCost"]').first().value)*1;a.handlingCost=a.me.getValueFromCurrency($$('[save-order="handlingCost"]').first().value)*1;a.totalExcGST=a.me.getValueFromCurrency($(a.me._htmlIds.totalPriceExcludeGST).innerHTML)*1;a.totalPaymentDue=a.totalExcGST*1+a.shippingCost*1+a.handlingCost*1-a.totalPaidAmount*1;$$(".total-payment-due").each(function(b){a.newEl=new Element("strong",{"class":"label"}).update(a.me.getCurrency(a.totalPaymentDue)+" ");if(a.totalPaymentDue*1>0){a.newEl.addClassName("label-info").writeAttribute("title","Need to pay supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-import"})})}else{if(a.totalPaymentDue*1===0){a.newEl.addClassName("label-success").insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok"})})}else{a.newEl.addClassName("label-danger").writeAttribute("title","Over paid to supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-export"})})}}b.update(a.newEl)})}}).observe("click",function(){$(this).select()});a.newDiv=new Element("div",{"class":"panel panel-info",id:a.me._htmlIds.paymentPanel}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("strong").update("Total Payment Due: ")}).insert({bottom:new Element("span",{"class":"pull-right total-payment-due"}).update(a.me.getCurrency(a.totalPaymentDue))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-md-6"}).insert({bottom:new Element("div",{"class":"list-group-item"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-left form-group",style:"margin: 0px;"}).insert({bottom:new Element("lable",{"class":"text-left active"}).update(new Element("span").update("Total Ex GST"))})}).insert({bottom:new Element("div",{"class":"col-xs-6 text-left form-group",style:"margin: 0px;"}).insert({bottom:a.totalAmountExGstEl.addClassName("form-control input-sm col-xs-6")})})})}).insert({bottom:new Element("div",{"class":"list-group-item"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-left form-group",style:"margin: 0px;"}).insert({bottom:new Element("lable",{"class":"text-left active"}).update(new Element("span").update("Total Paid"))})}).insert({bottom:new Element("div",{"class":"col-xs-6 form-group",style:"margin: 0px;"}).insert({bottom:a.totalPaidEl.addClassName("form-control input-sm")})})})})}).insert({bottom:new Element("div",{"class":"col-md-6"}).insert({bottom:new Element("div",{"class":"list-group-item"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-left form-group",style:"margin: 0px;"}).insert({bottom:new Element("lable",{"class":"text-left active"}).update(new Element("span").update("Shipping Cost"))})}).insert({bottom:new Element("div",{"class":"col-xs-6 form-group",style:"margin: 0px;"}).insert({bottom:a.shippingCostEl.addClassName("form-control input-sm")})})})}).insert({bottom:new Element("div",{"class":"list-group-item"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-left form-group",style:"margin: 0px;"}).insert({bottom:new Element("lable",{"class":"text-left active"}).update(new Element("span").update("Handling Cost"))})}).insert({bottom:new Element("div",{"class":"col-xs-6 form-group",style:"margin: 0px;"}).insert({bottom:a.handlingCostEl.addClassName("form-control input-sm")})})})})})});return a.newDiv},_getPartsTable:function(){var a={};a.me=this;a.productListDiv=new Element("table",{"class":"table table-hover table-condensed order_change_details_table"}).insert({bottom:a.me._getProductRow({product:{sku:"SKU",name:"Description"},unitPrice:"Unit Price (Ex)",qtyOrdered:"Qty",totalPrice:"Total Price"},true).wrap(new Element("thead"))});a.productListDiv.insert({bottom:a.tbody=new Element("tbody",{style:"border: 3px #ccc solid;"}).insert({bottom:a.me._getNewProductRow()})});a.productListDiv.insert({bottom:a.tbody=new Element("tfoot").insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:2,rowspan:4}).insert({bottom:a.me._getFormGroup("Comments:",new Element("textarea",{"save-order":"comments",style:"height:33px"}).update(a.me._comment?a.me._comment:""))}).insert({bottom:new Element("div",{colspan:2,"class":"active"}).update(a.me._saveBtns())})}).insert({bottom:new Element("td",{colspan:2,"class":"text-right active"}).update(new Element("strong").update("Total Excl. GST: "))}).insert({bottom:new Element("td",{id:a.me._htmlIds.totalPriceExcludeGST,"class":"active"}).update(a.me.getCurrency(0))}).insert({bottom:new Element("td",{rowspan:4}).update("&nbsp;")})}).insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:2,"class":"text-right active"}).update(new Element("strong").update("Total GST: "))}).insert({bottom:new Element("td",{id:a.me._htmlIds.totalPriceGST,"class":"active"}).update(a.me.getCurrency(0))})}).insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:2,"class":"text-right active"}).update(new Element("strong").update("Total Incl. GST: "))}).insert({bottom:new Element("td",{id:a.me._htmlIds.totalPriceIncludeGST,"class":"active"}).update(a.me.getCurrency(0))})})});return new Element("div",{"class":"panel panel-info"}).insert({bottom:new Element("div",{"class":"panel-body table-responsive"}).insert({bottom:a.productListDiv})})},_getProductRow:function(b,a){var c={};c.me=this;c.isTitle=(a||false);c.tag=(c.isTitle===true?"th":"td");c.row=new Element("tr",{"class":(c.isTitle===true?"":"item_row order-item-row")}).store("data",b).insert({bottom:new Element(c.tag,{"class":"productName"}).insert({bottom:b.product.name})}).insert({bottom:new Element(c.tag,{"class":"uprice col-xs-2"}).insert({bottom:(b.unitPrice)}).observe("keydown",function(d){c.txtBox=this;c.me.keydown(d,function(){$(c.txtBox).up(".item_row").down(".tprice input").value=c.me.getCurrency($(c.txtBox).down("input").value);$(c.txtBox).up(".item_row").down(".glyphicon.glyphicon-floppy-saved").click()});return false})}).insert({bottom:new Element(c.tag,{"class":"qty col-xs-1"}).insert({bottom:(b.receievedQty&&c.me._purchaseorder.status!=="NEW")?(b.receievedQty+"/"+b.qtyOrdered):(b.qtyOrdered)}).observe("keydown",function(d){c.txtBox=this;c.me.keydown(d,function(){$(c.txtBox).up(".item_row").down(".glyphicon.glyphicon-floppy-saved").click()});return false})}).insert({bottom:new Element(c.tag,{"class":"tprice col-xs-1"}).insert({bottom:(b.totalPrice)}).observe("keydown",function(d){c.txtBox=this;c.me.keydown(d,function(){$(c.txtBox).up(".item_row").down(".glyphicon.glyphicon-floppy-saved").click()});return false})}).insert({bottom:new Element(c.tag,{"class":"btns  col-xs-1"}).update(b.btns?b.btns:"")});if(b.product.sku){c.row.insert({top:new Element(c.tag,{"class":"productSku"}).update(b.product.sku)})}else{c.row.down(".productName").writeAttribute("colspan",2)}return c.row},_getNewProductRow:function(){var a={};a.me=this;a.skuAutoComplete=a.me._getNewProductProductAutoComplete();a.data={product:{name:a.skuAutoComplete},unitPrice:a.me._getFormGroup(null,new Element("input",{"class":"input-sm","new-order-item":"unitPrice",required:"Required!",value:a.me.getCurrency(0)}).observe("keyup",function(){a.row=$(this).up(".item_row");a.unitPrice=a.me.getValueFromCurrency($F(this));a.qty=$F(a.row.down("[new-order-item=qtyOrdered]"));$(a.row.down("[new-order-item=totalPrice]")).value=a.me.getCurrency(a.unitPrice*a.qty)}).observe("click",function(){$(this).select()})),qtyOrdered:a.me._getFormGroup(null,new Element("input",{"class":"input-sm","new-order-item":"qtyOrdered",required:"Required!",value:"1"}).observe("keyup",function(){a.row=$(this).up(".item_row");a.unitPrice=a.me.getValueFromCurrency($F(a.row.down("[new-order-item=unitPrice]")));a.qty=$F(this);$(a.row.down("[new-order-item=totalPrice]")).value=a.me.getCurrency(a.unitPrice*a.qty)}).observe("click",function(){$(this).select()})),totalPrice:a.me._getFormGroup(null,new Element("input",{"class":"input-sm",disabled:true,"new-order-item":"totalPrice",required:"Required!",value:a.me.getCurrency(0)}).observe("keyup",function(){a.row=$(this).up(".item_row");a.totalPrice=a.me.getValueFromCurrency($F(this));a.qty=$F(a.row.down("[new-order-item=qtyOrdered]"));$(a.row.down("[new-order-item=unitPrice]")).value=a.me.getCurrency(a.totalPrice/a.qty)}).observe("click",function(){$(this).select()})),btns:new Element("span",{"class":"btn-group btn-group-sm pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-primary"}).insert({bottom:new Element("span",{"class":" glyphicon glyphicon-floppy-saved"})}).observe("click",function(){a.me._addNewProductRow(this)})}).insert({bottom:new Element("span",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-floppy-remove"})}).observe("click",function(){if(!confirm("You about to clear this entry. All input data for this entry will be lost.\n\nContinue?")){return}a.newRow=a.me._getNewProductRow();a.currentRow=$(this).up(".new-order-item-input");a.currentRow.getElementsBySelector(".form-group.has-error .form-control").each(function(b){$(b).retrieve("clearErrFunc")()});a.currentRow.replace(a.newRow);a.newRow.down("[new-order-item=product]").focus()})})};return a.me._getProductRow(a.data,false).addClassName("new-order-item-input info").removeClassName("order-item-row")},_getNewProductProductAutoComplete:function(){var a={};a.me=this;a.skuAutoComplete=a.me._getFormGroup(null,new Element("div",{"class":"input-group input-group-sm product-autocomplete"}).insert({bottom:new Element("input",{"class":"form-control search-txt visible-xs visible-sm visible-md visible-lg","new-order-item":"product",required:"Required!",placeholder:"search SKU, NAME and any BARCODE for this product"}).observe("keydown",function(b){a.txtBox=this;a.me.keydown(b,function(){$(a.txtBox).up(".product-autocomplete").down(".search-btn").click()});a.me.keydown(b,function(){$(a.txtBox).up(".product-autocomplete").down(".search-btn").click()},null,9);return false}).observe("click",function(){$(this).select()})}).insert({bottom:new Element("span",{"class":"input-group-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary search-btn","data-loading-text":"searching..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})}).observe("click",function(){a.me._searchProduct(this)})})}));a.skuAutoComplete.down(".input-group").removeClassName("form-control");return a.skuAutoComplete},_recalculateSummary:function(b){var a={};a.me=this;a.totalIncGSTBox=$(a.me._htmlIds.totalPriceIncludeGST)?$(a.me._htmlIds.totalPriceIncludeGST):a.me._newDiv.down("#"+a.me._htmlIds.totalPriceIncludeGST);a.totalGSTBox=$(a.me._htmlIds.totalPriceGST)?$(a.me._htmlIds.totalPriceGST):a.me._newDiv.down("#"+a.me._htmlIds.totalPriceGST);a.totalExcGSTBox=$(a.me._htmlIds.totalPriceExcludeGST)?$(a.me._htmlIds.totalPriceExcludeGST):a.me._newDiv.down("#"+a.me._htmlIds.totalPriceExcludeGST);a.totalShippingCostBox=$("shipping_cost");a.totalHandlingCostBox=$("handling_cost");a.totalExcGST=a.me.getValueFromCurrency(a.totalExcGSTBox.innerHTML)*1+b*1;a.totalIncGST=a.totalExcGST?(a.totalExcGST*1*1.1):0;a.totalShippingCost=a.totalShippingCostBox?a.me.getValueFromCurrency($F(a.totalShippingCostBox)):a.me._purchaseorder.shippingCost;a.totalHandlingCost=a.totalHandlingCostBox?a.me.getValueFromCurrency($F(a.totalHandlingCostBox)):a.me._purchaseorder.handlingCost;a.totalGST=a.totalExcGST?(a.totalIncGST*1-a.totalExcGST*1):0;a.totalIncGSTBox.update(a.me.getCurrency(a.totalIncGST));a.totalGSTBox.update(a.me.getCurrency(a.totalGST));a.totalExcGSTBox.update(a.me.getCurrency(a.totalExcGST));a.totalPaidAmount=$$(".pull-right.total-payment-due").first()?($(a.me._htmlIds.totalPaidAmount)?a.me.getValueFromCurrency($F(a.me._htmlIds.totalPaidAmount)):0):a.me._purchaseorder.totalPaid;a.totalPaymentDue=a.totalExcGST*1+a.totalShippingCost*1+a.totalHandlingCost*1-a.totalPaidAmount*1;$$(".total-payment-due").each(function(c){a.newEl=new Element("strong",{"class":"label"}).update(a.me.getCurrency(a.totalPaymentDue)+" ");if(a.totalPaymentDue*1>0){a.newEl.addClassName("label-info").writeAttribute("title","Need to pay supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-import"})})}else{if(a.totalPaymentDue*1===0){a.newEl.addClassName("label-success").insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok"})})}else{a.newEl.addClassName("label-danger").writeAttribute("title","Over paid to supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-export"})})}}c.update(a.newEl)});if(!($$(".pull-right.total-payment-due").first())){a.me._newDiv.getElementsBySelector(".total-payment-due").each(function(c){a.newEl=new Element("strong",{"class":"label"}).update(a.me.getCurrency(a.totalPaymentDue)+" ");if(a.totalPaymentDue*1>0){a.newEl.addClassName("label-info").writeAttribute("title","Need to pay supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-import"})})}else{if(a.totalPaymentDue*1===0){a.newEl.addClassName("label-success").insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok"})})}else{a.newEl.addClassName("label-danger").writeAttribute("title","Over paid to supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-export"})})}}c.update(a.newEl)})}if($$("#"+a.me._htmlIds.paymentPanel).first()){$$("#"+a.me._htmlIds.paymentPanel).first().down('[save-order]="totalAmount"[disabled]="disabled"').value=a.me.getCurrency(a.totalExcGST)}else{a.me._newDiv.down('[save-order]="totalAmount"[disabled]="disabled"').value=a.me.getCurrency(a.totalExcGST)}return a.me},_addNewProductRow:function(b,c){var a={};a.me=this;a.currentRow=$(b).up(".new-order-item-input");a.product=(typeof c==="undefined")?a.currentRow.retrieve("product"):c.product;if(!a.product){a.productBox=a.currentRow.down("[new-order-item=product]");if(a.currentRow.down("[new-order-item=product]")){a.me._markFormGroupError(a.productBox,"Select a product first!")}else{a.me.showModalBox("Product Needed","Select a product first!",true)}return}a.unitPriceBox=a.currentRow.down("[new-order-item=unitPrice]");a.unitPrice=(typeof c==="undefined")?a.me.getValueFromCurrency($F(a.unitPriceBox)):c.unitPrice;if((!jQuery.isNumeric(a.unitPrice))&&(a.unitPrice.match(/^\d+(\.\d{1,2})?$/)===null)){a.me._markFormGroupError(a.unitPriceBox,"Invalid value provided!");return}a.qtyOrderedBox=a.currentRow.down("[new-order-item=qtyOrdered]");a.qtyOrdered=(typeof c==="undefined")?a.me.getValueFromCurrency($F(a.qtyOrderedBox)):c.qty;if(a.qtyOrdered.match(/^\d+(\.\d{1,2})?$/)===null){a.me._markFormGroupError(a.qtyOrderedBox,"Invalid value provided!");return}a.receievedQty=(typeof c==="undefined")?"":c.receievedQty;a.totalPriceBox=a.currentRow.down("[new-order-item=totalPrice]");a.totalPrice=(typeof c==="undefined")?a.me.getValueFromCurrency($F(a.totalPriceBox)):c.totalPrice;if((!jQuery.isNumeric(a.totalPrice))&&(a.totalPrice.match(/^\d+(\.\d{1,2})?$/)===null)){a.me._markFormGroupError(a.totalPriceBox,"Invalid value provided!");return}a.currentRow.getElementsBySelector(".form-group.has-error .form-control").each(function(d){$(d).retrieve("clearErrFunc")()});a.data={id:c&&c.id?c.id:"",product:a.product,unitPrice:a.me.getCurrency(a.unitPrice),qtyOrdered:a.qtyOrdered,receievedQty:a.receievedQty,totalPrice:a.me.getCurrency(a.totalPrice),btns:new Element("span",{"class":"pull-right",style:a.me._purchaseorder.status!=="NEW"?"display:none":""}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-xs"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){if(!confirm("You remove this entry.\n\nContinue?")){return}a.row=$(this).up(".item_row");a.me._recalculateSummary(0-a.me.getValueFromCurrency(a.row.retrieve("data").totalPrice)*1);if(a.row.hasClassName("order-item-row-old")){a.row.addClassName("order-item-row-old-removed");a.row.hide()}else{a.row.remove()}})})};a.currentRow.insert({after:a.productRow=a.me._getProductRow(a.data).addClassName("btn-hide-row")});a.me.setProductLink(a.productRow.down(".productSku"),a.product.id);a.newRow=a.me._getNewProductRow();a.currentRow.replace(a.newRow);a.newRow.down("[new-order-item=product]").focus();a.me._recalculateSummary(a.totalPrice);return a.me},setProductLink:function(b,c){var a={};a.me=this;$(b).setStyle("text-decoration: underline; cursor: pointer;").observe("click",function(d){Event.stop(d);a.window=window.open("/product/"+c+".html","_blank");a.window.focus()})},_searchProduct:function(b){var a={};a.me=this;a.btn=b;a.me._signRandID(a.btn);a.searchTxtBox=$(a.btn).up(".product-autocomplete").down(".search-txt");a.searchTxt=$F(a.searchTxtBox);a.me.postAjax(a.me.getCallbackId("searchProduct"),{searchTxt:a.searchTxt,supplierID:a.me._supplier.id},{onLoading:function(){jQuery("#"+a.btn.id).button("loading")},onSuccess:function(c,f){a.resultList=new Element("div",{style:"overflow: auto; max-height: 400px;"});try{a.result=a.me.getResp(f,false,true);if(!a.result||!a.result.items||a.result.items.size()===0){throw"Nothing Found for: "+a.searchTxt}a.me._signRandID(a.searchTxtBox);a.result.items.each(function(e){a.resultList.insert({bottom:a.me._getSearchPrductResultRow(e,a.searchTxtBox)})});a.resultList.addClassName("list-group")}catch(d){a.resultList.update(a.me.getAlertBox("Error: ",d).addClassName("alert-danger"))}a.me.showModalBox("Products that has: "+a.searchTxt,a.resultList,false)},onComplete:function(c,d){jQuery("#"+a.btn.id).button("reset")}});return a.me},_getSearchPrductResultRow:function(c,b){var a={};a.me=this;a.defaultImgSrc="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+";a.newRow=new Element("a",{"class":"list-group-item",href:"javascript: void(0);"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-2"}).insert({bottom:new Element("div",{"class":"thumbnail"}).insert({bottom:new Element("img",{"data-src":"holder.js/100%x64",alert:"Product Image",src:c.images.size()===0?a.defaultImgSrc:c.images[0].asset.url})})})}).insert({bottom:new Element("div",{"class":"col-xs-10"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("strong").update(c.name).insert({bottom:new Element("small",{"class":"btn btn-xs btn-info"}).insert({bottom:new Element("small",{"class":"glyphicon glyphicon-new-window"})})}).observe("click",function(d){Event.stop(d);a.window=window.open("/product/"+c.id+".html","_blank");a.window.focus()}).insert({bottom:new Element("small",{"class":"pull-right"}).update("SKU: "+c.sku)})}).insert({bottom:new Element("div").insert({bottom:new Element("small").update(c.shortDescription)})})}).insert({bottom:new Element("div",{"class":"row",style:(c.minProductPrice||c.lastSupplierPrice||c.minSupplierPrice)?"height: 2px; background-color: brown;":"display:none"}).update("&nbsp;")}).insert({bottom:new Element("div",{"class":"row small"}).insert({bottom:new Element("span",{"class":"btn btn-link btn-xs",style:c.minProductPrice?"":"display:none"}).update("Minimum product price: ").insert({bottom:new Element("strong").update(a.me.getCurrency(c.minProductPrice))}).observe("click",function(d){Event.stop(d);a.me._openPOPage(c.minProductPriceId)})})}).insert({bottom:new Element("div",{"class":"row small"}).insert({bottom:new Element("span",{"class":"btn btn-link btn-xs",style:c.lastSupplierPrice?"":"display:none"}).update("Last supplier price: ").insert({bottom:new Element("strong").update(a.me.getCurrency(c.lastSupplierPrice))}).observe("click",function(d){Event.stop(d);a.me._openPOPage(c.lastSupplierPriceId)})})}).insert({bottom:new Element("div",{"class":"row small"}).insert({bottom:new Element("span",{"class":"btn btn-link btn-xs",style:c.minSupplierPrice?"":"display:none"}).update("Minimum supplier price: ").insert({bottom:new Element("strong").update(a.me.getCurrency(c.minSupplierPrice))}).observe("click",function(d){Event.stop(d);a.me._openPOPage(c.minSupplierPriceId)})})})})}).observe("click",function(){a.inputRow=$(b).up(".new-order-item-input").store("product",c);b.up(".productName").writeAttribute("colspan",false).update(c.sku).setStyle("text-decoration: underline; cursor: pointer;").observe("click",function(d){Event.stop(d);a.window=window.open("/product/"+c.id+".html","_blank");a.window.focus()}).insert({after:new Element("td").update(c.name).insert({bottom:new Element("a",{href:"javascript: void(0);","class":"text-danger pull-right",title:"click to change the product"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){a.newRow=a.me._getNewProductRow();$(this).up(".new-order-item-input").replace(a.newRow);a.newRow.down("[new-order-item=product]").select()})})});jQuery("#"+a.me.modalId).modal("hide");a.inputRow.down("[new-order-item=totalPrice]").writeAttribute("value",a.me.getCurrency(c.minProductPrice));a.inputRow.down("[new-order-item=qtyOrdered]").writeAttribute("value",1);a.inputRow.down("[new-order-item=unitPrice]").writeAttribute("value",a.me.getCurrency(c.minProductPrice)).select()});return a.newRow},_saveBtns:function(){var a={};a.me=this;a.newDiv=new Element("span",{"class":"btn-group pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"saving..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok-circle"})}).insert({bottom:new Element("span").update(" save ")}).observe("click",function(){a.me._submitOrder($(this))})}).insert({bottom:new Element("span",{"class":a.me._purchaseorder.status==="NEW"?"btn btn-info":"hidden","data-loading-text":"saving..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-send"})}).insert({bottom:new Element("span").update(" submit ")}).observe("click",function(){a.selBox=new Element("select",{"save-order":"status"});a.selBox.insert({bottom:new Element("option").update("ORDERED")});a.me._statusOptions.each(function(b){if(a.me._purchaseorder.status!=="ORDERED"){a.selBox.insert({bottom:new Element("option").update(b)})}});$$('select[save-order="status"]').first().replace(a.selBox);a.me._submitOrder($(this),true)})}).insert({bottom:new Element("span",{"class":"btn btn-success"}).insert({bottom:new Element("span",{"class":""}).update("Print Order ")}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-print"})}).observe("click",function(){a.me._openOrderPrintPage()})}).insert({bottom:new Element("span",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove-sign"})}).insert({bottom:new Element("span").update(" cancel ")}).observe("click",function(){a.me.showModalBox('<strong class="text-danger">Cancelling the current order</strong>','<div>You are about to cancel this new order, all input data will be lost.</div><br /><div>Continue?</div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',true)})});a.newDiv=a.newDiv.wrap(new Element("div"));a.newDiv.insert({top:(!(a.me._purchaseorder.id&&(a.me._purchaseorder.status==="ORDERED"||a.me._purchaseorder.status==="RECEIVING"))||a.me._purchaseorder.active!==true)?"":new Element("span",{"class":"btn btn-success",title:"Receiving Items"}).update("Receiving").addClassName("pull-left").observe("click",function(){a.newWindow=window.open("/receiving/"+a.me._purchaseorder.id+".html","PO Details","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no");a.newWindow.focus()})});return a.newDiv},_submitOrder:function(c,b){var a={};a.me=this;a.btn=c;a.isSubmit=(b===true?true:false);a.data=a.me._collectFormData($(a.me._htmlIds.itemDiv),"save-order");if(a.data===null){return a.me}a.data.items=[];$$(".order-item-row").each(function(d){a.item=d.retrieve("data");a.data.items.push({id:a.item.id,productId:a.item.product.id,qtyOrdered:a.item.qtyOrdered,totalPrice:(a.item.totalPrice?a.me.getValueFromCurrency(a.item.totalPrice):""),unitPrice:(a.item.unitPrice?a.me.getValueFromCurrency(a.item.unitPrice):""),active:(!d.hasClassName("order-item-row-old-removed"))})});a.data.id=a.me._purchaseorder.id;a.data.supplierId=a.me._supplier.id;a.data.totalAmount=a.data.totalAmount?a.me.getValueFromCurrency($(a.me._htmlIds.totalPriceIncludeGST).innerHTML):"";a.data.totalPaid=a.data.totalPaid?a.me.getValueFromCurrency(a.data.totalPaid):"";a.data.handlingCost=a.data.handlingCost?a.me.getValueFromCurrency(a.data.handlingCost):"";a.data.shippingCost=a.data.shippingCost?a.me.getValueFromCurrency(a.data.shippingCost):"";a.me._signRandID(a.btn);a.data.isSubmit=a.isSubmit;a.me.postAjax(a.me.getCallbackId("saveOrder"),a.data,{onLoading:function(d,e){jQuery("#"+a.btn.id).button("loading")},onSuccess:function(d,g){try{a.result=a.me.getResp(g,false,true);if(!a.result||!a.result.item){return}a.me._item=a.result.item;a.me.refreshParentWindow();a.me.showModalBox("Success","Saved successfully",false);location.reload()}catch(f){a.me.showModalBox("Error!",f,false)}},onComplete:function(d,e){jQuery("#"+a.btn.id).button("reset")}});return a.me},_openPOPage:function(b){var a={};a.me=this;a.newWindow=window.open("/purchase/"+b+".html","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no");a.newWindow.focus();return a.me},refreshParentWindow:function(){var a={};a.me=this;if(!window.opener){return}a.parentWindow=window.opener;a.row=$(a.parentWindow.document.body).down("#"+a.parentWindow.pageJs.resultDivId+" .item_row[item_id="+a.me._item.id+"]");if(a.row){a.row.replace(a.parentWindow.pageJs._getResultRow(a.me._item))}},_getSummaryDiv:function(b){var a={};a.me=this;a.item=b;a.statusOptionSel=new Element("select",{"class":"","save-item":"status"}).insert({bottom:new Element("option",{value:a.item.status}).update(a.item.status)});a.me._statusOptions.each(function(c){if(c!==a.item.status){a.statusOptionSel.insert({bottom:new Element("option",{value:c}).update(c)})}});a.newDiv=new Element("div",{"class":"panel panel-default purchaseorder-summary"}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("a",{href:"javascript: void(0);",title:"click to show/hide below"}).insert({bottom:new Element("strong").update(a.item.supplier.name?"Editing: "+a.item.supplier.name+" - "+a.item.id:"Creating new purchase order: ")}).insert({bottom:new Element("small",{"class":"pull-right"}).insert({bottom:new Element("label",{"for":"showOnWeb_"+a.item.id}).update("Show on Web?")}).insert({bottom:new Element("input",{id:"showOnWeb_"+a.item.id,style:"margin-left:10px;","save-item":"sellOnWeb",type:"checkbox"})})})}).observe("click",function(){$(this).up(".panel").down(".panel-body").toggle()})}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("strong",{"class":"col-sm-4 pull-left"}).update("Purchase Order Info")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-1 purchaseOrderNo"}).update(a.me._getFormGroup("PO Number",new Element("input",{disabled:"disabled",type:"value",value:a.item.purchaseOrderNo?a.item.purchaseOrderNo:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 purchaseRefNo"}).update(a.me._getFormGroup("PO RefNumber",new Element("input",{"save-item":"purchaseRefNo",type:"value",value:a.item.supplierRefNo?a.item.supplierRefNo:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 status"}).update(a.me._getFormGroup("Status",a.statusOptionSel))}).insert({bottom:new Element("div",{"class":"col-sm-1 active"}).update(a.me._getFormGroup("Active?",new Element("input",{"save-item":"active",type:"checkbox",checked:a.item.active})))}).insert({bottom:new Element("div",{"class":"col-sm-2 orderDate"}).update(a.me._getFormGroup("Ordered Date",new Element("input",{"class":"datepicker","save-item":"orderDate",value:(a.item.orderDate?a.item.orderDate:"")})))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("strong",{"class":"col-sm-4 pull-left"}).update("Supplier Info")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierName"}).update(a.me._getFormGroup("Name",new Element("input",{"save-item":"supplierName",type:"text",value:a.item.supplier.name?a.item.supplier.name:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierId"}).update(a.me._getFormGroup("ID",new Element("input",{"save-item":"supplierId",type:"text",value:a.item.supplier.id?a.item.supplier.id:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierMageId"}).update(a.me._getFormGroup("Mage ID",new Element("input",{"save-item":"supplierMageId",type:"value",value:a.item.supplier.mageId?a.item.supplier.mageId:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierActive"}).update(a.me._getFormGroup("Active?",new Element("input",{"save-item":"supplierActive",type:"checkbox",checked:a.item.supplier.active})))}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierContactName"}).update(a.me._getFormGroup("contactName",new Element("input",{"save-item":"supplierContactName",type:"text",value:a.item.supplierContact?a.item.supplierContact:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierContactNo"}).update(a.me._getFormGroup("Contact No",new Element("input",{"save-item":"supplierContactNo",type:"value",value:a.item.supplierContactNumber?a.item.supplierContactNumber:""})))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("strong",{"class":"col-sm-4 pull-left"}).update("Finance Info")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-1 totalAmount"}).update(a.me._getFormGroup("Total Amount",new Element("input",{"save-item":"totalAmount",type:"value",value:a.item.totalAmount?a.item.totalAmount:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 totalPaid"}).update(a.me._getFormGroup("Total Paid",new Element("input",{style:(a.item.totalAmount-a.item.totalPaid)?"color: red":"","save-item":"totalPaid",type:"value",value:a.item.totalPaid?a.item.totalPaid:""})))})})});return a.newDiv},_getFormGroup:function(b,a){return new Element("div",{"class":"form-group"}).insert({bottom:b?new Element("label",{"class":"control-label"}).update(b):""}).insert({bottom:a.addClassName("form-control")})},bindAllEventNObjects:function(){var a={};a.me=this;return a.me},load:function(){var a={};a.me=this;a.newDiv=a.me._getItemDiv();$(a.me._htmlIds.itemDiv).update(a.newDiv);if(a.me._purchaseorder.status!=="NEW"){$$(".order_change_details_table").first().down(".new-order-item-input ").remove();a.tableHead=$$(".order_change_details_table").first().down("tr");a.tableHead.addClassName("info").setStyle({border:"3px solid #ccc"})}$(a.me._htmlIds.itemDiv).down('input[save-order="contactName"]').focus();$(a.me._htmlIds.itemDiv).down('input[save-order="contactName"]').select();if(a.me._purchaseorder.status==="RECEIVED"||a.me._purchaseorder.status==="CLOSED"){$$("input").each(function(b){b.disabled=true});$$("select").each(function(b){b.disabled=true});if(a.me._purchaseorder.status!=="CLOSED"){$("total-paid-amount").disabled=false;$$('select[save-order="status"]').each(function(b){b.disabled=false})}}return a.me}});