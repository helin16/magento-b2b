var PageJs=new Class.create;PageJs.prototype=Object.extend(new DetailsPageJs,{_htmlIds:{paymentPanel:"payment_panel",itemDiv:"",searchPanel:"search_panel",totalPriceExcludeGST:"total_price_exclude_gst",totalPriceGST:"total_price_gst",totalPriceIncludeGST:"total_price_include_gst",totalPaidAmount:"total-paid-amount",totalShippingCost:"total-shipping-cost"},_supplier:null,_purchaseorder:{},_newDiv:null,setHTMLIDs:function(e){var t={};return t.me=this,t.me._htmlIds.itemDiv=e,t.me},setPreData:function(e){var t={};return t.me=this,t.me._purchaseorder=e,t.me._supplier=e.supplier,t.me},setStatusOptions:function(e){var t={};return t.me=this,t.me._statusOptions=e,t.me},setComment:function(e){var t={};return t.me=this,t.me._comments=e,t.me},setPurchaseOrderItems:function(e){var t={};return t.me=this,t.me._purchaseOrderItems=e,t.me},_getCommentsRow:function(e,t){return new Element("tr",{"class":t?"comments_row header":"comments_row"}).store("data",e).insert({bottom:new Element("td",{"class":"created",width:"15%"}).update(new Element("small").update(t?"Created":e.created))}).insert({bottom:new Element("td",{"class":"creator",width:"15%"}).update(new Element("small").update(t?"Who":e.createdBy.person.fullname))}).insert({bottom:new Element("td",{"class":"type",width:"10%"}).update(new Element("small").update(t?"Type":e.type))}).insert({bottom:new Element("td",{"class":"comments",width:"auto"}).update(t?"":e.comments)})},_openOrderPrintPage:function(){var e={};return e.me=this,e.newWindow=window.open("/print/purchase/"+e.me._purchaseorder.id+".html",e.me._purchaseorder.status+" PO "+e.me._purchaseorder.purchaseOrderNo,"width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),e.newWindow.onload=function(){e.newWindow.document.title=e.me._purchaseorder.status+" Order "+e.me._purchaseorder.purchaseOrderNo,e.newWindow.focus(),e.newWindow.print(),e.newWindow.close()},e.me},_getItemDiv:function(){var e={};return e.me=this,e.me._newDiv=new Element("div").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-6"}).update(e.me._getSupplierInfoPanel())}).insert({bottom:new Element("div",{"class":"col-sm-6"}).update(e.me._getPaymentPanel())})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(e.me._getPartsTable())})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(e.me._getCommentsPanel())})}),e.me._purchaseOrderItems.each(function(t){e.me._addNewProductRow(e.me._newDiv.down(".glyphicon.glyphicon-floppy-saved"),t)}),e.me._newDiv.getElementsBySelector(".order-item-row").each(function(e){e.addClassName("order-item-row-old")}),e.me._newDiv},_getSupplierInfoPanel:function(){var e={};return e.me=this,e.supplier=e.me._purchaseorder.supplier,e.purchaseOrder=e.me._purchaseorder,e.newDiv=new Element("div",{"class":"panel panel-info"}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("strong").update("Editing PO "+e.purchaseOrder.purchaseOrderNo+" for "+e.supplier.name+" ")}).insert({bottom:new Element("div",{"class":"pull-right"}).insert({bottom:new Element("strong",{style:"padding-left: 10px"}).update("ETA: ")}).insert({bottom:new Element("input",{style:"max-height:19px","class":"datepicker","save-order":"ETA",type:"date",value:e.purchaseOrder.eta?e.purchaseOrder.eta:""})})}).insert({bottom:new Element("div",{"class":"pull-right"}).insert({bottom:new Element("strong").update("Status: ")}).insert({bottom:e.me._getOrderStatus()})})}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-3"}).update(e.me._getFormGroup("Contact Name",new Element("input",{"save-order":"contactName",type:"text",value:e.supplier.contactName?e.supplier.contactName:""})))}).insert({bottom:new Element("div",{"class":"col-sm-3"}).update(e.me._getFormGroup("Contact Number",new Element("input",{"save-order":"contactNo",type:"value",value:e.supplier.contactNo?e.supplier.contactNo:""})))}).insert({bottom:new Element("div",{"class":"col-sm-3"}).update(e.me._getFormGroup("Contact Email",new Element("input",{"save-order":"contactEmail",type:"email",value:e.supplier.email?e.supplier.email:""})))}).insert({bottom:new Element("div",{"class":"col-sm-3"}).update(e.me._getFormGroup("PO Ref Num",new Element("input",{required:"required","save-order":"supplierRefNum",type:"text",value:e.purchaseOrder.supplierRefNo?e.purchaseOrder.supplierRefNo:""})))})})}),e.newDiv},_loadDataPicker:function(){return $$(".datepicker").each(function(e){new Prado.WebUI.TDatePicker({ID:e,InputMode:"TextBox",Format:"yyyy-MM-dd 00:00:00",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,PositionMode:"Bottom",ClassName:"datepicker-layer-fixer"})}),this},_getCommentsPanel:function(){var e={};return e.me=this,e.comments=e.me._comments,e.newDiv=new Element("div",{"class":"panel panel-info"}).insert({bottom:new Element("div",{"class":"panel-heading"}).update("Comment History")}).insert({bottom:new Element("div",{"class":"table-responsive"}).insert({bottom:new Element("table",{id:"comments_result_div","class":"table table-hover table-condensed"}).insert({bottom:new Element("thead")}).insert({bottom:new Element("tbody")})})}),e.row=e.me._getCommentsRow("",!0),e.newDiv.down("#comments_result_div thead").insert({bottom:e.row}),e.comments.each(function(t){""!==t.comments&&(e.row=e.me._getCommentsRow(t,!1),e.newDiv.down("#comments_result_div tbody").insert({bottom:e.row}))}),e.newDiv},_getOrderStatus:function(){var e={};return e.me=this,e.selBox=new Element("select",{"save-order":"status"}),e.selBox.insert({bottom:new Element("option").update(e.me._purchaseorder.status)}),e.me._statusOptions.each(function(t){e.me._purchaseorder.status!==t&&e.selBox.insert({bottom:new Element("option").update(t)})}),e.selBox},_getPaymentPanel:function(){var e={};return e.me=this,e.supplier=e.me._supplier,e.totalShippingCost=e.me._purchaseorder.shippingCost?e.me._purchaseorder.shippingCost:0,e.totalHandlingCost=e.me._purchaseorder.handlingCost?e.me._purchaseorder.handlingCost:0,e.totalExcGST=e.me._purchaseorder.totalAmount?e.me._purchaseorder.totalAmount:0,e.totalPaidAmount=e.me._purchaseorder.totalPaid?e.me._purchaseorder.totalPaid:0,e.totalPaymentDue=1*e.totalExcGST+1*e.totalShippingCost+1*e.totalHandlingCost-1*e.totalPaidAmount,e.shippingCostEl=new Element("input",{"class":"text-right",id:"shipping_cost","save-order":"shippingCost",value:e.me.getCurrency(e.me._purchaseorder.shippingCost?e.me._purchaseorder.shippingCost:0)}).observe("keyup",function(){e.shippingCost=""===this.value?0:e.me.getValueFromCurrency(this.value),jQuery.isNumeric(e.shippingCost)&&(e.totalPaidAmount=1*e.me.getValueFromCurrency($$('[save-order="totalPaid"]').first().value),e.handlingCost=1*e.me.getValueFromCurrency($$('[save-order="handlingCost"]').first().value),e.totalExcGST=1*e.me.getValueFromCurrency($(e.me._htmlIds.totalPriceExcludeGST).innerHTML),e.totalPaymentDue=1*e.totalExcGST+1*e.shippingCost+1*e.handlingCost-1*e.totalPaidAmount,$$(".total-payment-due").each(function(t){e.newEl=new Element("strong",{"class":"label"}).update(e.me.getCurrency(e.totalPaymentDue)+" "),1*e.totalPaymentDue>0?e.newEl.addClassName("label-info").writeAttribute("title","Need to pay supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-import"})}):1*e.totalPaymentDue===0?e.newEl.addClassName("label-success").insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok"})}):e.newEl.addClassName("label-danger").writeAttribute("title","Over paid to supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-export"})}),t.update(e.newEl)}))}).observe("click",function(){$(this).select()}),e.handlingCostEl=new Element("input",{"class":"text-right",id:"handling_cost","save-order":"handlingCost",value:e.me.getCurrency(e.me._purchaseorder.handlingCost?e.me._purchaseorder.handlingCost:0)}).observe("keyup",function(){e.handlingCost=""===this.value?0:e.me.getValueFromCurrency(this.value),jQuery.isNumeric(e.handlingCost)&&(e.totalPaidAmount=1*e.me.getValueFromCurrency($$('[save-order="totalPaid"]').first().value),e.shippingCost=1*e.me.getValueFromCurrency($$('[save-order="shippingCost"]').first().value),e.totalExcGST=1*e.me.getValueFromCurrency($(e.me._htmlIds.totalPriceExcludeGST).innerHTML),e.totalPaymentDue=1*e.totalExcGST+1*e.shippingCost+1*e.handlingCost-1*e.totalPaidAmount,$$(".total-payment-due").each(function(t){e.newEl=new Element("strong",{"class":"label"}).update(e.me.getCurrency(e.totalPaymentDue)+" "),1*e.totalPaymentDue>0?e.newEl.addClassName("label-info").writeAttribute("title","Need to pay supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-import"})}):1*e.totalPaymentDue===0?e.newEl.addClassName("label-success").insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok"})}):e.newEl.addClassName("label-danger").writeAttribute("title","Over paid to supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-export"})}),t.update(e.newEl)}))}).observe("click",function(){$(this).select()}),e.totalAmountExGstEl=new Element("input",{"class":"text-right",disabled:"disabled","save-order":"totalAmount"}),e.totalPaidEl=new Element("input",{"class":"text-right",id:e.me._htmlIds.totalPaidAmount,"save-order":"totalPaid",value:e.me.getCurrency(e.me._purchaseorder.totalPaid?e.me._purchaseorder.totalPaid:0)}).observe("keyup",function(){e.totalPaidAmount=""===this.value?0:e.me.getValueFromCurrency(this.value),jQuery.isNumeric(e.totalPaidAmount)&&(e.shippingCost=1*e.me.getValueFromCurrency($$('[save-order="shippingCost"]').first().value),e.handlingCost=1*e.me.getValueFromCurrency($$('[save-order="handlingCost"]').first().value),e.totalExcGST=1*e.me.getValueFromCurrency($(e.me._htmlIds.totalPriceExcludeGST).innerHTML),e.totalPaymentDue=1*e.totalExcGST+1*e.shippingCost+1*e.handlingCost-1*e.totalPaidAmount,$$(".total-payment-due").each(function(t){e.newEl=new Element("strong",{"class":"label"}).update(e.me.getCurrency(e.totalPaymentDue)+" "),1*e.totalPaymentDue>0?e.newEl.addClassName("label-info").writeAttribute("title","Need to pay supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-import"})}):1*e.totalPaymentDue===0?e.newEl.addClassName("label-success").insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok"})}):e.newEl.addClassName("label-danger").writeAttribute("title","Over paid to supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-export"})}),t.update(e.newEl)}))}).observe("click",function(){$(this).select()}),e.newDiv=new Element("div",{"class":"panel panel-info",id:e.me._htmlIds.paymentPanel}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("strong").update("Total Payment Due: ")}).insert({bottom:new Element("span",{"class":"pull-right total-payment-due"}).update(e.me.getCurrency(e.totalPaymentDue))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-md-6"}).insert({bottom:new Element("div",{"class":"list-group-item"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-left form-group",style:"margin: 0px;"}).insert({bottom:new Element("lable",{"class":"text-left active"}).update(new Element("span").update("Total Ex GST"))})}).insert({bottom:new Element("div",{"class":"col-xs-6 text-left form-group",style:"margin: 0px;"}).insert({bottom:e.totalAmountExGstEl.addClassName("form-control input-sm col-xs-6")})})})}).insert({bottom:new Element("div",{"class":"list-group-item"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-left form-group",style:"margin: 0px;"}).insert({bottom:new Element("lable",{"class":"text-left active"}).update(new Element("span").update("Total Paid"))})}).insert({bottom:new Element("div",{"class":"col-xs-6 form-group",style:"margin: 0px;"}).insert({bottom:e.totalPaidEl.addClassName("form-control input-sm")})})})})}).insert({bottom:new Element("div",{"class":"col-md-6"}).insert({bottom:new Element("div",{"class":"list-group-item"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-left form-group",style:"margin: 0px;"}).insert({bottom:new Element("lable",{"class":"text-left active"}).update(new Element("span").update("Shipping Cost"))})}).insert({bottom:new Element("div",{"class":"col-xs-6 form-group",style:"margin: 0px;"}).insert({bottom:e.shippingCostEl.addClassName("form-control input-sm")})})})}).insert({bottom:new Element("div",{"class":"list-group-item"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-left form-group",style:"margin: 0px;"}).insert({bottom:new Element("lable",{"class":"text-left active"}).update(new Element("span").update("Handling Cost"))})}).insert({bottom:new Element("div",{"class":"col-xs-6 form-group",style:"margin: 0px;"}).insert({bottom:e.handlingCostEl.addClassName("form-control input-sm")})})})})})}),e.newDiv},_getPartsTable:function(){var e={};return e.me=this,e.productListDiv=new Element("table",{"class":"table table-hover table-condensed order_change_details_table"}).insert({bottom:e.me._getProductRow({product:{sku:"SKU",name:"Description"},unitPrice:"Unit Price (Ex)",qtyOrdered:"Qty",totalPrice:"Total Price"},!0).wrap(new Element("thead"))}),e.productListDiv.insert({bottom:e.tbody=new Element("tbody",{style:"border: 3px #ccc solid;"}).insert({bottom:e.me._getNewProductRow()})}),e.productListDiv.insert({bottom:e.tbody=new Element("tfoot").insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:2,rowspan:4}).insert({bottom:e.me._getFormGroup("Comments:",new Element("textarea",{"save-order":"comments",style:"height:33px"}).update(e.me._comment?e.me._comment:""))}).insert({bottom:new Element("td",{colspan:2,"class":"text-right active pull-right"}).update(e.me._saveBtns())})}).insert({bottom:new Element("td",{colspan:2,"class":"text-right active"}).update(new Element("strong").update("Total Excl. GST: "))}).insert({bottom:new Element("td",{id:e.me._htmlIds.totalPriceExcludeGST,"class":"active"}).update(e.me.getCurrency(0))}).insert({bottom:new Element("td",{rowspan:4}).update("&nbsp;")})}).insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:2,"class":"text-right active"}).update(new Element("strong").update("Total GST: "))}).insert({bottom:new Element("td",{id:e.me._htmlIds.totalPriceGST,"class":"active"}).update(e.me.getCurrency(0))})}).insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:2,"class":"text-right active"}).update(new Element("strong").update("Total Incl. GST: "))}).insert({bottom:new Element("td",{id:e.me._htmlIds.totalPriceIncludeGST,"class":"active"}).update(e.me.getCurrency(0))})})}),new Element("div",{"class":"panel panel-info"}).insert({bottom:new Element("div",{"class":"panel-body table-responsive"}).insert({bottom:e.productListDiv})})},_getProductRow:function(e,t){var n={};return n.me=this,n.isTitle=t||!1,n.tag=n.isTitle===!0?"th":"td",n.row=new Element("tr",{"class":n.isTitle===!0?"":"item_row order-item-row"}).store("data",e).insert({bottom:new Element(n.tag,{"class":"productName"}).insert({bottom:e.product.name})}).insert({bottom:new Element(n.tag,{"class":"uprice col-xs-2"}).insert({bottom:e.unitPrice}).observe("keydown",function(e){return n.txtBox=this,n.me.keydown(e,function(){$(n.txtBox).up(".item_row").down(".tprice input").value=n.me.getCurrency($(n.txtBox).down("input").value),$(n.txtBox).up(".item_row").down(".glyphicon.glyphicon-floppy-saved").click()}),!1})}).insert({bottom:new Element(n.tag,{"class":"qty col-xs-1"}).insert({bottom:e.receievedQty&&"NEW"!==n.me._purchaseorder.status?e.receievedQty+"/"+e.qtyOrdered:e.qtyOrdered}).observe("keydown",function(e){return n.txtBox=this,n.me.keydown(e,function(){$(n.txtBox).up(".item_row").down(".glyphicon.glyphicon-floppy-saved").click()}),!1})}).insert({bottom:new Element(n.tag,{"class":"tprice col-xs-1"}).insert({bottom:e.totalPrice}).observe("keydown",function(e){return n.txtBox=this,n.me.keydown(e,function(){$(n.txtBox).up(".item_row").down(".glyphicon.glyphicon-floppy-saved").click()}),!1})}).insert({bottom:new Element(n.tag,{"class":"btns  col-xs-1"}).update(e.btns?e.btns:"")}),e.product.sku?n.row.insert({top:new Element(n.tag,{"class":"productSku"}).update(e.product.sku)}):n.row.down(".productName").writeAttribute("colspan",2),n.row},_getNewProductRow:function(){var e={};return e.me=this,e.skuAutoComplete=e.me._getNewProductProductAutoComplete(),e.data={product:{name:e.skuAutoComplete},unitPrice:e.me._getFormGroup(null,new Element("input",{"class":"input-sm","new-order-item":"unitPrice",required:"Required!",value:e.me.getCurrency(0)}).observe("keyup",function(){e.row=$(this).up(".item_row"),e.unitPrice=e.me.getValueFromCurrency($F(this)),e.qty=$F(e.row.down("[new-order-item=qtyOrdered]")),$(e.row.down("[new-order-item=totalPrice]")).value=e.me.getCurrency(e.unitPrice*e.qty)}).observe("click",function(){$(this).select()})),qtyOrdered:e.me._getFormGroup(null,new Element("input",{"class":"input-sm","new-order-item":"qtyOrdered",required:"Required!",value:"1"}).observe("keyup",function(){e.row=$(this).up(".item_row"),e.unitPrice=e.me.getValueFromCurrency($F(e.row.down("[new-order-item=unitPrice]"))),e.qty=$F(this),$(e.row.down("[new-order-item=totalPrice]")).value=e.me.getCurrency(e.unitPrice*e.qty)}).observe("click",function(){$(this).select()})),totalPrice:e.me._getFormGroup(null,new Element("input",{"class":"input-sm",disabled:!0,"new-order-item":"totalPrice",required:"Required!",value:e.me.getCurrency(0)}).observe("keyup",function(){e.row=$(this).up(".item_row"),e.totalPrice=e.me.getValueFromCurrency($F(this)),e.qty=$F(e.row.down("[new-order-item=qtyOrdered]")),$(e.row.down("[new-order-item=unitPrice]")).value=e.me.getCurrency(e.totalPrice/e.qty)}).observe("click",function(){$(this).select()})),btns:new Element("span",{"class":"btn-group btn-group-sm pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-primary"}).insert({bottom:new Element("span",{"class":" glyphicon glyphicon-floppy-saved"})}).observe("click",function(){e.me._addNewProductRow(this)})}).insert({bottom:new Element("span",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-floppy-remove"})}).observe("click",function(){confirm("You about to clear this entry. All input data for this entry will be lost.\n\nContinue?")&&(e.newRow=e.me._getNewProductRow(),e.currentRow=$(this).up(".new-order-item-input"),e.currentRow.getElementsBySelector(".form-group.has-error .form-control").each(function(e){$(e).retrieve("clearErrFunc")()}),e.currentRow.replace(e.newRow),e.newRow.down("[new-order-item=product]").focus())})})},e.me._getProductRow(e.data,!1).addClassName("new-order-item-input info").removeClassName("order-item-row")},_getNewProductProductAutoComplete:function(){var e={};return e.me=this,e.skuAutoComplete=e.me._getFormGroup(null,new Element("div",{"class":"input-group input-group-sm product-autocomplete"}).insert({bottom:new Element("input",{"class":"form-control search-txt visible-xs visible-sm visible-md visible-lg","new-order-item":"product",required:"Required!",placeholder:"search SKU, NAME and any BARCODE for this product"}).observe("keydown",function(t){return e.txtBox=this,e.me.keydown(t,function(){$(e.txtBox).up(".product-autocomplete").down(".search-btn").click()}),e.me.keydown(t,function(){$(e.txtBox).up(".product-autocomplete").down(".search-btn").click()},null,9),!1}).observe("click",function(){$(this).select()})}).insert({bottom:new Element("span",{"class":"input-group-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary search-btn","data-loading-text":"searching..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})}).observe("click",function(){e.me._searchProduct(this)})})})),e.skuAutoComplete.down(".input-group").removeClassName("form-control"),e.skuAutoComplete},_recalculateSummary:function(e){var t={};return t.me=this,t.totalIncGSTBox=$(t.me._htmlIds.totalPriceIncludeGST)?$(t.me._htmlIds.totalPriceIncludeGST):t.me._newDiv.down("#"+t.me._htmlIds.totalPriceIncludeGST),t.totalGSTBox=$(t.me._htmlIds.totalPriceGST)?$(t.me._htmlIds.totalPriceGST):t.me._newDiv.down("#"+t.me._htmlIds.totalPriceGST),t.totalExcGSTBox=$(t.me._htmlIds.totalPriceExcludeGST)?$(t.me._htmlIds.totalPriceExcludeGST):t.me._newDiv.down("#"+t.me._htmlIds.totalPriceExcludeGST),t.totalShippingCostBox=$("shipping_cost"),t.totalHandlingCostBox=$("handling_cost"),t.totalExcGST=1*t.me.getValueFromCurrency(t.totalExcGSTBox.innerHTML)+1*e,t.totalIncGST=t.totalExcGST?1*t.totalExcGST*1.1:0,t.totalShippingCost=t.totalShippingCostBox?t.me.getValueFromCurrency($F(t.totalShippingCostBox)):t.me._purchaseorder.shippingCost,t.totalHandlingCost=t.totalHandlingCostBox?t.me.getValueFromCurrency($F(t.totalHandlingCostBox)):t.me._purchaseorder.handlingCost,t.totalGST=t.totalExcGST?1*t.totalIncGST-1*t.totalExcGST:0,t.totalIncGSTBox.update(t.me.getCurrency(t.totalIncGST)),t.totalGSTBox.update(t.me.getCurrency(t.totalGST)),t.totalExcGSTBox.update(t.me.getCurrency(t.totalExcGST)),t.totalPaidAmount=$$(".pull-right.total-payment-due").first()?$(t.me._htmlIds.totalPaidAmount)?t.me.getValueFromCurrency($F(t.me._htmlIds.totalPaidAmount)):0:t.me._purchaseorder.totalPaid,t.totalPaymentDue=1*t.totalExcGST+1*t.totalShippingCost+1*t.totalHandlingCost-1*t.totalPaidAmount,$$(".total-payment-due").each(function(e){t.newEl=new Element("strong",{"class":"label"}).update(t.me.getCurrency(t.totalPaymentDue)+" "),1*t.totalPaymentDue>0?t.newEl.addClassName("label-info").writeAttribute("title","Need to pay supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-import"})}):1*t.totalPaymentDue===0?t.newEl.addClassName("label-success").insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok"})}):t.newEl.addClassName("label-danger").writeAttribute("title","Over paid to supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-export"})}),e.update(t.newEl)}),$$(".pull-right.total-payment-due").first()||t.me._newDiv.getElementsBySelector(".total-payment-due").each(function(e){t.newEl=new Element("strong",{"class":"label"}).update(t.me.getCurrency(t.totalPaymentDue)+" "),1*t.totalPaymentDue>0?t.newEl.addClassName("label-info").writeAttribute("title","Need to pay supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-import"})}):1*t.totalPaymentDue===0?t.newEl.addClassName("label-success").insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok"})}):t.newEl.addClassName("label-danger").writeAttribute("title","Over paid to supplier").insert({bottom:new Element("span",{"class":" glyphicon glyphicon-export"})}),e.update(t.newEl)}),$$("#"+t.me._htmlIds.paymentPanel).first()?$$("#"+t.me._htmlIds.paymentPanel).first().down('[save-order]="totalAmount"[disabled]="disabled"').value=t.me.getCurrency(t.totalExcGST):t.me._newDiv.down('[save-order]="totalAmount"[disabled]="disabled"').value=t.me.getCurrency(t.totalExcGST),t.me},_addNewProductRow:function(e,t){var n={};return n.me=this,n.currentRow=$(e).up(".new-order-item-input"),n.product="undefined"==typeof t?n.currentRow.retrieve("product"):t.product,n.product?(n.unitPriceBox=n.currentRow.down("[new-order-item=unitPrice]"),n.unitPrice="undefined"==typeof t?n.me.getValueFromCurrency($F(n.unitPriceBox)):t.unitPrice,jQuery.isNumeric(n.unitPrice)||null!==n.unitPrice.match(/^\d+(\.\d{1,2})?$/)?(n.qtyOrderedBox=n.currentRow.down("[new-order-item=qtyOrdered]"),n.qtyOrdered="undefined"==typeof t?n.me.getValueFromCurrency($F(n.qtyOrderedBox)):t.qty,null===n.qtyOrdered.match(/^\d+(\.\d{1,2})?$/)?void n.me._markFormGroupError(n.qtyOrderedBox,"Invalid value provided!"):(n.receievedQty="undefined"==typeof t?"":t.receievedQty,n.totalPriceBox=n.currentRow.down("[new-order-item=totalPrice]"),n.totalPrice="undefined"==typeof t?n.me.getValueFromCurrency($F(n.totalPriceBox)):t.totalPrice,jQuery.isNumeric(n.totalPrice)||null!==n.totalPrice.match(/^\d+(\.\d{1,2})?$/)?(n.currentRow.getElementsBySelector(".form-group.has-error .form-control").each(function(e){$(e).retrieve("clearErrFunc")()}),n.data={product:n.product,unitPrice:n.me.getCurrency(n.unitPrice),qtyOrdered:n.qtyOrdered,receievedQty:n.receievedQty,totalPrice:n.me.getCurrency(n.totalPrice),btns:new Element("span",{"class":"pull-right",style:"NEW"!==n.me._purchaseorder.status?"display:none":""}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-xs"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){confirm("You remove this entry.\n\nContinue?")&&(n.row=$(this).up(".item_row"),n.me._recalculateSummary(0-1*n.me.getValueFromCurrency(n.row.retrieve("data").totalPrice)),n.row.hasClassName("order-item-row-old")?(n.row.addClassName("order-item-row-old-removed"),n.row.hide()):n.row.remove())})})},n.currentRow.insert({after:n.me._getProductRow(n.data).addClassName("btn-hide-row")}),n.newRow=n.me._getNewProductRow(),n.currentRow.replace(n.newRow),n.newRow.down("[new-order-item=product]").focus(),n.me._recalculateSummary(n.totalPrice),n.me):void n.me._markFormGroupError(n.totalPriceBox,"Invalid value provided!"))):void n.me._markFormGroupError(n.unitPriceBox,"Invalid value provided!")):(n.productBox=n.currentRow.down("[new-order-item=product]"),void(n.currentRow.down("[new-order-item=product]")?n.me._markFormGroupError(n.productBox,"Select a product first!"):n.me.showModalBox("Product Needed","Select a product first!",!0)))},_searchProduct:function(e){var t={};return t.me=this,t.btn=e,t.me._signRandID(t.btn),t.searchTxtBox=$(t.btn).up(".product-autocomplete").down(".search-txt"),t.searchTxt=$F(t.searchTxtBox),t.me.postAjax(t.me.getCallbackId("searchProduct"),{searchTxt:t.searchTxt,supplierID:t.me._supplier.id},{onLoading:function(){jQuery("#"+t.btn.id).button("loading")},onSuccess:function(e,n){t.resultList=new Element("div",{style:"overflow: auto; max-height: 400px;"});try{if(t.result=t.me.getResp(n,!1,!0),!t.result||!t.result.items||0===t.result.items.size())throw"Nothing Found for: "+t.searchTxt;t.me._signRandID(t.searchTxtBox),t.result.items.each(function(e){t.resultList.insert({bottom:t.me._getSearchPrductResultRow(e,t.searchTxtBox)})}),t.resultList.addClassName("list-group")}catch(o){t.resultList.update(t.me.getAlertBox("Error: ",o).addClassName("alert-danger"))}t.me.showModalBox("Products that has: "+t.searchTxt,t.resultList,!1)},onComplete:function(){jQuery("#"+t.btn.id).button("reset")}}),t.me},_getSearchPrductResultRow:function(e,t){var n={};return n.me=this,n.defaultImgSrc="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+",n.newRow=new Element("a",{"class":"list-group-item",href:"javascript: void(0);"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-2"}).insert({bottom:new Element("div",{"class":"thumbnail"}).insert({bottom:new Element("img",{"data-src":"holder.js/100%x64",alert:"Product Image",src:0===e.images.size()?n.defaultImgSrc:e.images[0].asset.url})})})}).insert({bottom:new Element("div",{"class":"col-xs-10"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("strong").update(e.name).insert({bottom:new Element("small",{"class":"pull-right"}).update("SKU: "+e.sku)})}).insert({bottom:new Element("div").insert({bottom:new Element("small").update(e.shortDescription)})})}).insert({bottom:new Element("div",{"class":"row",style:e.minProductPrice||e.lastSupplierPrice||e.minSupplierPrice?"height: 2px; background-color: brown;":"display:none"}).update("&nbsp;")}).insert({bottom:new Element("div",{"class":"row small"}).insert({bottom:new Element("span",{"class":"btn btn-link btn-xs",style:e.minProductPrice?"":"display:none"}).update("Minimum product price: ").insert({bottom:new Element("strong").update(n.me.getCurrency(e.minProductPrice))}).observe("click",function(t){Event.stop(t),n.me._openPOPage(e.minProductPriceId)})})}).insert({bottom:new Element("div",{"class":"row small"}).insert({bottom:new Element("span",{"class":"btn btn-link btn-xs",style:e.lastSupplierPrice?"":"display:none"}).update("Last supplier price: ").insert({bottom:new Element("strong").update(n.me.getCurrency(e.lastSupplierPrice))}).observe("click",function(t){Event.stop(t),n.me._openPOPage(e.lastSupplierPriceId)})})}).insert({bottom:new Element("div",{"class":"row small"}).insert({bottom:new Element("span",{"class":"btn btn-link btn-xs",style:e.minSupplierPrice?"":"display:none"}).update("Minimum supplier price: ").insert({bottom:new Element("strong").update(n.me.getCurrency(e.minSupplierPrice))}).observe("click",function(t){Event.stop(t),n.me._openPOPage(e.minSupplierPriceId)})})})})}).observe("click",function(){n.inputRow=$(t).up(".new-order-item-input").store("product",e),t.up(".productName").writeAttribute("colspan",!1).update(e.sku).insert({after:new Element("td").update(e.name).insert({bottom:new Element("a",{href:"javascript: void(0);","class":"text-danger pull-right",title:"click to change the product"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){n.newRow=n.me._getNewProductRow(),$(this).up(".new-order-item-input").replace(n.newRow),n.newRow.down("[new-order-item=product]").select()})})}),jQuery("#"+n.me.modalId).modal("hide"),n.inputRow.down("[new-order-item=totalPrice]").writeAttribute("value",n.me.getCurrency(e.minProductPrice)),n.inputRow.down("[new-order-item=qtyOrdered]").writeAttribute("value",1),n.inputRow.down("[new-order-item=unitPrice]").writeAttribute("value",n.me.getCurrency(e.minProductPrice)).select()}),n.newRow},_saveBtns:function(){var e={};return e.me=this,e.newDiv=new Element("span",{"class":"btn-group"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"saving..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok-circle"})}).insert({bottom:new Element("span").update(" save ")}).observe("click",function(){e.me._submitOrder($(this))})}).insert({bottom:new Element("span",{"class":"NEW"===e.me._purchaseorder.status?"btn btn-info":"hidden","data-loading-text":"saving..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-send"})}).insert({bottom:new Element("span").update(" submit ")}).observe("click",function(){e.selBox=new Element("select",{"save-order":"status"}),e.selBox.insert({bottom:new Element("option").update("ORDERED")}),e.me._statusOptions.each(function(t){"ORDERED"!==e.me._purchaseorder.status&&e.selBox.insert({bottom:new Element("option").update(t)})}),$$('select[save-order="status"]').first().replace(e.selBox),e.me._submitOrder($(this),!0)})}).insert({bottom:new Element("span",{"class":"btn btn-success"}).insert({bottom:new Element("span",{"class":""}).update("Print Order ")}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-print"})}).observe("click",function(){e.me._openOrderPrintPage()})}).insert({bottom:new Element("span",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove-sign"})}).insert({bottom:new Element("span").update(" cancel ")}).observe("click",function(){e.me.showModalBox('<strong class="text-danger">Cancelling the current order</strong>','<div>You are about to cancel this new order, all input data will be lost.</div><br /><div>Continue?</div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',!0)
})}),e.newDiv},_submitOrder:function(e,t){var n={};return n.me=this,n.btn=e,n.isSubmit=t===!0?!0:!1,n.data=n.me._collectFormData($(n.me._htmlIds.itemDiv),"save-order"),null===n.data?n.me:(n.data.newItems=[],n.data.removedOldItems=[],$$(".order-item-row").each(function(e){n.item=e.retrieve("data"),n.item.totalPrice=n.item.totalPrice?n.me.getValueFromCurrency(n.item.totalPrice):"",n.item.unitPrice=n.item.unitPrice?n.me.getValueFromCurrency(n.item.unitPrice):"",e.hasClassName("order-item-row-old order-item-row-old-removed")?n.data.removedOldItems.push(n.item):e.hasClassName("order-item-row-old")||n.data.newItems.push(n.item)}),n.data.id=n.me._purchaseorder.id,n.data.supplier=n.me._supplier,n.data.totalAmount=n.data.totalAmount?n.me.getValueFromCurrency(n.data.totalAmount):"",n.data.totalPaid=n.data.totalPaid?n.me.getValueFromCurrency(n.data.totalPaid):"",n.data.handlingCost=n.data.handlingCost?n.me.getValueFromCurrency(n.data.handlingCost):"",n.data.shippingCost=n.data.shippingCost?n.me.getValueFromCurrency(n.data.shippingCost):"",n.me._signRandID(n.btn),n.data.isSubmit=n.isSubmit,n.me.postAjax(n.me.getCallbackId("saveOrder"),n.data,{onLoading:function(){jQuery("#"+n.btn.id).button("loading")},onSuccess:function(e,t){try{if(n.result=n.me.getResp(t,!1,!0),!n.result||!n.result.item)return;n.me._item=n.result.item,n.me.refreshParentWindow(),n.me.showModalBox("Success","Saved successfully",!1),location.reload()}catch(o){n.me.showModalBox("Error!",o,!1)}},onComplete:function(){jQuery("#"+n.btn.id).button("reset")}}),n.me)},_openPOPage:function(e){var t={};return t.me=this,t.newWindow=window.open("/purchase/"+e+".html","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),t.newWindow.focus(),t.me},refreshParentWindow:function(){var e={};e.me=this,window.opener&&(e.parentWindow=window.opener,e.row=$(e.parentWindow.document.body).down("#"+e.parentWindow.pageJs.resultDivId+" .item_row[item_id="+e.me._item.id+"]"),e.row&&e.row.replace(e.parentWindow.pageJs._getResultRow(e.me._item).addClassName("success")))},_getSummaryDiv:function(e){var t={};return t.me=this,t.item=e,t.statusOptionSel=new Element("select",{"class":"","save-item":"status"}).insert({bottom:new Element("option",{value:t.item.status}).update(t.item.status)}),t.me._statusOptions.each(function(e){e!==t.item.status&&t.statusOptionSel.insert({bottom:new Element("option",{value:e}).update(e)})}),t.newDiv=new Element("div",{"class":"panel panel-default purchaseorder-summary"}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("a",{href:"javascript: void(0);",title:"click to show/hide below"}).insert({bottom:new Element("strong").update(t.item.supplier.name?"Editing: "+t.item.supplier.name+" - "+t.item.id:"Creating new purchase order: ")}).insert({bottom:new Element("small",{"class":"pull-right"}).insert({bottom:new Element("label",{"for":"showOnWeb_"+t.item.id}).update("Show on Web?")}).insert({bottom:new Element("input",{id:"showOnWeb_"+t.item.id,style:"margin-left:10px;","save-item":"sellOnWeb",type:"checkbox"})})})}).observe("click",function(){$(this).up(".panel").down(".panel-body").toggle()})}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("strong",{"class":"col-sm-4 pull-left"}).update("Purchase Order Info")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-1 purchaseOrderNo"}).update(t.me._getFormGroup("PO Number",new Element("input",{disabled:"disabled",type:"value",value:t.item.purchaseOrderNo?t.item.purchaseOrderNo:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 purchaseRefNo"}).update(t.me._getFormGroup("PO RefNumber",new Element("input",{"save-item":"purchaseRefNo",type:"value",value:t.item.supplierRefNo?t.item.supplierRefNo:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 status"}).update(t.me._getFormGroup("Status",t.statusOptionSel))}).insert({bottom:new Element("div",{"class":"col-sm-1 active"}).update(t.me._getFormGroup("Active?",new Element("input",{"save-item":"active",type:"checkbox",checked:t.item.active})))}).insert({bottom:new Element("div",{"class":"col-sm-2 orderDate"}).update(t.me._getFormGroup("Ordered Date",new Element("input",{"class":"datepicker","save-item":"orderDate",value:t.item.orderDate?t.item.orderDate:""})))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("strong",{"class":"col-sm-4 pull-left"}).update("Supplier Info")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierName"}).update(t.me._getFormGroup("Name",new Element("input",{"save-item":"supplierName",type:"text",value:t.item.supplier.name?t.item.supplier.name:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierId"}).update(t.me._getFormGroup("ID",new Element("input",{"save-item":"supplierId",type:"text",value:t.item.supplier.id?t.item.supplier.id:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierMageId"}).update(t.me._getFormGroup("Mage ID",new Element("input",{"save-item":"supplierMageId",type:"value",value:t.item.supplier.mageId?t.item.supplier.mageId:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierActive"}).update(t.me._getFormGroup("Active?",new Element("input",{"save-item":"supplierActive",type:"checkbox",checked:t.item.supplier.active})))}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierContactName"}).update(t.me._getFormGroup("contactName",new Element("input",{"save-item":"supplierContactName",type:"text",value:t.item.supplierContact?t.item.supplierContact:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 supplierContactNo"}).update(t.me._getFormGroup("Contact No",new Element("input",{"save-item":"supplierContactNo",type:"value",value:t.item.supplierContactNumber?t.item.supplierContactNumber:""})))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("strong",{"class":"col-sm-4 pull-left"}).update("Finance Info")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-1 totalAmount"}).update(t.me._getFormGroup("Total Amount",new Element("input",{"save-item":"totalAmount",type:"value",value:t.item.totalAmount?t.item.totalAmount:""})))}).insert({bottom:new Element("div",{"class":"col-sm-1 totalPaid"}).update(t.me._getFormGroup("Total Paid",new Element("input",{style:t.item.totalAmount-t.item.totalPaid?"color: red":"","save-item":"totalPaid",type:"value",value:t.item.totalPaid?t.item.totalPaid:""})))})})}),t.newDiv},_getFormGroup:function(e,t){return new Element("div",{"class":"form-group"}).insert({bottom:e?new Element("label",{"class":"control-label"}).update(e):""}).insert({bottom:t.addClassName("form-control")})},bindAllEventNObjects:function(){var e={};return e.me=this,e.me},load:function(){var e={};return e.me=this,e.newDiv=e.me._getItemDiv(),$(e.me._htmlIds.itemDiv).update(e.newDiv),"NEW"!==e.me._purchaseorder.status&&($$(".order_change_details_table").first().down(".new-order-item-input ").remove(),e.tableHead=$$(".order_change_details_table").first().down("tr"),e.tableHead.addClassName("info").setStyle({border:"3px solid #ccc"})),$(e.me._htmlIds.itemDiv).down('input[save-order="contactName"]').focus(),$(e.me._htmlIds.itemDiv).down('input[save-order="contactName"]').select(),("RECEIVED"===e.me._purchaseorder.status||"CLOSED"===e.me._purchaseorder.status)&&($$("input").each(function(e){e.disabled=!0}),$$("select").each(function(e){e.disabled=!0}),"CLOSED"!==e.me._purchaseorder.status&&($("total-paid-amount").disabled=!1,$$('select[save-order="status"]').each(function(e){e.disabled=!1}))),e.me}});