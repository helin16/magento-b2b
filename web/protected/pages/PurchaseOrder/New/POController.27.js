var POCreateJs=new Class.create;
POCreateJs.prototype=Object.extend(new BPCPageJs,{_htmlIds:{itemDiv:"",searchPanel:"search_panel"},_supplier:null,_item:null,_searchTxtBox:null,_isCredit:!1,_purchaseOrderItems:[],setHTMLIDs:function(a){this._htmlIds.itemDiv=a;return this},setPaymentMethods:function(a){this._paymentMethods=a;return this},setShippingMethods:function(a){this._shippingMethods=a;return this},_getFormGroup:function(a,b){return(new Element("div",{"class":"form-group"})).insert({bottom:a?(new Element("label",{"class":"control-label"})).update(a):
""}).insert({bottom:b.addClassName("form-control")})},_submitOrder:function(a){var b,c,d,e;b=this;c=(new Element("div",{"class":"text-center",style:"margin-top: 100px;"})).insert({bottom:(new Element("h4")).update("Saving PO, please do NOT close the window")}).insert({bottom:new Element("span",{"class":"fa fa-refresh fa-spin fa-5x"})});b.postAjax(b.getCallbackId("saveOrder"),a,{onLoading:function(a,d){b.hideModalBox();$(b._htmlIds.itemDiv).insert({after:c}).hide()},onSuccess:function(a,g){try{(d=
b.getResp(g,!1,!0))&&d.item&&(b._item=d.item,b.refreshParentWindow(),e=(new Element("div")).insert({bottom:(new Element("h4")).update("Yah! Saved Successfully.")}).insert({bottom:(new Element("div")).insert({bottom:(new Element("span",{"class":"btn btn-primary pull-right"})).update("Add Another PO").observe("click",function(){window.location=document.URL})}).insert({bottom:(new Element("a",{"class":"btn btn-info goto-details",href:"/purchase/"+d.item.id+".html"})).update("View the details")})}),b.showModalBox('<strong class="text-success">Success</strong>',
e,!1),jQuery("#"+b.modalId).on("hide.bs.modal",function(a){e.down(".goto-details")&&e.down(".goto-details").click()}))}catch(h){b.showModalBox('<strong class="text-danger">Error:</strong>',h,!1),$(b._htmlIds.itemDiv).show(),c.remove()}},onComplete:function(a,d){$(b._htmlIds.itemDiv).show();c.remove()}});return b},refreshParentWindow:function(){var a,b;window.opener&&(a=window.opener,(b=$(a.document.body).down("table#item-list tbody"))&&$(a.document.body).down("table#item-list tbody").insert({top:a.pageJs._getResultRow(this._item).addClassName("success")}))},
_confirmSubmit:function(a){var b,c,d,e;b=this;c={};c.submitToSupplier=!0===a?!0:!1;a=b._collectFormData($(b._htmlIds.itemDiv),"save-order");if(null===a)return b;c.items=[];$$(".order-item-row").each(function(a){d=a.retrieve("data");d.totalPrice=d.totalPrice?b.getValueFromCurrency(d.totalPrice):"0";d.unitPrice=d.unitPrice?b.getValueFromCurrency(d.unitPrice):"0";c.items.push({productId:d.product.id,qtyOrdered:d.qtyOrdered,totalPrice:d.totalPrice,unitPrice:d.unitPrice})});if(0>=c.items.size())return b.showModalBox('<strong class="text-danger">Error</strong>',
"At least one order item is needed!",!0),b;c.supplier={};c.supplier.id=b._supplier.id;c.supplier.contactName=a.contactName?a.contactName:b._supplier.contactName;c.supplier.contactNo=a.contactNo?a.contactNo:b._supplier.contactNo;c.supplier.email=a.contactEmail?a.contactEmail:b._supplier.email;c.supplierRefNum=a.supplierRefNum;c.eta=a.ETA.strip();c.comments=a.comments.strip();c.shippingCost=a.shippingCost?b.getValueFromCurrency(a.shippingCost):0;c.handlingCost=a.handlingCost?b.getValueFromCurrency(a.handlingCost):
0;c.totalPaymentDue=a.totalPaymentDue?b.getValueFromCurrency(a.totalPaymentDue):0;!0===b._isCredit&&(c.type="CREDIT",b._po&&jQuery.isNumeric(b._po.id)&&(c.po=b._po));!0===c.submitToSupplier?(a=(new Element("div",{"class":"confirm-div"})).insert({bottom:(new Element("div")).insert({bottom:b._getFormGroup("Do you want to send an email to this address:",new Element("input",{value:c.supplier.email,"confirm-po":"po_email",required:!0,placeholder:"The email to send to. WIll NOT update the supplier's email with this."}))})}).insert({bottom:(new Element("div")).insert({bottom:(new Element("em")).insert({bottom:(new Element("small")).update("The above email will be used to send the email to. WIll NOT update the supplier's email with this.")})})}).insert({bottom:(new Element("div")).insert({bottom:(new Element("span",
{"class":"btn btn-primary pull-right"})).update("Yes, send the PO to this email address").observe("click",function(){e=$(this).up(".confirm-div").down('[confirm-po="po_email"]');$F(e).blank()?b._markFormGroupError(e,"Email Address Required Here"):/^.+@.+(\..)*$/.test($F(e).strip())?(c.confirmEmail=$F(e).strip(),b._submitOrder(c)):b._markFormGroupError(e,"Please provide an valid email address")})}).insert({bottom:(new Element("span",{"class":"btn btn-info"})).update("No, push PO status but DO NOT send email").observe("click",
function(){b._submitOrder(c)})})}),b.showModalBox('<strong class="text-info">Confirm</strong>',a,!1)):b._submitOrder(c);return b},_saveBtns:function(){var a;a=this;return(new Element("div")).insert({bottom:(new Element("span",{"class":"btn btn-default"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove-sign"})}).insert({bottom:(new Element("span")).update(" cancel ")}).observe("click",function(){a.showModalBox('<strong class="text-danger">Cancelling the current order</strong>',
'<div>You are about to cancel this new order, all input data will be lost.</div><br /><div>Continue?</div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',!0)})}).insert({bottom:(new Element("span",{"class":"btn-group pull-right visible-xs visible-sm visible-md visible-lg"})).insert({bottom:(new Element("span",
{"class":"btn btn-primary"})).insert({bottom:(new Element("span")).update("save & submit")}).observe("click",function(){a._confirmSubmit(!0)})}).insert({bottom:(new Element("span",{"class":"btn btn-primary dropdown-toggle","data-toggle":"dropdown"})).insert({bottom:new Element("span",{"class":"caret"})})}).insert({bottom:(new Element("ul",{"class":"dropdown-menu save-btn-dropdown-menu"})).insert({bottom:(new Element("li")).insert({bottom:(new Element("a",{href:"javascript: void(0);"})).update("Save Only").observe("click",
function(){a._confirmSubmit()})})})})})},_getSupplierInfoPanel:function(){var a;a=this._supplier;return(new Element("div",{"class":"panel"})).addClassName(!0===this._isCredit?"panel-danger":"panel-info").insert({bottom:(new Element("div",{"class":"panel-heading"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-4"})).insert({bottom:(new Element("strong",{"class":"creatingFor"})).update("Creating "+(!0===this._ifCredit?"PO Credit":"PO")+" for: "+
a.name+" ")}).insert({bottom:(new Element("strong",{"class":"creatingFor"})).update(this._po&&jQuery.isNumeric(this._po.id)?' for Purchase Order <a target="_blank" href="/purchase/'+this._po.id+'">'+this._po.purchaseOrderNo+"</a>":"")})}).insert({bottom:(new Element("div",{"class":"col-sm-8 text-right"})).insert({bottom:(new Element("div",{"class":"col-sm-8 text-right"})).insert({bottom:(new Element("span")).insert({bottom:(new Element("strong",{style:"padding-left: 10px"})).update("ETA: ")}).insert({bottom:new Element("input",
{style:"max-height:19px","class":"datepicker","save-order":"ETA",type:"date",value:""})})})}).insert({bottom:(new Element("div",{"class":"col-sm-4"})).insert({bottom:(new Element("strong")).update("Total Due: ")}).insert({bottom:(new Element("span",{"class":"badge total-payment-due"})).update(this.getCurrency(0))}).insert({bottom:new Element("input",{type:"hidden","class":"total-payment-due","save-order":"totalPaymentDue",value:this.getCurrency(0)})})})})})}).insert({bottom:(new Element("div",{"class":"panel-body"})).insert({bottom:(new Element("div",
{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-3"})).update(this._getFormGroup("Contact Name",new Element("input",{"save-order":"contactName",placeholder:"The name of the contact person",type:"text",value:a.contactName?a.contactName:""})))}).insert({bottom:(new Element("div",{"class":"col-sm-3"})).update(this._getFormGroup("Contact Number",new Element("input",{"save-order":"contactNo",placeholder:"The contact number of the sales person",value:a.contactNo?a.contactNo:""})))}).insert({bottom:(new Element("div",
{"class":"col-sm-3"})).update(this._getFormGroup("Contact Email",new Element("input",{"save-order":"contactEmail",placeholder:"The email of the supplier",type:"email",value:a.email?a.email:""})))}).insert({bottom:(new Element("div",{"class":"col-sm-3"})).update(this._getFormGroup("PO Ref Num",new Element("input",{required:"required",placeholder:"The supplier invoice number / PO reference number","save-order":"supplierRefNum",type:"text",value:""})))})})})},_loadDataPicker:function(){$$(".datepicker").each(function(a){new Prado.WebUI.TDatePicker({ID:a,
InputMode:"TextBox",Format:"yyyy-MM-dd 00:00:00",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,PositionMode:"Bottom",ClassName:"datepicker-layer-fixer"})});return this},_getProductRow:function(a,b){var c,d,e,f;c=this;d=b||!1;e=!0===d?"th":"td";d=(new Element("tr",{"class":!0===d?"":"item_row order-item-row"})).store("data",a).insert({bottom:(new Element(e,{"class":"productName"})).insert({bottom:a.product.name})}).insert({bottom:(new Element(e,{"class":"uprice col-xs-2"})).insert({bottom:a.unitPrice}).observe("keydown",
function(a){f=this;c.keydown(a,function(){$(f).up(".item_row").down(".tprice input").value=c.getCurrency($(f).down("input").value);$(f).up(".item_row").down(".glyphicon.glyphicon-floppy-saved").click()});return!1})}).insert({bottom:(new Element(e,{"class":"qty col-xs-1"})).insert({bottom:a.qtyOrdered}).observe("keydown",function(a){f=this;c.keydown(a,function(){$(f).up(".item_row").down(".glyphicon.glyphicon-floppy-saved").click()});return!1})}).insert({bottom:(new Element(e,{"class":"tprice col-xs-1"})).insert({bottom:a.totalPrice}).observe("keydown",
function(a){f=this;c.keydown(a,function(){$(f).up(".item_row").down(".glyphicon.glyphicon-floppy-saved").click()});return!1})}).insert({bottom:(new Element(e,{"class":"btns  col-xs-1"})).update(a.btns?a.btns:"")});a.product.sku?d.insert({top:(new Element(e,{"class":"productSku"})).update(a.product.sku)}):d.down(".productName").writeAttribute("colspan",2);return d},_getSearchPrductResultRow:function(a,b){var c,d,e;c=this;return d=(new Element("a",{"class":"list-group-item search-product-result-row",
href:"javascript: void(0);"})).store("data",a).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-2"})).insert({bottom:(new Element("div",{"class":"thumbnail"})).insert({bottom:new Element("img",{"data-src":"holder.js/100%x64",alert:"Product Image",src:0===a.images.size()?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+":
a.images[0].asset.url})})})}).insert({bottom:(new Element("div",{"class":"col-xs-10"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("strong")).update(a.name).insert({bottom:(new Element("small",{"class":"",style:"padding-left: 10px;"})).update("SKU: "+a.sku)})}).insert({bottom:(new Element("small",{"class":"btn btn-xs btn-info"})).insert({bottom:new Element("small",{"class":"glyphicon glyphicon-new-window"})}).observe("click",function(a){Event.stop(a);($productId=
$(this).up(".search-product-result-row").retrieve("data").id)&&c._openProductDetailPage($productId)})}).insert({bottom:(new Element("div")).insert({bottom:(new Element("small")).update(a.shortDescription)})})}).insert({bottom:(new Element("div",{"class":"row",style:a.minProductPrice||a.lastSupplierPrice||a.minSupplierPrice?"height: 2px; background-color: brown;":"display:none"})).update("&nbsp;")}).insert({bottom:(new Element("div",{"class":"row small"})).insert({bottom:(new Element("span",{"class":"col-xs-4 btn btn-link btn-xs",
style:a.minProductPrice?"text-align: left":"display:none"})).update("Minimum product price: ").insert({bottom:(new Element("strong")).update(c.getCurrency(a.minProductPrice))})}).observe("click",function(b){Event.stop(b);c._openPOPage(a.minProductPriceId)}).insert({bottom:(new Element("span",{"class":"col-xs-4 btn btn-link btn-xs",style:a.lastSupplierPrice?"text-align: left":"display:none"})).update("Last supplier price: ").insert({bottom:(new Element("strong")).update(c.getCurrency(a.lastSupplierPrice))})}).observe("click",
function(b){Event.stop(b);c._openPOPage(a.lastSupplierPriceId)}).insert({bottom:(new Element("span",{"class":"col-xs-4 btn btn-link btn-xs",style:a.minSupplierPrice?"text-align: left":"display:none"})).update("Minimum supplier price: ").insert({bottom:(new Element("strong")).update(c.getCurrency(a.minSupplierPrice))})}).observe("click",function(b){Event.stop(b);c._openPOPage(a.minSupplierPriceId)})})})}).observe("click",function(){e=$(b).up(".new-order-item-input").store("product",a);b.up(".productName").writeAttribute("colspan",
!1).update(a.sku).insert({bottom:(new Element("small",{"class":"btn btn-xs btn-info"})).insert({bottom:new Element("small",{"class":"glyphicon glyphicon-new-window"})}).observe("click",function(b){Event.stop(b);($productId=a.id)&&c._openProductDetailPage($productId)})}).insert({after:(new Element("td")).update(a.name).insert({bottom:(new Element("a",{href:"javascript: void(0);","class":"text-danger pull-right",title:"click to change the product"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",
function(){d=c._getNewProductRow();$(this).up(".new-order-item-input").replace(d);d.down("[new-order-item=product]").select()})})});jQuery("#"+c.modalId).modal("hide");e.down("[new-order-item=totalPrice]").writeAttribute("value",c.getCurrency(a.minProductPrice));e.down("[new-order-item=qtyOrdered]").writeAttribute("value",1);e.down("[new-order-item=unitPrice]").writeAttribute("value",c.getCurrency(a.minProductPrice)).select()})},_openPOPage:function(a){window.open("/purchase/"+a+".html","Product Details",
"width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no").focus();return this},_openNewProductPage:function(a){var b;b=window.open("/product/new.html?btnidnewpo="+a,"New Product Page","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no");b.onload=function(){b.document.title="New Product Page";b.focus()};return this},_searchProduct:function(a,b,c){var d,e,f,g,h,k,l,n,m;d=this;e=!0===$(a).retrieve("showMore")?
!0:!1;f=b||1;d._signRandID(a);g=$(a).up(".product-autocomplete")&&$(a).up(".product-autocomplete").down(".search-txt")?$(a).up(".product-autocomplete").down(".search-txt"):$($(a).retrieve("searchBoxId"));h=$F(g);d.postAjax(d.getCallbackId("searchProduct"),{searchTxt:h,supplierID:d._supplier.id,pageNo:f},{onLoading:function(){jQuery("#"+a.id).button("loading")},onSuccess:function(b,p){k=!1===e?new Element("div",{"class":"search-product-list"}):$(a).up(".search-product-list");try{l=d.getResp(p,!1,!0);
if(!l||!l.items||0===l.items.size())throw(new Element("span")).insert({bottom:(new Element("span")).update("Nothing Found for: "+h)}).insert({bottom:(new Element("span",{"class":"btn btn-success btn-xs pull-right"})).insert({bottom:new Element("i",{"class":"fa fa-plus",title:"add new product"})}).observe("click",function(a){n=$(this);d._signRandID(n);d._openNewProductPage(n.id)})});d._signRandID(g);d._searchTxtBox=g;l.items.each(function(a){k.insert({bottom:d._getSearchPrductResultRow(a,g)})});"function"===
typeof c&&c();l.pagination.pageNumber<l.pagination.totalPages&&k.insert({bottom:(new Element("a",{"class":"item-group-item"})).insert({bottom:(new Element("span",{"class":"btn btn-primary","data-loading-text":"Getting more ..."})).update("Show Me More")}).observe("click",function(){m=$(this);$(m).store("searchBoxId",g.id);$(m).store("showMore",!0);d._searchProduct(this,1*f+1,function(){$(m).remove()})})});k.addClassName("list-group")}catch(q){k.update(d.getAlertBox("Error: ",q).addClassName("alert-danger"))}!1===
e&&d.showModalBox("Products that has: "+h,k,!1)},onComplete:function(b,c){jQuery("#"+a.id).button("reset")}});return d},_openProductDetailPage:function(a){window.open("/products/"+a+".html","Product Details","width=1920, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no").focus();return this},_getNewProductProductAutoComplete:function(){var a,b,c;a=this;b=a._getFormGroup(null,(new Element("div",{"class":"input-group input-group-sm product-autocomplete"})).insert({bottom:(new Element("input",
{"class":"form-control search-txt visible-xs visible-sm visible-md visible-lg","new-order-item":"product",required:"Required!",placeholder:"search SKU, NAME and any BARCODE for this product"})).observe("keydown",function(b){c=this;a.keydown(b,function(){$(c).up(".product-autocomplete").down(".search-btn").click()});a.keydown(b,function(){$(c).up(".product-autocomplete").down(".search-btn").click()},null,9);return!1}).observe("click",function(){$(this).select()})}).insert({bottom:(new Element("span",
{"class":"input-group-btn"})).insert({bottom:(new Element("span",{"class":" btn btn-primary search-btn","data-loading-text":"searching..."})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})}).observe("click",function(){a._searchProduct(this)})})}));b.down(".input-group").removeClassName("form-control");return b},_recalculateSummary:function(){var a,b,c,d,e,f;a=this;b=0;$$(".item_row.order-item-row").each(function(d){c=d.retrieve("data");b=1*b+1*a.getValueFromCurrency(c.totalPrice)});
jQuery('[save-order-summary="totalExGST"]').val(a.getCurrency(b)).html(a.getCurrency(b));d=.1*b;jQuery('[save-order-summary="totalGST"]').val(a.getCurrency(d)).html(a.getCurrency(d));d=1*b+1*d;jQuery('[save-order-summary="totalInGST"]').val(a.getCurrency(d)).html(a.getCurrency(d));e=0;0<jQuery('[save-order-summary="shippingCost"]').length&&(e=a.getValueFromCurrency(jQuery('[save-order-summary="shippingCost"]').val()));f=0;0<jQuery('[save-order-summary="handlingCost"]').length&&(f=a.getValueFromCurrency(jQuery('[save-order-summary="handlingCost"]').val()));
d=1*d+1*e+1*f;jQuery(".total-payment-due").val(a.getCurrency(d)).html(a.getCurrency(d));return a},_addNewProductRow:function(a,b){var c,d,e,f,g,h,k;c=this;d=$(a).up(".new-order-item-input");if(e="undefined"===typeof b?d.retrieve("product"):b.product)if(f=d.down("[new-order-item=unitPrice]"),g="undefined"===typeof b?c.getValueFromCurrency($F(f)):b.unitPrice,jQuery.isNumeric(g)||null!==g.match(/^\d+(\.\d{1,2})?$/))if(f=d.down("[new-order-item=qtyOrdered]"),h="undefined"===typeof b?c.getValueFromCurrency($F(f)):
b.qty,null===h.match(/^(-)?\d+(\.\d{1,2})?$/))c._markFormGroupError(f,"Invalid value provided!");else return f=c.getValueFromCurrency(g)*h,d.getElementsBySelector(".form-group.has-error .form-control").each(function(a){$(a).retrieve("clearErrFunc")()}),g={id:b&&b.id?b.id:"",product:e,unitPrice:c.getCurrency(g),qtyOrdered:h,totalPrice:c.getCurrency(f),btns:(new Element("span",{"class":"pull-right"})).insert({bottom:(new Element("span",{"class":"btn btn-danger btn-xs"})).insert({bottom:new Element("span",
{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){confirm("You remove this entry.\n\nContinue?")&&(k=$(this).up(".item_row"),c._recalculateSummary(),k.remove())})})},d.insert({after:g=c._getProductRow(g).addClassName("btn-hide-row")}),c.setProductLink(g.down(".productSku"),e.id),e=c._getNewProductRow(),d.replace(e),e.down("[new-order-item=product]").focus(),e.down("[new-order-item=product]").select(),c._recalculateSummary(f),c;else c._markFormGroupError(f,"Invalid value provided!");
else e=d.down("[new-order-item=product]"),d.down("[new-order-item=product]")?c._markFormGroupError(e,"Select a product first!"):c.showModalBox("Product Needed","Select a product first!",!0)},setProductLink:function(a,b){var c;$(a).setStyle("text-decoration: underline; cursor: pointer;").observe("click",function(a){Event.stop(a);c=window.open("/product/"+b+".html","_blank");c.focus()})},_getNewProductRow:function(){var a,b,c,d,e,f,g,h;a=this;b={product:{name:a._getNewProductProductAutoComplete()},
unitPrice:a._getFormGroup(null,(new Element("input",{"class":"input-sm","new-order-item":"unitPrice",required:"Required!",value:a.getCurrency(0)})).observe("keyup",function(){c=$(this).up(".item_row");d=a.getValueFromCurrency($F(this));e=$F(c.down("[new-order-item=qtyOrdered]"));$(c.down("[new-order-item=totalPrice]")).value=a.getCurrency(d*e)}).observe("click",function(a){$(this).select()})),qtyOrdered:a._getFormGroup(null,(new Element("input",{"class":"input-sm","new-order-item":"qtyOrdered",required:"Required!",
value:"1"})).observe("keyup",function(){c=$(this).up(".item_row");d=a.getValueFromCurrency($F(c.down("[new-order-item=unitPrice]")));e=$F(this);$(c.down("[new-order-item=totalPrice]")).value=a.getCurrency(d*e)}).observe("click",function(a){$(this).select()})),totalPrice:a._getFormGroup(null,(new Element("input",{"class":"input-sm",disabled:!0,"new-order-item":"totalPrice",required:"Required!",value:a.getCurrency(0)})).observe("keyup",function(){c=$(this).up(".item_row");f=a.getValueFromCurrency($F(this));
e=$F(c.down("[new-order-item=qtyOrdered]"));$(c.down("[new-order-item=unitPrice]")).value=a.getCurrency(f/e)}).observe("click",function(a){$(this).select()})),btns:(new Element("span",{"class":"btn-group btn-group-sm pull-right new-order-item-btn"})).insert({bottom:(new Element("span",{"class":"btn btn-primary"})).insert({bottom:new Element("span",{"class":" glyphicon glyphicon-floppy-saved"})}).observe("click",function(){a._addNewProductRow(this)})}).insert({bottom:(new Element("span",{"class":"btn btn-default"})).insert({bottom:new Element("span",
{"class":"glyphicon glyphicon-floppy-remove"})}).observe("click",function(){confirm("You about to clear this entry. All input data for this entry will be lost.\n\nContinue?")&&(g=a._getNewProductRow(),h=$(this).up(".new-order-item-input"),h.getElementsBySelector(".form-group.has-error .form-control").each(function(a){$(a).retrieve("clearErrFunc")()}),h.replace(g),g.down("[new-order-item=product]").focus(),g.down("[new-order-item=product]").select())})})};return a._getProductRow(b,!1).addClassName("new-order-item-input").addClassName(!0===
a._isCredit?"danger":"info").removeClassName("order-item-row")},_getPartsTable:function(){var a,b;a=this;b=(new Element("table",{"class":"table table-hover table-condensed order_change_details_table"})).insert({bottom:a._getProductRow({product:{sku:"SKU",name:"Description"},unitPrice:"Unit Price (Ex GST)",qtyOrdered:"Qty",totalPrice:"Total Price (Ex GST)"},!0).wrap(new Element("thead"))});b.insert({bottom:(new Element("tbody",{style:"border: 3px #ccc solid;"})).insert({bottom:a._getNewProductRow()})});
b.insert({bottom:(new Element("tfoot")).insert({bottom:(new Element("tr")).insert({bottom:(new Element("td",{colspan:2,rowspan:6})).insert({bottom:a._getFormGroup("Comments:",new Element("textarea",{"save-order":"comments",rows:8}))})}).insert({bottom:(new Element("td",{colspan:2,"class":"text-right active"})).update((new Element("span")).update("Total Excl. GST: "))}).insert({bottom:(new Element("td",{"save-order-summary":"totalExGST","class":"active"})).update(a.getCurrency(0))})}).insert({bottom:(new Element("tr")).insert({bottom:(new Element("td",
{colspan:2,"class":"text-right active",style:"border-bottom: 1px solid brown"})).update((new Element("span")).update("Total GST: "))}).insert({bottom:(new Element("td",{"save-order-summary":"totalGST","class":"active",style:"border-bottom: 1px solid brown"})).update(a.getCurrency(0))})}).insert({bottom:(new Element("tr")).insert({bottom:(new Element("td",{colspan:2,"class":"text-right active"})).update((new Element("strong")).update("SubTotal Incl. GST: "))}).insert({bottom:(new Element("td",{"save-order-summary":"totalInGST",
"class":"active"})).update(a.getCurrency(0))})}).insert({bottom:(new Element("tr")).insert({bottom:(new Element("td",{colspan:2,"class":"text-right active"})).update((new Element("span")).update("Shipping Cost Incl. GST: "))}).insert({bottom:(new Element("td",{"class":"active"})).update((new Element("input",{"save-order":"shippingCost","save-order-summary":"shippingCost",placeholder:a.getCurrency(0)})).observe("change",function(){a._recalculateSummary()}))})}).insert({bottom:(new Element("tr")).insert({bottom:(new Element("td",
{colspan:2,"class":"text-right active",style:"border-bottom: 1px solid brown"})).update((new Element("span")).update("Handling Cost  Incl. GST: "))}).insert({bottom:(new Element("td",{"class":"active",style:"border-bottom: 1px solid brown"})).update((new Element("input",{"save-order":"handlingCost","save-order-summary":"handlingCost",placeholder:a.getCurrency(0)})).observe("change",function(){a._recalculateSummary()}))})}).insert({bottom:(new Element("tr")).insert({bottom:(new Element("td",{colspan:2,
"class":"text-right active"})).update((new Element("h4")).update("Total Due: "))}).insert({bottom:(new Element("td",{"class":"active"})).update((new Element("h4",{"save-order-summary":"totalPaymentDue","class":"total-payment-due"})).update(a.getCurrency(0)))})})});return(new Element("div",{"class":"panel"})).addClassName(!0===a._isCredit?"panel-danger":"panel-info").insert({bottom:(new Element("div",{"class":"panel-body table-responsive"})).insert({bottom:b})})},_getViewOfPurchaseOrder:function(){return(new Element("div")).insert({bottom:(new Element("div",
{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-12"})).update(this._getSupplierInfoPanel())})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-12"})).update(this._getPartsTable())})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-12"})).update(this._saveBtns())})})},selectSupplier:function(a){this._supplier=a;a=this._getViewOfPurchaseOrder();$(this._htmlIds.itemDiv).update(a);
a.down('input[save-order="contactName"]').focus();a.down('input[save-order="contactName"]').select();this._loadDataPicker();return this},_getSupplierRow:function(a,b){var c,d,e;c=this;d=b||!1;e=!0===d?"th":"td";return(new Element("tr",{"class":(!0===d?"item_top_row":"btn-hide-row item_row")+(0==a.active?" danger":""),item_id:!0===d?"":a.id})).store("data",a).insert({bottom:(new Element(e)).insert({bottom:!0===d?"&nbsp;":(new Element("span",{"class":"btn btn-primary btn-xs"})).update("select").observe("click",
function(){c.selectSupplier(a)})})}).insert({bottom:(new Element(e)).update(a.name)}).insert({bottom:(new Element(e)).update(a.contactName)}).insert({bottom:(new Element(e)).update(a.contactNo)}).insert({bottom:(new Element(e)).update(a.description)}).insert({bottom:(new Element(e)).insert({bottom:!0===d?a.active:new Element("input",{type:"checkbox",disabled:!0,checked:a.active})})})},_searchSupplier:function(a){var b,c,d,e,f;b=this;c=$F(a).strip();d=$(a).up("#"+b._htmlIds.searchPanel);b.postAjax(b.getCallbackId("searchSupplier"),
{searchTxt:c},{onLoading:function(){$(d).down(".list-div")&&$(d).down(".list-div").remove();$(d).insert({bottom:(new Element("div",{"class":"panel-body"})).update(b.getLoadingImg())})},onSuccess:function(a,c){$(d).down(".panel-body").remove();try{(e=b.getResp(c,!1,!0))&&e.items&&($(d).insert({bottom:(new Element("small",{"class":"table-responsive list-div"})).insert({bottom:(new Element("table",{"class":"table table-hover table-condensed"})).insert({bottom:(new Element("thead")).insert({bottom:b._getSupplierRow({name:"Supplier Name",
contactName:"Contact Name",contactNo:"Contact Number",description:"Description",active:"Active?"},!0)})}).insert({bottom:f=new Element("tbody")})})}),e.items.each(function(a){f.insert({bottom:b._getSupplierRow(a)})}))}catch(k){$(d).insert({bottom:(new Element("div",{"class":"panel-body"})).update(b.getAlertBox("ERROR",k).addClassName("alert-danger"))})}}});return b},_getSupplierListPanel:function(){var a,b,c;a=this;return(new Element("div",{id:a._htmlIds.searchPanel,"class":"panel search-panel"})).addClassName(!0===
a._isCredit?"panel-danger":"panel-info").insert({bottom:(new Element("div",{"class":"panel-heading form-inline"})).insert({bottom:(new Element("strong")).update("Creating a new order for: ")}).insert({bottom:(new Element("span",{"class":"input-group col-sm-6"})).insert({bottom:(new Element("input",{"class":"form-control search-txt init-focus",placeholder:"Supplier name"})).observe("keydown",function(c){b=this;a.keydown(c,function(){void 0!=b.up("#"+pageJs._htmlIds.searchPanel).down(".item_row")&&
1===b.up("#"+pageJs._htmlIds.searchPanel).down("tbody").getElementsBySelector(".item_row").length?b.up("#"+pageJs._htmlIds.searchPanel).down("tbody .item_row .btn").click():$(a._htmlIds.searchPanel).down(".search-btn").click()});a.keydown(c,function(){void 0!=b.up("#"+pageJs._htmlIds.searchPanel).down(".item_row")&&1===b.up("#"+pageJs._htmlIds.searchPanel).down("tbody").getElementsBySelector(".item_row").length?b.up("#"+pageJs._htmlIds.searchPanel).down("tbody .item_row .btn").click():$(a._htmlIds.searchPanel).down(".search-btn").click()},
null,9);return!1})}).insert({bottom:(new Element("span",{"class":"input-group-btn search-btn"})).insert({bottom:(new Element("span",{"class":" btn btn-primary"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})})}).observe("click",function(){b=$(a._htmlIds.searchPanel).down(".search-txt");$F(b).blank()?$(a._htmlIds.searchPanel).down(".table tbody")&&($(a._htmlIds.searchPanel).down(".table tbody").innerHTML=null):a._searchSupplier(b)})})}).insert({bottom:(new Element("span",
{"class":"btn btn-success pull-right btn-sm"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus"})}).insert({bottom:" ADD"}).observe("click",function(){jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",href:"/supplier/new.html?blanklayout=1",beforeClose:function(){c=$$("iframe.fancybox-iframe").first().contentWindow.pageJs._item;c.id&&a.selectSupplier(c)}})})})})},init:function(a){a?this.selectSupplier(a):$(this._htmlIds.itemDiv).update(this._getSupplierListPanel());
0<$$(".init-focus").size()&&$$(".init-focus").first().focus();return this}});