var PageJs=new Class.create;PageJs.prototype=Object.extend(new CRUDPageJs,{_getTitleRowData:function(){return{totalAmount:"Total Amount",totalPaid:"Total Paid",purchaseOrderNo:"PO Number",supplier:{name:"Supplier"},status:"Status",supplierRefNo:"PO Ref.",orderDate:"Order Date",active:"Active"}},_loadChosen:function(){return jQuery(".chosen").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"95%"}),jQuery('.chosen-container input[type="text"]').keydown(function(e){(13==e.which||13==e.keyCode)&&(e.preventDefault(),$("searchPanel").down("#searchBtn").click())}),this},_bindSearchKey:function(){var e={};return e.me=this,$$("#searchBtn").first().observe("click",function(){$$("#showSearch").first().checked?e.me.getSearchCriteria().getResults(!0,e.me._pagination.pageSize):$$("#showSearch").first().click()}),$("searchDiv").getElementsBySelector("[search_field]").each(function(t){t.observe("keydown",function(t){e.me.keydown(t,function(){$("searchPanel").down("#searchBtn").click()})})}),this},_loadDataPicker:function(){return $$(".datepicker").each(function(e){new Prado.WebUI.TDatePicker({ID:e,InputMode:"TextBox",Format:"yyyy-MM-dd 00:00:00",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,PositionMode:"Bottom",ClassName:"datepicker-layer-fixer"})}),this},_setStatusOptions:function(e){var t={};return t.me=this,t.selBox=$$("#searchPanel").first().down("#statusSelect"),t.me._statusOptions=e,t.me._statusOptions.each(function(e){t.selBox.insert({bottom:new Element("option").update(e)})}),t.me},_loadSuppliers:function(e){var t={};return t.me=this,t.me.suppliers=e,t.listBox=$(t.me.searchDivId).down('[search_field="po.supplierIds"]'),t.me.suppliers.each(function(e){t.listBox.insert({bottom:new Element("option",{value:e.id}).update(e.name)})}),this},getResults:function(e,t){var n={};n.me=this,n.reset=e||!1,n.resultDiv=$(n.me.resultDivId),n.reset===!0&&(n.me._pagination.pageNo=1),n.me._pagination.pageSize=t||n.me._pagination.pageSize,n.me.postAjax(n.me.getCallbackId("getItems"),{pagination:n.me._pagination,searchCriteria:n.me._searchCriteria},{onLoading:function(){jQuery("#"+n.me.searchDivId+" #searchBtn").button("loading"),n.reset===!0&&n.resultDiv.update(new Element("tr").update(new Element("td").update(n.me.getLoadingImg())))},onSuccess:function(e,t){try{if(n.result=n.me.getResp(t,!1,!0),!n.result)return;$(n.me.totalNoOfItemsId).update(n.result.pageStats.totalRows),n.reset===!0&&n.resultDiv.update(n.me._getResultRow(n.me._getTitleRowData(),!0).wrap(new Element("thead"))),n.resultDiv.getElementsBySelector(".paginWrapper").each(function(e){e.remove()}),n.tbody=$(n.resultDiv).down("tbody"),n.tbody||$(n.resultDiv).insert({bottom:n.tbody=new Element("tbody")}),n.result.items.each(function(e){e.item.totalProdcutCount=e.totalProdcutCount,e=e.item,n.tbody.insert({bottom:n.me._getResultRow(e).addClassName("item_row").writeAttribute("item_id",e.id)})}),n.result.pageStats.pageNumber<n.result.pageStats.totalPages&&n.resultDiv.insert({bottom:n.me._getNextPageBtn().addClassName("paginWrapper")})}catch(o){n.resultDiv.insert({bottom:n.me.getAlertBox("Error",o).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+n.me.searchDivId+" #searchBtn").button("reset")}})},_getResultRow:function(e,t){var n={};return n.me=this,n.tag=n.isTitle===!0?"th":"td",n.isTitle=t||!1,n.row=new Element("tr",{"class":(n.isTitle===!0?"item_top_row":"btn-hide-row item_row po_item")+(0==e.active?" danger":""),item_id:n.isTitle===!0?"":e.id}).store("data",e).insert({bottom:new Element(n.tag,{"class":"purchaseOrderNo col-xs-1"}).update(e.purchaseOrderNo)}).observe("dblclick",function(){t||n.me._openEditPage(e)}).observe("click",function(){}).insert({bottom:new Element(n.tag,{"class":" col-xs-1"}).update(n.me.loadUTCTime(e.orderDate).toLocaleString())}).insert({bottom:new Element(n.tag,{"class":" col-xs-1"}).update(e.supplier.name?e.supplier.name:"")}).insert({bottom:new Element(n.tag,{"class":" col-xs-1"}).update(e.supplierRefNo?e.supplierRefNo:"")}).insert({bottom:new Element(n.tag,{"class":" col-xs-1"}).update(n.isTitle?"Products Count":new Element("a",{href:"/serialnumbers.html?purchaseorderid="+e.id,target:"_BLANK"}).insert({bottom:new Element("abbr",{title:"Received Product Count on this PO"}).update(e.totalReceivedCount)}).insert({bottom:new Element("span").update(" / ")}).insert({bottom:new Element("abbr",{title:"Total Product Count on this PO"}).update(e.totalProductCount)}))}).insert({bottom:new Element(n.tag,{"class":" col-xs-1"}).update(n.isTitle?"ETA":e.eta?n.me.loadUTCTime(e.eta).toDateString():"")}).insert({bottom:new Element(n.tag,{"class":" col-xs-1"}).update(n.isTitle?"Total Amount":n.me.getCurrency(e.totalAmount))}).insert({bottom:new Element(n.tag,{"class":" col-xs-1"}).update(n.isTitle?"Total Paid":e.totalPaid?n.me.getCurrency(e.totalPaid):"")}).insert({bottom:new Element(n.tag,{"class":" col-xs-1",order_status:e.status}).update(e.status)}).insert({bottom:n.btns=new Element(n.tag,{"class":"col-xs-1 text-right"})}),n.btns.insert(n.isTitle!==!0?{bottom:new Element("div",{"class":"btn-group"}).insert({bottom:!e.id||"ORDERED"!==e.status&&"RECEIVING"!==e.status||e.active!==!0?"":new Element("span",{"class":"btn btn-success btn-sm",title:"Receiving Items"}).update("Receiving").observe("click",function(){n.newWindow=window.open("/receiving/"+e.id+".html","PO Details","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),n.newWindow.focus()})}).insert({bottom:new Element("span",{"class":"btn btn-default btn-sm",title:"Edit"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-pencil"})}).observe("click",function(){n.me._openEditPage(e)})}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-sm",title:"Delete"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){return confirm("Are you sure you want to delete this item?")?void(e.active&&n.me._deactivateItem(this)):!1})})}:{bottom:new Element("div",{"class":"btn-group"}).insert({bottom:new Element("span",{"class":"btn btn-primary btn-sm",title:"New"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){$(this).up("thead").insert({bottom:n.me._openNewPage()})})})}),n.row},_highlightSelectedRow:function(e){var t={};t.me=this,t.item=e.down(".glyphicon-plus")?"":$(e).up("[item_id]").retrieve("data"),jQuery(".item_row.success").removeClass("success"),t.selectedRow=jQuery("[item_id="+t.item.id+"]").addClass("success")},_openEditPage:function(e){var t={};return t.me=this,t.newWindow=window.open("/purchase/"+(e&&e.id?e.id:"new")+".html","PO Details","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),t.newWindow.focus(),t.me},_openNewPage:function(){var e={};return e.me=this,e.newWindow=window.open("/purchase/new.html","PO Details","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),e.newWindow.focus(),e.me},_deactivateItem:function(e){var t={};t.me=this,t.row=$(e).up("[item_id]"),t.item=t.row.retrieve("data"),t.me.postAjax(t.me.getCallbackId("deactivateItems"),{item_id:t.item.id},{onLoading:function(){t.row&&(t.row.toggleClassName("danger"),t.row.hide())},onSuccess:function(e,n){try{if(t.row.toggleClassName("danger"),t.result=t.me.getResp(n,!1,!0),!t.result.item)throw"errror";$$('[item_id="'+t.result.item.id+'"]').first().replace(t.me._getResultRow(t.result.item,!1))}catch(o){t.me.showModalBox('<span class="text-danger">ERROR</span>',o,!0)}}})}});