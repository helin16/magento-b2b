var PageJs=new Class.create;PageJs.prototype=Object.extend(new BPCPageJs,{_htmlIds:{itemDiv:"",searchPanel:"search_panel"},_customer:null,_order:null,setOrder:function(e){return this._order=e,this},setHTMLIDs:function(e){return this._htmlIds.itemDiv=e,this},setPaymentMethods:function(e){return this._paymentMethods=e,this},setShippingMethods:function(e){return this._shippingMethods=e,this},setOrderTypes:function(e){return this._orderTypes=e,this},_getFormGroup:function(e,t){return new Element("div",{"class":"form-group"}).insert({bottom:e?new Element("label",{"class":"control-label"}).update(e):""}).insert({bottom:t.addClassName("form-control")})},_redirectOrder:function(e){var t={};return t.me=this,t.redirectURL=jQuery(e.target).find('[window="redirec-url"]').val(),t.redirectURL&&!t.redirectURL.blank()&&(window.location=t.redirectURL),t.me},_preConfirmSubmit:function(e){var t={};return t.me=this,t.paidAmountBox=$$('[save-order="totalPaidAmount"]').first(),t.selectedType=jQuery('[save-order-type="type"]').val(),t.paidAmountBox&&"INVOICE"!==t.selectedType?(t.data=t.me._collectFormData($(t.me._htmlIds.itemDiv),"save-order"),null===t.data?t.me:t.data.totalPaidAmount&&t.data.totalPaidAmount>0?(t.newDiv=new Element("div",{"class":"confirm-div"}).insert({bottom:new Element("h4",{"class":"text-danger"}).update("You are recording a payment with "+t.me.getCurrency(t.data.totalPaidAmount)+" against this "+t.selectedType+", it will be push to an INVOICE.")}).insert({bottom:new Element("div",{"class":"text-right"}).insert({bottom:new Element("span",{"class":"btn btn-danger","data-loading-text":"Pushing..."}).update("OK").observe("click",function(){t.me._confirmSubmit(e,t.newDiv)})})}),t.me.showModalBox('<strong class="text-danger">Warning! Payments Provided:</strong>',t.newDiv,!1,null,{"hide.bs.modal":function(e){t.me._redirectOrder(e)}}),t.me):t.me._confirmSubmit(e)):t.me._confirmSubmit(e)},_confirmSubmit:function(e,t){var r={};if(r.me=this,r.printIt=e===!0?!0:!1,r.confirmDiv=t||null,r.data=r.me._collectFormData($(r.me._htmlIds.itemDiv),"save-order"),null===r.data)return r.me;if(r.data.printIt=r.printIt,r.data.type=r.data.totalPaidAmount&&r.data.totalPaidAmount>0?"INVOICE":jQuery('[save-order-type="type"]').val(),r.data.customer={},r.data.customer.id=r.me._customer.id,r.shippAddrPanel=$$(".shipping-address.address-div").first(),r.shippAddrPanel){if(r.shippAddr=r.me._collectFormData(r.shippAddrPanel,"address-editable-field"),null===r.shippAddr)return r.me;r.data.shippingAddr=r.shippAddr}return r.data.items=[],r.hasItems=!1,$$(".order-item-row").each(function(e){r.itemData=e.retrieve("data"),e.hasClassName("deactivated")||(r.hasItems=!0),r.data.items.push({id:r.itemData.id?r.itemData.id:"",active:!e.hasClassName("deactivated"),product:{id:r.itemData.product.id},itemDescription:r.itemData.itemDescription,unitPrice:r.itemData.unitPrice,qtyOrdered:r.itemData.qtyOrdered,totalPrice:r.itemData.totalPrice,serials:e.retrieve("serials")})}),r.hasItems===!1?(r.me.showModalBox('<strong class="text-danger">Error</strong>',"At least one order item is needed!",!0),r.me):(r.data.items.each(function(e){e.totalPrice=r.me.getValueFromCurrency(e.totalPrice),e.unitPrice=r.me.getValueFromCurrency(e.unitPrice)}),r.newDiv=new Element("div").insert({bottom:new Element("h4").update("Have all the GOODs deliver / given to the customer?")}).insert({bottom:new Element("ul").insert({bottom:new Element("li").update(" - YES: This "+r.data.type+" will push this order to be an INVOICE and status SHIPPED")}).insert({bottom:new Element("li").update(" - NO: This "+r.data.type+" will be saved as status NEW")})}).insert({bottom:new Element("div").insert({bottom:new Element("span",{"class":"btn btn-danger",title:"This will push this order to be an INVOICE and status SHIPPED"}).update("YES").observe("click",function(){r.data.type="INVOICE",r.data.shipped=!0,r.me._submitOrder(this,r.data)})}).insert({bottom:new Element("span",{"class":"btn btn-primary pull-right",title:"This will push this order to be an INVOICE and status SHIPPED"}).update("NO").observe("click",function(){r.me._submitOrder(this,r.data)})})}),null===r.confirmDiv?r.me.showModalBox('<strong class="text-info">Confirmation Needed</strong>',r.newDiv,!1,null,{"hide.bs.modal":function(e){r.me._redirectOrder(e)}}):(r.confirmDiv.up(".modal-content").down(".modal-title").update('<strong class="text-info">Confirmation Needed</strong>'),r.confirmDiv.replace(r.newDiv)),r.me)},_submitOrder:function(e,t){var r={};return r.me=this,r.modalBoxPanel=$(e).up(".modal-content"),r.modalBoxTitlePanel=r.modalBoxPanel.down(".modal-title"),r.modalBoxBodyPanel=r.modalBoxPanel.down(".modal-body"),r.me._order&&r.me._order.id?t.orderId=r.me._order.id:r.me._originalOrder&&r.me._originalOrder.id&&(t.orderCloneFromId=r.me._originalOrder.id),r.me.postAjax(r.me.getCallbackId("saveOrder"),t,{onLoading:function(){r.modalBoxTitlePanel.update("Please wait..."),r.modalBoxBodyPanel.update('<h4>Submitting the data, please be patient.</h4><div><h3 class="fa fa-spinner fa-spin"></h3></div>')},onSuccess:function(e,t){try{if(r.result=r.me.getResp(t,!1,!0),!r.result||!r.result.item)return;r.me._order=r.me._item=r.result.item,r.redirectURL=r.result.redirectURL,r.modalBoxPanel.insert({bottom:new Element("input",{window:"redirec-url",type:"hidden",value:r.redirectURL})}),$extraMsg="",r.result.printURL&&(r.printWindow=window.open(r.result.printURL,"Printing Order","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),r.printWindow||($extraMsg='<h4>Your browser has block the popup window, please enable it for further operations.</h4><a href="'+r.result.printURL+'" target="_BLANK"> click here for now</a>')),r.modalBoxTitlePanel.update('<strong class="text-success">Success!</strong>'),r.modalBoxBodyPanel.update('<h4 class="text-success">Saved Successfully for '+r.result.item.type+": "+r.result.item.orderNo+'</h4><div><a class="btn btn-primary" href="javascript: void(0)" onclick="pageJs.hideModalBox();"> click here to view it</a></div>')}catch(n){r.modalBoxTitlePanel.update('<h4 class="text-danger">Error:</h4>'),r.modalBoxBodyPanel.update(n)}},onComplete:function(){}}),r.me},_saveBtns:function(){var e={};return e.me=this,e.newDiv=new Element("div").insert({bottom:new Element("div",{"class":"btn-group pull-right  visible-xs visible-sm visible-md visible-lg"}).insert({bottom:new Element("span",{"class":"btn btn-primary save-btn"}).insert({bottom:new Element("span").update(" Save & Print ")}).observe("click",function(){e.me._preConfirmSubmit(!0)})})}).insert({bottom:new Element("div",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove-sign"})}).insert({bottom:new Element("span").update(" cancel ")}).observe("click",function(){e.me.showModalBox('<strong class="text-danger">Cancelling the current order</strong>','<div>You are about to cancel this new order, all input data will be lost.</div><br /><div>Continue?</div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',!0)})}),e.newDiv},_getAddressDiv:function(e,t,r){var n={};return n.me=this,n.address=t||null,n.editable=r||!1,n.newDiv=new Element("div",{"class":"address-div"}).insert({bottom:new Element("strong").update(e)}).insert({bottom:new Element("dl",{"class":"dl-horizontal dl-condensed"}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-user",title:"Customer Name"}))}).insert({bottom:new Element("dd").insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"col-sm-6"}).update(n.editable!==!0?t.contactName:new Element("input",{"address-editable-field":"contactName","class":"form-control input-sm",placeholder:"The name of contact person",value:n.address.contactName?n.address.contactName:""}))}).insert({bottom:new Element("div",{"class":"col-sm-6"}).update(n.editable!==!0?t.contactNo:new Element("input",{"address-editable-field":"contactNo","class":"form-control input-sm",placeholder:"The contact number of contact person",value:n.address.contactNo?n.address.contactNo:""}))})})}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-map-marker",title:"Address"}))}).insert({bottom:new Element("dd").insert({bottom:new Element("div").insert({bottom:n.editable!==!0?t.street:new Element("div",{"class":"street col-sm-12"}).update(new Element("input",{"address-editable-field":"street","class":"form-control input-sm",placeholder:"Street Number and Street name",value:n.address.street?n.address.street:""}))})}).insert({bottom:new Element("div").insert({bottom:n.editable!==!0?t.city+" ":new Element("div",{"class":"city col-sm-6"}).update(new Element("input",{"address-editable-field":"city","class":"form-control input-sm",placeholder:"City / Suburb",value:n.address.city?n.address.city:""}))}).insert({bottom:n.editable!==!0?t.region+" ":new Element("div",{"class":"region col-sm-3"}).update(new Element("input",{"address-editable-field":"region","class":"form-control input-sm",placeholder:"State / Province",value:n.address.region?n.address.region:""}))}).insert({bottom:n.editable!==!0?t.postCode:new Element("div",{"class":"postcode col-sm-3"}).update(new Element("input",{"address-editable-field":"postCode","class":"form-control input-sm",placeholder:"PostCode",value:n.address.postCode?n.address.postCode:""}))})}).insert({bottom:new Element("div").insert({bottom:n.editable!==!0?t.country:new Element("div",{"class":"postcode col-sm-4"}).update(new Element("input",{"address-editable-field":"country","class":"form-control input-sm",placeholder:"Country",value:n.address.country?n.address.country:""}))})})})}),n.editable===!0&&n.newDiv.writeAttribute("address-editable",!0),n.newDiv},_openCustomerDetailsPage:function(e){var t={};return t.me=this,jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",href:"/customer/"+e.id+".html?blanklayout=1",beforeClose:function(){t.customer=$$("iframe.fancybox-iframe").first().contentWindow.pageJs._item,t.customer&&t.customer.id&&t.me.selectCustomer(t.customer)}}),t.me},_deactiveOrder:function(e){var t={};return t.me=this,t.confirmDiv=$(e).up(".confirm-div"),t.confirmDiv.getElementsBySelector(".msg").each(function(e){e.remove()}),t.data=t.me._collectFormData(t.confirmDiv,"confirm-panel"),null!==t.data?(t.data.orderId=t.me._order.id,t.me.postAjax(t.me.getCallbackId("cancelOrder"),t.data,{onLoading:function(){t.me._signRandID(e),jQuery("#"+e.id).button("loading")},onSuccess:function(e,r){try{if(t.result=t.me.getResp(r,!1,!0),!t.result||!t.result.item||!t.result.item.id)return;t.me._order=t.result.item,t.confirmDiv.update('<h4 class="text-success">This '+t.me._order.type+" has been CANCELLED successfully.</h4>"),t.me.disableEverything()}catch(n){t.confirmDiv.insert({top:new Element("h4",{"class":"msg"}).update(new Element("span",{"class":"label label-danger"}).update(n))})}},onComplete:function(){jQuery("#"+e.id).button("reset")}}),t.me):void 0},_showConfirmCancelOrderPanel:function(){var e={};return e.me=this,e.newDiv=new Element("div",{"class":"confirm-div"}).insert({bottom:new Element("div").insert({bottom:e.me._getFormGroup("You are about CANCEL this "+e.me._order.type+", please provide some reason:",new Element("input",{value:"","confirm-panel":"reason",required:!0,placeholder:"The Reason For CANCELLATION"}))})}).insert({bottom:new Element("div",{"class":"text-right"}).insert({bottom:new Element("span",{"class":"btn btn-default pull-left"}).update("CANCEL").observe("click",function(){e.me.hideModalBox()})}).insert({bottom:new Element("span",{"class":"btn btn-danger","data-loading-text":"Sending ..."}).update("Yes, Cancel this "+e.me._order.type).observe("click",function(){e.me._deactiveOrder(this)})})}),e.me.showModalBox("<strong>Confirm Cancellation:</strong>",e.newDiv),e.me},_getCustomerInfoPanel:function(e){var t={};return t.me=this,t.customer=e,t.typeSelBox=new Element("select",{"save-order-type":"type"}),t.me._orderTypes.each(function(e){t.typeSelBox.insert({bottom:t.option=new Element("option",{value:e,selected:t.me._order&&t.me._order.type===e}).update(e)}).observe("change",function(){t.panels=jQuery(".panel").removeClass("panel-success").removeClass("panel-warning").removeClass("panel-default"),t.inputs=jQuery(".list-group-item").removeClass("list-group-item-success").removeClass("list-group-item-warning"),"QUOTE"===$F(this)?(t.panels.addClass("panel-warning"),t.inputs.addClass("list-group-item-warning")):"ORDER"===$F(this)?(t.panels.addClass("panel-success"),t.inputs.addClass("list-group-item-success")):t.panels.addClass("panel-default")})}),t.operationBtnsDiv=new Element("div"),t.me._order&&t.me._order.id&&t.operationBtnsDiv.update(new OrderBtnsJs(t.me,t.me._order).getBtnsDiv()).insert({bottom:new Element("btn",{"class":"btn btn-danger btn-xs pull-right"}).update("CANCEL THIS "+t.me._order.type).observe("click",function(){t.me._showConfirmCancelOrderPanel(this)})}),t.newDiv=new Element("div",{"class":"panel customer-info-div"}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-8"}).insert({bottom:new Element("strong").update((t.me._order&&t.me._order.id?"Editing":"CREATING")+" A ")}).insert({bottom:t.typeSelBox}).insert({bottom:t.me._order&&t.me._order.id?new Element("strong").update(" "+t.me._order.orderNo).setStyle("margin-left: 5px; margin-right: 25px;"):""}).insert({bottom:new Element("strong").update(" FOR:  ")}).insert({bottom:new Element("a",{href:"javascript: void(0);"}).update(t.customer.name).observe("click",function(){t.me._openCustomerDetailsPage(t.customer)})}).insert({bottom:" <"}).insert({bottom:new Element("a",{href:"mailto:"+t.customer.email}).update(t.customer.email)}).insert({bottom:">"}).insert({bottom:new Element("strong").update(" with PO No.:")}).insert({bottom:new Element("input",{type:"text","save-order":"poNo",placeholder:"Optional - PO No. From Customer",value:t.me._order&&t.me._order.pONo?t.me._order.pONo:""}).setStyle("width: 200px;")}).insert({bottom:t.me._originalOrder?new Element("span").setStyle("margin-left: 8px;").insert({bottom:new Element("strong",{"class":"text-danger"}).update("CLONING FROM: ")}).insert({bottom:new Element("a",{href:"/orderdetails/"+t.me._originalOrder.id+".html",target:"_BLANK"}).update(t.me._originalOrder.orderNo)}):""})}).insert({bottom:new Element("div",{"class":"col-sm-4"}).update(t.operationBtnsDiv)})})}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("small").update(new Element("em").update(t.customer.description))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:t.me._getAddressDiv("Billing Address: ",t.customer.address?t.customer.address.billing:null).addClassName("col-xs-6")}).insert({bottom:t.me._getAddressDiv("Shipping Address: ",t.customer.address?t.customer.address.shipping:null,!0).addClassName("col-xs-6").addClassName("shipping-address")})})}),t.newDiv},_getProductRow:function(e,t){var r={};return r.me=this,r.isTitle=t||!1,r.tag=r.isTitle===!0?"strong":"div",r.btns=e.btns?e.btns:new Element("span",{"class":"pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-xs"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){confirm("You remove this entry.\n\nContinue?")&&(r.row=$(this).up(".item_row"),r.row&&(r.orderItem=r.row.retrieve("data"),r.orderItem.id?(r.orderItem.active=!1,r.row.store("data",r.orderItem),r.row.hide(),r.row.addClassName("deactivated")):r.row.remove()),r.me._recalculateSummary())})}),r.row=new Element("div",{"class":" list-group-item "+(r.isTitle===!0?"":"item_row order-item-row")}).store("data",e).insert({bottom:new Element("div",{"class":"row"}).store("data",e).insert({bottom:new Element(r.tag,{"class":"productName col-xs-6"}).insert({bottom:e.itemDescription?e.itemDescription:e.product.name})}).insert({bottom:new Element(r.tag,{"class":"uprice col-xs-1"}).insert({bottom:r.isTitle===!0||"object"==typeof e.unitPrice?e.unitPrice:r.me._getFormGroup(null,r.me._getOrderItemInputBox("order-item",r.me.getCurrency(r.me.getValueFromCurrency(e.unitPrice)),{"order-item":"unitPrice",required:!0}))})}).insert({bottom:new Element(r.tag,{"class":"col-xs-2"}).insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"qty col-xs-6"}).update(r.isTitle===!0||"object"==typeof e.qtyOrdered?e.qtyOrdered:r.me._getFormGroup(null,r.me._getOrderItemInputBox("order-item",e.qtyOrdered,{"order-item":"qtyOrdered",required:!0})))}).insert({bottom:new Element("div",{"class":"discount col-xs-6"}).update(r.isTitle===!0||"object"==typeof e.discount?e.discount:r.me._getFormGroup(null,r.me._getOrderItemInputBox("order-item",e.discount,{"order-item":"discount"})))})})}).insert({bottom:new Element(r.tag,{"class":"tprice col-xs-1"}).insert({bottom:r.isTitle===!0||"object"==typeof e.totalPrice?e.totalPrice:r.me._getFormGroup(null,r.me._getOrderItemInputBox("order-item",e.totalPrice,{"order-item":"totalPrice",disabled:!0,required:!0}))})}).insert({bottom:new Element(r.tag,{"class":"margin col-xs-1 text-right"}).update(e.margin)}).insert({bottom:new Element(r.tag,{"class":"btns col-xs-1 text-right"}).update(r.btns)})}),e.id&&r.row.writeAttribute("item-id",e.id),e.product.sku&&r.row.down(".productName").removeClassName("col-xs-6").addClassName("col-xs-4").insert({before:new Element(r.tag,{"class":"productSku col-xs-2"}).update(e.product.sku).insert({bottom:new Element("small",{"class":e.product.id?"btn btn-xs btn-info":"hidden"}).insert({bottom:new Element("small",{"class":"glyphicon glyphicon-new-window"})}).observe("click",function(t){Event.stop(t),$productId=e.product.id,$productId&&r.me._openProductDetailPage($productId)})})}),e.scanTable&&r.row.insert({bottom:new Element("div",{"class":"row product-content-row"}).insert({bottom:new Element("span",{"class":"col-sm-2 show-tools"}).insert({bottom:new Element("input",{type:"checkbox",checked:!0,"class":"show-panel-check"}).observe("click",function(){r.btn=this,r.panel=$(r.btn).up(".product-content-row").down(".serial-no-scan-pane"),r.btn.checked?r.panel.show():r.panel.hide()})}).insert({bottom:new Element("a",{href:"javascript: void(0);"}).update(" show serial scan panel?").observe("click",function(){$(this).up(".show-tools").down(".show-panel-check").click()})})}).insert({bottom:new Element("span",{"class":"col-sm-10 serial-no-scan-pane",style:"padding-top: 5px"}).update(e.scanTable)})}),r.row},_getSearchPrductResultRow:function(e,t){var r={};return r.me=this,r.defaultImgSrc="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+",r.newRow=new Element("a",{"class":"list-group-item search-product-result-row",href:"javascript: void(0);"}).store("data",e).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-2"}).insert({bottom:new Element("div",{"class":"thumbnail"}).insert({bottom:new Element("img",{"data-src":"holder.js/100%x64",alert:"Product Image",src:0===e.images.size()?r.defaultImgSrc:e.images[0].asset.url})})})}).insert({bottom:new Element("div",{"class":"col-xs-10"}).insert({bottom:new Element("strong").update(e.name).insert({bottom:new Element("small",{"class":"btn btn-xs btn-info"}).insert({bottom:new Element("small",{"class":"glyphicon glyphicon-new-window"})})}).observe("click",function(e){Event.stop(e),$productId=$(this).up(".search-product-result-row").retrieve("data").id,$productId&&r.me._openProductDetailPage($productId)}).insert({bottom:new Element("small",{"class":"pull-right"}).update("SKU: "+e.sku)})}).insert({bottom:new Element("div").insert({bottom:new Element("small").update(e.shortDescription)})}).insert({bottom:new Element("div").insert({bottom:new Element("small",{"class":"col-xs-4"}).insert({bottom:new Element("div",{"class":"input-group",title:"stock on HAND"}).insert({bottom:new Element("span",{"class":"input-group-addon"}).update("SOH:")}).insert({bottom:new Element("strong",{"class":"form-control"}).update(e.stockOnHand)})})}).insert({bottom:new Element("small",{"class":"col-xs-4"}).insert({bottom:new Element("div",{"class":"input-group",title:"stock on ORDER"}).insert({bottom:new Element("span",{"class":"input-group-addon"}).update("SOO:")}).insert({bottom:new Element("strong",{"class":"form-control"}).update(e.stockOnOrder)})})}).insert({bottom:new Element("small",{"class":"col-xs-4"}).insert({bottom:new Element("div",{"class":"input-group",title:"stock on PO"}).insert({bottom:new Element("span",{"class":"input-group-addon"}).update("SOP:")}).insert({bottom:new Element("strong",{"class":"form-control"}).update(e.stockOnPO)})})})})})}).observe("click",function(){r.inputRow=$(t).up(".new-order-item-input").store("product",e),t.up(".productName").writeAttribute("colspan",!1).update(e.sku).removeClassName("col-xs-8").addClassName("col-xs-2").insert({bottom:new Element("small",{"class":"btn btn-xs btn-info"}).insert({bottom:new Element("small",{"class":"glyphicon glyphicon-new-window"})}).observe("click",function(t){Event.stop(t),$productId=e.id,$productId&&r.me._openProductDetailPage($productId)})}).insert({bottom:new Element("a",{href:"javascript: void(0);","class":"text-danger pull-right",title:"click to change the product"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){r.newRow=r.me._getNewProductRow(),$(this).up(".new-order-item-input").replace(r.newRow),r.newRow.down("[new-order-item=product]").select()})}).insert({after:new Element("div",{"class":"col-xs-4"}).update(new Element("textarea",{"new-order-item":"itemDescription"}).setStyle("width: 100%").update(e.name))}),jQuery("#"+r.me.modalId).modal("hide"),r.retailPrice=0===e.prices.size()?0:e.prices[0].price,r.inputRow.down("[new-order-item=unitPrice]").writeAttribute("value",r.me.getCurrency(r.retailPrice)).select(),r.me._calculateNewProductPrice(r.inputRow,"new-order-item")}),r.newRow},_searchProduct:function(e,t,r){var n={};return n.me=this,n.btn=e,n.showMore=$(e).retrieve("showMore")===!0?!0:!1,n.pageNo=t||1,n.me._signRandID(n.btn),n.searchTxtBox=$(n.btn).up(".product-autocomplete")&&$(n.btn).up(".product-autocomplete").down(".search-txt")?$(n.btn).up(".product-autocomplete").down(".search-txt"):$($(n.btn).retrieve("searchBoxId")),n.me._signRandID(n.searchTxtBox),n.searchTxt=$F(n.searchTxtBox),n.me.postAjax(n.me.getCallbackId("searchProduct"),{searchTxt:n.searchTxt,pageNo:n.pageNo},{onLoading:function(){jQuery("#"+n.btn.id).button("loading"),jQuery("#"+n.searchTxtBox.id).button("loading")},onSuccess:function(t,o){n.resultList=n.showMore===!1?new Element("div",{"class":"search-product-list"}):$(e).up(".search-product-list");try{if(n.result=n.me.getResp(o,!1,!0),!n.result||!n.result.items||0===n.result.items.size())throw"Nothing Found for: "+n.searchTxt;n.me._signRandID(n.searchTxtBox),n.result.items.each(function(e){n.resultList.insert({bottom:n.me._getSearchPrductResultRow(e,n.searchTxtBox)})}),n.resultList.addClassName("list-group")}catch(s){n.resultList.update(n.me.getAlertBox("Error: ",s).addClassName("alert-danger"))}"function"==typeof r&&r(),n.result.pagination.pageNumber<n.result.pagination.totalPages&&n.resultList.insert({bottom:new Element("a",{"class":"item-group-item"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Getting more ..."}).update("Show Me More")}).observe("click",function(){n.newBtn=$(this),$(n.newBtn).store("searchBoxId",n.searchTxtBox.id),$(n.newBtn).store("showMore",!0),n.me._searchProduct(this,1*n.pageNo+1,function(){$(n.newBtn).remove()})})}),n.showMore===!1&&n.me.showModalBox("Products that has: "+n.searchTxt,n.resultList,!1)},onComplete:function(){jQuery("#"+n.btn.id).button("reset"),jQuery("#"+n.searchTxtBox.id).button("reset")}}),n.me},_getNewProductProductAutoComplete:function(){var e={};return e.me=this,e.skuAutoComplete=e.me._getFormGroup(null,new Element("div",{"class":"input-group input-group-sm product-autocomplete"}).insert({bottom:new Element("input",{"class":"form-control search-txt visible-xs visible-sm visible-md visible-lg","new-order-item":"product",required:!0,placeholder:"search SKU, NAME and any BARCODE for this product"}).observe("keyup",function(t){e.txtBox=this,e.me.keydown(t,function(){$(e.txtBox).up(".product-autocomplete").down(".search-btn").click()})}).observe("keydown",function(t){e.txtBox=this,e.me.keydown(t,function(){$(e.txtBox).up(".product-autocomplete").down(".search-btn").click()},function(){},Event.KEY_TAB)})}).insert({bottom:new Element("span",{"class":"input-group-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary search-btn","data-loading-text":"searching..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})}).observe("click",function(){$F($(this).up(".product-autocomplete").down(".search-txt")).blank()?$(this).up(".product-autocomplete").down(".search-txt").focus():e.me._searchProduct(this)})})})),e.skuAutoComplete.down(".input-group").removeClassName("form-control"),e.skuAutoComplete},_recalculateSummary:function(){var e={};return e.me=this,e.totalPriceIncGSTNoDicount=0,e.totalPriceIncGSTWithDiscount=0,e.totalMargin=0,$$(".item_row.order-item-row").each(function(t){e.rowData=t.retrieve("data"),e.rowData.active!==!1&&(e.totalPriceIncGSTWithDiscount=1*e.totalPriceIncGSTWithDiscount+1*e.me.getValueFromCurrency(e.rowData.totalPrice),e.totalPriceIncGSTNoDicount=1*e.totalPriceIncGSTNoDicount+e.me.getValueFromCurrency(e.rowData.unitPrice)*e.rowData.qtyOrdered,e.rowData.margin&&(e.totalMargin=1*e.totalMargin+1*e.me.getValueFromCurrency(e.rowData.margin)))}),e.totalPriceExcGST=1*e.totalPriceIncGSTWithDiscount/1.1,jQuery('[order-price-summary="totalPriceExcludeGST"]').val(e.me.getCurrency(e.totalPriceExcGST)).html(e.me.getCurrency(e.totalPriceExcGST)),e.totalGST=1*e.totalPriceIncGSTWithDiscount-1*e.totalPriceExcGST,jQuery('[order-price-summary="totalPriceGST"]').val(e.me.getCurrency(e.totalGST)).html(e.me.getCurrency(e.totalGST)),e.totalDiscount=1*e.totalPriceIncGSTNoDicount-1*e.totalPriceIncGSTWithDiscount,jQuery('[order-price-summary="totalDiscount"]').val(e.me.getCurrency(e.totalDiscount)).html(e.me.getCurrency(e.totalDiscount)),jQuery('[order-price-summary="totalPriceIncludeGST"]').val(e.me.getCurrency(e.totalPriceIncGSTWithDiscount)).html(e.me.getCurrency(e.totalPriceIncGSTWithDiscount)),e.totalShipping=jQuery('[order-price-summary="totalShippingCost"]').length>0?jQuery('[order-price-summary="totalShippingCost"]').val():0,e.subTotal=1*e.totalShipping+1*e.totalPriceIncGSTWithDiscount,jQuery('[order-price-summary="subTotal"]').val(e.me.getCurrency(e.subTotal)).html(e.me.getCurrency(e.subTotal)),e.totalPaid=jQuery('[order-price-summary="totalPaidAmount"]').length>0?jQuery('[order-price-summary="totalPaidAmount"]').val():0,e.totalDue=1*e.subTotal-1*e.totalPaid,e.totalDue<0&&e.me.showModalBox('<h4 class="text-danger">Attention!</h4>','<div><strong>The customer has paid more than the due amount?</strong></div><div><span class="btn btn-primary" onclick="pageJs.hideModalBox();">OK</span>',!0),jQuery('[order-price-summary="total-payment-due"]').val(e.me.getCurrency(e.totalDue)).html(e.me.getCurrency(e.totalDue)),jQuery('[order-price-summary="total-margin"]').val(e.me.getCurrency(e.totalMargin)).html(e.me.getCurrency(e.totalMargin)),e.me},_addNewProductRow:function(e){var t={};return t.me=this,t.currentRow=$(e).up(".new-order-item-input"),t.product=t.currentRow.retrieve("product"),t.product?(t.unitPriceBox=t.currentRow.down("[new-order-item=unitPrice]"),t.unitPrice=t.me.getValueFromCurrency($F(t.unitPriceBox)),null===t.unitPrice.match(/^\d+(\.\d{1,2})?$/)?void t.me._markFormGroupError(t.unitPriceBox,"Invalid value provided!"):(t.qtyOrderedBox=t.currentRow.down("[new-order-item=qtyOrdered]"),t.qtyOrdered=t.me.getValueFromCurrency($F(t.qtyOrderedBox)),null===t.qtyOrdered.match(/^\d+(\.\d{1,2})?$/)?void t.me._markFormGroupError(t.qtyOrderedBox,"Invalid value provided!"):(t.discountBox=t.currentRow.down("[new-order-item=discount]"),t.discount=t.me.getValueFromCurrency($F(t.discountBox)),null===t.discount.match(/^\d+(\.\d{1,2})?$/)?void t.me._markFormGroupError(t.discountBox,"Invalid value provided!"):(t.totalPriceBox=t.currentRow.down("[new-order-item=totalPrice]"),t.totalPrice=t.me.getValueFromCurrency($F(t.totalPriceBox)),null===t.totalPrice.match(/^\d+(\.\d{1,2})?$/)?void t.me._markFormGroupError(t.totalPriceBox,"Invalid value provided!"):(t.currentRow.getElementsBySelector(".form-group.has-error .form-control").each(function(e){$(e).retrieve("clearErrFunc")()}),t.itemDescription=$F(t.currentRow.down("[new-order-item=itemDescription]")).replace(/\n/g,"<br />"),t.data={product:t.product,itemDescription:t.itemDescription,unitPrice:t.me.getCurrency(t.unitPrice),qtyOrdered:t.qtyOrdered,discount:t.discount,margin:t.me.getCurrency(parseFloat(t.totalPrice)-parseFloat(1.1*t.product.unitCost*t.qtyOrdered)),totalPrice:t.me.getCurrency(t.totalPrice)},t.data.scanTable=t.me._getScanTable(t.data),t.currentRow.up(".list-group").insert({bottom:t.itemRow=t.me._getProductRow(t.data)}),t.newRow=t.me._getNewProductRow(),t.currentRow.replace(t.newRow).addClassName(),t.newRow.down("[new-order-item=product]").focus(),t.me._recalculateSummary(),t.me))))):(t.productBox=t.currentRow.down("[new-order-item=product]"),void(t.currentRow.down("[new-order-item=product]")?t.me._markFormGroupError(t.productBox,"Select a product first!"):t.me.showModalBox("Product Needed","Select a product first!",!0)))},_getScanTable:function(e){var t={};for(t.me=this,t.item=e,t.newDiv=new Element("div",{"class":"scanTable"}),t.i=0;t.i<e.qtyOrdered;t.i++)t.newDiv.insert({bottom:new Element("input",{"class":"form-control","scanned-item":"serialNo",type:"text",placeholder:"Serial Number:"}).observe("change",function(){t.emptyIput=null,t.serials=[],$(this).up(".scanTable").getElementsBySelector('input[scanned-item="serialNo"]').each(function(e){$F(e).blank()||t.serials.push($F(e)),null===t.emptyIput&&$F(e).blank()&&(t.emptyIput=e)}),$(this).up(".order-item-row").store("serials",t.serials),null!==t.emptyIput&&t.emptyIput.select()}).wrap(new Element("div",{"class":"col-sm-3"}))});return t.newDiv},_calculateNewProductPrice:function(e,t){var r={};return r.me=this,r.row=e,r.unitPrice=r.me.getValueFromCurrency($F(r.row.down("["+t+"=unitPrice]"))),r.discount=$F(r.row.down("["+t+"=discount]")).strip().replace("%",""),r.qty=$F(r.row.down("["+t+"=qtyOrdered]")).strip(),r.totalPrice=r.unitPrice*(1-r.discount/100)*r.qty,$(r.row.down("["+t+"=totalPrice]")).value=r.me.getCurrency(r.totalPrice),r.product=e.retrieve("product")?e.retrieve("product"):e.retrieve("data")&&e.retrieve("data").product?e.retrieve("data").product:{},r.product.id&&(r.unitCost=r.product.unitCost,r.row.down(".margin")&&$(r.row.down(".margin")).update(r.me.getCurrency(1*r.totalPrice-1.1*r.unitCost*r.qty)+(0===parseInt(r.unitCost)?'<div><small class="label label-danger">No Cost Yet</small</div>':""))),r.rowData=r.row.retrieve("data"),r.rowData&&r.rowData.id&&(r.rowData.unitPrice=r.unitPrice,r.rowData.discount=r.discount,r.rowData.qty=r.qty,r.rowData.totalPrice=r.totalPrice,r.row.store("data",r.rowData)),r.me},_bindSubmitNewProductRow:function(e,t){var r={};return r.me=this,r.txtBox=t,r.me.keydown(e,function(){$(r.txtBox)&&$(r.txtBox).up(".item_row")&&$(r.txtBox).up(".item_row").down(".save-new-product-btn")&&$(r.txtBox).up(".item_row").down(".save-new-product-btn").click()
}),r.me},_getOrderItemInputBox:function(e,t,r,n,o,s){var i={};return i.me=this,i.newInput=Element("input",{"class":"input-sm",value:t}).observe("click",function(e){"function"==typeof n&&n(e)}).observe("keydown",function(e){"function"==typeof o?o(e):i.me._bindSubmitNewProductRow(e,this)}).observe("keyup",function(t){if("function"==typeof s)s(t);else try{i.me._calculateNewProductPrice($(this).up(".item_row"),e),i.me._recalculateSummary()}catch(r){}}),$H(r).each(function(e){i.newInput.writeAttribute(e.key,e.value)}),i.newInput},_getNewProductRow:function(){var e={};return e.me=this,e.skuAutoComplete=e.me._getNewProductProductAutoComplete(),e.data={product:{name:e.skuAutoComplete},unitPrice:e.me._getFormGroup(null,e.me._getOrderItemInputBox("new-order-item",e.me.getCurrency(0),{"new-order-item":"unitPrice",required:!0})),qtyOrdered:e.me._getFormGroup(null,e.me._getOrderItemInputBox("new-order-item",1,{"new-order-item":"qtyOrdered",required:!0})),discount:e.me._getFormGroup(null,e.me._getOrderItemInputBox("new-order-item",0,{"new-order-item":"discount"},function(){($F($(this)).blank()||$F($(this))>100)&&($(this).value=0,$(this).select()),e.me._calculateNewProductPrice($(this).up(".item_row"),"new-order-item")})),totalPrice:e.me._getFormGroup(null,e.me._getOrderItemInputBox("new-order-item",e.me.getCurrency(0),{"new-order-item":"totalPrice",required:!0,disabled:!0})),margin:e.me.getCurrency(0),btns:new Element("span",{"class":"btn-group btn-group-sm pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-primary"}).insert({bottom:new Element("span",{"class":" glyphicon glyphicon-floppy-saved save-new-product-btn"})}).observe("click",function(){e.me._addNewProductRow(this)})}).insert({bottom:new Element("span",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-floppy-remove"})}).observe("click",function(){confirm("You about to clear this entry. All input data for this entry will be lost.\n\nContinue?")&&(e.newRow=e.me._getNewProductRow(),e.currentRow=$(this).up(".new-order-item-input"),e.currentRow.getElementsBySelector(".form-group.has-error .form-control").each(function(e){$(e).retrieve("clearErrFunc")()}),e.currentRow.replace(e.newRow),e.newRow.down("[new-order-item=product]").focus())})})},e.me._getProductRow(e.data,!1).addClassName("new-order-item-input list-group-item-success").removeClassName("order-item-row")},_getPartsTable:function(){var e={};return e.me=this,e.productListDiv=new Element("div",{"class":"list-group order_item_list_table"}).insert({bottom:e.me._getProductRow({product:{sku:"SKU",name:"Description"},unitPrice:"Unit Price<div><small>(inc GST)</small><div>",qtyOrdered:"Qty",margin:"Margin",discount:"Disc. %",totalPrice:"Total Price<div><small>(inc GST)</small><div>",btns:new Element("div").insert({bottom:new Element("label",{"for":"hide-margin-checkbox"}).update("Show Margin ")}).insert({bottom:new Element("input",{id:"hide-margin-checkbox",type:"checkbox",checked:!0}).observe("click",function(){jQuery(".margin").toggle()})})},!0)}),e.productListDiv.insert({bottom:e.me._getNewProductRow().addClassName("list-group-item-success")}),e.productListDiv},_getShippingCostBox:function(e){var t={};return t.me=this,t.shippingCostBox=new Element("input",{"order-price-summary":"totalShippingCost","class":"form-control input-sm","save-order":"totalShippingCost",placeholder:t.me.getCurrency(0),required:!0,validate_currency:"Invalid number provided!",value:e?e:0}).observe("keyup",function(){t.me._recalculateSummary()}),t.shippingCostBox.wrap(new Element("div",{"class":"form-group"}))},_getSummaryFooter:function(){var e={};return e.me=this,e.shippingMethodSel=new Element("select",{"class":"form-control input-sm","save-order":"courierId",required:!0}).insert({bottom:new Element("option",{value:""}).update("Shipping Via:")}),e.shippingMethod=e.me._order&&e.me._order.infos[9]?e.me._order.infos[9][0].value:"",e.shippingCost=e.me._order&&e.me._order.infos[14]?e.me.getValueFromCurrency(e.me._order.infos[14][0].value):"",e.foundMatchedShippingMethod=!1,e.me._shippingMethods.each(function(t){e.sameShippingMethod=t.name.strip()===e.shippingMethod.strip(),e.shippingMethodSel.insert({bottom:new Element("option",{value:t.id,selected:e.sameShippingMethod}).update(t.name)}),e.foundMatchedShippingMethod===!1&&e.sameShippingMethod===!0&&(e.foundMatchedShippingMethod=e.sameShippingMethod)}),e.shippingMethod.blank()||e.foundMatchedShippingMethod!==!1||e.shippingMethodSel.insert({bottom:new Element("option",{value:e.shippingMethod,selected:!0}).update(e.shippingMethod.stripTags())}),e.paymentMethodSel=new Element("select",{"class":"form-control input-sm","save-order":"paymentMethodId"}).insert({bottom:new Element("option",{value:""}).update("Paid Via:")}),e.me._paymentMethods.each(function(t){e.paymentMethodSel.insert({bottom:new Element("option",{value:t.id}).update(t.name)})}),e.newDiv=new Element("div",{"class":"panel-footer"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-8"}).insert({bottom:e.me._order&&e.me._order.id?new Element("div",{"class":"comments-div-wrapper"}).store("CommentsDivJs",new CommentsDivJs(e.me,"Order",e.me._order.id)):e.me._getFormGroup("Comments:",new Element("textarea",{"save-order":"comments",rows:"8"}))})}).insert({bottom:new Element("div",{"class":"col-sm-4"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total Excl. GST: "))}).insert({bottom:new Element("div",{"class":"col-xs-6","order-price-summary":"totalPriceExcludeGST"}).update(e.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total GST: "))}).insert({bottom:new Element("div",{"order-price-summary":"totalPriceGST","class":"col-xs-6"}).update(e.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total Discount:"))}).insert({bottom:new Element("div",{"order-price-summary":"totalDiscount","class":"col-xs-6"}).update(e.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Sub Total Incl. GST: "))}).insert({bottom:new Element("div",{"order-price-summary":"totalPriceIncludeGST","class":"col-xs-6"}).update(e.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(e.me._getFormGroup("",e.shippingMethodSel.observe("change",function(){e.btn=this,$(e.btn).up(".row").down(".input-field").update($F(e.btn).blank()?e.me.getCurrency(0):e.shippingCostBox=e.me._getShippingCostBox()),e.me._recalculateSummary(),e.shippingCostBox&&e.shippingCostBox.select()})))}).insert({bottom:new Element("div",{"class":"col-xs-6 input-field"}).update(""===e.shippingCost?e.me.getCurrency(0):e.me._getShippingCostBox(e.shippingCost))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total Incl. GST:"))}).insert({bottom:new Element("strong",{"order-price-summary":"subTotal","class":"col-xs-6"}).update(e.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update(e.paymentMethodSel.observe("change",function(){e.btn=this,$(e.btn).up(".row").down(".input-field").update($F(e.btn).blank()?e.me.getCurrency(0):new Element("span",{"class":"form-group"}).update(e.paidAmountBox=new Element("input",{value:"5"===$F(e.btn).strip()?"0":"","order-price-summary":"totalPaidAmount","class":"form-control input-sm","save-order":"totalPaidAmount",placeholder:e.me.getCurrency(0),required:!0,validate_currency:"Invalid number provided!"}).observe("keyup",function(){e.me._recalculateSummary()}))),e.me._recalculateSummary(),e.paidAmountBox&&e.paidAmountBox.select()})))}).insert({bottom:new Element("div",{"class":"col-xs-6 input-field"}).update(e.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("h4",{"class":"col-xs-6 text-right"}).setStyle("color: #d30014 !important").update(new Element("strong").update("DUE:"))}).insert({bottom:new Element("h4",{"class":"col-xs-6","order-price-summary":"total-payment-due"}).setStyle("color: #d30014 !important").update(e.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row margin"}).insert({bottom:new Element("strong",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Margin Total Incl. GST:"))}).insert({bottom:new Element("strong",{"class":"col-xs-6","order-price-summary":"total-margin"}).update(e.me.getCurrency(0))})})})}),e.newDiv},_getViewOfOrder:function(){var e={};return e.me=this,e.newDiv=new Element("div").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(e.me._getCustomerInfoPanel(e.me._customer))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).insert({bottom:new Element("div",{"class":"panel"}).update(e.me._getPartsTable()).insert({bottom:e.me._getSummaryFooter()})})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(e.me._saveBtns())})}),e.newDiv},selectCustomer:function(e){var t={};return t.me=this,t.resultDiv=$(t.me._htmlIds.itemDiv),t.me._customer=e,t.resultListDiv=t.resultDiv.down(".order_item_list_table"),t.resultListDiv&&t.resultListDiv.getElementsBySelector(".item_row.order-item-row").size()>0?t.resultDiv.down(".customer-info-div").replace(t.me._getCustomerInfoPanel(e)):(t.resultListDiv=t.me._getViewOfOrder(),t.commentsDiv=t.resultDiv.update(t.resultListDiv).down(".comments-div-wrapper"),t.commentsDiv&&t.commentsDiv.retrieve("CommentsDivJs")._setDisplayDivId(t.commentsDiv).render()),t.resultListDiv.down('.new-order-item-input [new-order-item="product"]').focus(),t.me},_getCustomerRow:function(e,t){var r={};return r.me=this,r.isTitle=t||!1,r.tag=r.isTitle===!0?"th":"td",r.newDiv=new Element("tr").store("data",e).insert({bottom:new Element(r.tag).insert({bottom:r.isTitle===!0?"&nbsp;":new Element("span",{"class":"btn btn-primary btn-xs"}).update("select").observe("click",function(){r.me.selectCustomer(e),r.panels=jQuery(".panel").removeClass("panel-success").removeClass("panel-warning").removeClass("panel-default").addClass("panel-warning"),r.inputs=jQuery(".list-group-item").removeClass("list-group-item-success").removeClass("list-group-item-warning").addClass("list-group-item-warning")})})}).insert({bottom:new Element(r.tag).update(e.name)}).insert({bottom:new Element(r.tag).update(e.email)}).insert({bottom:new Element(r.tag).update(e.address&&e.address.billing?e.address.billing.full:"")}),r.newDiv},_searchCustomer:function(e,t){var r={};return r.me=this,r.pageNo=t||1,r.searchPanel=$(e).up("#"+r.me._htmlIds.searchPanel),r.searchTxt=$F(r.searchPanel.down(".search-txt")).strip(),r.me.postAjax(r.me.getCallbackId("searchCustomer"),{searchTxt:r.searchTxt,pageNo:r.pageNo},{onLoading:function(){r.me._signRandID(e),jQuery("#"+e.id).button("loading"),1===r.pageNo&&($(r.searchPanel).down(".list-div")&&$(r.searchPanel).down(".list-div").remove(),$(r.searchPanel).insert({bottom:new Element("div",{"class":"panel-body"}).update(r.me.getLoadingImg())}))},onSuccess:function(e,t){try{if(r.result=r.me.getResp(t,!1,!0),!r.result||!r.result.items)return;1===r.pageNo?($(r.searchPanel).down(".panel-body").remove(),$(r.searchPanel).insert({bottom:new Element("small",{"class":"table-responsive list-div"}).insert({bottom:new Element("table",{"class":"table table-hover table-condensed"}).insert({bottom:new Element("thead").insert({bottom:r.me._getCustomerRow({name:"Customer Name",email:"Email",address:{billing:{full:"Address"}}},!0)})}).insert({bottom:r.listDiv=new Element("tbody")})})})):r.listDiv=$(r.searchPanel).down("tbody"),$(r.searchPanel).down(".get-more-btn-wrapper")&&$(r.searchPanel).down(".get-more-btn-wrapper").remove(),r.result.items.each(function(e){r.listDiv.insert({bottom:r.me._getCustomerRow(e)})}),r.result.pagination.pageNumber<r.result.pagination.totalPages&&r.listDiv.insert({bottom:new Element("tr",{"class":"get-more-btn-wrapper"}).insert({bottom:new Element("td").insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Getting More ..."}).update("Get more").observe("click",function(){r.me._searchCustomer(this,1*r.pageNo+1)})})})})}catch(n){1===r.pageNo?$(r.searchPanel).insert({bottom:new Element("div",{"class":"panel-body"}).update(r.me.getAlertBox("ERROR",n).addClassName("alert-danger"))}):r.me.showModalBox('<strong class="text-danger">Error:</strong>',n)}},onComplete:function(){jQuery("#"+e.id).button("reset")}}),r.me},_getCustomerListPanel:function(){var e={};return e.me=this,e.newDiv=new Element("div",{id:e.me._htmlIds.searchPanel,"class":"panel panel-default search-panel"}).insert({bottom:new Element("div",{"class":"panel-heading form-inline"}).insert({bottom:new Element("strong").update("Creating a new order for: ")}).insert({bottom:new Element("span",{"class":"input-group col-sm-6"}).insert({bottom:new Element("input",{"class":"form-control search-txt init-focus",placeholder:"customer name or email"}).observe("keyup",function(){$(e.me._htmlIds.searchPanel).down(".search-btn").click()})}).insert({bottom:new Element("span",{"class":"input-group-btn search-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary","data-loading-text":"Searching ..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})})}).observe("click",function(){e.btn=this,e.me._searchCustomer(e.btn,1)})})}).insert({bottom:new Element("span",{"class":"btn btn-success pull-right btn-sm"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus-sign"})}).insert({bottom:" NEW"}).observe("click",function(){e.me._openNewCustomerPage()})})}),e.newDiv},_openNewCustomerPage:function(){var e={};return e.me=this,jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",href:"/customer/new.html",beforeClose:function(){e.newCustomer=$$("iframe.fancybox-iframe").first().contentWindow.pageJs._item,e.newCustomer.id&&e.me.selectCustomer(e.newCustomer)}}),e.me},_openProductDetailPage:function(e){var t={};return t.me=this,t.newWindow=window.open("/product/"+e+".html","Product Details","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),t.newWindow.focus(),t.me},setOriginalOrder:function(e){var t={};return t.me=this,t.me._originalOrder=e,t.me},_populateOrderItems:function(e){var t={};return t.me=this,e.size()>0&&(t.productListDiv=$(t.me._htmlIds.itemDiv).down(".order_item_list_table"),e.each(function(e){t.unitPriceValue=t.me.getValueFromCurrency(e.unitPrice),t.totalPriceValue=t.me.getValueFromCurrency(e.totalPrice),t.data={id:e.id,product:e.product,itemDescription:e.itemDescription,unitPrice:t.me.getCurrency(t.unitPriceValue),qtyOrdered:e.qtyOrdered,discount:(t.unitPriceValue*e.qtyOrdered-t.totalPriceValue)/t.totalPriceValue,margin:t.me.getCurrency(t.me.getValueFromCurrency(e.margin)),totalPrice:t.me.getCurrency(t.totalPriceValue),scanTable:t.me._getScanTable(e),orderItem:t.me._order&&t.me._order.id?e:{}},t.productListDiv.insert({bottom:t.me._getProductRow(t.data)})}),t.me._recalculateSummary()),t.me},init:function(e){var t={};return t.me=this,t.className="warning",t.me._order&&t.me._order.id?(t.me.selectCustomer(t.me._order.customer)._populateOrderItems(t.me._order.items),t.className="QUOTE"===t.me._order.type?"warning":"ORDER"===t.me._order.type?"success":"default"):e?t.me.selectCustomer(e):t.me._originalOrder?(t.me.selectCustomer(t.me._originalOrder.customer)._populateOrderItems(t.me._originalOrder.items),t.className="QUOTE"===t.me._originalOrder.type?"warning":"ORDER"===t.me._order.type?"success":"default"):$(t.me._htmlIds.itemDiv).update(t.me._getCustomerListPanel()),t.panels=jQuery(".panel").removeClass("panel-success").removeClass("panel-warning").removeClass("panel-default").addClass("panel-"+t.className),t.inputs=jQuery(".list-group-item").removeClass("list-group-item-success").removeClass("list-group-item-warning").addClass("list-group-item-"+t.className),$$(".init-focus").size()>0&&$$(".init-focus").first().focus(),t.me},disableEverything:function(){var e={};return e.me=this,jQuery(".btn").attr("disabled",!0),jQuery("input").attr("disabled",!0),jQuery(".form-control").attr("disabled",!0),e.me}});