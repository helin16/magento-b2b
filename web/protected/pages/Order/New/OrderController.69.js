var PageJs=new Class.create;
PageJs.prototype=Object.extend(new BPCPageJs,{_customer:null,_order:null,setOrder:function(a){this._order=a;return this},setPaymentMethods:function(a){this._paymentMethods=a;return this},setShippingMethods:function(a){this._shippingMethods=a;return this},setOrderTypes:function(a){this._orderTypes=a;return this},_getFormGroup:function(a,c){return(new Element("div",{"class":"form-group"})).insert({bottom:a?(new Element("label",{"class":"control-label"})).update(a):""}).insert({bottom:c.addClassName("form-control")})},_redirectOrder:function(a){var c=
{me:this};c.redirectURL=a&&a.target?jQuery(c.eventTarget).find('[window="redirec-url"]').val():jQuery('[window="redirec-url"]').val();c.redirectURL&&!c.redirectURL.blank()&&(window.location=c.redirectURL);return c.me},_preConfirmSubmit:function(a){var c,b,d,g;c=this;b=$$('[save-order="totalPaidAmount"]').first();d=jQuery('[save-order-type="type"]').val();if(!b||"INVOICE"===d)return c._confirmSubmit(a);b=c._collectFormData($(c.getHTMLID("itemDiv")),"save-order");if(null===b)return c;if(b.totalPaidAmount&&
0<b.totalPaidAmount)g=(new Element("div",{"class":"confirm-div"})).insert({bottom:(new Element("h4",{"class":"text-danger"})).update("You are recording a payment with "+c.getCurrency(b.totalPaidAmount)+" against this "+d+", it will be push to an INVOICE.")}).insert({bottom:(new Element("div",{"class":"text-right"})).insert({bottom:(new Element("span",{"class":"btn btn-danger","data-loading-text":"Pushing..."})).update("OK").observe("click",function(){c._confirmSubmit(a,g)})})}),c.showModalBox('<strong class="text-danger">Warning! Payments Provided:</strong>',
g,!1,null,{"hide.bs.modal":function(a){c._redirectOrder(a)}});else return c._confirmSubmit(a);return c},_confirmSubmit:function(a,c){var b,d,g,e,f,h,k;b=this;d=!0===a?!0:!1;g=c||null;e=b._collectFormData($(b.getHTMLID("itemDiv")),"save-order");if(null===e)return b;e.printIt=d;e.type=e.totalPaidAmount&&0<e.totalPaidAmount?"INVOICE":jQuery('[save-order-type="type"]').val();e.customer={};e.customer.id=b._customer.id;if(d=$$(".shipping-address.address-div").first()){d=b._collectFormData(d,"address-editable-field");
if(null===d)return b;e.shippingAddr=d}e.items=[];f=!1;h=[];$$(".order-item-row").each(function(a){k=a.retrieve("data");a.hasClassName("deactivated")||(f=!0);k.product&&k.product.active&&!0!==k.product.active&&h.push(k.product.sku);e.items.push({id:k.id?k.id:"",active:!a.hasClassName("deactivated"),product:{id:k.product.id},itemDescription:k.itemDescription,unitPrice:k.unitPrice,qtyOrdered:k.qtyOrdered,totalPrice:k.totalPrice,serials:a.retrieve("serials")})});if(!1===f)return b.showModalBox('<strong class="text-danger">Error</strong>',
"At least one order item is needed!",!0),b;if("INVOICE"===e.type&&0<h.size())return b.showModalBox('<strong class="text-danger">Error</strong>',"Products (SKUs:"+h.join(", ")+") are DEACTIVATED, please change them to the proper product firste before convert this to an INVOICE"),b;e.items.each(function(a){a.totalPrice=b.getValueFromCurrency(a.totalPrice);a.unitPrice=b.getValueFromCurrency(a.unitPrice)});d=(new Element("div")).insert({bottom:(new Element("h4")).update("Have all the GOODs deliver / given to the customer?")}).insert({bottom:(new Element("ul")).insert({bottom:(new Element("li")).update(" - YES: This "+
e.type+" will push this order to be an INVOICE and status SHIPPED")}).insert({bottom:(new Element("li")).update(" - NO: This "+e.type+" will be saved as status NEW")})}).insert({bottom:(new Element("div")).insert({bottom:(new Element("span",{"class":"btn btn-danger",title:"This will push this order to be an INVOICE and status SHIPPED"})).update("YES").observe("click",function(){e.type="INVOICE";e.shipped=!0;b._submitOrder(this,e)})}).insert({bottom:(new Element("span",{"class":"btn btn-primary pull-right",
title:"This will push this order to be an INVOICE and status SHIPPED"})).update("NO").observe("click",function(){b._submitOrder(this,e)})})});null===g?b.showModalBox('<strong class="text-info">Confirmation Needed</strong>',d,!1,null,{"hide.bs.modal":function(a){b._redirectOrder(a)}}):(g.up(".modal-content").down(".modal-title").update('<strong class="text-info">Confirmation Needed</strong>'),g.replace(d));return b},_submitOrder:function(a,c){var b,d,g,e,f,h,k,l;b=this;d=$(a).up(".modal-content");
g=d.down(".modal-title");e=d.down(".modal-body");b._order&&b._order.id?c.orderId=b._order.id:b._originalOrder&&b._originalOrder.id&&(c.orderCloneFromId=b._originalOrder.id);if(!b._order||!b._order.id)if(f=$(b.getHTMLID("itemDiv")).down('.memo-panel .new-memo-div [new-memo="comments"]'))f=$F(f),f.blank()||(c.newMemo=f.strip());b.postAjax(b.getCallbackId("saveOrder"),c,{onCreate:function(a,b){g.update("Please wait...");e.update('<h4>Submitting the data, please be patient.</h4><div><h3 class="fa fa-spinner fa-spin"></h3></div>')},
onSuccess:function(a,f){try{(h=b.getResp(f,!1,!0))&&h.item&&(b._order=b._item=h.item,console.log(c),console.log(h),k=h.redirectURL,d.insert({bottom:new Element("input",{window:"redirec-url",type:"hidden",value:k})}),$extraMsg="",h.printURL&&((l=window.open(h.printURL,"Printing Order","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"))||($extraMsg='<h4>Your browser has block the popup window, please enable it for further operations.</h4><a href="'+
h.printURL+'" target="_BLANK"> click here for now</a>')),g.update('<strong class="text-success">Success!</strong>'),e.update('<h4 class="text-success">Saved Successfully for '+h.item.type+": "+h.item.orderNo+'</h4><div><a class="btn btn-primary" href="javascript: void(0)" onclick="pageJs.hideModalBox();"> click here to view it</a></div>'),(k||!c.orderId&&b._order.id)&&b._redirectOrder())}catch(q){g.update('<h4 class="text-danger">Error:</h4>'),e.update(q)}},onComplete:function(a,b){}});return b},
_saveBtns:function(){var a;a=this;return(new Element("div")).insert({bottom:(new Element("div",{"class":"btn-group pull-right"})).insert({bottom:(new Element("span",{"class":"btn btn-primary save-btn"})).insert({bottom:(new Element("span")).update(" Save ")}).observe("click",function(){a._preConfirmSubmit(!1)})}).insert({bottom:(new Element("span",{"class":"btn btn-info save-btn"})).insert({bottom:(new Element("span")).update(" Save & Print ")}).observe("click",function(){a._preConfirmSubmit(!0)})})})},
_getAddressDiv:function(a,c,b){var d;d=c||null;b=b||!1;a=(new Element("div",{"class":"address-div"})).insert({bottom:(new Element("strong")).update(a)}).insert({bottom:(new Element("dl",{"class":"dl-horizontal dl-condensed"})).insert({bottom:(new Element("dt")).update(new Element("span",{"class":"glyphicon glyphicon-user",title:"Customer Name"}))}).insert({bottom:(new Element("dd")).insert({bottom:(new Element("div")).insert({bottom:(new Element("div",{"class":"col-sm-6"})).update(!0!==b?c.contactName:
new Element("input",{"address-editable-field":"contactName","class":"form-control input-sm",placeholder:"The name of contact person",value:d.contactName?d.contactName:""}))}).insert({bottom:(new Element("div",{"class":"col-sm-6"})).update(!0!==b?c.contactNo:new Element("input",{"address-editable-field":"contactNo","class":"form-control input-sm",placeholder:"The contact number of contact person",value:d.contactNo?d.contactNo:""}))})})}).insert({bottom:(new Element("dt")).update(new Element("span",
{"class":"glyphicon glyphicon-map-marker",title:"Address"}))}).insert({bottom:(new Element("dd")).insert({bottom:(new Element("div")).insert({bottom:!0!==b?c.street:(new Element("div",{"class":"street col-sm-12"})).update(new Element("input",{"address-editable-field":"street","class":"form-control input-sm",placeholder:"Street Number and Street name",value:d.street?d.street:""}))})}).insert({bottom:(new Element("div")).insert({bottom:!0!==b?c.city+" ":(new Element("div",{"class":"city col-sm-6"})).update(new Element("input",
{"address-editable-field":"city","class":"form-control input-sm",placeholder:"City / Suburb",value:d.city?d.city:""}))}).insert({bottom:!0!==b?c.region+" ":(new Element("div",{"class":"region col-sm-3"})).update(new Element("input",{"address-editable-field":"region","class":"form-control input-sm",placeholder:"State / Province",value:d.region?d.region:""}))}).insert({bottom:!0!==b?c.postCode:(new Element("div",{"class":"postcode col-sm-3"})).update(new Element("input",{"address-editable-field":"postCode",
"class":"form-control input-sm",placeholder:"PostCode",value:d.postCode?d.postCode:""}))})}).insert({bottom:(new Element("div")).insert({bottom:!0!==b?c.country:(new Element("div",{"class":"postcode col-sm-4"})).update(new Element("input",{"address-editable-field":"country","class":"form-control input-sm",placeholder:"Country",value:d.country?d.country:""}))})})})});!0===b&&a.writeAttribute("address-editable",!0);return a},_openCustomerDetailsPage:function(a){var c,b;c=this;jQuery.fancybox({width:"95%",
height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",href:"/customer/"+a.id+".html?blanklayout=1",beforeClose:function(){(b=$$("iframe.fancybox-iframe").first().contentWindow.pageJs._item)&&b.id&&c.selectCustomer(b)}});return c},_deactiveOrder:function(a){var c,b,d,g;c=this;b=$(a).up(".confirm-div");b.getElementsBySelector(".msg").each(function(a){a.remove()});d=c._collectFormData(b,"confirm-panel");if(null!==d)return d.orderId=c._order.id,c.postAjax(c.getCallbackId("cancelOrder"),
d,{onCreate:function(){c._signRandID(a);jQuery("#"+a.id).button("loading")},onSuccess:function(a,d){try{(g=c.getResp(d,!1,!0))&&g.item&&g.item.id&&(c._order=g.item,b.update('<h4 class="text-success">This '+c._order.type+" has been CANCELLED successfully.</h4>"),c.disableEverything())}catch(h){b.insert({top:(new Element("h4",{"class":"msg"})).update((new Element("span",{"class":"label label-danger"})).update(h))})}},onComplete:function(){jQuery("#"+a.id).button("reset")}}),c},_showConfirmCancelOrderPanel:function(a){var c;
c=this;a=(new Element("div",{"class":"confirm-div"})).insert({bottom:(new Element("div")).insert({bottom:c._getFormGroup("You are about CANCEL this "+c._order.type+", please provide some reason:",new Element("input",{value:"","confirm-panel":"reason",required:!0,placeholder:"The Reason For CANCELLATION"}))})}).insert({bottom:(new Element("div",{"class":"text-right"})).insert({bottom:(new Element("span",{"class":"btn btn-default pull-left"})).update("CANCEL").observe("click",function(){c.hideModalBox()})}).insert({bottom:(new Element("span",
{"class":"btn btn-danger","data-loading-text":"Sending ..."})).update("Yes, Cancel this "+c._order.type).observe("click",function(){c._deactiveOrder(this)})})});c.showModalBox("<strong>Confirm Cancellation:</strong>",a);return c},_getCustomerInfoPanel:function(a){var c,b,d,g,e,f;c=this;b=new Element("select",{"save-order-type":"type"});c._orderTypes.each(function(a){b.insert({bottom:(new Element("option",{value:a,selected:c._order&&c._order.type===a})).update(a)}).observe("change",function(){d=jQuery(".panel").removeClass("panel-success").removeClass("panel-warning").removeClass("panel-default");
g=jQuery(".item_row_header").removeClass("list-group-item-success").removeClass("list-group-item-warning");"QUOTE"===$F(this)?(d.addClass("panel-warning"),g.addClass("list-group-item-warning")):"ORDER"===$F(this)?(d.addClass("panel-success"),g.addClass("list-group-item-success")):d.addClass("panel-default")})});e=new Element("div");c._order&&c._order.id&&e.update((new OrderBtnsJs(c,c._order)).getBtnsDiv()).insert({bottom:(new Element("btn",{"class":"btn btn-danger btn-xs pull-right"})).update("CANCEL THIS "+
c._order.type).observe("click",function(){c._showConfirmCancelOrderPanel(this)})});f=c._order&&c._order.address?c._order.address:a.address;return(new Element("div",{"class":"panel customer-info-div"})).insert({bottom:(new Element("div",{"class":"panel-heading"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-8"})).insert({bottom:(new Element("strong")).update((c._order&&c._order.id?"Editing":"CREATING")+" A ")}).insert({bottom:b}).insert({bottom:c._order&&
c._order.id?(new Element("strong")).update(" "+c._order.orderNo).setStyle("margin-left: 5px; margin-right: 25px;"):""}).insert({bottom:(new Element("strong")).update(" FOR:  ")}).insert({bottom:(new Element("a",{href:"javascript: void(0);","class":"customer-edit-link"})).update(a.name).observe("click",function(){c._openCustomerDetailsPage(a)})}).insert({bottom:" <"}).insert({bottom:(new Element("a",{href:"mailto:"+a.email})).update(a.email)}).insert({bottom:">"}).insert({bottom:(new Element("strong")).update(" with PO No.:")}).insert({bottom:(new Element("input",
{type:"text","save-order":"poNo",placeholder:"Optional - PO No. From Customer",value:c._order&&c._order.pONo?c._order.pONo:""})).setStyle("width: 200px;")}).insert({bottom:c._originalOrder?(new Element("span")).setStyle("margin-left: 8px;").insert({bottom:(new Element("strong",{"class":"text-danger"})).update("CLONING FROM: ")}).insert({bottom:(new Element("a",{href:"/orderdetails/"+c._originalOrder.id+".html",target:"_BLANK"})).update(c._originalOrder.orderNo)}):""})}).insert({bottom:(new Element("div",
{"class":"col-sm-4"})).update(e)})})}).insert({bottom:(new Element("div",{"class":"panel-body"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("small")).update((new Element("em")).update(a.description))})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:c._getAddressDiv("Billing Address: ",f&&f.billing?f.billing:null).addClassName("col-xs-6")}).insert({bottom:c._getAddressDiv("Shipping Address: ",f&&f.shipping?f.shipping:null,!0).addClassName("col-xs-6").addClassName("shipping-address")})})})},
_getProductRow:function(a,c){var b,d,g,e,f,h,k,l,m,n,q,p,r,v,t,u;b=this;d=c||!1;g=!0===d?"strong":"div";e=a.btns?a.btns:(new Element("span",{"class":"pull-right"})).insert({bottom:(new Element("span",{"class":"btn btn-danger btn-xs"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){if(confirm("You remove this entry.\n\nContinue?")){if(f=$(this).up(".item_row"))h=f.retrieve("data"),h.id?(h.active=!1,f.store("data",h),f.hide(),f.addClassName("deactivated")):
f.remove();b._recalculateSummary()}})});f=(new Element("div",{"class":"list-group-item "+(!0===d?"item_row_header":"item_row order-item-row")})).store("data",a).insert({bottom:(new Element("div",{"class":"row"})).store("data",a).insert({bottom:(new Element(g,{"class":"productName col-xs-6"})).insert({bottom:a.itemDescription?a.itemDescription:a.product.shortDescription&&!a.product.shortDescription.blank()?a.product.shortDescription:a.product.name})}).insert({bottom:(new Element(g,{"class":"uprice col-xs-1"})).insert({bottom:!0===
d||"object"===typeof a.unitPrice?a.unitPrice:b._getFormGroup(null,b._getOrderItemInputBox("order-item",b.getCurrency(b.getValueFromCurrency(a.unitPrice)),{"order-item":"unitPrice",required:!0}))})}).insert({bottom:(new Element(g,{"class":"col-xs-2"})).insert({bottom:(new Element("div")).insert({bottom:(new Element("div",{"class":"qty col-xs-6"})).update(!0===d||"object"===typeof a.qtyOrdered?a.qtyOrdered:b._getFormGroup(null,k=b._getOrderItemInputBox("order-item",a.qtyOrdered,{"order-item":"qtyOrdered",
required:!0})))}).insert({bottom:(new Element("div",{"class":"discount col-xs-6"})).update(!0===d||"object"===typeof a.discount?a.discount:b._getFormGroup(null,b._getOrderItemInputBox("order-item",a.discount,{"order-item":"discount"})))})})}).insert({bottom:(new Element(g,{"class":"tprice col-xs-1"})).insert({bottom:!0===d||"object"===typeof a.totalPrice?a.totalPrice:b._getFormGroup(null,b._getOrderItemInputBox("order-item",a.totalPrice,{"order-item":"totalPrice",disabled:!0,required:!0}))})}).insert({bottom:(new Element(g,
{"class":"margin col-xs-1 text-right"})).update(a.margin)}).insert({bottom:(new Element(g,{"class":"btns col-xs-1 text-right"})).update(e)})});k&&k.observe("change",function(a){k=this;l=$F(this);m=this.up(".order-item-row").down(".scanTable").getElementsBySelector('input[scanned-item="serialNo"]');if(l>m.length)for(n=0;n<l-m.length;n++)q=b._getScanTableRow({}).wrap(new Element("div",{"class":"col-sm-3"})),k.up(".order-item-row").down(".scanTable").insert({bottom:q});else if(l<m.length)for(n=0;n<m.length-
l;n++)m[m.length-n-1].remove();p=null;r=[];$(this).up(".order-item-row").down(".scanTable").getElementsBySelector('input[scanned-item="serialNo"]').each(function(a){$F(a).blank()||r.push($F(a));null===p&&$F(a).blank()&&(p=a)});$(this).up(".order-item-row").store("serials",r);null!==p&&p.select()});a.id&&f.writeAttribute("item-id",a.id);a.product.sku&&f.down(".productName").removeClassName("col-xs-6").addClassName("col-xs-4").insert({before:(new Element(g,{"class":"productSku col-xs-2"})).insert({bottom:a.product&&
a.product.isKit&&!0===a.product.isKit?(new Element("abbr",{"class":"text-danger initialism",title:"This product a kit"})).setStyle("margin-right: 4px;").update(new Element("i",{"class":"glyphicon glyphicon-wrench"})):""}).insert({bottom:(new Element(a.product.id?"a":"span",{href:"javascript: void(0);"})).update(a.product.sku).observe("click",function(c){Event.stop(c);(v=a.product&&a.product.id?a.product.id:void 0)&&b._openProductDetailPage(v)})})});a.scanTable&&(f.insert({bottom:(new Element("div",
{"class":"row product-content-row"})).insert({bottom:(new Element("span",{"class":"col-sm-2 show-tools"})).insert({bottom:(new Element("input",{type:"checkbox",checked:!1,"class":"show-panel-check"})).observe("click",function(){t=this;u=$(t).up(".product-content-row").down(".serial-no-scan-panel");t.checked?u.show():u.hide()})}).insert({bottom:(new Element("a",{href:"javascript: void(0);"})).update(" show serial scan panel?").observe("click",function(){$(this).up(".show-tools").down(".show-panel-check").click()})})}).insert({bottom:(new Element("span",
{"class":"col-sm-10 serial-no-scan-panel"})).setStyle("padding-top: 5px; display: none;").update(a.scanTable)})}),a.orderItem&&a.orderItem.sellingitems&&0<a.orderItem.sellingitems.length&&(r=[],a.orderItem.sellingitems.each(function(a){r.push(a.serialNo)}),f.store("serials",r)));return f},_getSearchPrductResultRow:function(a,c){var b,d,g,e,f;b=this;return d=(new Element("a",{"class":"list-group-item search-product-result-row",href:"javascript: void(0);"})).store("data",a).insert({bottom:(new Element("div",
{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-2"})).insert({bottom:(new Element("div",{"class":"thumbnail"})).insert({bottom:new Element("img",{"data-src":"holder.js/100%x64",alert:"Product Image",src:0===a.images.size()?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+":
a.images[0].asset.url})})})}).insert({bottom:(new Element("div",{"class":"col-xs-10"})).insert({bottom:(new Element("a",{href:"javascript: void(0);"})).update(a.shortDescription.blank()?a.name:a.shortDescription).observe("click",function(a){Event.stop(a);($productId=$(this).up(".search-product-result-row").retrieve("data").id)&&b._openProductDetailPage($productId)}).insert({bottom:(new Element("small",{"class":"pull-right"})).update("SKU: "+a.sku)})}).insert({bottom:(new Element("div")).insert({bottom:(new Element("small")).update(a.shortDescription)})}).insert({bottom:(new Element("div")).insert({bottom:(new Element("small",
{"class":"col-xs-4"})).insert({bottom:(new Element("div",{"class":"input-group input-group-sm",title:"stock on HAND"})).insert({bottom:(new Element("span",{"class":"input-group-addon"})).update("SOH:")}).insert({bottom:(new Element("strong",{"class":"form-control"})).update(a.stockOnHand)})})}).insert({bottom:(new Element("small",{"class":"col-xs-4"})).insert({bottom:(new Element("div",{"class":"input-group input-group-sm",title:"stock on ORDER"})).insert({bottom:(new Element("span",{"class":"input-group-addon"})).update("SOO:")}).insert({bottom:(new Element("strong",
{"class":"form-control"})).update(a.stockOnOrder)})})}).insert({bottom:(new Element("small",{"class":"col-xs-4"})).insert({bottom:(new Element("div",{"class":"input-group input-group-sm",title:"stock on PO"})).insert({bottom:(new Element("span",{"class":"input-group-addon"})).update("SOP:")}).insert({bottom:(new Element("strong",{"class":"form-control"})).update(a.stockOnPO)})})})}).insert({bottom:(new Element("div")).insert({bottom:(new Element("div",{"class":"col-xs-6"})).insert({bottom:(new Element("span")).update("Last UnitPrice from this customer:")}).insert({bottom:a.lastOrderItemFromCustomer&&
a.lastOrderItemFromCustomer.order&&a.lastOrderItemFromCustomer.order.id?(new Element("a",{href:"javascript: void(0);",title:"Last purchased unit price for this customer:"+a.lastOrderItemFromCustomer.order.orderNo})).update(b.getCurrency(a.lastOrderItemFromCustomer.unitPrice)).observe("click",function(b){Event.stop(b);g=window.open("/orderdetails/"+a.lastOrderItemFromCustomer.order.id+".html","_blank");g.focus()}):"NA"})})})})}).observe("click",function(){e=$(c).up(".new-order-item-input").store("product",
a);c.up(".productName").writeAttribute("colspan",!1).update((new Element("a",{href:"javascript: void(0);"})).insert({bottom:a.isKit&&!0===a.isKit?(new Element("abbr",{"class":"text-danger initialism",title:"This product a kit"})).setStyle("margin-right: 4px;").update(new Element("i",{"class":"glyphicon glyphicon-wrench"})):""}).insert({bottom:(new Element("span")).update(a.sku)}).observe("click",function(c){Event.stop(c);($productId=a.id)&&b._openProductDetailPage($productId)})).removeClassName("col-xs-8").addClassName("col-xs-2").insert({bottom:(new Element("a",
{href:"javascript: void(0);","class":"text-danger pull-right",title:"click to change the product"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){d=b._getNewProductRow();$(this).up(".new-order-item-input").replace(d);d.down("[new-order-item=product]").select()})}).insert({after:(new Element("div",{"class":"col-xs-4"})).update((new Element("textarea",{"new-order-item":"itemDescription"})).setStyle("width: 100%").update(a.shortDescription.blank()?
a.name:a.shortDescription))});jQuery("#"+b.modalId).modal("hide");f=0===a.prices.size()?0:a.prices[0].price;e.down("[new-order-item=unitPrice]").writeAttribute("value",b.getCurrency(f)).select();b._calculateNewProductPrice(e,"new-order-item")})},_searchProduct:function(a,c,b){var d,g,e,f,h,k,l,m;d=this;g=!0===$(a).retrieve("showMore")?!0:!1;e=c||1;d._signRandID(a);f=$(a).up(".product-autocomplete")&&$(a).up(".product-autocomplete").down(".search-txt")?$(a).up(".product-autocomplete").down(".search-txt"):
$($(a).retrieve("searchBoxId"));d._signRandID(f);h=$F(f);d.postAjax(d.getCallbackId("searchProduct"),{searchTxt:h,pageNo:e,customerId:d._customer?d._customer.id:""},{onCreate:function(){jQuery("#"+a.id).button("loading");jQuery("#"+f.id).button("loading")},onSuccess:function(c,q){k=!1===g?new Element("div",{"class":"search-product-list"}):$(a).up(".search-product-list");try{l=d.getResp(q,!1,!0);if(!l||!l.items||0===l.items.size())throw"Nothing Found for: "+h;d._signRandID(f);l.items.each(function(a){k.insert({bottom:d._getSearchPrductResultRow(a,
f)})});k.addClassName("list-group")}catch(p){k.update(d.getAlertBox("Error: ",p).addClassName("alert-danger"))}"function"===typeof b&&b();l.pagination.pageNumber<l.pagination.totalPages&&k.insert({bottom:(new Element("a",{"class":"item-group-item"})).insert({bottom:(new Element("span",{"class":"btn btn-primary","data-loading-text":"Getting more ..."})).update("Show Me More")}).observe("click",function(){m=$(this);$(m).store("searchBoxId",f.id);$(m).store("showMore",!0);d._searchProduct(this,1*e+1,
function(){$(m).remove()})})});!1===g&&d.showModalBox("Products that has: "+h,k,!1)},onComplete:function(b,c){jQuery("#"+a.id).button("reset");jQuery("#"+f.id).button("reset")}});return d},_getNewProductProductAutoComplete:function(){var a,c,b;a=this;c=a._getFormGroup(null,(new Element("div",{"class":"input-group input-group-sm product-autocomplete"})).insert({bottom:(new Element("input",{"class":"form-control search-txt visible-xs visible-sm visible-md visible-lg","new-order-item":"product",required:!0,
placeholder:"search SKU, NAME and any BARCODE for this product"})).observe("keyup",function(c){b=this;a.keydown(c,function(){$(b).up(".product-autocomplete").down(".search-btn").click()})}).observe("keydown",function(c){b=this;a.keydown(c,function(){$(b).up(".product-autocomplete").down(".search-btn").click()},function(){},Event.KEY_TAB)})}).insert({bottom:(new Element("span",{"class":"input-group-btn"})).insert({bottom:(new Element("span",{"class":" btn btn-primary search-btn","data-loading-text":"searching..."})).insert({bottom:new Element("span",
{"class":"glyphicon glyphicon-search"})}).observe("click",function(){$F($(this).up(".product-autocomplete").down(".search-txt")).blank()?$(this).up(".product-autocomplete").down(".search-txt").focus():a._searchProduct(this)})})}));c.down(".input-group").removeClassName("form-control");return c},_recalculateSummary:function(){var a,c,b,d,g,e,f;a=this;d=b=c=0;$$(".item_row.order-item-row").each(function(f){g=f.retrieve("data");!1!==g.active&&(b=1*b+1*a.getValueFromCurrency(g.totalPrice),c=1*c+a.getValueFromCurrency(g.unitPrice)*
g.qtyOrdered,g.margin&&(d=1*d+1*a.getValueFromCurrency(g.margin)))});e=1*b/1.1;jQuery('[order-price-summary="totalPriceExcludeGST"]').val(a.getCurrency(e)).html(a.getCurrency(e));e=1*b-1*e;jQuery('[order-price-summary="totalPriceGST"]').val(a.getCurrency(e)).html(a.getCurrency(e));e=1*c-1*b;jQuery('[order-price-summary="totalDiscount"]').val(a.getCurrency(e)).html(a.getCurrency(e));jQuery('[order-price-summary="totalPriceIncludeGST"]').val(a.getCurrency(b)).html(a.getCurrency(b));e=1*(0<jQuery('[order-price-summary="totalShippingCost"]').length?
jQuery('[order-price-summary="totalShippingCost"]').val():0)+1*b;jQuery('[order-price-summary="subTotal"]').val(a.getCurrency(e)).html(a.getCurrency(e));f=0<jQuery('[order-price-summary="totalPaidAmount"]').length?jQuery('[order-price-summary="totalPaidAmount"]').val():0;e=1*e-1*f;0>e&&a.showModalBox('<h4 class="text-danger">Attention!</h4>','<div><strong>The customer has paid more than the due amount?</strong></div><div><span class="btn btn-primary" onclick="pageJs.hideModalBox();">OK</span>',!0);
jQuery('[order-price-summary="total-payment-due"]').val(a.getCurrency(e)).html(a.getCurrency(e));jQuery('[order-price-summary="total-margin"]').val(a.getCurrency(d)).html(a.getCurrency(d));return a},_addNewProductRow:function(a){var c,b,d,g,e,f;a=$(a).up(".new-order-item-input");if(c=a.retrieve("product"))if(b=a.down("[new-order-item=unitPrice]"),d=this.getValueFromCurrency($F(b)),null===d.match(/^\d+(\.\d{1,2})?$/))this._markFormGroupError(b,"Invalid value provided!");else if(g=a.down("[new-order-item=qtyOrdered]"),
b=this.getValueFromCurrency($F(g)),null===b.match(/^\d+(\.\d{1,2})?$/)||0==b)this._markFormGroupError(g,"Invalid value provided!");else if(e=a.down("[new-order-item=discount]"),g=this.getValueFromCurrency($F(e)),null===g.match(/^\d+(\.\d{1,2})?$/))this._markFormGroupError(e,"Invalid value provided!");else if(f=a.down("[new-order-item=totalPrice]"),e=this.getValueFromCurrency($F(f)),null===e.match(/^\d+(\.\d{1,2})?$/))this._markFormGroupError(f,"Invalid value provided!");else return a.getElementsBySelector(".form-group.has-error .form-control").each(function(a){$(a).retrieve("clearErrFunc")()}),
f=$F(a.down("[new-order-item=itemDescription]")).replace(/\n/g,"<br />"),c={product:c,itemDescription:f,unitPrice:this.getCurrency(d),qtyOrdered:b,discount:g,margin:this.getCurrency(parseFloat(e)-parseFloat(1.1*c.unitCost*b)),totalPrice:this.getCurrency(e)},c.scanTable=this._getScanTable(c),a.up(".list-group").insert({bottom:this._getProductRow(c)}),c=this._getNewProductRow(),a.replace(c).addClassName(),c.down("[new-order-item=product]").focus(),this._recalculateSummary(),this;else c=a.down("[new-order-item=product]"),
a.down("[new-order-item=product]")?this._markFormGroupError(c,"Select a product first!"):this.showModalBox("Product Needed","Select a product first!",!0)},_getScanTable:function(a){var c,b,d;c=new Element("div",{"class":"scanTable"});for(b=0;b<a.qtyOrdered;b++)d=a.sellingitems&&a.sellingitems[b]&&jQuery.isNumeric(a.sellingitems[b].id)?a.sellingitems[b]:{},c.insert({bottom:this._getScanTableRow(d).wrap(new Element("div",{"class":"col-sm-3"}))});return c},_getScanTableRow:function(a){var c,b,d;c=(new Element("div")).update((new Element("input",
{"class":"form-control","scanned-item":"serialNo",type:"text",placeholder:"Serial Number:",value:a.serialNo&&""!==a.serialNo?a.serialNo:""})).observe("change",function(){b=null;d=[];$(this).up(".scanTable").getElementsBySelector('input[scanned-item="serialNo"]').each(function(a){$F(a).blank()||d.push($F(a));null===b&&$F(a).blank()&&(b=a)});$(this).up(".order-item-row").store("serials",d);null!==b&&b.select()}));a&&a.kit&&a.kit.id&&c.addClassName("input-group input-group-sm").insert({bottom:(new Element("a",
{"class":"input-group-addon btn btn-primary",href:"/kit/"+a.kit.id+".html",target:"_BLANK"})).insert({bottom:new Element("i",{"class":"glyphicon glyphicon-link"})})});return c},_calculateNewProductPrice:function(a,c){var b,d,g,e,f,h;b=this.getValueFromCurrency($F(a.down("["+c+"=unitPrice]")));d=$F(a.down("["+c+"=discount]")).strip().replace("%","");g=$F(a.down("["+c+"=qtyOrdered]")).strip();e=b*(1-d/100)*g;$(a.down("["+c+"=totalPrice]")).value=this.getCurrency(e);f=a.retrieve("product")?a.retrieve("product"):
a.retrieve("data")&&a.retrieve("data").product?a.retrieve("data").product:{};f.id&&(f=f.unitCost,h=this.getCurrency(1*e-1.1*f*g),a.down(".margin")&&$(a.down(".margin")).update(h+(0===parseInt(f)?'<div><small class="label label-danger">No Cost Yet</small</div>':"")));f=a.retrieve("data");f.unitPrice=b;f.discount=d;f.qtyOrdered=g;f.totalPrice=e;h&&(f.margin=h);a.store("data",f);return this},_bindSubmitNewProductRow:function(a,c){this.keydown(a,function(){$(c)&&$(c).up(".item_row")&&$(c).up(".item_row").down(".save-new-product-btn")&&
$(c).up(".item_row").down(".save-new-product-btn").click()});return this},_getOrderItemInputBox:function(a,c,b,d,g,e){var f,h;f=this;h=Element("input",{"class":"input-sm",value:c}).observe("click",function(a){"function"===typeof d&&d(a)}).observe("keydown",function(a){"function"===typeof g?g(a):f._bindSubmitNewProductRow(a,this)}).observe("keyup",function(b){if("function"===typeof e)e(b);else try{f._calculateNewProductPrice($(this).up(".item_row"),a),f._recalculateSummary()}catch(c){f.showModalBox("Error",
c)}});$H(b).each(function(a){h.writeAttribute(a.key,a.value)});return h},_getNewProductRow:function(){var a,c,b,d;a=this;c={product:{name:a._getNewProductProductAutoComplete()},unitPrice:a._getFormGroup(null,a._getOrderItemInputBox("new-order-item",a.getCurrency(0),{"new-order-item":"unitPrice",required:!0})),qtyOrdered:a._getFormGroup(null,a._getOrderItemInputBox("new-order-item",1,{"new-order-item":"qtyOrdered",required:!0})),discount:a._getFormGroup(null,a._getOrderItemInputBox("new-order-item",
0,{"new-order-item":"discount"},function(b){if($F($(this)).blank()||100<$F($(this)))$(this).value=0,$(this).select();a._calculateNewProductPrice($(this).up(".item_row"),"new-order-item")})),totalPrice:a._getFormGroup(null,a._getOrderItemInputBox("new-order-item",a.getCurrency(0),{"new-order-item":"totalPrice",required:!0,disabled:!0})),margin:a.getCurrency(0),btns:(new Element("span",{"class":"btn-group btn-group-sm pull-right"})).insert({bottom:(new Element("span",{"class":"btn btn-primary"})).insert({bottom:new Element("span",
{"class":"glyphicon glyphicon-floppy-saved save-new-product-btn"})}).observe("click",function(){a._addNewProductRow(this)})}).insert({bottom:(new Element("span",{"class":"btn btn-default"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-floppy-remove"})}).observe("click",function(){confirm("You about to clear this entry. All input data for this entry will be lost.\n\nContinue?")&&(b=a._getNewProductRow(),d=$(this).up(".new-order-item-input"),d.getElementsBySelector(".form-group.has-error .form-control").each(function(a){$(a).retrieve("clearErrFunc")()}),
d.replace(b),b.down("[new-order-item=product]").focus())})})};return a._getProductRow(c,!1).addClassName("new-order-item-input list-group-item-info").removeClassName("order-item-row")},_getPartsTable:function(){var a;a=(new Element("div",{"class":"list-group order_item_list_table"})).insert({bottom:this._getProductRow({product:{sku:"SKU",name:"Description",shortDescription:"Description"},unitPrice:"Unit Price<div><small>(inc GST)</small><div>",qtyOrdered:"Qty",margin:"Margin",discount:"Disc. %",totalPrice:"Total Price<div><small>(inc GST)</small><div>",
btns:(new Element("div")).insert({bottom:(new Element("label",{"for":"hide-margin-checkbox"})).update("Show Margin ")}).insert({bottom:(new Element("input",{id:"hide-margin-checkbox",type:"checkbox",checked:!0})).observe("click",function(){jQuery(".margin").toggle()})})},!0)});a.insert({bottom:this._getNewProductRow().addClassName("list-group-item-info")});return a},_getShippingCostBox:function(a){var c;c=this;return(new Element("input",{"order-price-summary":"totalShippingCost","class":"form-control input-sm",
"save-order":"totalShippingCost",placeholder:c.getCurrency(0),required:!0,validate_currency:"Invalid number provided!",value:a?a:0})).observe("keyup",function(){c._recalculateSummary()}).wrap(new Element("div",{"class":"form-group"}))},_getSummaryFooter:function(){var a,c,b,d,g,e,f,h,k,l;a=this;c=(new Element("select",{"class":"form-control input-sm","save-order":"courierId",required:!0})).insert({bottom:(new Element("option",{value:""})).update("Shipping Via:")});b=a._order&&a._order.infos["9"]?
a._order.infos[9][0].value:"";d=a._order&&a._order.infos["14"]?a.getValueFromCurrency(a._order.infos[14][0].value):"";g=!1;a._shippingMethods.each(function(a){e=a.name.strip()===b.strip();c.insert({bottom:(new Element("option",{value:a.id,selected:e})).update(a.name)});!1===g&&!0===e&&(g=e)});b.blank()||!1!==g||c.insert({bottom:(new Element("option",{value:b,selected:!0})).update(b.stripTags())});f=(new Element("select",{"class":"form-control input-sm","save-order":"paymentMethodId"})).insert({bottom:(new Element("option",
{value:""})).update("Paid Via:")});a._paymentMethods.each(function(a){f.insert({bottom:(new Element("option",{value:a.id})).update(a.name)})});return(new Element("div",{"class":"panel-footer"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-8"})).insert({bottom:a._order&&a._order.id?(new Element("div",{"class":"comments-div-wrapper"})).store("CommentsDivJs",new CommentsDivJs(a,"Order",a._order.id)):a._getFormGroup("Comments:",new Element("textarea",
{"save-order":"comments",rows:"8"}))})}).insert({bottom:(new Element("div",{"class":"col-sm-4"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-6 text-right"})).update((new Element("strong")).update("Total Excl. GST: "))}).insert({bottom:(new Element("div",{"class":"col-xs-6","order-price-summary":"totalPriceExcludeGST"})).update(a.getCurrency(0))})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-6 text-right"})).update((new Element("strong")).update("Total GST: "))}).insert({bottom:(new Element("div",
{"order-price-summary":"totalPriceGST","class":"col-xs-6"})).update(a.getCurrency(0))})}).insert({bottom:(new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"})).insert({bottom:(new Element("div",{"class":"col-xs-6 text-right"})).update((new Element("strong")).update("Total Discount:"))}).insert({bottom:(new Element("div",{"order-price-summary":"totalDiscount","class":"col-xs-6"})).update(a.getCurrency(0))})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",
{"class":"col-xs-6 text-right"})).update((new Element("strong")).update("Sub Total Incl. GST: "))}).insert({bottom:(new Element("div",{"order-price-summary":"totalPriceIncludeGST","class":"col-xs-6"})).update(a.getCurrency(0))})}).insert({bottom:(new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"})).insert({bottom:(new Element("div",{"class":"col-xs-6 text-right"})).update(a._getFormGroup("",c.observe("change",function(){h=this;$(h).up(".row").down(".input-field").update($F(h).blank()?
a.getCurrency(0):k=a._getShippingCostBox());a._recalculateSummary();k&&k.select()})))}).insert({bottom:(new Element("div",{"class":"col-xs-6 input-field"})).update(""===d?a.getCurrency(0):a._getShippingCostBox(d))})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-6 text-right"})).update((new Element("strong")).update("Total Incl. GST:"))}).insert({bottom:(new Element("strong",{"order-price-summary":"subTotal","class":"col-xs-6"})).update(a.getCurrency(0))})}).insert({bottom:(new Element("div",
{"class":"row",style:"border-bottom: 1px solid brown"})).insert({bottom:(new Element("div",{"class":"col-xs-6 text-right"})).update((new Element("strong")).update(f.observe("change",function(){h=this;$(h).up(".row").down(".input-field").update($F(h).blank()?a.getCurrency(0):(new Element("span",{"class":"form-group"})).update(l=(new Element("input",{value:"5"===$F(h).strip()?"0":"","order-price-summary":"totalPaidAmount","class":"form-control input-sm","save-order":"totalPaidAmount",placeholder:a.getCurrency(0),
required:!0,validate_currency:"Invalid number provided!"})).observe("keyup",function(){a._recalculateSummary()})));a._recalculateSummary();l&&l.select()})))}).insert({bottom:(new Element("div",{"class":"col-xs-6 input-field"})).update(a.getCurrency(0))})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("h4",{"class":"col-xs-6 text-right"})).setStyle("color: #d30014 !important").update((new Element("strong")).update("DUE:"))}).insert({bottom:(new Element("h4",{"class":"col-xs-6",
"order-price-summary":"total-payment-due"})).setStyle("color: #d30014 !important").update(a.getCurrency(0))})}).insert({bottom:(new Element("div",{"class":"row margin"})).insert({bottom:(new Element("strong",{"class":"col-xs-6 text-right"})).update((new Element("strong")).update("Margin Total Incl. GST:"))}).insert({bottom:(new Element("strong",{"class":"col-xs-6","order-price-summary":"total-margin"})).update(a.getCurrency(0))})})})})},_getViewOfOrder:function(){var a;return(new Element("div")).insert({bottom:(new Element("div",
{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-12"})).update(this._getCustomerInfoPanel(this._customer))})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-8 memo-panel"})).store("lastMemoJs",a=new LastMemoPanelJs(this,"Order",this._order&&this._order.id?this._order.id:"",!0)).update(a?a._getPanel():"")}).insert({bottom:new Element("div",{"class":"col-sm-4 taskListPanel"})})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",
{"class":"col-sm-12"})).insert({bottom:(new Element("div",{"class":"panel"})).update(this._getPartsTable()).insert({bottom:this._getSummaryFooter()})})})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-12"})).update(this._saveBtns())})})},selectCustomer:function(a){var c,b;c=$(this.getHTMLID("itemDiv"));this._customer=a;(b=c.down(".order_item_list_table"))&&0<b.getElementsBySelector(".item_row.order-item-row").size()?c.down(".customer-info-div").replace(this._getCustomerInfoPanel(a)):
(b=this._getViewOfOrder(),(a=c.update(b).down(".comments-div-wrapper"))&&a.retrieve("CommentsDivJs")._setDisplayDivId(a).render());c.down(".memo-panel").retrieve("lastMemoJs").load();b.down('.new-order-item-input [new-order-item="product"]').focus();return this},_getCustomerRow:function(a,c){var b,d,g;b=this;d=c||!1;g=!0===d?"th":"td";return(new Element("tr")).store("data",a).insert({bottom:(new Element(g)).insert({bottom:!0===d?"&nbsp;":(new Element("span",{"class":"btn btn-primary btn-xs"})).update("select").observe("click",
function(){b.selectCustomer(a);jQuery(".panel").removeClass("panel-success").removeClass("panel-warning").removeClass("panel-default").addClass("panel-warning");jQuery(".item_row_header").removeClass("list-group-item-success").removeClass("list-group-item-warning").addClass("list-group-item-warning")})})}).insert({bottom:(new Element(g)).update(a.name)}).insert({bottom:(new Element(g)).update(a.email)}).insert({bottom:(new Element(g)).update(a.address&&a.address.billing?a.address.billing.full:"")})},
_searchCustomer:function(a,c){var b,d,g,e,f,h;b=this;d=c||1;g=$(a).up("#"+b.getHTMLID("searchPanel"));e=$F(g.down(".search-txt")).strip();b.postAjax(b.getCallbackId("searchCustomer"),{searchTxt:e,pageNo:d},{onCreate:function(){b._signRandID(a);jQuery("#"+a.id).button("loading");1===d&&($(g).down(".list-div")&&$(g).down(".list-div").remove(),$(g).insert({bottom:(new Element("div",{"class":"panel-body"})).update(b.getLoadingImg())}))},onSuccess:function(a,c){try{(f=b.getResp(c,!1,!0))&&f.items&&(1===
d?($(g).down(".panel-body").remove(),$(g).insert({bottom:(new Element("small",{"class":"table-responsive list-div"})).insert({bottom:(new Element("table",{"class":"table table-hover table-condensed"})).insert({bottom:(new Element("thead")).insert({bottom:b._getCustomerRow({name:"Customer Name",email:"Email",address:{billing:{full:"Address"}}},!0)})}).insert({bottom:h=new Element("tbody")})})})):h=$(g).down("tbody"),$(g).down(".get-more-btn-wrapper")&&$(g).down(".get-more-btn-wrapper").remove(),f.items.each(function(a){h.insert({bottom:b._getCustomerRow(a)})}),
f.pagination.pageNumber<f.pagination.totalPages&&h.insert({bottom:(new Element("tr",{"class":"get-more-btn-wrapper"})).insert({bottom:(new Element("td")).insert({bottom:(new Element("span",{"class":"btn btn-primary","data-loading-text":"Getting More ..."})).update("Get more").observe("click",function(){b._searchCustomer(this,1*d+1)})})})}))}catch(e){1===d?$(g).insert({bottom:(new Element("div",{"class":"panel-body"})).update(b.getAlertBox("ERROR",e).addClassName("alert-danger"))}):b.showModalBox('<strong class="text-danger">Error:</strong>',
e)}},onComplete:function(){jQuery("#"+a.id).button("reset")}});return b},_getCustomerListPanel:function(){var a,c;a=this;return(new Element("div",{id:a.getHTMLID("searchPanel"),"class":"panel panel-default search-panel"})).insert({bottom:(new Element("div",{"class":"panel-heading form-inline"})).insert({bottom:(new Element("strong")).update("Creating a new order for: ")}).insert({bottom:(new Element("span",{"class":"input-group col-sm-6"})).insert({bottom:(new Element("input",{"class":"form-control search-txt init-focus",
placeholder:"customer name or email"})).observe("keyup",function(b){$(a.getHTMLID("searchPanel")).down(".search-btn").click()})}).insert({bottom:(new Element("span",{"class":"input-group-btn search-btn"})).insert({bottom:(new Element("span",{"class":" btn btn-primary","data-loading-text":"Searching ..."})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})})}).observe("click",function(){c=this;a._searchCustomer(c,1)})})}).insert({bottom:(new Element("span",{"class":"btn btn-success pull-right btn-sm"})).insert({bottom:new Element("span",
{"class":"glyphicon glyphicon-plus-sign"})}).insert({bottom:" NEW"}).observe("click",function(){a._openNewCustomerPage()})})})},_openNewCustomerPage:function(a){var c,b;c=this;jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",href:"/customer/new.html",beforeClose:function(){b=$$("iframe.fancybox-iframe").first().contentWindow.pageJs._item;b.id&&c.selectCustomer(b)}});return c},_openProductDetailPage:function(a){window.open("/product/"+
a+".html","_BLANK").focus();return this},setOriginalOrder:function(a){this._originalOrder=a;return this},_populateOrderItems:function(a,c){var b,d,g,e,f,h,k;b=this;d=c||!1;0<a.size()&&(g=$(b.getHTMLID("itemDiv")).down(".order_item_list_table"),a.each(function(a){!0!==d&&(a.sellingitems=[]);e=b.getValueFromCurrency(a.unitPrice);f=b.getValueFromCurrency(a.totalPrice);h=b.getValueFromCurrency(e*a.qtyOrdered);k={id:a.id,product:a.product,itemDescription:a.itemDescription,unitPrice:b.getCurrency(e),qtyOrdered:a.qtyOrdered,
discount:0===Math.ceil(h)?0:Math.round(100*(h-f)/h),margin:b.getCurrency(b.getValueFromCurrency(a.margin)),totalPrice:b.getCurrency(f),scanTable:b._getScanTable(a),orderItem:b._order&&b._order.id?a:{}};g.insert({bottom:b._getProductRow(k)})}),b._recalculateSummary());return b},init:function(a){var c,b;c="warning";if(this._order&&this._order.id){if(this.selectCustomer(this._order.customer)._populateOrderItems(this._order.items,!0),c="QUOTE"===this._order.type?"warning":"ORDER"===this._order.type?"success":
"default",a=$(this.getHTMLID("itemDiv")).down(".taskListPanel"))a.store("taskListPanelJs",b=new TaskStatusListPanelJs(this)).update(b.getDiv("Order",this._order)),b.setOpenInFancyBox("1"!==this.getUrlParam("blanklayout")).render()}else a?this.selectCustomer(a):this._originalOrder?(this.selectCustomer(this._originalOrder.customer)._populateOrderItems(this._originalOrder.items,!1),c="QUOTE"===this._originalOrder.type?"warning":"ORDER"===this._originalOrder.type?"success":"default"):$(this.getHTMLID("itemDiv")).update(this._getCustomerListPanel());
jQuery(".panel").removeClass("panel-success").removeClass("panel-warning").removeClass("panel-default").addClass("panel-"+c);jQuery(".item_row_header").removeClass("list-group-item-success").removeClass("list-group-item-warning").addClass("list-group-item-"+c);0<$$(".init-focus").size()&&$$(".init-focus").first().focus();return this},disableEverything:function(a){a=a||!1;jQuery(".btn").not(".new_comments_wrapper #add_new_comments_btn").attr("disabled",!0);jQuery("input").attr("disabled",!0);jQuery("select").attr("disabled",
!0);jQuery(".form-control").attr("disabled",!0);jQuery(".new-order-item-input").remove();jQuery(".customer-edit-link").replaceWith(jQuery(".customer-edit-link").html());jQuery(".new_comments_wrapper input").attr("disabled",!1);!0===a&&(jQuery('[save-order="paymentMethodId"]').attr("disabled",!1),jQuery(".save-btn").attr("disabled",!1));return this}});