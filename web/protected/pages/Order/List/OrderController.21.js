var PageJs=new Class.create;PageJs.prototype=Object.extend(new BPCPageJs,{resultDivId:"",searchDivId:"",totalNoOfItemsId:"",_pagination:{pageNo:1,pageSize:10},_searchCriteria:{},_infoTypes:{},orderStatuses:[],_type:"ORDER",_loadChosen:function(){return jQuery(".chosen").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"100%"}),this},_bindSearchKey:function(){var e={};return e.me=this,$("searchDiv").getElementsBySelector("[search_field]").each(function(t){t.observe("keydown",function(t){e.me.keydown(t,function(){$("searchBtn").click()})})}),this},_loadStatuses:function(e){this.orderStatuses=e;var t={};return t.me=this,t.statusBox=$(t.me.searchDivId).down("#orderStatusId"),t.me.orderStatuses.each(function(e){t.statusBox.insert({bottom:new Element("option",{value:e.id}).update(e.name)})}),this},setSearchCriteria:function(e){var t={};return t.me=this,t.searchPanel=$(t.me.searchDivId),$H(e).each(function(e){if(t.field=e.key,t.value=e.value,t.fieldBox=t.searchPanel.down('[search_field="'+t.field+'"]'),t.fieldBox)for(t.optlength=t.fieldBox.options.length,t.i=0;t.i<t.optlength;t.i++)t.value.indexOf(1*t.fieldBox.options[t.i].value)>=0&&(t.fieldBox.options[t.i].selected=!0)}),t.me._loadChosen()._bindSearchKey(),this},getSearchCriteria:function(){var e={};return e.me=this,null===e.me._searchCriteria&&(e.me._searchCriteria={}),e.nothingTosearch=!0,$(e.me.searchDivId).getElementsBySelector("[search_field]").each(function(t){e.field=t.readAttribute("search_field"),t.hasClassName("datepicker")?(e.me._signRandID(t),e.date=jQuery("#"+t.id).data("DateTimePicker").date(),e.me._searchCriteria[e.field]=e.date?e.date.utc():""):e.me._searchCriteria[e.field]=$F(t),($F(t)instanceof Array&&$F(t).size()>0||"string"==typeof $F(t)&&!$F(t).blank())&&(e.nothingTosearch=!1)}),e.nothingTosearch===!0&&(e.me._searchCriteria=null),this},getResults:function(e,t){var n={};return n.me=this,n.reset=e||!1,null===n.me._searchCriteria?void n.me.showModalBox("Warning","Nothing to search!",!0):(n.reset===!0&&(n.me._pagination.pageNo=1),n.me._pagination.pageSize=t||n.me._pagination.pageSize,n.me._searchCriteria["ord.type"]=n.me._type,void n.me.postAjax(n.me.getCallbackId("getOrders"),{pagination:n.me._pagination,searchCriteria:n.me._searchCriteria},{onLoading:function(){jQuery("#searchBtn").button("loading"),jQuery(".popovershipping").popover("hide"),n.reset===!0&&($(n.me.totalNoOfItemsId).update("0"),$(n.me.resultDivId).update("").insert({after:new Element("div",{"class":"panel-body"}).update(n.me.getLoadingImg())}))},onSuccess:function(e,t){try{if(n.result=n.me.getResp(t,!1,!0),!n.result)return;$(n.me.totalNoOfItemsId).update(n.result.pageStats.totalRows),n.resultDiv=$(n.me.resultDivId),n.reset===!0&&(n.titleRow={orderNo:"Order Info.",type:"Type",custName:"Customer Name",shippingAddr:"Shipping Address",invNo:"Invoice No.",status:{name:"Status"},totalDue:"Total Due",passPaymentCheck:"Payment Cleared?"},n.resultDiv.update(n.me._getResultRow(n.titleRow,!0).wrap(new Element("thead")))),n.resultDiv.getElementsBySelector(".paginWrapper").each(function(e){e.remove()}),n.tbody=$(n.resultDiv).down("tbody"),n.tbody||$(n.resultDiv).insert({bottom:n.tbody=new Element("tbody")}),n.result.items.each(function(e){n.tbody.insert({bottom:n.me._getResultRow(e)})}),n.result.pageStats.pageNumber<n.result.pageStats.totalPages&&n.resultDiv.insert({bottom:n.me._getNextPageBtn().addClassName("paginWrapper")}),n.resultDiv.getElementsBySelector(".popovershipping.newPopover").each(function(e){e.removeClassName("newPopover"),n.rowData=e.up(".order_item").retrieve("data"),jQuery("#"+e.id).popover({container:"body",title:'<div class="row"><div class="col-xs-10">Details for: '+n.rowData.orderNo+'</div><div class="col-xs-2"><a class="pull-right" href="javascript:void(0);" onclick="jQuery(\'#'+e.id+"').popover('hide');\"><strong>&times;</strong></a></div></div>",content:jQuery(".popover_content",jQuery("#"+e.id)).html(),html:!0,placement:"right",trigger:"manual"})})}catch(s){n.me.showModalBox('<strong class="text-danger">Error</strong>',s,!0)}},onComplete:function(){jQuery("#searchBtn").button("reset"),$(n.me.resultDivId).up(".panel").down(".panel-body")&&$(n.me.resultDivId).up(".panel").down(".panel-body").remove()}}))},_getNextPageBtn:function(){var e={};return e.me=this,new Element("tfoot").insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:"5","class":"text-center"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Fetching more results ..."}).update("Show More").observe("click",function(){e.me._pagination.pageNo=1*e.me._pagination.pageNo+1,jQuery(this).button("loading"),e.me.getResults()})})})})},_getOrderDetailsDiv:function(e){var t={};return t.me=this,t.custName=e.infos[t.me._infoTypes.custName][0].value,t.custEmail=e.infos[t.me._infoTypes.custEmail][0].value,new Element("div").insert({bottom:new Element("div").update('<span class="glyphicon glyphicon-user" title="Customer Name"></span>: '+t.custName)}).insert({bottom:new Element("div").update('<span class="glyphicon glyphicon-envelope" title="Customer Email"></span>: <a href="mailto:'+t.custEmail+'">'+t.custEmail+"</a>")}).insert({bottom:new Element("div").update('<span class="glyphicon glyphicon-shopping-cart" title="Order Date"></span>: '+e.orderDate)}).insert({bottom:new Element("div").update("<strong>Shipping</strong>:")}).insert({bottom:new Element("div").update('<span class="glyphicon glyphicon-user" title="Customer Name"></span>: '+e.address.shipping.contactName)}).insert({bottom:new Element("div").update('<span class="glyphicon glyphicon-phone-alt" title="Phone"></span>: '+e.address.shipping.contactNo)}).insert({bottom:new Element("div").update('<span class="glyphicon glyphicon-map-marker" title="Address"></span>: '+e.address.shipping.full)})},_getTitledDiv:function(e,t){return new Element("div",{"class":"field_div"}).insert({bottom:new Element("span",{"class":"inlineblock title"}).update(e)}).insert({bottom:new Element("span",{"class":"inlineblock divcontent"}).update(t)})},_openDetailsPage:function(e){var t={};return t.me=this,jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",href:"/orderdetails/"+e.id+".html?blanklayout=1",beforeClose:function(){$(t.me.resultDivId).down(".order_item[order_id="+e.id+"]")&&$(t.me.resultDivId).down(".order_item[order_id="+e.id+"]").replace(t.me._getResultRow($$("iframe.fancybox-iframe").first().contentWindow.pageJs._order))}}),t.me},_getOpenDetailBtn:function(e){var t={};return t.me=this,new Element("a",{href:"javascript: void(0)",title:"Click to view the order"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-new-window"})}).observe("click",function(){t.me._openDetailsPage(e)})},_getOrderInfoCell:function(e){var t={};return t.me=this,t.quantity="n/a",t.custName="n/a",t.custEmail="n/a",e.infos&&null!==e.infos&&(t.me._infoTypes.qty in e.infos&&e.infos[t.me._infoTypes.qty].length>0&&(t.quantity=e.infos[t.me._infoTypes.qty][0].value),t.me._infoTypes.custName in e.infos&&e.infos[t.me._infoTypes.custName].length>0&&(t.custName=e.infos[t.me._infoTypes.custName][0].value),t.me._infoTypes.custEmail in e.infos&&e.infos[t.me._infoTypes.custEmail].length>0&&(t.custEmail=e.infos[t.me._infoTypes.custEmail][0].value)),t.newDiv=new Element("div").insert({bottom:t.me._getOpenDetailBtn(e)}).insert({bottom:" "}).insert({bottom:new Element("span").insert({bottom:t.orderLink=new Element("a",{id:"orderno-btn-"+e.id,"class":"orderNo visible-xs visible-sm visible-md visible-lg newPopover popovershipping",href:"javascript:void(0);"}).update(e.orderNo).insert({bottom:new Element("div",{style:"display: none;","class":"popover_content"}).update(t.me._getOrderDetailsDiv(e))})})}),t.me.observeClickNDbClick(t.orderLink,function(e){t.btn=e.target,jQuery(t.btn).popover("show"),jQuery(".popovershipping").not(t.btn).popover("hide")},function(n){t.btn=n.target,jQuery(t.btn).popover("hide"),t.me._openDetailsPage(e)}),t.newDiv},_getPaymentCell:function(e){var t={};return t.me=this,new Element("a",{href:"javascript: void(0);"}).insert({bottom:e.passPaymentCheck?new Element("span",{title:0===e.totalDue?"Full Paid":"Short Paid","class":0===e.totalDue?"text-success":"text-danger"}).update(new Element("span",{"class":"glyphicon "+(0===e.totalDue?"glyphicon-ok-sign":"glyphicon-warning-sign")})):""}).insert({bottom:" "}).insert({bottom:new Element("span").update(t.me.getCurrency(e.totalDue)).writeAttribute("title","Total Due Amount:"+t.me.getCurrency(e.totalDue))}).observe("click",function(){t.me._openDetailsPage(e)})},_getMarginCell:function(e){var t={};return t.me=this,new Element("a",{href:"javascript: void(0);"}).insert({bottom:new Element("span").update(t.me.getCurrency(e.margin)).writeAttribute("title","Order margin:"+t.me.getCurrency(e.margin))}).observe("click",function(){t.me._openDetailsPage(e)})},_getPurchasingCell:function(e){var t={};return t.me=this,t.statusId_stockchecked=["4","5","6","7","8"],t.statusId_stockchecked_not_passed=["4","6"],t.hasCheckedStock=t.statusId_stockchecked.indexOf(e.status.id)>=0,t.stockChkedWIssues=t.statusId_stockchecked_not_passed.indexOf(e.status.id)>=0,new Element("div").insert({bottom:t.hasCheckedStock?new Element("a",{href:"javascript: void(0);","class":t.stockChkedWIssues?"text-danger":"text-success",title:e.stockChkedWIssues?"insufficient stock":"Stock checked"}).update(new Element("span",{"class":"glyphicon "+(t.stockChkedWIssues?"glyphicon-warning-sign":"glyphicon-ok-sign")})).observe("click",function(){t.me._openDetailsPage(e)}):""})},_getWarehouseCell:function(e){var t={};return t.me=this,t.statusId_whchecked=["6","7","8"],t.statusId_whchecked_not_passed=["6"],t.hasChecked=t.statusId_whchecked.indexOf(e.status.id)>=0,t.chkedWIssues=t.statusId_whchecked_not_passed.indexOf(e.status.id)>=0,new Element("div").insert({bottom:t.hasChecked?new Element("a",{href:"javascript: void(0);","class":t.chkedWIssues?"text-danger":"text-success",title:e.chkedWIssues?"insufficient stock":"Stock Handled successfully"}).update(new Element("span",{"class":"glyphicon "+(t.chkedWIssues?"glyphicon-warning-sign":"glyphicon-ok-sign")})).observe("click",function(){t.me._openDetailsPage(e)}):""})},_getResultRow:function(e,t){var n={};return n.me=this,n.isTitle=t||!1,n.deliveryMethod=n.isTitle?"D.Method":e.infos[9]?e.infos[9][0].value:"",n.row=new Element("tr",{"class":n.isTitle===!0?"":"order_item",order_id:e.id}).store("data",e).insert({bottom:new Element("td",{"class":"orderInfo  col-xs-1"}).update(n.isTitle?e.orderNo:n.me._getOrderInfoCell(e))}).insert({bottom:new Element("td",{"class":"order-date col-xs-1"}).update(n.isTitle===!0?"Order Date":n.me.loadUTCTime(e.orderDate).toLocaleDateString())}).insert({bottom:new Element("td",{"class":"customer col-xs-2 "}).update(n.isTitle===!0?"Customer":e.customer.name)}).insert({bottom:new Element("td",{"class":"col-xs-2 "+(n.deliveryMethod.toLowerCase().indexOf("pickup")>-1?"danger":""),title:"Delivery Method"}).update(n.deliveryMethod)}).insert({bottom:new Element("td",{"class":"status col-xs-2",order_status:e.status.name}).update(e.status?e.status.name:"")}).insert({bottom:new Element("td",{"class":"text-right col-xs-1",payment:!0}).update(n.isTitle?"Payments":n.me._getPaymentCell(e))}).insert({bottom:new Element("td",{"class":"text-right col-xs-1",margin:!0}).update(n.isTitle?"Margin":n.me._getMarginCell(e))}).insert({bottom:new Element("td",{"class":"text-center col-xs-1",purchasing:!0}).update(n.isTitle?"Purchasing":n.me._getPurchasingCell(e))}).insert({bottom:new Element("td",{"class":"text-center col-xs-1",warehouse:!0}).update(n.isTitle?"Warehouse":n.me._getWarehouseCell(e))}),n.row},_initDeliveryMethods:function(){var e={};return e.me=this,e.selectBox=$(e.me.searchDivId).down('[search_field="delivery_method"]'),e.me._signRandID(e.selectBox),jQuery("#"+e.selectBox.id).select2({minimumInputLength:3,multiple:!0,ajax:{delay:250,url:"/ajax/getDeliveryMethods",type:"POST",data:function(e){return{searchTxt:e}},results:function(t){return e.result=[],t.resultData&&t.resultData.items&&t.resultData.items.each(function(t){e.result.push({id:t+"{|}",text:t.stripTags()})}),{results:e.result}},cache:!0}}),e.me},_changeType:function(e){var t={};switch(t.me=this,jQuery(".type-swither-item.active").removeClass("active"),t.me._type=$(e).addClassName("active").readAttribute("data-type"),t.panelClass="panel-default",t.me._type){case"ORDER":t.panelClass="panel-success";break;case"INVOICE":t.panelClass="panel-default";break;case"QUOTE":t.panelClass="panel-warning"}return $(e).up(".panel").removeClassName("panel-success").removeClassName("panel-default").removeClassName("panel-warning").addClassName(t.panelClass),$("searchBtn").click(),t.me},_initTypeSwither:function(){var e={};return e.me=this,$$(".type-swither-item").each(function(t){t.observe("click",function(){e.me._changeType(this)})}),e.me},init:function(){var e={};return e.me=this,jQuery(".datepicker").datetimepicker({format:"DD/MM/YYYY HH:mm A"}),e.me._initDeliveryMethods()._initTypeSwither(),e.me}});