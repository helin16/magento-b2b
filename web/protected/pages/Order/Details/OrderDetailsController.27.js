var PageJs=new Class.create;PageJs.prototype=Object.extend(new BPCPageJs,{_order:null,_orderStatuses:[],_orderStatusID_Shipped:"",_paymentMethods:[],_payments:[],_orderItems:[],_resultDivId:"",_couriers:[],_courier_LocalPickUpId:"",_editMode:{purchasing:!1,warehouse:!1,accounting:!1,status:!1},_commentsDiv:{pagination:{pageSize:5,pageNo:1},resultDivId:"comments_result_div",types:{purchasing:"",warehouse:""}},infoType_custName:1,infoType_custEmail:2,orderStatusIds:{warehouseCanEdit:[],purchaseCanEdit:[],canAddShipment:[]},setEditMode:function(e,t,n,o){return this._editMode.purchasing=e||!1,this._editMode.warehouse=t||!1,this._editMode.accounting=n||!1,this._editMode.status=o||!1,this},setCommentType:function(e,t){return this._commentsDiv.types.purchasing=e,this._commentsDiv.types.warehouse=t,this},setOrderStatusIds:function(e,t,n){return this.orderStatusIds.purchaseCanEdit=e,this.orderStatusIds.warehouseCanEdit=t,this.orderStatusIds.canAddShipment=n,this},setOrder:function(e,t,n,o){return this._order=e,this._orderItems=t,this._orderStatuses=n,this._orderStatusID_Shipped=o,this},setCourier:function(e,t){return this._couriers=e,this._courier_LocalPickUpId=t,this},setPaymentMethods:function(e){return this._paymentMethods=e,this},setPayments:function(e){return this._payments=e,this},_updateAddress:function(e,t){var n={};return n.me=this,n.inputPane=$(e).up(".address-div"),n.data=n.me._collectFormData(n.inputPane,"address-editable-field"),n.data.title=t,n.data.orderId=n.me._order.id,n.me.postAjax(n.me.getCallbackId("updateAddress"),n.data,{onLoading:function(){n.me._signRandID(e),jQuery("#"+e.id).button("loading")},onSuccess:function(e,o){try{if(n.result=n.me.getResp(o,!1,!0),!n.result||!n.result.item||!n.result.item.id)return;n.inputPane.replace(n.me._getAddressDiv(t,n.result.item))}catch(s){n.me.showModalBox('<strong class="text-danger">Error When Updating Address</strong>',s)}},onComplete:function(){jQuery("#"+e.id).button("reset")}}),n.me},_getAddresEditDiv:function(e,t){var n={};return n.me=this,new Element("div",{"class":"address-div",title:"Double click to edit this address","address-editable":!0}).insert({bottom:new Element("strong").update(e)}).insert({bottom:new Element("dl",{"class":"dl-horizontal dl-condensed"}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-user",title:"Customer Name"}))}).insert({bottom:new Element("dd").insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"col-sm-6"}).update(new Element("input",{"address-editable-field":"contactName","class":"form-control input-sm",placeholder:"The name of contact person",value:t.contactName}))}).insert({bottom:new Element("div",{"class":"col-sm-6"}).update(new Element("input",{"address-editable-field":"contactNo","class":"form-control input-sm",placeholder:"The contact number of contact person",value:t.contactNo}))})})}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-map-marker",title:"Address"}))}).insert({bottom:new Element("dd").insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"street col-sm-12"}).update(new Element("input",{"address-editable-field":"street","class":"form-control input-sm",placeholder:"Street Number and Street name",value:t.street}))})}).insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"city col-sm-6"}).update(new Element("input",{"address-editable-field":"city","class":"form-control input-sm",placeholder:"City / Suburb",value:t.city}))}).insert({bottom:new Element("div",{"class":"region col-sm-3"}).update(new Element("input",{"address-editable-field":"region","class":"form-control input-sm",placeholder:"State / Province",value:t.region}))}).insert({bottom:new Element("div",{"class":"postcode col-sm-3"}).update(new Element("input",{"address-editable-field":"postCode","class":"form-control input-sm",placeholder:"PostCode",value:t.postCode}))})}).insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"postcode col-sm-4"}).update(new Element("input",{"address-editable-field":"country","class":"form-control input-sm",placeholder:"Country",value:t.country}))}).insert({bottom:new Element("div",{"class":"col-sm-8"}).insert({bottom:new Element("input",{type:"hidden",value:t.id,"address-editable-field":"id"})}).insert({bottom:new Element("div",{"class":"btn btn-primary btn-sm col-xs-4 pull-right","data-loading-text":"updating..."}).update("Update").observe("click",function(){n.me._updateAddress(this,e)})}).insert({bottom:new Element("div",{"class":"btn btn-default btn-sm col-xs-4 pull-right"}).update("Cancel").observe("click",function(){$(this).up(".address-div").replace(n.me._getAddressDiv(e,t))})})})})})})},_getAddressDiv:function(e,t){var n={};return n.me=this,new Element("div",{"class":"address-div",title:"Double click to edit this address"}).setStyle("cursor: pointer").insert({bottom:new Element("strong").update(e)}).insert({bottom:new Element("dl",{"class":"dl-horizontal dl-condensed"}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-user",title:"Customer Name"}))}).insert({bottom:new Element("dd").update(t.contactName)}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-map-marker",title:"Address"}))}).insert({bottom:new Element("dd").insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"street inlineblock"}).update(t.street)}).insert({bottom:new Element("span",{"class":"city inlineblock"}).update(t.city+" ")}).insert({bottom:new Element("span",{"class":"region inlineblock"}).update(t.region+" ")}).insert({bottom:new Element("span",{"class":"postcode inlineblock"}).update(t.postCode)})})})}).observe("dblclick",function(){$(this).replace(n.me._getAddresEditDiv(e,t))})},_getfieldDiv:function(e,t){return new Element("dl",{"class":"dl-condensed"}).insert({bottom:new Element("dt").update(e)}).insert({bottom:new Element("dd").update(t)})},_getFormGroup:function(e,t){return new Element("div",{"class":"form-group"}).insert({bottom:new Element("label",{"class":"control-label"}).update(e)}).insert({bottom:t.addClassName("form-control")})},_collectData:function(e,t){var n={};return n.me=this,n.data={},n.hasError=!1,$$("["+e+"]").each(function(o){n.groupIndexName=t?o.readAttribute(t):null,n.fieldName=o.readAttribute(e),o.hasAttribute("required")&&$F(o).blank()&&(n.me._markFormGroupError(o,"This is requried"),n.hasError=!0),n.itemValue="checkbox"!==o.readAttribute("type")?$F(o):$(o).checked,(o.hasAttribute("validate_currency")||o.hasAttribute("validate_number"))&&(null===n.me.getValueFromCurrency(n.itemValue).match(/^(-)?\d+(\.\d{1,2})?$/)&&(n.me._markFormGroupError(o,o.hasAttribute("validate_currency")?o.readAttribute("validate_currency"):o.hasAttribute("validate_number")),n.hasErr=!0),n.value=n.me.getValueFromCurrency(n.itemValue)),null!==n.groupIndexName&&void 0!==n.groupIndexName?(n.data[n.groupIndexName]||(n.data[n.groupIndexName]={}),n.data[n.groupIndexName][n.fieldName]=n.itemValue):n.data[n.fieldName]=n.itemValue}),n.hasError===!0?null:n.data},_submitPaymentConfirmation:function(e){var t={};return t.me=this,t.data=t.me._collectData("payment_field"),null!==t.data?(t.me._signRandID(e),t.me.postAjax(t.me.getCallbackId("confirmPayment"),{payment:t.data,order:t.me._order},{onLoading:function(){jQuery("#"+e.id).button("loading")},onSuccess:function(e,n){try{t.result=t.me.getResp(n,!1,!0),t.result&&t.result.items&&(t.me.showModalBox('<h4 class="text-success">Success</h4>',"Payment saved successfully!"),window.location=document.URL)}catch(o){t.me.showModalBox('<h4 class="text-danger">Error</h4>',o)}},onComplete:function(){jQuery("#"+e.id).button("reset")}}),this):void 0},_getCommentsRow:function(e){return new Element("tr",{"class":"comments_row"}).store("data",e).insert({bottom:new Element("td",{"class":"created",width:"15%"}).update(new Element("small").update(e.created))}).insert({bottom:new Element("td",{"class":"creator",width:"15%"}).update(new Element("small").update(e.createdBy.person.fullname))}).insert({bottom:new Element("td",{"class":"type",width:"10%"}).update(new Element("small").update(e.type))}).insert({bottom:new Element("td",{"class":"comments",width:"auto"}).update(e.comments)})},_getComments:function(e,t){var n={};return n.me=this,n.reset=e||!1,n.reset===!0&&$(n.me._commentsDiv.resultDivId).update(""),n.ajax=new Ajax.Request("/ajax/getComments",{method:"get",parameters:{entity:"Order",entityId:n.me._order.id,orderBy:{created:"desc"},pageNo:n.me._commentsDiv.pagination.pageNo,pageSize:n.me._commentsDiv.pagination.pageSize},onLoading:function(){t&&jQuery("#"+t.id).button("loading")},onSuccess:function(e){try{if(n.result=e.responseText.evalJSON()||{},n.reset===!0&&$(n.me._commentsDiv.resultDivId).update(n.me._getCommentsRow({type:"Type",createdBy:{person:{fullname:"WHO"}},created:"WHEN",comments:"COMMENTS"}).addClassName("header").wrap(new Element("thead"))),!n.result||!n.result.items)return;$$(".new-page-btn-div").size()>0&&$$(".new-page-btn-div").each(function(e){e.remove()}),n.tbody=$(n.me._commentsDiv.resultDivId).down("tbody"),n.tbody||$(n.me._commentsDiv.resultDivId).insert({bottom:n.tbody=new Element("tbody")}),n.result.items.each(function(e){n.tbody.insert({bottom:n.me._getCommentsRow(e)})}),n.result.pageStats.pageNumber<n.result.pageStats.totalPages&&n.tbody.insert({bottom:new Element("tr",{"class":"new-page-btn-div"}).insert({bottom:new Element("td",{colspan:4}).insert({bottom:new Element("span",{id:"comments_get_more_btn","class":"btn btn-primary","data-loading-text":"Getting More ..."}).update("Get More Comments").observe("click",function(){n.me._commentsDiv.pagination.pageNo=1*n.me._commentsDiv.pagination.pageNo+1,n.me._getComments(!1,this)})})})})}catch(t){$(n.me._commentsDiv.resultDivId).insert({bottom:n.me.getAlertBox("ERROR: ",t).addClassName("alert-danger")})}},onComplete:function(){t&&jQuery("#"+t.id).button("reset")}}),this},_addComments:function(e){var t={};return t.me=this,t.commentsBox=$(e).up(".new_comments_wrapper").down("[new_comments=comments]"),t.comments=$F(t.commentsBox),t.comments.blank()?this:(t.me.postAjax(t.me.getCallbackId("addComments"),{comments:t.comments,order:t.me._order},{onLoading:function(){jQuery("#"+e.id).button("loading")},onSuccess:function(e,n){try{if(t.result=t.me.getResp(n,!1,!0),!t.result)return;t.tbody=$(t.me._commentsDiv.resultDivId).down("tbody"),t.tbody||$(t.me._commentsDiv.resultDivId).insert({bottom:t.tbody=new Element("tbody")}),t.tbody.insert({top:t.me._getCommentsRow(t.result)}),t.commentsBox.setValue("")}catch(o){alert(o)}},onComplete:function(){jQuery("#"+e.id).button("reset")}}),this)},_getEmptyCommentsDiv:function(){var e={};return e.me=this,new Element("div",{"class":"panel panel-default"}).insert({bottom:new Element("div",{"class":"panel-heading"}).update("Comments")}).insert({bottom:new Element("div",{"class":"table-responsive"}).insert({bottom:new Element("table",{id:e.me._commentsDiv.resultDivId,"class":"table table-hover table-condensed"})})}).insert({bottom:new Element("div",{"class":"panel-body new_comments_wrapper"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-2"}).update("<strong>New Comments:</strong>")}).insert({bottom:new Element("div",{"class":"col-xs-10"}).insert({bottom:new Element("div",{"class":"input-group"}).insert({bottom:new Element("input",{"class":"form-control",type:"text",new_comments:"comments",placeholder:"add more comments to this order"}).observe("keydown",function(t){e.me.keydown(t,function(){$(t.currentTarget).up(".new_comments_wrapper").down("[new_comments=btn]").click()})})}).insert({bottom:new Element("span",{"class":"input-group-btn"}).insert({bottom:new Element("span",{id:"add_new_comments_btn",new_comments:"btn","class":"btn btn-primary","data-loading-text":"saving..."}).update("add").observe("click",function(){e.me._addComments(this)})})})})})})})},_clearETA:function(e,t){var n={};return n.me=this,confirm("You are trying to mark a part as received/clearing the ETA?\n continue?")?(n.reason=prompt("The reason for clearing the ETA"),null===n.reason?n.me:(n.me.postAjax(n.me.getCallbackId("clearETA"),{item_id:t.id,comments:n.reason},{onLoading:function(){},onSuccess:function(e,t){try{if(n.result=n.me.getResp(t,!1,!0),!n.result)return;alert("ETA cleared Successfully!"),window.location=document.URL}catch(o){alert(o)}},onComplete:function(){}}),n.me)):n.me},_getPurchasingEditCelPanel:function(e,t){var n={};n.me=this,t.insert({bottom:n.me._getfieldDiv("ETA:",n.etaBox=new Element("input",{"class":"form-control input-sm datepicker",type:"datetime",value:e.eta,update_order_item_purchase:"eta",order_item_id:e.id,required:!0})).addClassName("no-stock-div dl-horizontal form-group")}).insert({bottom:n.me._getfieldDiv("Has Ordered?",new Element("input",{"class":"input-sm",type:"checkbox",update_order_item_purchase:"isOrdered",order_item_id:e.id,checked:e.isOrdered})).addClassName("no-stock-div dl-horizontal form-group")}).insert({bottom:n.me._getfieldDiv("Comments:",new Element("input",{"class":"form-control input-sm",type:"text",update_order_item_purchase:"comments",order_item_id:e.id,required:!0})).addClassName("no-stock-div dl-horizontal form-group")}),n.me._signRandID(n.etaBox);try{new Prado.WebUI.TDatePicker({ID:n.etaBox.id,InputMode:"TextBox",Format:"yyyy-MM-dd 17:00:00",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,PositionMode:"Bottom",ClassName:"datepicker-layer-fixer"})}catch(o){}return n.me},_getPurchasingEditCell:function(e){var t={};return t.me=this,t.hasStock=""===e.eta?"":"0001-01-01 00:00:00"===e.eta?!0:!1,t.isOrdered=e.isOrdered===!1?!1:!0,t.me._editMode.purchasing!==!1?(t.editCellPanel=new Element("small",{"class":"update_order_item_purchase_div update_order_item_div"}),t.editCellPanel.insert({bottom:t.me._getfieldDiv("Has Stock?",new Element("select",{"class":"form-control input-sm",update_order_item_purchase:"hasStock",required:!0,order_item_id:e.id}).insert({bottom:new Element("option",{value:" "}).update("Not Checked")}).insert({bottom:new Element("option",{value:"1"}).update("Yes").writeAttribute("selected",t.hasStock===!0)}).insert({bottom:new Element("option",{value:"0"}).update("No").writeAttribute("selected",t.hasStock===!1)}).observe("change",function(){t.editPanel=$(this).up(".update_order_item_purchase_div"),t.editPanel.getElementsBySelector(".no-stock-div").each(function(e){e.remove()}),"0"===$F(this)&&t.me._getPurchasingEditCelPanel(e,t.editPanel)})).addClassName("dl-horizontal form-group")}),t.hasStock===!1&&t.me._getPurchasingEditCelPanel(e,t.editCellPanel),t.editCellPanel):void 0},_changeIsOrdered:function(e,t){var n={};return n.me=this,n.isOrdered=$(e).checked,confirm("You are going to change this order item to be: "+(n.isOrdered===!0?"ORDERED":"NOT ORDERED"))?(n.me.postAjax(n.me.getCallbackId("changeIsOrdered"),{item_id:t.id,isOrdered:n.isOrdered},{onLoading:function(){},onSuccess:function(e,t){try{if(n.result=n.me.getResp(t,!1,!0),!n.result)return;alert("IsOrdered flag changed Successfully!"),window.location=document.URL}catch(o){alert(o)}},onComplete:function(){}}),!0):!1},_getPurchasingCell:function(e){var t={};return t.me=this,t.hasStock=""===e.eta?"":"0001-01-01 00:00:00"===e.eta?!0:!1,t.isOrdered=e.isOrdered===!1?!1:!0,t.me._editMode.purchasing===!1||t.me.orderStatusIds.purchaseCanEdit.indexOf(1*t.me._order.status.id)<0?(t.newDiv=new Element("small"),""===t.hasStock?t.newDiv.update("Not Checked"):(t.newDiv.insert({bottom:new Element("span",{"class":t.hasStock?"text-success":"text-danger"}).insert({bottom:new Element("strong").update("hasStock? ")}).insert({bottom:new Element("span",{"class":"glyphicon "+(t.hasStock?"glyphicon-ok-circle":"glyphicon-remove-circle")})}).insert({bottom:new Element("a",{href:"javascript: void(0);","class":"text-muted pull-right popover-comments",title:"comments","comments-type":t.me._commentsDiv.types.purchasing,"comments-entity-id":e.id,"comments-entity":"OrderItem"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-comment"})})})}),t.hasStock===!1&&t.newDiv.insert({bottom:new Element("span").update("&nbsp;&nbsp;")}).insert({bottom:new Element("span").insert({bottom:new Element("strong").update("ETA: ")}).insert({bottom:new Element("span").insert({bottom:new Element("small").update(e.eta+" ")}).insert({bottom:new Element("a",{href:"javascript: void(0);","class":"text-danger",title:"clear ETA"}).update(new Element("span",{"class":"glyphicon glyphicon-remove"})).observe("click",function(){t.me._clearETA(this,e)})})})}).insert({bottom:new Element("span").update("&nbsp;&nbsp;")}).insert({bottom:new Element("span").insert({bottom:new Element("strong").update("Is Ordered: ")}).insert({bottom:new Element("input",{type:"checkbox",checked:t.isOrdered}).observe("change",function(){return t.me._changeIsOrdered(this,e)})})}),t.newDiv)):t.me._getPurchasingEditCell(e)},_getWarehouseEditCell:function(e){var t={};return t.me=this,t.isPicked=e.isPicked===!0,t.editCellPanel=new Element("small",{"class":"update_order_item_warehouse_div update_order_item_div"}),t.editcommentsDiv=t.me._getfieldDiv("Comments:",new Element("input",{"class":"form-control input-sm",type:"text",update_order_item_warehouse:"comments",order_item_id:e.id,required:!0})).addClassName("no-stock-div dl-horizontal form-group"),t.editCellPanel.insert({bottom:t.me._getfieldDiv("Picked?",new Element("select",{"class":"form-control input-sm",update_order_item_warehouse:"isPicked",order_item_id:e.id}).insert({bottom:new Element("option",{value:""}).update("Not Picked Yet")}).insert({bottom:new Element("option",{value:"1"}).update("Yes").writeAttribute("selected",t.isPicked===!0)}).insert({bottom:new Element("option",{value:"0"}).update("No").writeAttribute("selected",t.isPicked===!1)}).observe("change",function(){t.editPanel=$(this).up(".update_order_item_warehouse_div"),t.editPanel.getElementsBySelector(".no-stock-div").each(function(e){e.remove()}),"0"===$F(this)&&t.editCellPanel.insert({bottom:t.editcommentsDiv})})).addClassName("dl-horizontal form-group")}),t.isPicked===!1&&t.editCellPanel.insert({bottom:t.editcommentsDiv}),t.editCellPanel},_getWarehouseCell:function(e){var t={};return t.me=this,t.me._editMode.warehouse===!1||t.me.orderStatusIds.warehouseCanEdit.indexOf(1*t.me._order.status.id)<0?new Element("small").insert({bottom:new Element("span",{"class":e.isPicked?"text-success":"text-danger"}).insert({bottom:new Element("strong").update("Picked? ")}).insert({bottom:new Element("span",{"class":"glyphicon "+(e.isPicked?"glyphicon-ok-circle":"glyphicon-remove-circle")})}).insert({bottom:new Element("a",{href:"javascript: void(0);","class":"text-muted pull-right popover-comments",title:"comments","comments-type":t.me._commentsDiv.types.warehouse,"comments-entity-id":e.id,"comments-entity":"OrderItem"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-comment"})})})}):t.me._getWarehouseEditCell(e)},_getProductRow:function(e,t){var n={};return n.me=this,n.isTitle=t||!1,n.tag=n.isTitle===!0?"th":"td",new Element("tr",{"class":n.isTitle===!0?"":"productRow",order_item_id:e.id}).store("data",e).insert({bottom:new Element(n.tag,{"class":"productName"}).insert({bottom:n.isTitle===!0?e.product.name:new Element("div").insert({bottom:new Element("div").update(new Element("a",{href:"/product/"+e.product.id+".html",target:"_BLANK"}).update(new Element("strong",{"class":"text-info"}).update("SKU: "+e.product.sku)))}).insert({bottom:new Element("em").update(new Element("small").update(e.itemDescription))})})}).insert({bottom:new Element(n.tag,{"class":"uprice"}).update(n.isTitle===!0?e.unitPrice:n.me.getCurrency(e.unitPrice))}).insert({bottom:new Element(n.tag,{"class":"qty"}).update(e.qtyOrdered)}).insert({bottom:new Element(n.tag,{"class":"tprice"}).update(n.isTitle===!0?e.totalPrice:n.me.getCurrency(e.totalPrice))}).insert({bottom:new Element(n.tag,{"class":"margin"}).update(n.isTitle===!0?e.margin:new Element("abbr",{title:"Unit Cost When This Order Created: "+n.me.getCurrency(e.unitCost)}).update(n.me.getCurrency(e.margin)))}).insert({bottom:new Element(n.tag,{"class":"purchasing"}).update(n.isTitle===!0?"Purchasing":n.me._getPurchasingCell(e))}).insert({bottom:new Element(n.tag,{"class":"warehouse"}).update(n.isTitle===!0?"Warehouse":n.me._getWarehouseCell(e))})},_updateOrderItems:function(e,t,n,o){var s={};return s.me=this,s.notifyCustomer=o||!1,s.btn=$(e),s.me._signRandID(s.btn),s.me.postAjax(s.me.getCallbackId("updateOrder"),{items:t,order:s.me._order,"for":n,notifyCustomer:s.notifyCustomer},{onLoading:function(){jQuery("#"+s.btn.id).button("loading")},onSuccess:function(e,t){try{if(s.result=s.me.getResp(t,!1,!0),!s.result)return;alert("Saved Successfully!"),window.location=document.URL}catch(n){alert(n)}},onComplete:function(){jQuery("#"+s.btn.id).button("reset")}}),s.me},_getPurchasingBtns:function(){var e={};return e.me=this,e.me._editMode.purchasing===!1||e.me.orderStatusIds.purchaseCanEdit.indexOf(1*e.me._order.status.id)<0?void 0:new Element("div",{"class":"row"}).insert({bottom:new Element("span",{"class":"col-xs-7",title:"Notify Customer?"}).insert({bottom:new Element("label",{"for":"notify-customer-purchasing"}).update("Notify Cust.?")}).insert({bottom:e.notifyCustBox=new Element("input",{type:"checkbox",id:"notify-customer-purchasing",checked:!0})})}).insert({bottom:new Element("span",{"class":"col-xs-5",title:"Notify Customer?"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Saving..."}).update("submit").observe("click",function(){e.btn=this,e.me._signRandID(e.btn),e.data=e.me._collectData("update_order_item_purchase","order_item_id"),null!==e.data&&e.me._updateOrderItems(e.btn,e.data,e.me._commentsDiv.types.purchasing,e.notifyCustBox.checked)})})})},_getWHBtns:function(){var e={};return e.me=this,e.me._editMode.warehouse===!1||e.me.orderStatusIds.warehouseCanEdit.indexOf(1*e.me._order.status.id)<0?"":new Element("div",{"class":"row"}).insert({bottom:new Element("span",{"class":"col-xs-7",title:"Notify Customer?"}).insert({bottom:new Element("label",{"for":"notify-customer-purchasing"}).update("Notify Cust.?")}).insert({bottom:e.notifyCustBox=new Element("input",{type:"checkbox",id:"notify-customer-purchasing",checked:!0})})}).insert({bottom:new Element("span",{"class":"col-xs-5",title:"Notify Customer?"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Saving..."}).update("submit").observe("click",function(){e.btn=this,e.data=e.me._collectData("update_order_item_warehouse","order_item_id"),null!==e.data&&e.me._updateOrderItems(e.btn,e.data,e.me._commentsDiv.types.warehouse,e.notifyCustBox.checked)})})})},_getPartsTable:function(){var e={};return e.me=this,e.productListDiv=new Element("table",{"class":"table table-hover table-condensed order_change_details_table"}).insert({bottom:e.me._getProductRow({product:{sku:"SKU",name:"Product Name"},unitPrice:"Unit Price Inc",margin:"Margin",qtyOrdered:"Qty",totalPrice:"Total Price Inc"},!0).wrap(new Element("thead"))}),e.productListDiv.insert({bottom:e.tbody=new Element("tbody")}),e.me._orderItems.each(function(t){e.tbody.insert({bottom:e.me._getProductRow(t)})}),e.tfoot=new Element("tfoot").update(e.me._getProductRow({product:{sku:"",name:""},unitPrice:"",qtyOrdered:"",totalPrice:""},!0).addClassName("submitBtns")),e.tfoot.down(".purchasing").update(e.me._getPurchasingBtns()),e.tfoot.down(".warehouse").update(e.me._getWHBtns()),e.productListDiv.insert({bottom:e.tfoot}),new Element("div",{"class":"panel panel-default"}).insert({bottom:new Element("div",{"class":"panel-body table-responsive"}).insert({bottom:e.productListDiv})})},_checkAndSubmitShippingOptions:function(e){var t={};t.me=this,t.shippingDiv=$(e).up(".save_shipping_panel"),t.finalShippingDataArray=t.me._collectData("save_shipping"),null!==t.finalShippingDataArray&&t.me.postAjax(t.me.getCallbackId("updateShippingInfo"),{shippingInfo:t.finalShippingDataArray,order:t.me._order},{onLoading:function(){jQuery("#"+e.id).button("loading")},onSuccess:function(e,n){try{if(t.result=t.me.getResp(n,!1,!0),!t.result)return;t.me.showModalBox("Success","Shipment saved successfully."),window.location=document.URL}catch(o){t.newDiv=new Element("div",{"class":"shipping-reconfim-wrapper"}).insert({bottom:t.me.getAlertBox("ERROR: ",o).addClassName("alert-danger")}).insert({bottom:new Element("h4").update("Please check with your Accountant to make sure this cusomter has paid for this order!")}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("label").update("If you really want to mark this order to be SHIPPED, please provide a comments and click save:")}).insert({bottom:new Element("input",{"class":"form-control comments",placeholder:"Comments"})})}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("span",{"class":"btn btn-primary"}).update("Confirm").observe("click",function(){return t.commentsBox=$(this).up(".shipping-reconfim-wrapper").down(".comments"),t.comments=$F(t.commentsBox),t.comments.blank()?void t.me._markFormGroupError(t.commentsBox,"Please provide some reason for this confirmation."):void t.me._submitOrderStatusChange(t.me._orderStatusID_Shipped,t.comments)})}).insert({bottom:new Element("span",{"class":"btn btn-default pull-right"}).update("Cancel").observe("click",function(){t.me.hideModalBox()})})}),t.me.showModalBox("Error",t.newDiv,!1)}},onComplete:function(){jQuery("#"+e.id).button("reset")}})},_getCourierList:function(){var e={};return e.me=this,e.courierSelect=new Element("select").insert({bottom:new Element("option",{value:""}).update("")}),e.me._couriers.each(function(t){e.courierSelect.insert({bottom:new Element("option",{value:t.id}).update(t.name)})}),e.courierSelect},_getShippmentRow:function(){var e={};return e.me=this,e.shipmentDiv=new Element("div",{"class":"panel panel-default"}).insert({bottom:new Element("div",{"class":"panel-heading"}).update("Shipment")}),e.me._order.shippments.size()>0&&(e.shippingInfos=e.me._order.shippments,e.shipmentListDiv=new Element("small",{"class":"viewShipping list-group"}),e.shippingInfos.each(function(t){e.shipmentListDiv.insert({bottom:new Element("div",{"class":"list-group-item"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:e.me._getfieldDiv("Date:",t.shippingDate).wrap(new Element("div",{"class":"col-xs-6 col-sm-2"}))}).insert({bottom:e.me._getfieldDiv("Est./Act.",e.me.getCurrency(t.estShippingCost)+" / "+e.me.getCurrency(t.actualShippingCost)).writeAttribute("title","Estimated Shipping Cost VS. Actual Shipping Cost").wrap(new Element("div",{"class":"col-xs-6 col-sm-2"}))}).insert({bottom:e.me._getfieldDiv("Receiver:",t.receiver).wrap(new Element("div",{"class":"col-xs-6 col-sm-2"}))}).insert({bottom:e.me._getfieldDiv("Contact No:",t.contact).wrap(new Element("div",{"class":"col-xs-6 col-sm-2"}))}).insert({bottom:e.me._getfieldDiv("Courier:",t.courier.name).wrap(new Element("div",{"class":"col-xs-3 col-sm-1"}))}).insert({bottom:e.me._getfieldDiv("Con. No:",t.conNoteNo).writeAttribute("title","Consignment Note Number").wrap(new Element("div",{"class":"col-xs-6 col-sm-2"}))}).insert({bottom:e.me._getfieldDiv("Cartons:",t.noOfCartons).writeAttribute("title","No Of Cartons Send On This Shipment").wrap(new Element("div",{"class":"col-xs-3 col-sm-1"}))}).insert({bottom:e.me._getfieldDiv("Shipping Address:","<small><em>"+t.address.full+"</em></small>").wrap(new Element("div",{"class":"col-xs-12 col-sm-6"}))}).insert({bottom:e.me._getfieldDiv("Delivery Instructions:",t.deliveryInstructions).wrap(new Element("div",{"class":"col-xs-12 col-xs-6"}))})})})}),e.shipmentDiv.insert({bottom:e.shipmentListDiv})),e.me._editMode.warehouse===!1||e.me.orderStatusIds.canAddShipment.indexOf(1*e.me._order.status.id)<0?e.shipmentDiv:(e.shipmentDivBody=new Element("div",{"class":"panel-body save_shipping_panel"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("Contact Name:",new Element("input",{type:"text",save_shipping:"contactName",required:!0,"class":"input-sm",value:e.me._order.address.shipping.contactName}))})}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("Contact No:",new Element("input",{type:"tel",save_shipping:"contactNo",required:!0,"class":"input-sm",value:e.me._order.address.shipping.contactNo}))})}).insert({bottom:new Element("div",{"class":"col-sm-2 bg-info"}).insert({bottom:e.me._getFormGroup("Courier:",e.me._getCourierList().writeAttribute("save_shipping","courierId").writeAttribute("required",!0).observe("change",function(){e.panel=$(this).up(".save_shipping_panel"),$F(this)==e.me._courier_LocalPickUpId?(e.panel.down('[save_shipping="conNoteNo"]').setValue("Local Pickup").disabled=!0,e.panel.down('[save_shipping="actualShippingCost"]').setValue("0").disabled=!0):(e.panel.down('[save_shipping="conNoteNo"]').setValue("").disabled=!1,e.panel.down('[save_shipping="actualShippingCost"]').setValue("").disabled=!1),e.panel.down('[save_shipping="noOfCartons"]').select()}))})}).insert({bottom:new Element("div",{"class":"col-sm-2 bg-info"}).insert({bottom:e.me._getFormGroup("Carton(s):",new Element("input",{type:"number",required:!0,save_shipping:"noOfCartons","class":"input-sm",validate_number:"Only accept whole number!"}).observe("change",function(){return e.inputBox=this,e.inputValue=$F(e.inputBox).strip(),null===e.inputValue.match(/^\d+?$/)?(e.me._markFormGroupError(e.inputBox,"Only accept whole number!"),!1):void(e.inputBox.value=e.inputValue)}))})}).insert({bottom:new Element("div",{"class":"col-sm-2 bg-info"}).insert({bottom:e.me._getFormGroup("Con. No:",new Element("input",{type:"text",required:!0,save_shipping:"conNoteNo","class":"input-sm"})).writeAttribute("title","The consignment number of this shipping")})}).insert({bottom:new Element("div",{"class":"col-sm-2 bg-info"}).insert({bottom:e.me._getFormGroup("Cost($)",new Element("input",{type:"text",required:!0,save_shipping:"actualShippingCost","class":"input-sm",validate_currency:"Invalid currency provided"}).observe("change",function(){e.me._currencyInputChanged(this)})).writeAttribute("title","The actual cost of this shipping")})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-4"}).insert({bottom:e.me._getFormGroup("Street:",new Element("input",{type:"text",save_shipping:"street","class":"input-sm",value:e.me._order.address.shipping.street}))})}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("City:",new Element("input",{type:"text",save_shipping:"city","class":"input-sm",value:e.me._order.address.shipping.city}))})}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("State:",new Element("input",{type:"text",save_shipping:"region","class":"input-sm",value:e.me._order.address.shipping.region}))})}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("Country:",new Element("input",{type:"text",save_shipping:"country","class":"input-sm",value:e.me._order.address.shipping.country}))})}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("Post Code:",new Element("input",{type:"text",save_shipping:"postCode","class":"input-sm",value:e.me._order.address.shipping.postCode}))})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-8"}).insert({bottom:e.me._getFormGroup("Delivery Instruction:",new Element("textarea",{save_shipping:"deliveryInstructions","class":"input-sm",rows:2}))})}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("Notify Cust?",new Element("input",{type:"checkbox",save_shipping:"notifyCust","class":"input-sm",checked:!0}))})}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("&nbsp;",new Element("span",{id:"shipping_save_btn","class":"btn btn-primary","data-loading-text":"Saving..."}).update("Save").observe("click",function(){e.me._checkAndSubmitShippingOptions(this)
}))})})}),e.shipmentDiv.down(".panel-heading").insert({after:e.shipmentDivBody}),e.shipmentDiv)},_submitOrderStatusChange:function(e,t){var n={};n.me=this,n.me.postAjax(n.me.getCallbackId("changeOrderStatus"),{order:n.me._order,orderStatusId:e,comments:t},{onLoading:function(){$(selBox).disabled=!0},onSuccess:function(e,t){try{n.result=n.me.getResp(t,!1,!0),alert("Saved Successfully!"),window.location=document.URL}catch(o){alert(o),$(selBox).disabled=!1,$(selBox).replace(n.me._getOrderStatus())}},onComplete:function(){}})},_changeOrderStatus:function(e){var t={};if(t.me=this,t.msg="About to change the status of this order?\n Continue?",confirm(t.msg)){for(t.comments="";null!==t.comments&&t.comments.blank();)t.comments=window.prompt("Please Type in the reason for changing:");return null===t.comments?($(e).replace(t.me._getOrderStatus()),this):(t.me._submitOrderStatusChange($F(e),t.comments),this)}return $(e).replace(t.me._getOrderStatus()),this},_getOrderStatus:function(){var e={};return e.me=this,e.me._editMode.status!==!0?e.me._order.status.name:(e.selBox=new Element("select").observe("change",function(){e.me._changeOrderStatus(this)}),e.me._orderStatuses.each(function(t){e.opt=new Element("option",{value:t.id}).update(t.name),t.id===e.me._order.status.id&&e.opt.writeAttribute("selected",!0),e.selBox.insert({bottom:e.opt})}),e.selBox)},_getAddressPanel:function(){var e={};return e.me=this,e.custName=e.custEmail="n/a",e.me._order.infos&&null!==e.me._order.infos&&(e.me._order.infos[e.me.infoType_custName]&&e.me._order.infos[e.me.infoType_custName].length>0&&(e.custName=e.me._order.infos[e.me.infoType_custName][0].value),e.me._order.infos[e.me.infoType_custEmail]&&e.me._order.infos[e.me.infoType_custEmail].length>0&&(e.custEmail=e.me._order.infos[e.me.infoType_custEmail][0].value)),new Element("div",{"class":"panel panel-default"}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("strong").update(e.me._order.type+": ")}).insert({bottom:new Element("strong").update(e.me._order.orderNo)}).insert({bottom:new Element("span",{"class":"pull-right"}).update("Status: ").insert({bottom:e.me._getOrderStatus()})})}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-6"}).insert({bottom:new Element("strong").update("Customer: ")}).insert({bottom:e.custName})}).insert({bottom:new Element("div",{"class":"col-sm-6"}).insert({bottom:new Element("a",{href:"mailto:"+e.custEmail}).update(e.custEmail)})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6"}).update(e.me._getAddressDiv("Shipping Address: ",e.me._order.address.shipping))}).insert({bottom:new Element("div",{"class":"col-xs-6"}).update(e.me._getAddressDiv("Billing Address: ",e.me._order.address.billing))})})})},_openOrderPrintPage:function(){var e={};return e.me=this,e.newWindow=window.open("/print/order/"+e.me._order.id+".html?pdf=1",e.me._order.status.name+" Order "+e.me._order.orderNo,"width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),e.newWindow.onload=function(){e.newWindow.document.title=e.me._order.status.name+" Order "+e.me._order.orderNo,e.newWindow.focus(),e.newWindow.print(),e.newWindow.close()},e.me},_openDocketPrintPage:function(){var e={};return e.me=this,e.newWindow=window.open("/printdocket/order/"+e.me._order.id+".html",e.me._order.status.name+" Order "+e.me._order.orderNo,"width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),e.newWindow.onload=function(){e.newWindow.document.title=e.me._order.status.name+" Order "+e.me._order.orderNo,e.newWindow.focus(),e.newWindow.print(),e.newWindow.close()},e.me},_setOrderType:function(e){var t={};return t.me=pageJs,t.btn=e,t.me._signRandID(t.btn),t.me.order=t.me._order,t.me.postAjax(t.me.getCallbackId("setOrderType"),t.me.order,{onLoading:function(){jQuery("#"+t.btn.id).button("loading")},onSuccess:function(e,n){try{t.result=t.me.getResp(n,!1,!0),window.location=document.URL}catch(o){t.resultList.update(t.me.getAlertBox("Error: ",o).addClassName("alert-danger"))}},onComplete:function(){jQuery("#"+t.btn.id).button("reset")}}),t.me},_sendEmail:function(e){var t={};return t.me=this,t.confirmDiv=$(e).up(".confirm-div"),t.confirmDiv.getElementsBySelector(".msg").each(function(e){e.remove()}),t.data=t.me._collectFormData(t.confirmDiv,"confirm-email"),null!==t.data?(t.data.orderId=t.me._order.id,t.me.postAjax(t.me.getCallbackId("sendEmail"),t.data,{onLoading:function(){t.me._signRandID(e),jQuery("#"+e.id).button("loading")},onSuccess:function(e,n){try{if(t.result=t.me.getResp(n,!1,!0),!t.result||!t.result.item)return;t.confirmDiv.update('<h4 class="text-success">Email Successfully added into the Message Queue. Will be sent within a minute</h4>'),setTimeout(function(){t.me.hideModalBox()},2e3)}catch(o){t.confirmDiv.insert({top:new Element("h4",{"class":"msg"}).update(new Element("span",{"class":"label label-danger"}).update(o))})}},onComplete:function(){jQuery("#"+e.id).button("reset")}}),t.me):void 0},_showEmailPanel:function(){var e={};return e.me=this,e.newDiv=new Element("div",{"class":"confirm-div"}).insert({bottom:new Element("div").insert({bottom:e.me._getFormGroup("Do you want to send an email to this address:",new Element("input",{value:e.me._order.customer.email,"confirm-email":"emailAddress",required:!0,placeholder:"The email to send to. WIll NOT update the customer's email with this."}))})}).insert({bottom:new Element("div").insert({bottom:new Element("em").insert({bottom:new Element("small").update("The above email will be used to send the email to. WIll NOT update the customer's email with this.")})})}).insert({bottom:new Element("div").insert({bottom:e.me._getFormGroup("Something you want to say:",new Element("textarea",{"confirm-email":"emailBody"}))})}).insert({bottom:new Element("div",{"class":"text-right"}).insert({bottom:new Element("span",{"class":"btn btn-default pull-left"}).update("CANCEL").observe("click",function(){e.me.hideModalBox()})}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Sending ..."}).update("Yes, send this "+e.me._order.type+" to this email address").observe("click",function(){e.me._sendEmail(this)})})}),e.me.showModalBox("<strong>Confirm Email Address:</strong>",e.newDiv),e.me},_getInfoPanel:function(){var e={};return e.me=this,e.orderDate=e.me.loadUTCTime(e.me._order.orderDate),e.newDiv=new Element("div",{"class":"panel panel-default order-info-div"}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("span",{"class":"btn-group btn-group-xs"}).insert({bottom:new Element("span",{"class":"btn btn-info btn-xs"}).insert({bottom:new Element("span",{"class":"hidden-xs hidden-sm"}).update("Print ")}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-print"})}).observe("click",function(){e.me._openOrderPrintPage()})}).insert({bottom:new Element("span",{"class":"btn btn-warning btn-xs"}).insert({bottom:new Element("span",{"class":"hidden-xs hidden-sm"}).update("Print Delivery Docket ")}).insert({bottom:new Element("span",{"class":"fa fa-ils"})}).observe("click",function(){e.me._openDocketPrintPage()})}).insert({bottom:new Element("span",{"class":"btn btn-success btn-xs invoice-btn"}).insert({bottom:new Element("span",{"class":"hidden-xs hidden-sm"}).update("Invoice ")}).insert({bottom:new Element("span",{"class":"fa fa-credit-card"})}).observe("click",function(){e.me._order.type="INVOICE",e.me._setOrderType(this)})}).insert({bottom:new Element("span",{"class":"btn btn-primary btn-xs invoice-btn"}).insert({bottom:new Element("span",{"class":"hidden-xs hidden-sm"}).update("Email ")}).insert({bottom:new Element("span",{"class":"fa fa-envelope"})}).observe("click",function(){e.me._showEmailPanel(this)})})}).insert({bottom:new Element("span",{"class":"pull-right text-right"}).insert({bottom:new Element("small").update("Order Date: ")}).insert({bottom:new Element("strong").update(e.orderDate.toLocaleDateString())})})}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong><small>Shipping:</small></strong>")}).insert({bottom:new Element("div",{"class":"col-xs-8"}).update("<em><small>"+(e.me._order.infos[9]?e.me._order.infos[9][0].value:"")+"</small></em>")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong><small>Mage Payment:</small></strong>")}).insert({bottom:new Element("div",{"class":"col-xs-8"}).update(e.me._order.infos[6]?e.me._order.infos[6][0].value:"")})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong><small>Total Amount Incl. GST:</small></strong>")}).insert({bottom:new Element("div",{"class":"col-xs-8"}).update(e.me.getCurrency(e.me._order.totalAmount))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong><small>Total Paid Incl. GST:</small></strong>")}).insert({bottom:new Element("div",{"class":"col-xs-8"}).update(e.me.getCurrency(e.me._order.totalPaid))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong><small>Total Due Incl. GST:</small></strong>")}).insert({bottom:new Element("div",{"class":"col-xs-8"}).update(e.me.getCurrency(e.me._order.totalDue))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong><small>Order Margin:</small></strong>")}).insert({bottom:new Element("div",{"class":"col-xs-8"}).update(e.me.getCurrency(e.me._order.margin))})})}),"INVOICE"===e.me._order.type&&e.newDiv.down(".invoice-btn").writeAttribute("disabled",!0).down("span").update("INVOICED "),e.newDiv},_currencyInputChanged:function(e){var t={};return t.me=this,$F(e).blank()?!1:(t.inputValue=t.me.getValueFromCurrency($F(e)),null===t.inputValue.match(/^(-)?\d+(\.\d{1,4})?$/)?(t.me._markFormGroupError(e,"Invalid currency format provided!"),!1):($(e).value=t.me.getCurrency(t.inputValue),!0))},_deletePayment:function(e,t){var n={};return n.me=this,n.confirmPanel=$(e).up(".deletion-confirm"),n.confirmPanel.getElementsBySelector(".msg").each(function(e){e.remove()}),n.data=n.me._collectFormData(n.confirmPanel,"deletion-confirm"),n.data!==!0?(n.data.paymentId=t.id,n.me._signRandID(e),n.me.postAjax(n.me.getCallbackId("deletePayment"),n.data,{onLoading:function(){jQuery("#"+e.id).button("loading")},onSuccess:function(t,o){try{if(n.result=n.me.getResp(o,!1,!0),!n.result||!n.result.item)return;n.confirmPanel.update('<h4 class="text-success">Payment delete successfully</h4>Please do NOT click anywhere, page will automaticall refersh.'),window.location=document.URL}catch(s){$(e).insert({before:n.me.getAlertBox("Error",s).addClassName("alert-danger").addClassName("msg")})}},onComplete:function(){jQuery("#"+e.id).button("reset")}}),n.me):void 0},_getPaymentListTable:function(e){var t={};return t.me=this,0===e.size()?"":(t.paymentDiv=new Element("table",{"class":"table table-hover table-condensed"}).insert({bottom:new Element("thead").insert({bottom:new Element("th").update("Method")}).insert({bottom:new Element("th").update("Type")}).insert({bottom:new Element("th").update("value")}).insert({bottom:new Element("th").update("Confirmed By")}).insert({bottom:new Element("th").update("Comments")}).insert({bottom:new Element("th").update("&nbsp;")})}).insert({bottom:t.tbody=new Element("tbody")}),e.each(function(e){t.tbody.insert({bottom:new Element("tr").insert({bottom:new Element("td").update(e.method.name)}).insert({bottom:new Element("td").update(e.type)}).insert({bottom:new Element("td").update(t.me.getCurrency(e.value))}).insert({bottom:new Element("td").update(e.createdBy.person.fullname+" @ "+t.me.loadUTCTime(e.created).toLocaleString())}).insert({bottom:new Element("td").insert({bottom:new Element("a",{href:"javascript: void(0);","class":"text-muted popover-comments",title:"comments","comments-entity-id":e.id,"comments-entity":"Payment"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-comment"})})})}).insert({bottom:new Element("td").insert({bottom:new Element("a",{href:"javascript: void(0);","class":"text-danger",title:"Delete this payment"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){t.newConfirmDiv=new Element("div",{"class":"deletion-confirm"}).insert({bottom:new Element("h4").update("You are about to delete a payment with a value: "+t.me.getCurrency(e.value))}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("label").update('If you want to continue, please provide a reason/comments below and click <strong class="text-danger">"YES, Delete It"</strong> below:')}).insert({bottom:t.deleteMsgBox=new Element("input",{"class":"form-control",placeholder:"The reason of deleting this payment","deletion-confirm":"reason",required:!0})})}).insert({bottom:new Element("span",{"class":"btn btn-danger"}).update("YES, Delete It").observe("click",function(){t.me._deletePayment(this,e)})}).insert({bottom:new Element("span",{"class":"btn btn-default pull-right"}).update("NO, Cancel Deletion").observe("click",function(){t.me.hideModalBox()})}),t.me.showModalBox("Deleting a Payment?",t.newConfirmDiv),$(t.deleteMsgBox).focus()})})})})}),t.paymentDiv)},_getPaymentRow:function(){var e={};return e.me=this,e.paymentDiv=new Element("div",{"class":"panel panel-default payment_row_panel"}).insert({bottom:new Element("div",{"class":"panel-heading"}).update("Payments")}),e.me._editMode.accounting===!0&&(e.clearConfirmPanel=function(t,n){return e.paymentDiv.getElementsBySelector(".after_select_method").each(function(e){e.remove()}),$F(n).blank()||e.me._currencyInputChanged(n)!==!0?void $(n).select():(e.wrapperDiv=e.paymentDivBody.down(".row"),e.wrapperDiv.insert({bottom:new Element("div",{"class":"after_select_method col-sm-4",title:"Notify Customer?"}).insert({bottom:e.me._getFormGroup("Notify Cust.?",new Element("input",{type:"checkbox","class":"input-sm",payment_field:"notifyCust",checked:!0}))})}),e.wrapperDiv.insert({bottom:new Element("div",{"class":"after_select_method col-sm-8"}).insert({bottom:e.me._getFormGroup("Comments:",e.commentsBox=new Element("input",{type:"text","class":"after_select_method input-sm",payment_field:"extraComments",required:!0,placeholder:"The reason why the paidAmount is different to Total Amount Due: "+e.me.getCurrency(e.me._order.totalAmount)}))})}),e.commentsBox.select(),void e.wrapperDiv.insert({bottom:new Element("div",{"class":"after_select_method col-sm-4"}).insert({bottom:e.me._getFormGroup("&nbsp;",new Element("span",{"class":"btn btn-primary after_select_method","data-loading-text":"Saving..."}).update("Confirm").observe("click",function(){e.me._submitPaymentConfirmation(this)}))})}))},e.paymentMethodSelBox=new Element("select",{"class":"input-sm",payment_field:"payment_method_id",required:!0}).insert({bottom:new Element("option",{value:""}).update("Payment Method:")}).observe("change",function(){e.clearConfirmPanel(this,e.paymentDiv.down("[payment_field=paidAmount]"))}),e.me._paymentMethods.each(function(t){e.paymentMethodSelBox.insert({bottom:new Element("option",{value:t.id}).update(t.name)})}),e.paymentDivBody=new Element("div",{"class":"panel-body panel_row_confirm_panel"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-4"}).insert({bottom:e.me._getFormGroup("Method:",e.paymentMethodSelBox)})}).insert({bottom:new Element("div",{"class":"col-sm-4"}).insert({bottom:e.me._getFormGroup("Paid:",new Element("input",{type:"text",payment_field:"paidAmount","class":"input-sm",required:!0,validate_currency:!0,placeholder:"The paid amount"}).observe("change",function(){e.clearConfirmPanel(e.paymentMethodSelBox,this)}))})})}),e.paymentDiv.insert({bottom:e.paymentDivBody}),e.paymentDiv.insert({bottom:e.me._getPaymentListTable(e.me._payments)})),e.paymentDiv},init:function(e){var t={};return t.me=this,t.me._resultDivId=e,$(t.me._resultDivId).update(new Element("div").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-8"}).insert({bottom:t.me._getAddressPanel()})}).insert({bottom:new Element("div",{"class":"col-sm-4"}).insert({bottom:t.me._getInfoPanel()})})}).insert({bottom:t.me._getPartsTable()}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-md-8"}).update(t.me._getShippmentRow())}).insert({bottom:new Element("div",{"class":"col-md-4"}).update(t.me._getPaymentRow())})}).insert({bottom:t.me._getEmptyCommentsDiv()})),this},load:function(){var e={};return e.me=this,e.me._getComments(!0),$$(".datepicker").each(function(e){new Prado.WebUI.TDatePicker({ID:e.id,InputMode:"TextBox",Format:"yyyy-MM-dd 17:00:00",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,PositionMode:"Bottom",ClassName:"datepicker-layer-fixer"})}),jQuery(".popover-comments").click(function(){e.me._signRandID($(this)),e.item=jQuery(this).removeAttr("title").addClass("visible-lg visible-md visible-sm visible-xs"),e.item.hasClass("popover-loaded")||jQuery.ajax({type:"GET",dataType:"json",url:"/ajax/getComments",data:{entity:e.item.attr("comments-entity"),entityId:e.item.attr("comments-entity-Id"),type:e.item.attr("comments-type")},success:function(t){e.newDiv="N/A",t.items&&t.items.length>0&&(e.newDiv='<div class="list-group">',jQuery.each(t.items,function(t,n){e.newDiv+='<div class="list-group-item">',e.newDiv+='<span class="badge">'+n.type+"</span>",e.newDiv+='<strong class="list-group-item-heading"><small>'+n.createdBy.person.fullname+"</small></strong>: ",e.newDiv+="<p><small><em> @ "+e.me.loadUTCTime(n.created).toLocaleString()+"</em></small><br /><small>"+n.comments+"</small></p>",e.newDiv+="</div>"}),e.newDiv+="</div>"),e.item.popover({html:!0,placement:"left",title:'<div class="row" style="min-width: 200px;"><div class="col-xs-10">Comments:</div><div class="col-xs-2"><a class="pull-right" href="javascript:void(0);" onclick="jQuery(\'#'+e.item.attr("id")+"').popover('hide');\"><strong>&times;</strong></a></div></div>",content:e.newDiv}).popover("show"),e.item.addClass("popover-loaded")}})}),"QUOTE"===e.me._order.type&&jQuery(".panel").removeClass("panel-default").addClass("panel-warning"),"ORDER"===e.me._order.type&&jQuery(".panel").removeClass("panel-default").addClass("panel-success"),e.me}});