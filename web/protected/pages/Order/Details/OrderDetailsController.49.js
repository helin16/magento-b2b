var PageJs=new Class.create;PageJs.prototype=Object.extend(new BPCPageJs,{_order:null,_orderStatuses:[],_orderStatusID_Shipped:"",_orderItems:[],_resultDivId:"",_couriers:[],_courier_LocalPickUpId:"",_editMode:{purchasing:!1,warehouse:!1,accounting:!1,status:!1},_commentsDiv:{pagination:{pageSize:5,pageNo:1},resultDivId:"comments_result_div",types:{purchasing:"",warehouse:""}},infoType_custName:1,infoType_custEmail:2,orderStatusIds:{warehouseCanEdit:[],purchaseCanEdit:[],canAddShipment:[]},setEditMode:function(e,t,n,s){return this._editMode.purchasing=e||!1,this._editMode.warehouse=t||!1,this._editMode.accounting=n||!1,this._editMode.status=s||!1,this},setCommentType:function(e,t){return this._commentsDiv.types.purchasing=e,this._commentsDiv.types.warehouse=t,this},setOrderStatusIds:function(e,t,n){return this.orderStatusIds.purchaseCanEdit=e,this.orderStatusIds.warehouseCanEdit=t,this.orderStatusIds.canAddShipment=n,this},setOrder:function(e,t,n,s){return this._order=e,this._orderItems=t,this._orderStatuses=n,this._orderStatusID_Shipped=s,this},setCourier:function(e,t){return this._couriers=e,this._courier_LocalPickUpId=t,this},_updateAddress:function(e,t){var n={};return n.me=this,n.inputPane=$(e).up(".address-div"),n.data=n.me._collectFormData(n.inputPane,"address-editable-field"),n.data.title=t,n.data.orderId=n.me._order.id,n.me.postAjax(n.me.getCallbackId("updateAddress"),n.data,{onLoading:function(){n.me._signRandID(e),jQuery("#"+e.id).button("loading")},onSuccess:function(e,s){try{if(n.result=n.me.getResp(s,!1,!0),!n.result||!n.result.item||!n.result.item.id)return;n.inputPane.replace(n.me._getAddressDiv(t,n.result.item,n.data.type))}catch(o){n.me.showModalBox('<strong class="text-danger">Error When Updating Address</strong>',o)}},onComplete:function(){jQuery("#"+e.id).button("reset")}}),n.me},_getScanTable:function(e){var t={};for(t.me=this,t.item=e,t.newDiv=new Element("div",{"class":"scanTable"}),t.i=0;t.i<e.qtyOrdered;t.i++)t.sellingitem=t.item.sellingitems&&t.item.sellingitems[t.i]&&jQuery.isNumeric(t.item.sellingitems[t.i].id)?t.item.sellingitems[t.i]:{},t.newDiv.insert({bottom:new Element("div",{"class":"col-sm-12"}).update(new Element("div",{"class":"form-group"}).update(t.me._getScanTableRow(t.sellingitem,e)))});return t.newDiv},_getScanTableRow:function(e,t){var n={};return n.me=this,n.newDiv=new Element("div",{"class":"serial-no-input-wrapper"}).update(n.txtBox=new Element("input",{"class":"form-control input-sm","scanned-item":"serialNo",type:"text",placeholder:"Serial Number:",value:e.serialNo?e.serialNo:""}).store("data",e).store("orderItem",t).observe("change",function(){n.txtBox=$(this),n.sellingItemData=n.txtBox.retrieve("data"),n.sellingItemData.serialNo=$F(n.txtBox),$F(n.txtBox).blank()&&(n.sellingItemData.active=!1),n.txtBox.store("data",n.sellingItemData),n.me._updateSerialNumber(n.txtBox)})),e&&e.kit&&e.kit.id&&n.newDiv.addClassName("input-group input-group-sm").insert({bottom:new Element("a",{"class":"input-group-addon btn btn-primary",href:"/kit/"+e.kit.id+".html",target:"_BLANK"}).insert({bottom:new Element("i",{"class":"glyphicon glyphicon-link"})})}),n.newDiv},_updateSerialNumber:function(e){var t={};return t.me=this,t.formGroupDiv=$(e).up(".form-group"),t.orderItem=$(e).retrieve("orderItem"),t.sellingitem=$(e).retrieve("data"),t.orderItem&&t.orderItem.id?(t.me.postAjax(t.me.getCallbackId("updateSerials"),{orderItemId:t.orderItem.id,sellingitem:t.sellingitem},{onLoading:function(){$(e).writeAttribute("disabled",!0).writeAttribute("title",""),t.formGroupDiv.removeClassName("has-error")},onSuccess:function(n,s){try{if(t.result=t.me.getResp(s,!1,!0),!t.result||!t.result.orderItem)return;$(e).up(".scanTable").replace(t.me._getScanTable(t.result.orderItem))}catch(o){$(e).writeAttribute("title","ERROR: "+o),t.formGroupDiv.addClassName("has-error"),t.me.showModalBox('<strong class="text-danger">Error Occurred When Recording The Serial Number: '+t.sellingitem.serialNo+"</strong>",o)}},onComplete:function(){$(e).writeAttribute("disabled",!1)}}),t.me):t.me},_getAddresEditDiv:function(e,t,n){var s={};return s.me=this,new Element("div",{"class":"address-div",title:"Double click to edit this address","address-editable":!0}).insert({bottom:new Element("strong").update(e)}).insert({bottom:new Element("dl",{"class":"dl-horizontal dl-condensed"}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-user",title:"Customer Name"}))}).insert({bottom:new Element("dd").insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"col-sm-6"}).update(new Element("input",{"address-editable-field":"contactName","class":"form-control input-sm",placeholder:"The name of contact person",value:t.contactName?t.contactName:""}))}).insert({bottom:new Element("div",{"class":"col-sm-6"}).update(new Element("input",{"address-editable-field":"contactNo","class":"form-control input-sm",placeholder:"The contact number of contact person",value:t.contactNo?t.contactNo:""}))})})}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-map-marker",title:"Address"}))}).insert({bottom:new Element("dd").insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"street col-sm-12"}).update(new Element("input",{"address-editable-field":"street","class":"form-control input-sm",placeholder:"Street Number and Street name",value:t.street?t.street:""}))})}).insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"city col-sm-6"}).update(new Element("input",{"address-editable-field":"city","class":"form-control input-sm",placeholder:"City / Suburb",value:t.city?t.city:""}))}).insert({bottom:new Element("div",{"class":"region col-sm-3"}).update(new Element("input",{"address-editable-field":"region","class":"form-control input-sm",placeholder:"State / Province",value:t.region?t.region:""}))}).insert({bottom:new Element("div",{"class":"postcode col-sm-3"}).update(new Element("input",{"address-editable-field":"postCode","class":"form-control input-sm",placeholder:"PostCode",value:t.postCode?t.postCode:""}))})}).insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"postcode col-sm-4"}).update(new Element("input",{"address-editable-field":"country","class":"form-control input-sm",placeholder:"Country",value:t.country?t.country:""}))}).insert({bottom:new Element("div",{"class":"col-sm-8"}).insert({bottom:new Element("input",{type:"hidden",value:t.id?t.id:"","address-editable-field":"id"})}).insert({bottom:new Element("input",{type:"hidden",value:n,"address-editable-field":"type"})}).insert({bottom:new Element("div",{"class":"btn btn-primary btn-sm col-xs-4 pull-right","data-loading-text":"updating..."}).update("Update").observe("click",function(){s.me._updateAddress(this,e)})}).insert({bottom:new Element("div",{"class":"btn btn-default btn-sm col-xs-4 pull-right"}).update("Cancel").observe("click",function(){$(this).up(".address-div").replace(s.me._getAddressDiv(e,t,n))})})})})})})},_getAddressDiv:function(e,t,n){var s={};return s.me=this,new Element("div",{"class":"address-div",title:"Double click to edit this address"}).setStyle("cursor: pointer").insert({bottom:new Element("strong").update(e)}).insert({bottom:new Element("dl",{"class":"dl-horizontal dl-condensed"}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-user",title:"Customer Name"}))}).insert({bottom:new Element("dd").update(t.contactName?t.contactName:"")}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-map-marker",title:"Address"}))}).insert({bottom:new Element("dd").insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"street inlineblock"}).update(t.street?t.street:"")}).insert({bottom:new Element("span",{"class":"city inlineblock"}).update(t.city?t.city+" ":"")}).insert({bottom:new Element("span",{"class":"region inlineblock"}).update(t.region?t.region+" ":"")}).insert({bottom:new Element("span",{"class":"postcode inlineblock"}).update(t.postCode?t.postCode:"")})})})}).observe("dblclick",function(){$(this).replace(s.me._getAddresEditDiv(e,t,n))})},_getfieldDiv:function(e,t){return new Element("dl",{"class":"dl-condensed"}).insert({bottom:new Element("dt").update(e)}).insert({bottom:new Element("dd").update(t)})},_getFormGroup:function(e,t){return new Element("div",{"class":"form-group"}).insert({bottom:new Element("label",{"class":"control-label"}).update(e)}).insert({bottom:t.addClassName("form-control")})},_collectData:function(e,t){var n={};return n.me=this,n.data={},n.hasError=!1,$$("["+e+"]").each(function(s){n.groupIndexName=t?s.readAttribute(t):null,n.fieldName=s.readAttribute(e),s.hasAttribute("required")&&$F(s).blank()&&(n.me._markFormGroupError(s,"This is requried"),n.hasError=!0),n.itemValue="checkbox"!==s.readAttribute("type")?$F(s):$(s).checked,(s.hasAttribute("validate_currency")||s.hasAttribute("validate_number"))&&(null===n.me.getValueFromCurrency(n.itemValue).match(/^(-)?\d+(\.\d{1,2})?$/)&&(n.me._markFormGroupError(s,s.hasAttribute("validate_currency")?s.readAttribute("validate_currency"):s.hasAttribute("validate_number")),n.hasErr=!0),n.value=n.me.getValueFromCurrency(n.itemValue)),null!==n.groupIndexName&&void 0!==n.groupIndexName?(n.data[n.groupIndexName]||(n.data[n.groupIndexName]={}),n.data[n.groupIndexName][n.fieldName]=n.itemValue):n.data[n.fieldName]=n.itemValue}),n.hasError===!0?null:n.data},_clearETA:function(e,t){var n={};return n.me=this,confirm("You are trying to mark a part as received/clearing the ETA?\n continue?")?(n.reason=prompt("The reason for clearing the ETA"),null===n.reason?n.me:(n.me.postAjax(n.me.getCallbackId("clearETA"),{item_id:t.id,comments:n.reason},{onLoading:function(e,t){},onSuccess:function(e,t){try{if(n.result=n.me.getResp(t,!1,!0),!n.result)return;n.me.showModalBox('<strong class="text-success">Success</strong>',"<h4>ETA cleared Successfully!</h4>"),window.location=document.URL}catch(s){n.me.showModalBox('<strong class="text-danger">Error</strong>',s)}},onComplete:function(e,t){}}),n.me)):n.me},_getPurchasingEditCelPanel:function(e,t){var n={};n.me=this,t.insert({bottom:n.me._getfieldDiv("ETA:",n.etaBox=new Element("input",{"class":"form-control input-sm datepicker",type:"datetime",value:e.eta,update_order_item_purchase:"eta",order_item_id:e.id,required:!0})).addClassName("no-stock-div dl-horizontal form-group")}).insert({bottom:n.me._getfieldDiv("Has Ordered?",new Element("input",{"class":"input-sm",type:"checkbox",update_order_item_purchase:"isOrdered",order_item_id:e.id,checked:e.isOrdered})).addClassName("no-stock-div dl-horizontal form-group")}).insert({bottom:n.me._getfieldDiv("Comments:",new Element("input",{"class":"form-control input-sm",type:"text",update_order_item_purchase:"comments",order_item_id:e.id,required:!0})).addClassName("no-stock-div dl-horizontal form-group")}),n.me._signRandID(n.etaBox);try{new Prado.WebUI.TDatePicker({ID:n.etaBox.id,InputMode:"TextBox",Format:"yyyy-MM-dd 17:00:00",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,PositionMode:"Bottom",ClassName:"datepicker-layer-fixer"})}catch(s){}return n.me},_getPurchasingEditCell:function(e){var t={};return t.me=this,t.hasStock=""===e.eta?"":"0001-01-01 00:00:00"===e.eta?!0:!1,t.isOrdered=e.isOrdered===!1?!1:!0,t.me._editMode.purchasing!==!1?(t.editCellPanel=new Element("small",{"class":"update_order_item_purchase_div update_order_item_div"}),t.editCellPanel.insert({bottom:t.me._getfieldDiv("Has Stock?",new Element("select",{"class":"form-control input-sm",update_order_item_purchase:"hasStock",required:!0,order_item_id:e.id}).insert({bottom:new Element("option",{value:" "}).update("Not Checked")}).insert({bottom:new Element("option",{value:"1"}).update("Yes").writeAttribute("selected",t.hasStock===!0)}).insert({bottom:new Element("option",{value:"0"}).update("No").writeAttribute("selected",t.hasStock===!1)}).observe("change",function(){t.editPanel=$(this).up(".update_order_item_purchase_div"),t.editPanel.getElementsBySelector(".no-stock-div").each(function(e){e.remove()}),"0"===$F(this)&&t.me._getPurchasingEditCelPanel(e,t.editPanel)})).addClassName("dl-horizontal form-group")}),t.hasStock===!1&&t.me._getPurchasingEditCelPanel(e,t.editCellPanel),t.editCellPanel):void 0},_changeIsOrdered:function(e,t){var n={};return n.me=this,n.isOrdered=$(e).checked,confirm("You are going to change this order item to be: "+(n.isOrdered===!0?"ORDERED":"NOT ORDERED"))?(n.me.postAjax(n.me.getCallbackId("changeIsOrdered"),{item_id:t.id,isOrdered:n.isOrdered},{onLoading:function(e,t){},onSuccess:function(e,t){try{if(n.result=n.me.getResp(t,!1,!0),!n.result)return;n.me.showModalBox('<strong class="text-success">Success</strong>',"<h4>IsOrdered flag changed Successfully!</h4>"),window.location=document.URL}catch(s){n.me.showModalBox('<strong class="text-danger">Error</strong>',s)}},onComplete:function(e,t){}}),!0):!1},_getPurchasingCell:function(e){var t={};return t.me=this,t.hasStock=""===e.eta?"":"0001-01-01 00:00:00"===e.eta?!0:!1,t.isOrdered=e.isOrdered===!1?!1:!0,t.me._editMode.purchasing===!1||t.me.orderStatusIds.purchaseCanEdit.indexOf(1*t.me._order.status.id)<0?(t.newDiv=new Element("small"),""===t.hasStock?t.newDiv.update("Not Checked"):(t.newDiv.insert({bottom:new Element("span",{"class":t.hasStock?"text-success":"text-danger"}).insert({bottom:new Element("strong").update("hasStock? ")}).insert({bottom:new Element("span",{"class":"glyphicon "+(t.hasStock?"glyphicon-ok-circle":"glyphicon-remove-circle")})}).insert({bottom:new Element("a",{href:"javascript: void(0);","class":"text-muted pull-right popover-comments",title:"comments","comments-type":t.me._commentsDiv.types.purchasing,"comments-entity-id":e.id,"comments-entity":"OrderItem"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-comment"})})})}),t.hasStock===!1&&t.newDiv.insert({bottom:new Element("span").update("&nbsp;&nbsp;")}).insert({bottom:new Element("span").insert({bottom:new Element("strong").update("ETA: ")}).insert({bottom:new Element("span").insert({bottom:new Element("small").update(e.eta+" ")}).insert({bottom:new Element("a",{href:"javascript: void(0);","class":"text-danger",title:"clear ETA"}).update(new Element("span",{"class":"glyphicon glyphicon-remove"})).observe("click",function(){t.me._clearETA(this,e)})})})}).insert({bottom:new Element("span").update("&nbsp;&nbsp;")}).insert({bottom:new Element("span").insert({bottom:new Element("strong").update("Is Ordered: ")}).insert({bottom:new Element("input",{type:"checkbox",checked:t.isOrdered}).observe("change",function(n){return t.me._changeIsOrdered(this,e)})})}),t.newDiv)):t.me._getPurchasingEditCell(e)},_getWarehouseEditCell:function(e){var t={};return t.me=this,t.isPicked=e.isPicked===!0,t.editCellPanel=new Element("small",{"class":"update_order_item_warehouse_div update_order_item_div"}),t.editcommentsDiv=t.me._getfieldDiv("Comments:",new Element("input",{"class":"form-control input-sm",type:"text",update_order_item_warehouse:"comments",order_item_id:e.id,required:!0})).addClassName("no-stock-div dl-horizontal form-group"),t.editCellPanel.insert({bottom:t.me._getfieldDiv("Picked?",new Element("select",{"class":"form-control input-sm",update_order_item_warehouse:"isPicked",order_item_id:e.id}).insert({bottom:new Element("option",{value:""}).update("Not Picked Yet")}).insert({bottom:new Element("option",{value:"1"}).update("Yes").writeAttribute("selected",t.isPicked===!0)}).insert({bottom:new Element("option",{value:"0"}).update("No").writeAttribute("selected",t.isPicked===!1)}).observe("change",function(){t.editPanel=$(this).up(".update_order_item_warehouse_div"),t.editPanel.getElementsBySelector(".no-stock-div").each(function(e){e.remove()}),"0"===$F(this)&&t.editCellPanel.insert({bottom:t.editcommentsDiv})})).addClassName("dl-horizontal form-group")}),t.isPicked===!1&&t.editCellPanel.insert({bottom:t.editcommentsDiv}),t.editCellPanel},_getWarehouseCell:function(e){var t={};return t.me=this,t.me._editMode.warehouse===!1||t.me.orderStatusIds.warehouseCanEdit.indexOf(1*t.me._order.status.id)<0?new Element("small").insert({bottom:new Element("span",{"class":e.isPicked?"text-success":"text-danger"}).insert({bottom:new Element("strong").update("Picked? ")}).insert({bottom:new Element("span",{"class":"glyphicon "+(e.isPicked?"glyphicon-ok-circle":"glyphicon-remove-circle")})}).insert({bottom:new Element("a",{href:"javascript: void(0);","class":"text-muted pull-right popover-comments",title:"comments","comments-type":t.me._commentsDiv.types.warehouse,"comments-entity-id":e.id,"comments-entity":"OrderItem"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-comment"})})})}):t.me._getWarehouseEditCell(e)},_getProductRow:function(e,t){var n={};return n.me=this,n.isTitle=t||!1,n.tag=n.isTitle===!0?"th":"td",n.newDiv=new Element("tr",{"class":n.isTitle===!0?"":"productRow",order_item_id:e.id}).store("data",e).insert({bottom:new Element(n.tag,{"class":"productName"}).insert({bottom:n.isTitle===!0?e.product.name:new Element("div").insert({bottom:new Element("div").insert({bottom:e.product&&e.product.isKit&&e.product.isKit===!0?new Element("abbr",{"class":"text-danger initialism",title:"This product a kit"}).setStyle("margin-right: 4px;").update(new Element("i",{"class":"glyphicon glyphicon-wrench"})):""}).insert({bottom:new Element("a",{href:"/product/"+e.product.id+".html",target:"_BLANK"}).update(new Element("strong",{"class":"text-info"}).update(e.product.sku))})}).insert({bottom:n.itemDescriptionEl=new Element("em").update(new Element("small").update(e.itemDescription))})})}).insert({bottom:new Element(n.tag,{"class":"uprice"}).update(n.isTitle===!0?e.unitPrice:n.me.getCurrency(e.unitPrice))}).insert({bottom:new Element(n.tag,{"class":"qty"}).update(e.qtyOrdered)}).insert({bottom:new Element(n.tag,{"class":"tprice"}).update(n.isTitle===!0?e.totalPrice:n.me.getCurrency(e.totalPrice))}).insert({bottom:new Element(n.tag,{"class":"margin"}).update(n.isTitle===!0?e.margin:new Element("abbr",{title:"Unit Cost When This Order Created: "+n.me.getCurrency(e.unitCost)}).update(n.me.getCurrency(e.margin)))}).insert({bottom:new Element(n.tag,{"class":"purchasing"}).update(n.isTitle===!0?"Purchasing":n.me._getPurchasingCell(e))}).insert({bottom:new Element(n.tag,{"class":"warehouse"}).update(n.isTitle===!0?"Warehouse":n.me._getWarehouseCell(e))}),n.itemDescriptionEl&&(n.itemDescriptionEl.insert({bottom:new Element("div",{"class":"row product-content-row"}).insert({bottom:new Element("span",{"class":"col-sm-12 show-tools"}).insert({bottom:new Element("input",{type:"checkbox",checked:!1,"class":"show-panel-check"}).observe("click",function(){n.btn=this,n.panel=$(n.btn).up(".product-content-row").down(".serial-no-scan-panel"),n.btn.checked?n.panel.show():n.panel.hide()})}).insert({bottom:new Element("a",{href:"javascript: void(0);"}).update(" show serial scan panel?").observe("click",function(){$(this).up(".show-tools").down(".show-panel-check").click()})})}).insert({bottom:new Element("span",{"class":"col-sm-12 serial-no-scan-panel"}).setStyle("padding-top: 5px; display: none;").update(n.me._getScanTable(e))})}),e&&e.sellingitems&&e.sellingitems.length>0&&(n.serials=[],e.sellingitems.each(function(e){n.serials.push(e.serialNo)}),n.newDiv.store("serials",n.serials))),n.newDiv},_updateOrderItems:function(e,t,n,s){var o={};return o.me=this,o.notifyCustomer=s||!1,o.btn=$(e),o.me._signRandID(o.btn),o.me.postAjax(o.me.getCallbackId("updateOrder"),{items:t,order:o.me._order,"for":n,notifyCustomer:o.notifyCustomer},{onLoading:function(e,t){jQuery("#"+o.btn.id).button("loading")},onSuccess:function(e,t){try{if(o.result=o.me.getResp(t,!1,!0),!o.result)return;o.me.showModalBox('<strong class="text-success">Success</strong>',"<h4>Saved Successfully!</h4>"),window.location=document.URL}catch(n){o.me.showModalBox('<strong class="text-danger">Error</strong>',n)}},onComplete:function(e,t){jQuery("#"+o.btn.id).button("reset")}}),o.me},_getPurchasingBtns:function(){var e={};return e.me=this,e.me._editMode.purchasing===!1||e.me.orderStatusIds.purchaseCanEdit.indexOf(1*e.me._order.status.id)<0?void 0:new Element("div",{"class":"row"}).insert({bottom:new Element("span",{"class":"col-xs-7",title:"Notify Customer?"}).insert({bottom:new Element("label",{"for":"notify-customer-purchasing"}).update("Notify Cust.?")}).insert({bottom:e.notifyCustBox=new Element("input",{type:"checkbox",id:"notify-customer-purchasing",checked:!0})})}).insert({bottom:new Element("span",{"class":"col-xs-5",title:"Notify Customer?"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Saving..."}).update("submit").observe("click",function(){e.btn=this,e.me._signRandID(e.btn),e.data=e.me._collectData("update_order_item_purchase","order_item_id"),null!==e.data&&e.me._updateOrderItems(e.btn,e.data,e.me._commentsDiv.types.purchasing,e.notifyCustBox.checked)})})})},_getWHBtns:function(){var e={};return e.me=this,e.me._editMode.warehouse===!1||e.me.orderStatusIds.warehouseCanEdit.indexOf(1*e.me._order.status.id)<0?"":new Element("div",{"class":"row"}).insert({bottom:new Element("span",{"class":"col-xs-7",title:"Notify Customer?"}).insert({bottom:new Element("label",{"for":"notify-customer-purchasing"}).update("Notify Cust.?")}).insert({bottom:e.notifyCustBox=new Element("input",{type:"checkbox",id:"notify-customer-purchasing",checked:!0})})}).insert({bottom:new Element("span",{"class":"col-xs-5",title:"Notify Customer?"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Saving..."}).update("submit").observe("click",function(){e.btn=this,e.data=e.me._collectData("update_order_item_warehouse","order_item_id"),null!==e.data&&e.me._updateOrderItems(e.btn,e.data,e.me._commentsDiv.types.warehouse,e.notifyCustBox.checked)})})})},_getPartsTable:function(){var e={};return e.me=this,e.productListDiv=new Element("table",{"class":"table table-hover table-condensed order_change_details_table"}).insert({bottom:e.me._getProductRow({product:{sku:"SKU",name:"Product Name"},unitPrice:"Unit Price Inc",margin:"Margin",qtyOrdered:"Qty",totalPrice:"Total Price Inc"},!0).wrap(new Element("thead"))}),e.productListDiv.insert({bottom:e.tbody=new Element("tbody")}),e.me._orderItems.each(function(t){e.tbody.insert({bottom:e.me._getProductRow(t)})}),e.tfoot=new Element("tfoot").update(e.me._getProductRow({product:{sku:"",name:""},unitPrice:"",qtyOrdered:"",totalPrice:""},!0).addClassName("submitBtns")),e.tfoot.down(".purchasing").update(e.me._getPurchasingBtns()),e.tfoot.down(".warehouse").update(e.me._getWHBtns()),e.productListDiv.insert({bottom:e.tfoot}),new Element("div",{"class":"panel panel-default"}).insert({bottom:new Element("div",{"class":"panel-body table-responsive"}).insert({bottom:e.productListDiv})})},_checkAndSubmitShippingOptions:function(e){var t={};t.me=this,t.shippingDiv=$(e).up(".save_shipping_panel"),t.finalShippingDataArray=t.me._collectData("save_shipping"),null!==t.finalShippingDataArray&&t.me.postAjax(t.me.getCallbackId("updateShippingInfo"),{shippingInfo:t.finalShippingDataArray,order:t.me._order},{onLoading:function(t,n){jQuery("#"+e.id).button("loading")},onSuccess:function(e,n){try{if(t.result=t.me.getResp(n,!1,!0),!t.result)return;t.me.showModalBox("Success","Shipment saved successfully."),window.location=document.URL}catch(s){t.newDiv=new Element("div",{"class":"shipping-reconfim-wrapper"}).insert({bottom:t.me.getAlertBox("ERROR: ",s).addClassName("alert-danger")}).insert({bottom:new Element("h4").update("Please check with your Accountant to make sure this cusomter has paid for this order!")}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("label").update("If you really want to mark this order to be SHIPPED, please provide a comments and click save:")}).insert({bottom:new Element("input",{"class":"form-control comments",placeholder:"Comments"})})}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("span",{"class":"btn btn-primary"}).update("Confirm").observe("click",function(){return t.commentsBox=$(this).up(".shipping-reconfim-wrapper").down(".comments"),t.comments=$F(t.commentsBox),t.comments.blank()?void t.me._markFormGroupError(t.commentsBox,"Please provide some reason for this confirmation."):void t.me._submitOrderStatusChange(t.me._orderStatusID_Shipped,t.comments)})}).insert({bottom:new Element("span",{"class":"btn btn-default pull-right"}).update("Cancel").observe("click",function(){t.me.hideModalBox()})})}),t.me.showModalBox("Error",t.newDiv,!1)}},onComplete:function(t,n){jQuery("#"+e.id).button("reset")}})},_getCourierList:function(){var e={};return e.me=this,e.courierSelect=new Element("select").insert({bottom:new Element("option",{value:""}).update("")}),e.me._couriers.each(function(t){e.courierSelect.insert({bottom:new Element("option",{value:t.id}).update(t.name)})}),e.courierSelect},_getShippmentRow:function(){var e={};return e.me=this,e.shipmentDiv=new Element("div",{"class":"panel panel-default"}).insert({bottom:new Element("div",{"class":"panel-heading"}).update("Shipment").insert({bottom:e.me._order.status&&e.me._order.status.id==e.me._orderStatusID_Shipped?new Element("a",{"class":"btn btn-danger btn-xs pull-right",href:"/rma/new.html?orderid="+e.me._order.id}).update("Create RMA"):""})}),e.me._order.shippments.size()>0&&(e.shippingInfos=e.me._order.shippments,e.shipmentListDiv=new Element("small",{"class":"viewShipping list-group"}),e.shippingInfos.each(function(t){e.shipmentListDiv.insert({bottom:new Element("div",{"class":"list-group-item"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:e.me._getfieldDiv("Date:",t.shippingDate).wrap(new Element("div",{"class":"col-xs-6 col-sm-2"}))}).insert({bottom:e.me._getfieldDiv("Est./Act.",e.me.getCurrency(t.estShippingCost)+" / "+e.me.getCurrency(t.actualShippingCost)).writeAttribute("title","Estimated Shipping Cost VS. Actual Shipping Cost").wrap(new Element("div",{"class":"col-xs-6 col-sm-2"}))}).insert({bottom:e.me._getfieldDiv("Receiver:",t.receiver).wrap(new Element("div",{"class":"col-xs-6 col-sm-2"}))}).insert({bottom:e.me._getfieldDiv("Contact No:",t.contact).wrap(new Element("div",{"class":"col-xs-6 col-sm-2"}))}).insert({bottom:e.me._getfieldDiv("Courier:",t.courier.name).wrap(new Element("div",{"class":"col-xs-3 col-sm-1"}))}).insert({bottom:e.me._getfieldDiv("Con. No:",t.conNoteNo).writeAttribute("title","Consignment Note Number").wrap(new Element("div",{"class":"col-xs-6 col-sm-2"}))}).insert({bottom:e.me._getfieldDiv("Cartons:",t.noOfCartons).writeAttribute("title","No Of Cartons Send On This Shipment").wrap(new Element("div",{"class":"col-xs-3 col-sm-1"}))}).insert({bottom:e.me._getfieldDiv("Shipping Address:","<small><em>"+t.address.full+"</em></small>").wrap(new Element("div",{"class":"col-xs-12 col-sm-6"}))}).insert({bottom:e.me._getfieldDiv("Delivery Instructions:",t.deliveryInstructions).wrap(new Element("div",{"class":"col-xs-12 col-xs-6"}))})})})}),e.shipmentDiv.insert({bottom:e.shipmentListDiv})),e.me._editMode.warehouse===!1||e.me.orderStatusIds.canAddShipment.indexOf(1*e.me._order.status.id)<0?e.shipmentDiv:(e.shipmentDivBody=new Element("div",{"class":"panel-body save_shipping_panel"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("Contact Name:",new Element("input",{type:"text",save_shipping:"contactName",required:!0,"class":"input-sm",value:e.me._order.address.shipping.contactName}))})}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("Contact No:",new Element("input",{type:"tel",save_shipping:"contactNo",required:!0,"class":"input-sm",value:e.me._order.address.shipping.contactNo}))})}).insert({bottom:new Element("div",{"class":"col-sm-2 bg-info"}).insert({bottom:e.me._getFormGroup("Courier:",e.me._getCourierList().writeAttribute("save_shipping","courierId").writeAttribute("required",!0).observe("change",function(){e.panel=$(this).up(".save_shipping_panel"),$F(this)==e.me._courier_LocalPickUpId?(e.panel.down('[save_shipping="conNoteNo"]').setValue("Local Pickup").disabled=!0,e.panel.down('[save_shipping="actualShippingCost"]').setValue("0").disabled=!0):(e.panel.down('[save_shipping="conNoteNo"]').setValue("").disabled=!1,e.panel.down('[save_shipping="actualShippingCost"]').setValue("").disabled=!1),e.panel.down('[save_shipping="noOfCartons"]').select()}))})}).insert({bottom:new Element("div",{"class":"col-sm-2 bg-info"}).insert({bottom:e.me._getFormGroup("Carton(s):",new Element("input",{type:"number",required:!0,save_shipping:"noOfCartons","class":"input-sm",validate_number:"Only accept whole number!"}).observe("change",function(){return e.inputBox=this,e.inputValue=$F(e.inputBox).strip(),null===e.inputValue.match(/^\d+?$/)?(e.me._markFormGroupError(e.inputBox,"Only accept whole number!"),!1):void(e.inputBox.value=e.inputValue)}))})}).insert({bottom:new Element("div",{"class":"col-sm-2 bg-info"}).insert({bottom:e.me._getFormGroup("Con. No:",new Element("input",{type:"text",required:!0,save_shipping:"conNoteNo","class":"input-sm"})).writeAttribute("title","The consignment number of this shipping")})}).insert({bottom:new Element("div",{"class":"col-sm-2 bg-info"}).insert({bottom:e.me._getFormGroup("Cost($)",new Element("input",{type:"text",required:!0,save_shipping:"actualShippingCost","class":"input-sm",validate_currency:"Invalid currency provided"}).observe("change",function(){e.me._currencyInputChanged(this)})).writeAttribute("title","The actual cost of this shipping")})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-4"}).insert({bottom:e.me._getFormGroup("Street:",new Element("input",{type:"text",save_shipping:"street","class":"input-sm",value:e.me._order.address.shipping.street}))})}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("City:",new Element("input",{type:"text",save_shipping:"city","class":"input-sm",value:e.me._order.address.shipping.city}))})}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("State:",new Element("input",{type:"text",save_shipping:"region","class":"input-sm",value:e.me._order.address.shipping.region}))})}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("Country:",new Element("input",{type:"text",save_shipping:"country","class":"input-sm",value:e.me._order.address.shipping.country}))})}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("Post Code:",new Element("input",{type:"text",save_shipping:"postCode","class":"input-sm",value:e.me._order.address.shipping.postCode}))})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-8"}).insert({bottom:e.me._getFormGroup("Delivery Instruction:",new Element("textarea",{save_shipping:"deliveryInstructions","class":"input-sm",rows:2}))})}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("Notify Cust?",new Element("input",{type:"checkbox",save_shipping:"notifyCust","class":"input-sm",checked:!0}))})}).insert({bottom:new Element("div",{"class":"col-sm-2"}).insert({bottom:e.me._getFormGroup("&nbsp;",new Element("span",{id:"shipping_save_btn","class":"btn btn-primary","data-loading-text":"Saving..."}).update("Save").observe("click",function(){e.me._checkAndSubmitShippingOptions(this)}))})})}),e.shipmentDiv.down(".panel-heading").insert({after:e.shipmentDivBody}),e.shipmentDiv)},_submitOrderStatusChange:function(e,t,n,s,o,i){var r={};r.me=this,r.succFunc="function"==typeof n?n:function(){r.me.showModalBox('<strong class="text-success">Saved Successfully</strong>','<h3 class="text-success">Saved Successfully!</h3>'),window.location=document.URL;

},r.failedFunc="function"==typeof s?s:function(e){r.me.showModalbox('<strong class="text-danger">Error</strong>',e)},r.me.postAjax(r.me.getCallbackId("changeOrderStatus"),{order:r.me._order,orderStatusId:e,comments:t},{onLoading:function(e,t){"function"==typeof o&&o()},onSuccess:function(e,t){try{if(r.result=r.me.getResp(t,!1,!0),!r.result)return;"function"==typeof r.succFunc&&r.succFunc(r.result)}catch(n){"function"==typeof r.succFunc&&r.failedFunc(n)}},onComplete:function(e,t){"function"==typeof i&&i()}})},_changeOrderStatus:function(e){var t={};return t.me=this,t.newStatusId=$F(e),t.selectedOptText=e.options[e.selectedIndex].text,t.newDiv=new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"confirm-div"}).insert({bottom:new Element("div",{"class":"row msg-div"})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("label",{"class":"control-label"}).update("Some Reason:")}).insert({bottom:new Element("textarea",{"class":"form-control","confirm-div":"reason",placeholder:"Some reason please"})})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6"}).insert({bottom:new Element("div",{"class":"btn btn-default"}).update("Cancel").observe("click",function(){$(e).replace(t.me._getOrderStatus()),t.me.hideModalBox()})})}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).insert({bottom:new Element("div",{"class":"btn btn-danger"}).update("Update It").observe("click",function(){return t.loadingDiv=new Element("div",{"class":"loading-div"}).update(t.me.getLoadingImg()),t.confirmDiv=$(this).up(".confirm-div"),t.confirmDiv.down(".msg-div").update(""),t.comments=$F(t.confirmDiv.down('[confirm-div="reason"]')),t.comments.blank()?void t.confirmDiv.down(".msg-div").update(t.me.getAlertBox("Error: ","Some reason is required!").addClassName("alert-danger")):void t.me._submitOrderStatusChange(t.newStatusId,t.comments,null,function(e){t.confirmDiv.down(".msg-div").update(t.me.getAlertBox("Error: ",e).addClassName("alert-danger"))},function(){t.confirmDiv.insert({after:t.loadingDiv}).hide()},function(){t.loadingDiv.remove(),t.confirmDiv.show()})})})})})}),t.me.showModalBox("<strong>Please provide some reason for changing this Order to: "+t.selectedOptText+"</strong>",t.newDiv),this},_getOrderStatus:function(){var e={};return e.me=this,e.me._editMode.status!==!0?e.me._order.status.name:(e.selBox=new Element("select").observe("change",function(){e.me._changeOrderStatus(this)}),e.me._orderStatuses.each(function(t){e.opt=new Element("option",{value:t.id}).update(t.name),t.id===e.me._order.status.id&&e.opt.writeAttribute("selected",!0),e.selBox.insert({bottom:e.opt})}),e.selBox)},_updatePONo:function(e){var t={};return t.me=this,t.me.postAjax(t.me.getCallbackId("updatePONo"),{orderId:t.me._order.id,poNo:$F(e)},{onLoading:function(){},onSuccess:function(e,n){try{if(t.result=t.me.getResp(n,!1,!0),!t.result||!t.me.item)return;t.me._order.pONo=t.me.item}catch(s){t.me.showModalBox('<strong class="text-danger">Error</strong>',s)}}}),t.me},_getAddressPanel:function(){var e={};return e.me=this,e.custName=e.custEmail="n/a",e.me._order.infos&&null!==e.me._order.infos&&(e.me._order.infos[e.me.infoType_custName]&&e.me._order.infos[e.me.infoType_custName].length>0&&(e.custName=e.me._order.infos[e.me.infoType_custName][0].value),e.me._order.infos[e.me.infoType_custEmail]&&e.me._order.infos[e.me.infoType_custEmail].length>0&&(e.custEmail=e.me._order.infos[e.me.infoType_custEmail][0].value)),new Element("div",{"class":"panel panel-default"}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("strong").update(e.me._order.type+": ")}).insert({bottom:new Element("strong").update(e.me._order.orderNo)}).insert({bottom:new Element("span").update("&nbsp;")}).insert({bottom:new Element("span").update("PO No.:")}).insert({bottom:new Element("input",{placeholder:"Optional - PO No. From Customer",value:e.me._order.pONo?e.me._order.pONo:""}).observe("change",function(){e.me._updatePONo(this)})}).insert({bottom:new Element("span",{"class":"pull-right"}).update("Status: ").insert({bottom:e.me._getOrderStatus()})})}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-6"}).insert({bottom:new Element("strong").update("Customer: ")}).insert({bottom:e.custName}).insert({bottom:e.me._order.customer.contactNo.blank()?"":"("+e.me._order.customer.contactNo+")"})}).insert({bottom:new Element("div",{"class":"col-sm-6"}).insert({bottom:new Element("a",{href:"mailto:"+e.custEmail}).update(e.custEmail)})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6"}).update(e.me._getAddressDiv("Billing Address: ",e.me._order.address.billing,"billing"))}).insert({bottom:new Element("div",{"class":"col-xs-6"}).update(e.me._getAddressDiv("Shipping Address: ",e.me._order.address.shipping,"shipping"))})})})},_getOperationalBtns:function(){var e={};return e.me=this,e.orderDate=e.me.loadUTCTime(e.me._order.orderDate),e.newDiv=new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-8"}).insert({bottom:e.me.orderBtnsJs.getBtnsDiv()})}).insert({bottom:new Element("div",{"class":"col-sm-4 text-right"}).insert({bottom:new Element("small").update("Order Date: ")}).insert({bottom:new Element("strong").update(e.orderDate.toLocaleDateString())})}),e.newDiv},_getShippingMethodEditDiv:function(e){var t={};return t.me=this,t.shippingMethodSel=new Element("select",{"class":"form-control input-sm"}).observe("change",function(){t.sel=$(this),t.me.postAjax(t.me.getCallbackId("changeShippingMethod"),{orderId:t.me._order.id,shippingMethod:$F(t.sel)},{onSuccess:function(e,n){try{if(t.result=t.me.getResp(n,!1,!0),!t.result||!t.result.item)return;window.location=document.URL}catch(s){t.me.showModalBox('<strong class="text-danger">Error</strong>',s)}}})}),t.shippingMethod=t.me._order&&t.me._order.infos[9]?t.me._order.infos[9][0].value:"",t.foundMatchedShippingMethod=!1,e.each(function(e){t.sameShippingMethod=e.name.strip()===t.shippingMethod.strip(),t.shippingMethodSel.insert({bottom:new Element("option",{value:e.name,selected:t.sameShippingMethod}).update(e.name)}),t.foundMatchedShippingMethod===!1&&t.sameShippingMethod===!0&&(t.foundMatchedShippingMethod=t.sameShippingMethod)}),t.shippingMethod.blank()||t.foundMatchedShippingMethod!==!1||t.shippingMethodSel.insert({bottom:new Element("option",{value:t.shippingMethod,selected:!0}).update(t.shippingMethod.stripTags())}),t.shippingMethodSel},_getShippingMethodDisplayDiv:function(){var e={};return e.me=this,e.newDiv=new Element("div").setStyle("cursor: pointer").insert({bottom:new Element("em",{title:"Double click to change"}).insert({bottom:new Element("small").update(e.me._order.infos[9]?e.me._order.infos[9][0].value:"")})}).observe("dblclick",function(){e.div=$(this),e.loadingDiv=new Element("div").update(e.me.getLoadingImg().removeClassName("fa-5x")),e.ajax=new Ajax.Request("/ajax/getAll",{method:"get",parameters:{entityName:"Courier",orderBy:{name:"asc"}},onLoading:function(){e.div.update(e.loadingDiv)},onSuccess:function(t){try{if(e.result=e.me.getResp(t.responseText,!1,!0),!e.result||!e.result.items)return;e.div.update(e.me._getShippingMethodEditDiv(e.result.items))}catch(n){e.me.showModalBox('<strong class="text-danger">Error</strong>',n),e.div.replace(e.me._getShippingMethodDisplayDiv())}},onComplete:function(){e.loadingDiv.remove()}})}),e.newDiv},_getInfoPanel:function(){var e={};return e.me=this,e.newDiv=new Element("div",{"class":"panel panel-default order-info-div"}).insert({bottom:new Element("div",{"class":"panel-heading"}).setStyle("padding: 4px 5px;display: block !important;").insert({bottom:e.me._getOperationalBtns()})}).insert({bottom:new Element("div",{"class":"list-group"}).insert({bottom:new Element("a",{"class":"list-group-item"}).setStyle("padding: 3px 0px;").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong>Inv. #:</strong>")}).insert({bottom:new Element("div",{"class":"col-xs-8"}).update("<em><small>"+e.me._order.invNo+"</small></em>")})})}).insert({bottom:new Element("a",{"class":"list-group-item"}).setStyle("padding: 3px 0px;").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong><small>Delivery Method:</small></strong>")}).insert({bottom:new Element("div",{"class":"col-xs-8"}).update(e.me._getShippingMethodDisplayDiv())})})}).insert({bottom:new Element("a",{"class":"list-group-item"}).setStyle("padding: 3px 0px;").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong><small>Shipping Cost:</small></strong>")}).insert({bottom:new Element("div",{"class":"col-xs-8"}).update("<em><small>"+e.me.getCurrency(e.me.getValueFromCurrency(e.me._order.infos[14]?e.me._order.infos[14][0].value:""))+"</small></em>")})})}).insert({bottom:new Element("a",{"class":"list-group-item"}).setStyle("padding: 3px 0px;").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong><small>Payment Method:</small></strong>")}).insert({bottom:new Element("div",{"class":"col-xs-8"}).update(e.me._order.infos[6]?e.me._order.infos[6][0].value:"")})})}).insert({bottom:new Element("a",{"class":"list-group-item"}).setStyle("padding: 3px 0px;").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong><small>Total Amount Incl. GST:</small></strong>")}).insert({bottom:new Element("div",{"class":"col-xs-8"}).update(e.me.getCurrency(e.me._order.totalAmount))})})}).insert({bottom:new Element("a",{"class":"list-group-item"}).setStyle("padding: 3px 0px;").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong><small>Total Credit Value:</small></strong>")}).insert({bottom:new Element("div",{"class":"col-xs-8"}).update(new Element("a",{"class":"text-danger",href:"/creditnote.html?orderid="+e.me._order.id,target:"_BLANK"}).update(e.me.getCurrency(e.me._order.totalCreditNoteValue)))})})}).insert({bottom:new Element("a",{"class":"list-group-item"}).setStyle("padding: 3px 0px;").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong><small>Total Paid Incl. GST:</small></strong>")}).insert({bottom:new Element("div",{"class":"col-xs-8"}).update(e.me.getCurrency(e.me._order.totalPaid))})})}).insert({bottom:new Element("a",{"class":"list-group-item"}).setStyle("padding: 3px 0px;").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong><small>Total Due Incl. GST:</small></strong>")}).insert({bottom:new Element("div",{"class":"col-xs-8"}).update(e.me.getCurrency(e.me._order.totalDue))})})}).insert({bottom:new Element("a",{"class":"list-group-item"}).setStyle("padding: 3px 0px;").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-4 text-right"}).update("<strong><small>Order Margin:</small></strong>")}).insert({bottom:new Element("div",{"class":"col-xs-8"}).update(e.me.getCurrency(e.me._order.margin))})})})}),e.newDiv},_getChildrenOrderListPanel:function(){var e={};return e.me=this,e.newDiv=new Element("div").insert({bottom:e.list=new Element("ul",{"class":"list-inline"}).insert({bottom:new Element("li").update("<strong>Orders Cloned from this order:</strong>")})}),e.me._order.childrenOrders.each(function(t){e.list.insert({bottom:new Element("li").insert({bottom:new Element("a",{"class":"btn btn-primary btn-xs",href:"/orderdetails/"+t.id+".html",target:"_BLANK"}).update(t.orderNo)})})}),e.newDiv},_getCreditNoteListPanel:function(){var e={};return e.me=this,e.newDiv=new Element("div").insert({bottom:e.list=new Element("ul",{"class":"list-inline"}).insert({bottom:new Element("li").update("<strong>CreditNotes from this order:</strong>")})}),e.me._order.creditNotes.each(function(t){e.list.insert({bottom:new Element("li").insert({bottom:new Element("a",{"class":"btn btn-warning btn-xs",href:"/creditnote/"+t.id+".html",target:"_BLANK"}).update(t.creditNoteNo)})})}),e.newDiv},_currencyInputChanged:function(e){var t={};return t.me=this,$F(e).blank()?!1:(t.inputValue=t.me.getValueFromCurrency($F(e)),null===t.inputValue.match(/^(-)?\d+(\.\d{1,4})?$/)?(t.me._markFormGroupError(e,"Invalid currency format provided!"),!1):($(e).value=t.me.getCurrency(t.inputValue),!0))},init:function(e){var t={};return t.me=this,t.me.orderBtnsJs=new OrderBtnsJs(t.me,t.me._order),t.me.paymentListPanelJs=new PaymentListPanelJs(t.me,t.me._order,void 0,t.me._editMode.accounting,!0),t.me._resultDivId=e,$(t.me._resultDivId).update(new Element("div").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-8"}).insert({bottom:t.me._getAddressPanel()}).insert({bottom:t.me._getChildrenOrderListPanel()}).insert({bottom:t.me._getCreditNoteListPanel()}).insert({bottom:new Element("div",{"class":"taskListPanel"})})}).insert({bottom:new Element("div",{"class":"col-sm-4"}).insert({bottom:t.me._getInfoPanel()})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12 memo-panel"}).store("lastMemoJs",t.lastMemoJs=new LastMemoPanelJs(t.me,"Order",t.me._order&&t.me._order.id?t.me._order.id:"",!0)).update(t.lastMemoJs?t.lastMemoJs._getPanel():"")})}).insert({bottom:t.me._getPartsTable()}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-md-8"}).update(t.me._getShippmentRow())}).insert({bottom:new Element("div",{"class":"col-md-4"}).update(t.paymentsPanel=t.me.paymentListPanelJs.getPaymentListPanel())})}).insert({bottom:new Element("div",{"class":"comments-list-div"})})),$(t.me._resultDivId).store("CommentsDivJs",new CommentsDivJs(t.me,"Order",t.me._order.id)._setDisplayDivId($(t.me._resultDivId).down(".comments-list-div")).render()),$(t.me._resultDivId).down(".memo-panel").retrieve("lastMemoJs").load(),t.paymentsPanel.down(".panel-heading")&&t.paymentsPanel.down(".panel-heading").insert({bottom:2==t.me._order.status.id?"":new Element("a",{"class":"btn btn-danger btn-xs pull-right",href:"/creditnote/new.html?blanklayout=1&orderid="+t.me._order.id}).update("Create CreditNote")}),t.me.paymentListPanelJs.setAfterAddFunc(function(){window.location=document.URL}).setAfterDeleteFunc(function(){window.location=document.URL}).load(),t.taskListPanel=$(t.me._resultDivId).down(".taskListPanel"),t.taskListPanel&&(t.taskListPanel.store("taskListPanelJs",t.taskStatusListPanelJs=new TaskStatusListPanelJs(t.me)).update(t.taskStatusListPanelJs.getDiv("Order",t.me._order)),t.taskStatusListPanelJs.setOpenInFancyBox("1"!==t.me.getUrlParam("blanklayout")).render()),this},load:function(){var e={};return e.me=this,$$(".datepicker").each(function(e){new Prado.WebUI.TDatePicker({ID:e.id,InputMode:"TextBox",Format:"yyyy-MM-dd 17:00:00",FirstDayOfWeek:1,CalendarStyle:"default",FromYear:2009,UpToYear:2024,PositionMode:"Bottom",ClassName:"datepicker-layer-fixer"})}),jQuery(".popover-comments").click(function(){e.me._signRandID($(this)),e.item=jQuery(this).removeAttr("title").addClass("visible-lg visible-md visible-sm visible-xs"),e.item.hasClass("popover-loaded")||jQuery.ajax({type:"GET",dataType:"json",url:"/ajax/getComments",data:{entity:e.item.attr("comments-entity"),entityId:e.item.attr("comments-entity-Id"),type:e.item.attr("comments-type")},success:function(t){e.newDiv="N/A",t.resultData&&t.resultData.items&&t.resultData.items.length>0&&(e.newDiv='<div class="list-group">',jQuery.each(t.resultData.items,function(t,n){e.newDiv+='<div class="list-group-item">',e.newDiv+='<span class="badge">'+n.type+"</span>",e.newDiv+='<strong class="list-group-item-heading"><small>'+n.createdBy.person.fullname+"</small></strong>: ",e.newDiv+="<p><small><em> @ "+e.me.loadUTCTime(n.created).toLocaleString()+"</em></small><br /><small>"+n.comments+"</small></p>",e.newDiv+="</div>"}),e.newDiv+="</div>"),e.item.popover({html:!0,placement:"left",title:'<div class="row" style="min-width: 200px;"><div class="col-xs-10">Comments:</div><div class="col-xs-2"><a class="pull-right" href="javascript:void(0);" onclick="jQuery(\'#'+e.item.attr("id")+"').popover('hide');\"><strong>&times;</strong></a></div></div>",content:e.newDiv}).popover("show"),e.item.addClass("popover-loaded")}})}),"QUOTE"===e.me._order.type&&jQuery(".panel").removeClass("panel-default").addClass("panel-warning"),"ORDER"===e.me._order.type&&jQuery(".panel").removeClass("panel-default").addClass("panel-success"),e.me}});