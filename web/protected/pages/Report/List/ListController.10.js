var PageJs=new Class.create
PageJs.prototype=Object.extend(new BPCPageJs,{_confirm_form_id:"confirm_form_id",bindBtns:function(){var e={}
return e.me=this,$$(".gen-report-btn").each(function(t){$(t).observe("click",function(){e.me._showDateSelectPanel(this,t.readAttribute("data-type"))})}),e.me},_initFormValdation:function(e,t){var o={}
return o.me=this,o.mainForm=jQuery("#"+o.me._confirm_form_id),o.mainForm.formValidation({framework:"bootstrap",icon:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{date_from:{validators:{callback:{message:"The from date is needed.",callback:function(e,t,o){return null!==jQuery(o).data("DateTimePicker").date()}}}},date_to:{validators:{callback:{message:"The to date is needed.",callback:function(e,t,o){return null!==jQuery(o).data("DateTimePicker").date()}}}}}}).on("err.form.fv",function(){o.mainForm.data("formValidation").getSubmitButton()&&o.mainForm.data("formValidation").disableSubmitButtons(!1)}).on("success.form.fv",function(n){n.preventDefault(),o.mainForm.data("formValidation").getSubmitButton()&&o.mainForm.data("formValidation").disableSubmitButtons(!1),o.data={},o.data.type=t,$(o.me._confirm_form_id).getElementsBySelector('[report_date="date_from"]').each(function(e){o.me._signRandID(e),o.data[e.readAttribute("report_date")]=jQuery("#"+e.id).data("DateTimePicker").date().startOf("day").utc().format()}),$(o.me._confirm_form_id).getElementsBySelector('[report_date="date_to"]').each(function(e){o.me._signRandID(e),o.data[e.readAttribute("report_date")]=jQuery("#"+e.id).data("DateTimePicker").date().endOf("day").utc().format()}),o.me.genReport(e,o.data)}),o.mainForm.find(".datepicker").on("dp.change dp.show",function(){o.mainForm.formValidation("revalidateField","date_from"),o.mainForm.formValidation("revalidateField","date_to")}),o.me},_showDateSelectPanel:function(e,t){var o={}
return o.me=this,o.newDiv=new Element("form",{"class":"confirm-div form-horizontal",id:o.me._confirm_form_id}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("label",{"class":"col-sm-2 control-label"}).update("Date From:")}).insert({bottom:new Element("div",{"class":"col-sm-10"}).insert({bottom:new Element("input",{"class":"form-control datepicker",placeholder:"The start of the date range",report_date:"date_from",name:"date_from"})})})}).insert({bottom:new Element("div",{"class":"form-group"}).insert({bottom:new Element("label",{"class":"col-sm-2 control-label"}).update("Date To:")}).insert({bottom:new Element("div",{"class":"col-sm-10"}).insert({bottom:new Element("input",{"class":"form-control datepicker",placeholder:"The end of the date range",report_date:"date_to",name:"date_to"})})})}).insert({bottom:new Element("div",{"class":"text-right"}).insert({bottom:new Element("span",{"class":"btn btn-default pull-left"}).update("CANCEL").observe("click",function(){o.me.hideModalBox()})}).insert({bottom:new Element("button",{type:"submit","class":"btn btn-primary submit-btn","data-loading-text":"Generating ..."}).update("Generate The Report")})}),o.me.showModalBox("<strong>Please provide the date range for: "+$(e).innerHTML+"</strong>",o.newDiv,!1,null,{"shown.bs.modal":function(){o.me._signRandID(o.newDiv),jQuery("#"+o.newDiv.id).find(".datepicker").datetimepicker({format:"DD/MM/YYYY",viewMode:"days"}),o.me._initFormValdation(o.newDiv.down(".submit-btn"),t)},"hide.bs.modal":function(){o.fv=jQuery("#"+o.me._confirm_form_id).data("formValidation"),o.fv&&o.fv.destroy()}}),o.me},genReport:function(e,t){var o={}
return o.me=this,o.me.postAjax(o.me.getCallbackId("genReportBtn"),t,{onLoading:function(){o.me._signRandID(e),jQuery("#"+e.id).button("loading")},onSuccess:function(e,t){try{if(o.result=o.me.getResp(t,!1,!0),!o.result||!o.result.item||!o.result.item.id)return
window.open(o.result.item.url),window.focus(),o.me.hideModalBox()}catch(n){o.me.showModalBox('<strong class="text-danger">Error</strong>',"<h4>"+n+"</h4>")}},onComplete:function(){jQuery("#"+e.id).button("reset")}},6e4),o.me}})