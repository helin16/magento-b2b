var PageJs=new Class.create();PageJs.prototype=Object.extend(new CRUDPageJs(),{_getTitleRowData:function(){return{description:"Description",name:"Name",noOfChildren:null}},_saveItem:function(c,d,b){var a={};a.me=this;a.data=a.me._collectFormData(d,b);if(a.data===null){return}a.me.postAjax(a.me.getCallbackId("saveItem"),{item:a.data},{onLoading:function(){if(a.data.id){d.addClassName("item_row").writeAttribute("item_id",a.data.id)}d.hide()},onSuccess:function(f,h){try{a.result=a.me.getResp(h,false,true);if(!a.result||!a.result.item){return}a.tbody=$(a.me.resultDivId).down("tbody");a.row=a.tbody.down(".item_row[item_id="+a.result.item.id+"]");a.newRow=a.me._getResultRow(a.result.item).addClassName("item_row").writeAttribute("item_id",a.result.item.id);if(!a.row){if(a.result.parent&&a.result.parent.id&&(a.parentRow=a.tbody.down(".item_row[item_id="+a.result.parent.id+"]"))){if(!a.tbody.down("[parentId="+a.result.parent.id+"]")){a.parentRow.replace(a.me._getResultRow(a.result.parent).addClassName("item_row").writeAttribute("item_id",a.result.parent.id))}else{a.parentRow.insert({after:a.newRow})}}else{a.tbody.insert({top:a.newRow});d.remove();$(a.me.totalNoOfItemsId).update($(a.me.totalNoOfItemsId).innerHTML*1+1)}}else{a.row.replace(a.newRow)}}catch(g){a.me.showModalBox('<span class="text-danger">ERROR:</span>',g,true);d.show()}}});return a.me},_getEditPanel:function(b){var a={};a.me=this;a.newDiv=new Element("tr",{"class":"save-item-panel info"}).store("data",b).insert({bottom:new Element("input",{type:"hidden","save-item-panel":"id",value:b.id?b.id:""})}).insert({bottom:new Element("input",{type:"hidden","save-item-panel":"parentId",value:b.parent&&b.parent.id?b.parent.id:""})}).insert({bottom:new Element("td",{"class":"form-group"}).insert({bottom:new Element("input",{required:true,"class":"form-control",placeholder:"The name","save-item-panel":"name",value:b.name?b.name:""})})}).insert({bottom:new Element("td",{"class":"form-group"}).insert({bottom:new Element("input",{"class":"form-control",placeholder:"Optional - The description","save-item-panel":"description",value:b.description?b.description:""})})}).insert({bottom:new Element("td",{"class":"text-right"}).insert({bottom:new Element("span",{"class":"btn-group btn-group-sm"}).insert({bottom:new Element("span",{"class":"btn btn-success",title:"Save"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok"})}).observe("click",function(){a.btn=this;a.me._saveItem(a.btn,$(a.btn).up(".save-item-panel"),"save-item-panel")})}).insert({bottom:new Element("span",{"class":"btn btn-danger",title:"Delete"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){if(b.id){$(this).up(".save-item-panel").replace(a.me._getResultRow(b).addClassName("item_row").writeAttribute("item_id",b.id))}else{$(this).up(".save-item-panel").remove()}})})})});return a.newDiv},_removeRowByParentId:function(a,c){var b={};b.me=this;a.getElementsBySelector(".item_row[parentId="+c.id+"]").each(function(d){b.me._removeRowByParentId(a,d.retrieve("data"));d.remove()});return b.me},_getChildrenRows:function(b,c){var a={};a.me=this;a.icon=$(b).down(".icon");if(a.icon.hasClassName("glyphicon-minus-sign")){a.icon.removeClassName("glyphicon-minus-sign").addClassName("glyphicon-plus-sign");a.me._removeRowByParentId($(a.me.resultDivId).down("tbody"),c)}else{a.icon.removeClassName("glyphicon-plus-sign").addClassName("glyphicon-minus-sign");a.me.postAjax(a.me.getCallbackId("getItems"),{searchCriteria:{parentId:c.id},pagination:{pageNo:null,pageSize:a.me._pagination.pageSize}},{onLoading:function(){},onSuccess:function(d,g){try{a.result=a.me.getResp(g,false,true);if(!a.result||!a.result.items){return}a.row=$(b).up(".item_row");a.result.items.each(function(e){a.row.insert({after:a.me._getResultRow(e).addClassName("item_row").writeAttribute("item_id",e.id)})})}catch(f){a.me.showModalBox('<span class="text-danger">ERROR:</span>',f,true)}}})}return a.me},_getPreName:function(b){var a={};a.me=this;a.newDiv="";if(!b.position){return a.newDiv}a.levels=b.position.split("|").size();a.preString="";for(a.i=1;a.i<a.levels;a.i=(a.i*1+1)){a.preString=a.preString+"&nbsp;&nbsp;&nbsp;&nbsp;"}a.newDiv=new Element("small").insert({bottom:a.preString});if(b.noOfChildren>0){a.newDiv.insert({bottom:new Element("a",{href:"javascript: void(0);"}).update(new Element("span",{"class":"icon glyphicon glyphicon-plus-sign"})).observe("click",function(){a.me._getChildrenRows(this,b)})})}else{a.newDiv.insert({bottom:"&nbsp;&nbsp;&nbsp;"})}return a.newDiv},_getResultRow:function(c,a){var b={};b.me=this;b.tag=(b.isTitle===true?"th":"td");b.isTitle=(a||false);b.btns=new Element("span",{"class":"btn-group btn-group-xs"}).insert({bottom:new Element("span",{"class":"btn btn-primary",title:"Add under this category"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus"})}).observe("click",function(){$(this).up(".item_row").insert({after:b.me._getEditPanel({parent:{id:c.id}})})})}).insert({bottom:new Element("span",{"class":"btn btn-default",title:"Edit"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-pencil"})}).observe("click",function(){$(this).up(".item_row").replace(b.me._getEditPanel(c))})});if(c.hasChildren===false){b.btns.insert({bottom:new Element("span",{"class":"btn btn-danger",title:"Delete"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){if(!confirm("Are you sure you want to delete this item?")){return false}b.me._deleteItem(c)})})}b.row=new Element("tr",{"class":(b.isTitle===true?"":"btn-hide-row")}).store("data",c).insert({bottom:new Element(b.tag,{"class":"name col-xs-4"}).insert({bottom:b.me._getPreName(c)}).insert({bottom:" "+c.name})}).insert({bottom:new Element(b.tag,{"class":"description"}).update(c.description)}).insert({bottom:new Element(b.tag,{"class":"text-right btns col-xs-2"}).update(b.isTitle===true?(new Element("span",{"class":"btn btn-primary btn-xs",title:"New"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plus"})}).insert({bottom:" NEW"}).observe("click",function(){$(this).up("thead").insert({bottom:b.me._getEditPanel({})})})):b.btns)});if(c.parent&&c.parent.id){b.row.writeAttribute("parentId",c.parent.id)}return b.row}});