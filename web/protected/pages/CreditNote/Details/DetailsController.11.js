var PageJs=new Class.create;PageJs.prototype=Object.extend(new BPCPageJs,{_customer:null,_item:null,_searchTxtBox:null,_applyToOptions:null,_submitOrder:function(e,t){var o={};return o.me=this,o.modalBoxPanel=$(e).up(".modal-content"),o.modalBoxPanel||(o.me.showModalBox("saving...",new Element("div",{"class":"confirm-div"})),o.modalBoxPanel=$$(".modal-content").first()),o.modalBoxTitlePanel=o.modalBoxPanel.down(".modal-title"),o.oldTitlePanel=o.modalBoxTitlePanel.clone(!0),o.modalBoxBodyPanel=o.modalBoxPanel.down(".modal-body"),o.loadingDiv=new Element("div").update('<h4>Submitting the data, please be patient.</h4><div><h3 class="fa fa-spinner fa-spin"></h3></div>'),o.me.postAjax(o.me.getCallbackId("saveOrder"),t,{onLoading:function(e,t){o.modalBoxTitlePanel.update("Submiting data, please wait..."),o.modalBoxBodyPanel.insert({bottom:o.loadingDiv}),o.modalBoxBodyPanel.down(".confirm-div").hide().getElementsBySelector(".result-msg").each(function(e){e.remove()})},onSuccess:function(e,t){try{if(o.result=o.me.getResp(t,!1,!0),!o.result||!o.result.item||!o.result.redirectURL)return;if(o.me._item=o.result.item,jQuery("#"+o.me.modalId).on("hide.bs.modal",function(){window.location=o.result.redirectURL}),o.me.disableAll(),o.modalBoxTitlePanel.update('<strong class="text-success">Success!</strong>'),o.succDiv=new Element("div",{"class":"panel"}).insert({bottom:new Element("h4",{"class":"text-success"}).update("CreditNote (No.: "+o.result.item.creditNoteNo+") Saved Successfully.")}).insert({bottom:o.me.getAlertBox("Note: ","The original "+o.result.item.order.type+'(<a href="/orderdetails/'+o.result.item.order.id+'.html" target="_BLANK">'+o.result.item.order.orderNo+"</a>) is now CANCELED. "+(o.result.newOrder&&o.result.newOrder.id?'As a result of a partial credit for a order, a new order(<a href="/orderdetails/'+o.result.newOrder.id+'.html" target="_BLANK">'+o.result.newOrder.orderNo+"</a>)  is created with the remaining items.":"")).addClassName("alert-danger")}).insert({bottom:new Element("div").update(new Element("div",{"class":"btn btn-primary col-xs-6 col-xs-offset-3"}).update("OK").observe("click",function(){window.location=o.result.redirectURL}))}),o.modalBoxBodyPanel.update(o.succDiv),o.result.printURL&&(o.printWindow=window.open(o.result.printURL,"Printing Order","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),!o.printWindow))throw'<h4>Your browser has block the popup window, please enable it for further operations.</h4><a href="'+o.result.printURL+'" target="_BLANK"> click here for now</a>'}catch(n){o.modalBoxTitlePanel.replace(o.oldTitlePanel),o.modalBoxBodyPanel.down(".confirm-div").insert({top:o.me.getAlertBox("",n).addClassName("alert-danger result-msg")}).show()}},onComplete:function(e,t){o.loadingDiv.remove()}}),o.me},disableAll:function(e){e=e||!1,jQuery("input").attr("disabled",!0),jQuery("textarea").attr("disabled",!0),jQuery(".btn").attr("disabled",!0),jQuery(".form-control").attr("disabled",!0),e!==!1&&(window.location=document.URL)},_getShowStatusSelBox:function(e){var t={};return t.me=this,t.forAll=e||!1,t.newSelBoxDiv=new Element("span",{"class":"form-group"}).insert({bottom:new Element("select",{"class":"parts-confirm-status",required:!0}).insert({bottom:new Element("option",{value:""}).update("")}).insert({bottom:new Element("option",{value:"StockOnHand",title:"Goods will be return to StockOnHand"}).update("BrandNew, sealed")}).insert({bottom:new Element("option",{value:"StockOnRMA",title:"Goods will be return to StockOnRMA"}).update("UnSealed / Not Sure")}).observe("change",function(){t.msg="",t.selectedIndex=$(this).selectedIndex,t.selectedIndex>=0&&(t.msg=$(this).options[t.selectedIndex].title),t.forAll===!0?$(this).up(".parts-confirm-table").down("tbody").getElementsBySelector(".parts-confirm-status").each(function(e){e.options[t.selectedIndex].selected=!0,e.insert({after:new Element("small",{"class":"msg"}).update(new Element("em").update(t.msg))})}):(t.cell=$(this).up(),t.cell.down(".msg")&&t.cell.down(".msg").remove(),t.cell.insert({bottom:new Element("small",{"class":"msg"}).update(new Element("em").update(t.msg))}),t.allSel=t.cell.up(".table").down("thead .parts-confirm-status"),t.allSel&&t.allSel.selectedIndex!==t.selectedIndex&&(t.allSel.options[0].selected=!0))})}),t.newSelBoxDiv},_getConfirmPartsTable:function(e,t){var o={};return o.me=this,o.showStatus=t||!1,o.newTable=new Element("table",{"class":"table table-hover table-condensed parts-confirm-table"}).insert({bottom:new Element("thead").insert({bottom:new Element("tr").insert({bottom:new Element("th",{"class":"col-xs-4"}).update("Product")}).insert({bottom:new Element("th",{"class":"col-xs-2"}).update("Qty")}).insert({bottom:o.showStatus!==!0?"":new Element("th").update("All: ").insert({bottom:o.me._getShowStatusSelBox(!0)})})})}).insert({bottom:o.tbody=new Element("tbody")}),e.each(function(e){o.tbody.insert({bottom:new Element("tr",{"class":"parts-confirm-row"}).store("data",e).insert({bottom:new Element("td").update(e.product.sku)}).insert({bottom:new Element("td").update(e.qtyOrdered)}).insert({bottom:o.showStatus!==!0?"":new Element("td").update(o.me._getShowStatusSelBox())})})}),o.newTable},_confirmSubmit:function(e,t,o){var n={};return n.me=this,n.modalWrapper=$(e).up(".modal-content"),n.modalWrapper.down(".modal-title").update('<strong class="text-success">Please confirm the condition of returned goods</strong>'),n.newDiv=new Element("div",{"class":"panel confirm-div"}).insert({bottom:new Element("div").insert({bottom:new Element("h4",{"class":"text-success"}).update("What are the confiditions of these returned goods?")}).insert({bottom:n.partsTable=n.me._getConfirmPartsTable(o,!0)})}).insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"btn btn-primary"}).update("Save").observe("click",function(){n.btn=this,n.hasError=!1,n.index=0,n.partsTable.getElementsBySelector(".parts-confirm-row").each(function(e){n.selBox=e.down(".parts-confirm-status"),n.selBox&&($F(n.selBox).blank()?(n.hasError=!0,n.me._markFormGroupError(n.selBox,"Select one please.")):t.items[n.index]&&(t.items[n.index].stockData=$F(n.selBox))),n.index=1*n.index+1}),n.hasError===!1&&n.me._submitOrder(n.btn,t)})}).insert({bottom:new Element("div",{"class":"btn btn-default pull-right"}).update("Cancel").observe("click",function(){n.me.hideModalBox()})})}),n.modalWrapper.down(".modal-body").update(n.newDiv),n.me},_getConfirmGoodsReturnedPanel:function(e,t){var o={};return o.me=this,o.newDiv=new Element("div",{"class":"confirm-div"}).insert({bottom:new Element("div").insert({bottom:o.confirmHeadingEl=new Element("h4",{"class":"text-warning"}).update("Have the customer returned all the goods on this credit note already?")}).insert({bottom:o.me._getConfirmPartsTable(t)})}).insert({bottom:new Element("div").insert({bottom:o.confirmBtn=new Element("span",{"class":"btn btn-primary"}).update("YES").observe("click",function(){o.me._confirmSubmit(this,e,t)})}).insert({bottom:new Element("span",{"class":"btn btn-default pull-right"}).update("NO").observe("click",function(){o.modalWrapper=$(this).up(".modal-content"),o.modalWrapper.down(".modal-title").update('<strong class="text-danger">Stop Now!</strong>'),o.modalWrapper.down(".modal-body").update("").insert({bottom:new Element("div",{"class":"panel"}).insert({bottom:new Element("div").update('<h4 class="text-danger">You need to create a RMA '+(o.me._order&&o.me._order.orderNo?'<a href="/orderdetails/'+o.me._order.id+'.html" target="_BLANK">'+o.me._order.orderNo+"</a>":"")+" first, and waiting until the goods are back then create a credit note against those returned goods!</h4>")}).insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"btn btn-primary col-sm-6 col-sm-offset-3"}).update("OK").observe("click",function(){o.me.hideModalBox()})})})})})})}),o.newDiv},_getValueExceededPanel:function(e,t,o,n){var r={};return r.me=this,r.totalCreditableValue=r.me._order.totalAmount-r.me._order.totalCreditNoteValue,r.newDiv=new Element("div",{"class":"confirm-div"}).insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"text-warning"}).update(r.me.getAlertBox("Warning: ","<strong>Exeeded Total Creditable Value("+r.me.getCurrency(r.totalCreditableValue)+') of this order: </strong><a href="/orderdetails/'+r.me._order.id+'.html" target="_BLANK">'+r.me._order.orderNo+"</a><div>Order Total Value: "+r.me.getCurrency(r.me._order.totalAmount)+"</div><div>Order Total Credited Value: "+r.me.getCurrency(r.me._order.totalCreditNoteValue)+"</div><div>Order Total Creditable Value: "+r.me.getCurrency(r.totalCreditableValue)+"</div><div>Current CreditNote Value: <strong>"+r.me.getCurrency(n)+"</div>").addClassName("alert-danger"))})}).insert({bottom:new Element("div").update("Are you sure you want to continue?")}).insert({bottom:new Element("div").insert({bottom:new Element("span",{"class":"btn btn-primary"}).update("YES, continue").observe("click",function(){r.me._confirmOrderAgainShipments(this,e,t,o)})}).insert({bottom:new Element("span",{"class":"btn btn-default pull-right"}).update("NO").observe("click",function(){r.me.hideModalBox()})})}),r.newDiv},_confirmOrderAgainShipments:function(e,t,o,n){var r={};return r.me=this,r.data=o,r.me._order.shippments&&r.me._order.shippments.size()>0?(r.me.hideModalBox(),r.me.showModalBox("You're about to save a credit note for : "+r.me._customer.name,r.me._getConfirmGoodsReturnedPanel(r.data,n)),r.me):(r.data.printIt=t===!0?!0:!1,r.me._submitOrder(e,r.data),r.me)},_preConfirmSubmit:function(e,t){var o={};if(o.me=this,o.data=o.me._collectFormData($(o.me.getHTMLID("itemDiv")),"save-order"),o.data.totalPaidAmount=o.me.getValueFromCurrency(o.data.totalPaidAmount),null===o.data)return null;if(o.data.applyTo.blank())return o.me.hideModalBox(),o.me.showModalBox("Warning","You MUST select what this credit note is <strong>Apply To</strong>"),null;if(o.data.printIt=t===!0?!0:!1,o.data.customer={id:o.me._customer.id},o.data.creditNoteId=o.me._creditNote&&o.me._creditNote.id?o.me._creditNote.id:"",o.data.orderId=o.me._order&&o.me._order.id?o.me._order.id:"",o.shippAddrPanel=$$(".shipping-address.address-div").first(),o.shippAddrPanel){if(o.shippAddr=o.me._collectFormData(o.shippAddrPanel,"address-editable-field"),null===o.shippAddr)return o.me.hideModalBox(),o.me.showModalBox("Warning","some error in the shipping address"),null;o.data.shippingAddr=o.shippAddr}return o.data.items=[],o.originalItems=[],$$(".order-item-row").each(function(e){o.itemData=e.retrieve("data"),o.originalItems.push(o.itemData),o.data.items.push({orderItemId:e.readAttribute("orderItemId"),creditNoteItemId:e.readAttribute("creditNoteItemId"),valid:e.visible(),product:{id:o.itemData.product.id,name:o.itemData.product.name,sku:o.itemData.product.sku},itemDescription:o.itemData.itemDescription,unitPrice:o.itemData.unitPrice,qtyOrdered:o.itemData.qtyOrdered,totalPrice:o.itemData.totalPrice,serials:e.retrieve("serials")})}),o.noValidItem=!0,o.data.items.each(function(e){o.noValidItem===!0&&e.valid===!0&&(o.noValidItem=!1)}),o.noValidItem===!0?(o.me.hideModalBox(),o.me.showModalBox('<strong class="text-danger">Error</strong>',"<strong>At least one Credit Note Item</strong> is needed!",!0),null):o.me._order&&o.me._order.id?(o.totalCreditValueForCurrentNote=o.me.getValueFromCurrency(jQuery('[order-price-summary="totalPriceIncludeGST"]').val()),o.totalCreditValueForCurrentNote>1*o.me._order.totalAmount-1*o.me._order.totalCreditNoteValue?(o.me.hideModalBox(),o.me.showModalBox("You're about to save a credit note for : "+o.me._customer.name,o.me._getValueExceededPanel(t,o.data,o.originalItems,o.totalCreditValueForCurrentNote)),o.me):(o.me._confirmOrderAgainShipments(e,t,o.data,o.originalItems),o.me)):(o.me.hideModalBox(),o.me.showModalBox("You're about to save a credit note for : "+o.me._customer.name,o.me._getConfirmGoodsReturnedPanel(o.data,o.originalItems)),o.me)},_checkOrderItems:function(e){var t={};return t.me=this,t.result=!1,t.me._order.items.each(function(o){switch(e){case"anyPicked":t.result===!1&&o.isPicked===!0&&(t.result=!0);break;default:t.me.showModalBox("<strong>Error</strong>","Invalid Job"+e+" passed to tmp.me._checkOrderItems")}}),t.result},_saveBtns:function(){var e={};return e.me=this,e.newDiv=new Element("div").insert({bottom:new Element("div",{"class":"btn-group pull-right  visible-xs visible-sm visible-md visible-lg"}).insert({bottom:new Element("span",{"class":"btn btn-primary save-btn"}).insert({bottom:new Element("span").update(" Save ")}).observe("click",function(){e.me._preConfirmSubmit(this)})})}).insert({bottom:new Element("div",{"class":"btn btn-default"}).setStyle("display: none;").insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove-sign"})}).insert({bottom:new Element("span").update(" cancel ")}).observe("click",function(){e.me.showModalBox('<strong class="text-danger">Cancelling the current order</strong>','<div>You are about to cancel this new order, all input data will be lost.</div><br /><div>Continue?</div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',!0)})}),e.newDiv.down(".btn-group").removeClassName("btn-group"),e.newDiv},_addNewProductRow:function(e){var t={};return t.me=this,t.currentRow=$(e).up(".new-order-item-input"),t.product=t.currentRow.retrieve("product"),t.product?(t.unitPriceBox=t.currentRow.down("[new-order-item=unitPrice]"),t.unitPrice=t.me.getValueFromCurrency($F(t.unitPriceBox)),null===t.unitPrice.match(/^\d+(\.\d{1,2})?$/)?void t.me._markFormGroupError(t.unitPriceBox,"Invalid value provided!"):(t.qtyOrderedBox=t.currentRow.down("[new-order-item=qtyOrdered]"),t.qtyOrdered=t.me.getValueFromCurrency($F(t.qtyOrderedBox)),null===t.qtyOrdered.match(/^\d+(\.\d{1,2})?$/)?void t.me._markFormGroupError(t.qtyOrderedBox,"Invalid value provided!"):(t.discountBox=t.currentRow.down("[new-order-item=discount]"),t.discount=t.me.getValueFromCurrency($F(t.discountBox)),null===t.discount.match(/^\d+(\.\d{1,2})?$/)?void t.me._markFormGroupError(t.discountBox,"Invalid value provided!"):(t.totalPriceBox=t.currentRow.down("[new-order-item=totalPrice]"),t.totalPrice=t.me.getValueFromCurrency($F(t.totalPriceBox)),null===t.totalPrice.match(/^\d+(\.\d{1,2})?$/)?void t.me._markFormGroupError(t.totalPriceBox,"Invalid value provided!"):(t.currentRow.getElementsBySelector(".form-group.has-error .form-control").each(function(e){$(e).retrieve("clearErrFunc")()}),t.itemDescription=$F(t.currentRow.down("[new-order-item=itemDescription]")).replace(/\n/g,"<br />"),t.data={product:t.product,itemDescription:t.itemDescription,unitPrice:t.me.getCurrency(t.unitPrice),qtyOrdered:t.qtyOrdered,discount:t.discount,margin:t.me.getCurrency(parseFloat(t.totalPrice)-parseFloat(1.1*t.product.unitCost*t.qtyOrdered)),totalPrice:t.me.getCurrency(t.totalPrice)},t.currentRow.up(".list-group").insert({bottom:t.itemRow=t.me._getProductRow(t.data)}),t.newRow=t.me._getNewProductRow(),t.currentRow.replace(t.newRow).addClassName(),t.newRow.down("[new-order-item=product]").focus(),t.me._recalculateSummary(),t.me))))):(t.productBox=t.currentRow.down("[new-order-item=product]"),void(t.currentRow.down("[new-order-item=product]")?t.me._markFormGroupError(t.productBox,"Select a product first!"):t.me.showModalBox("Product Needed","Select a product first!",!0)))},_searchProduct:function(e,t,o){var n={};return n.me=this,n.btn=e,n.showMore=$(e).retrieve("showMore")===!0?!0:!1,n.pageNo=t||1,n.me._signRandID(n.btn),n.searchTxtBox=$(n.btn).up(".product-autocomplete")&&$(n.btn).up(".product-autocomplete").down(".search-txt")?$(n.btn).up(".product-autocomplete").down(".search-txt"):$($(n.btn).retrieve("searchBoxId")),n.me._signRandID(n.searchTxtBox),n.searchTxt=$F(n.searchTxtBox),n.me.postAjax(n.me.getCallbackId("searchProduct"),{searchTxt:n.searchTxt,pageNo:n.pageNo},{onLoading:function(){jQuery("#"+n.btn.id).button("loading"),jQuery("#"+n.searchTxtBox.id).button("loading")},onSuccess:function(t,r){n.showMore===!1?n.resultList=new Element("div",{"class":"search-product-list"}):n.resultList=$(e).up(".search-product-list");try{if(n.result=n.me.getResp(r,!1,!0),!n.result||!n.result.items||0===n.result.items.size())throw"Nothing Found for: "+n.searchTxt;n.me._signRandID(n.searchTxtBox),n.result.items.each(function(e){n.resultList.insert({bottom:n.me._getSearchPrductResultRow(e,n.searchTxtBox)})}),n.resultList.addClassName("list-group")}catch(s){n.resultList.update(n.me.getAlertBox("Error: ",s).addClassName("alert-danger"))}"function"==typeof o&&o(),n.result.pagination.pageNumber<n.result.pagination.totalPages&&n.resultList.insert({bottom:new Element("a",{"class":"item-group-item"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Getting more ..."}).update("Show Me More")}).observe("click",function(){n.newBtn=$(this),$(n.newBtn).store("searchBoxId",n.searchTxtBox.id),$(n.newBtn).store("showMore",!0),n.me._searchProduct(this,1*n.pageNo+1,function(){$(n.newBtn).remove()})})}),n.showMore===!1&&n.me.showModalBox("Products that has: "+n.searchTxt,n.resultList,!1)},onComplete:function(e,t){jQuery("#"+n.btn.id).button("reset"),jQuery("#"+n.searchTxtBox.id).button("reset")}}),n.me},_getSearchPrductResultRow:function(e,t){var o={};return o.me=this,o.defaultImgSrc="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+",o.newRow=new Element("a",{"class":"list-group-item search-product-result-row",href:"javascript: void(0);"}).store("data",e).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-2"}).insert({bottom:new Element("div",{"class":"thumbnail"}).insert({bottom:new Element("img",{"data-src":"holder.js/100%x64",alert:"Product Image",src:0===e.images.size()?o.defaultImgSrc:e.images[0].asset.url})})})}).insert({bottom:new Element("div",{"class":"col-xs-10"}).insert({bottom:new Element("strong").update(new Element("a",{href:"/product/"+e.id+".html",target:"_BLANK"}).update(e.name)).insert({bottom:new Element("small",{"class":"pull-right"}).update("SKU: "+e.sku)})}).insert({bottom:new Element("div").insert({bottom:new Element("small").update(e.shortDescription)})}).insert({bottom:new Element("div").insert({bottom:new Element("small",{"class":"col-xs-4"}).insert({bottom:new Element("div",{"class":"input-group",title:"stock on HAND"}).insert({bottom:new Element("span",{"class":"input-group-addon"}).update("SOH:")}).insert({bottom:new Element("strong",{"class":"form-control"}).update(e.stockOnHand)})})}).insert({bottom:new Element("small",{"class":"col-xs-4"}).insert({bottom:new Element("div",{"class":"input-group",title:"stock on ORDER"}).insert({bottom:new Element("span",{"class":"input-group-addon"}).update("SOO:")}).insert({bottom:new Element("strong",{"class":"form-control"}).update(e.stockOnOrder)})})}).insert({bottom:new Element("small",{"class":"col-xs-4"}).insert({bottom:new Element("div",{"class":"input-group",title:"stock on PO"}).insert({bottom:new Element("span",{"class":"input-group-addon"}).update("SOP:")}).insert({bottom:new Element("strong",{"class":"form-control"}).update(e.stockOnPO)})})})})})}).observe("click",function(){o.inputRow=$(t).up(".new-order-item-input").store("product",e),t.up(".productName").writeAttribute("colspan",!1).update(new Element("a",{href:"/product/"+e.id+".html",target:"_BLANK"}).update(e.sku)).removeClassName("col-xs-8").addClassName("col-xs-3").insert({bottom:new Element("a",{href:"javascript: void(0);","class":"text-danger pull-right",title:"click to change the product"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){o.newRow=o.me._getNewProductRow(),$(this).up(".new-order-item-input").replace(o.newRow),o.newRow.down("[new-order-item=product]").select()})}).insert({after:new Element("div",{"class":"col-xs-5"}).update(new Element("textarea",{"new-order-item":"itemDescription"}).setStyle("width: 100%").update(e.name))}),jQuery("#"+o.me.modalId).modal("hide"),o.retailPrice=0===e.prices.size()?0:e.prices[0].price,o.inputRow.down("[new-order-item=unitPrice]").writeAttribute("value",o.me.getCurrency(o.retailPrice)).select(),o.me._calculateNewProductPrice(o.inputRow)}),o.newRow},_selectProduct:function(e){var t={};return t.me=this,t.qty=e.qty?e.qty:e.qtyOrdered,t.shouldBeTotal=e.unitPrice*t.qty,t.discount=0==Math.ceil(t.shouldBeTotal)?0:Math.round(100*(t.shouldBeTotal-e.totalPrice)/t.shouldBeTotal),t.data={product:e.product,itemDescription:e.itemDescription,unitPrice:t.me.getCurrency(e.unitPrice),qtyOrdered:t.qty,discount:t.discount+"%",margin:0,totalPrice:t.me.getCurrency(e.totalPrice)},$$(".order_change_details_table").first().insert({bottom:t.newDiv=t.me._getProductRow(t.data)}),t.me._recalculateSummary(),t.newDiv},_getSummaryFooter:function(){var e={};return e.me=this,e.ifNew=!(e.me._creditNote&&e.me._creditNote.id),e.applyTo=new Element("select",{"class":"select2 form-control input-sm","save-order":"applyTo","data-placeholder":"Select an option"}).insert({bottom:new Element("option",{value:""}).update("")}),e.me._applyToOptions.each(function(t){e.applyTo.insert({bottom:e.option=new Element("option",{value:t}).update(t)}),e.me._creditNote&&e.me._creditNote.applyTo==t&&e.option.writeAttribute("selected",!0)}),e.paymentMethodSel=e.ifNew?new Element("select",{"class":"form-control input-sm","save-order":"paymentMethodId"}).insert({bottom:new Element("option",{value:""}).update("Paid Via:")}):"Total Paid",e.ifNew&&(e.me._paymentMethods.each(function(t){e.paymentMethodSel.insert({bottom:new Element("option",{value:t.id}).update(t.name)})}),e.paymentMethodSel.observe("change",function(){e.btn=this,$(e.btn).up(".row").down(".input-field").update($F(e.btn).blank()?e.me.getCurrency(0):new Element("span",{"class":"form-group"}).update(e.paidAmountBox=new Element("input",{value:"5"===$F(e.btn).strip()?"0":"","order-price-summary":"totalPaidAmount","class":"form-control input-sm","save-order":"totalPaidAmount",placeholder:e.me.getCurrency(0),required:!0,validate_currency:"Invalid number provided!"}).observe("keyup",function(){e.me._recalculateSummary()}))),e.me._recalculateSummary(),e.paidAmountBox&&e.paidAmountBox.select()})),e.me.paymentListPanelJs=new PaymentListPanelJs(e.me,void 0,e.me._creditNote,!0,!1),e.newDiv=new Element("div",{"class":"panel-footer"}).insert({bottom:new Element("div",{"class":"row list-group-item-danger"}).insert({bottom:new Element("div",{"class":e.ifNew?"col-sm-8":"col-sm-4"}).insert({bottom:e.me._getFormGroup("Description:",new Element("textarea",{"save-order":"description",rows:5}).update(e.me._creditNote?e.me._creditNote.description:""))})}).insert({bottom:e.ifNew?"":new Element("div",{"class":"col-sm-4"}).insert({bottom:e.me.paymentListPanelJs.getPaymentListPanel()})}).insert({bottom:new Element("div",{"class":"col-sm-4"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total Excl. GST: "))}).insert({bottom:new Element("div",{"class":"col-xs-6","order-price-summary":"totalPriceExcludeGST"}).update(e.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total GST: "))}).insert({bottom:new Element("div",{"order-price-summary":"totalPriceGST","class":"col-xs-6"}).update(e.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total Discount:"))}).insert({bottom:new Element("div",{"order-price-summary":"totalDiscount","class":"col-xs-6"}).update(e.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Sub Total Incl. GST: "))}).insert({bottom:new Element("div",{"order-price-summary":"totalPriceIncludeGST","class":"col-xs-6"}).update(e.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Shipping Cost: "))}).insert({bottom:e.me._getShippingCostBox(e.me._creditNote&&e.me._creditNote.id?e.me._creditNote.shippingValue:e.me._order&&e.me._order.infos[14]?e.me.getValueFromCurrency(e.me._order.infos[14][0].value):0)})}).insert({bottom:new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Apply To: "))}).insert({bottom:new Element("div",{"class":"col-xs-6"}).update(new Element("strong").update(e.applyTo))})}).insert({bottom:new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update(e.paymentMethodSel))}).insert({bottom:new Element("div",{"class":"col-xs-6 input-field"}).update(e.me.getCurrency(e.ifNew?0:e.me._creditNote.totalPaid))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Total Incl. GST:"))}).insert({bottom:new Element("strong",{"order-price-summary":"subTotal","class":"col-xs-6"}).update(e.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("h4",{"class":"col-xs-6 text-right"}).setStyle("color: #d30014 !important").update(new Element("strong").update("DUE:"))}).insert({bottom:new Element("h4",{"class":"col-xs-6","order-price-summary":"total-payment-due"}).setStyle("color: #d30014 !important").update(e.me.getCurrency(0))})}).insert({bottom:new Element("div",{"class":"row margin"}).setStyle("display: none;").insert({bottom:new Element("strong",{"class":"col-xs-6 text-right"}).update(new Element("strong").update("Margin Total Incl. GST:"))}).insert({bottom:new Element("strong",{"class":"col-xs-6","order-price-summary":"total-margin"}).update(e.me.getCurrency(0))})})})}),e.newDiv},_getNewProductProductAutoComplete:function(){var e={};return e.me=this,e.skuAutoComplete=e.me._getFormGroup(null,new Element("div",{"class":"input-group input-group-sm product-autocomplete"}).insert({bottom:new Element("input",{"class":"form-control search-txt visible-xs visible-sm visible-md visible-lg init-focus","new-order-item":"product",required:!0,placeholder:"search SKU, NAME and any BARCODE for this product"}).observe("keyup",function(t){e.txtBox=this,e.me.keydown(t,function(){$(e.txtBox).up(".product-autocomplete").down(".search-btn").click()})}).observe("keydown",function(t){e.txtBox=this,e.me.keydown(t,function(){$(e.txtBox).up(".product-autocomplete").down(".search-btn").click()},function(){},Event.KEY_TAB)})}).insert({bottom:new Element("span",{"class":"input-group-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary search-btn","data-loading-text":"searching..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})}).observe("click",function(){$F($(this).up(".product-autocomplete").down(".search-txt")).blank()?$(this).up(".product-autocomplete").down(".search-txt").focus():e.me._searchProduct(this)})})})),e.skuAutoComplete.down(".input-group").removeClassName("form-control"),e.skuAutoComplete},_getNewProductRow:function(){var e={};return e.me=this,e.skuAutoComplete=e.me._getNewProductProductAutoComplete(),e.data={product:{name:e.skuAutoComplete},unitPrice:e.me._getFormGroup(null,new Element("input",{"class":"input-sm","new-order-item":"unitPrice",required:!0,value:e.me.getCurrency(0)}).observe("click",function(){$(this).select()}).observe("keydown",function(t){e.me._bindSubmitNewProductRow(t,this)}).observe("keyup",function(){e.me._calculateNewProductPrice($(this).up(".item_row"))})),qtyOrdered:e.me._getFormGroup(null,new Element("input",{"class":"input-sm","new-order-item":"qtyOrdered",required:!0,value:"1"}).observe("keyup",function(){e.me._calculateNewProductPrice($(this).up(".item_row"))}).observe("keydown",function(t){e.me._bindSubmitNewProductRow(t,this)}).observe("click",function(){$(this).select()})),discount:e.me._getFormGroup(null,new Element("input",{"class":"input-sm","new-order-item":"discount",value:"0"}).observe("keyup",function(){($F($(this)).blank()||$F($(this))>100)&&($(this).value=0,$(this).select()),e.me._calculateNewProductPrice($(this).up(".item_row"))}).observe("keydown",function(t){e.me._bindSubmitNewProductRow(t,this)}).observe("click",function(){$(this).select()})),totalPrice:e.me._getFormGroup(null,new Element("input",{"class":"input-sm",disabled:!0,"new-order-item":"totalPrice",required:!0,value:e.me.getCurrency(0)})),margin:e.me.getCurrency(0),btns:new Element("span",{"class":"btn-group btn-group-sm pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-primary"}).insert({bottom:new Element("span",{"class":" glyphicon glyphicon-floppy-saved save-new-product-btn"})}).observe("click",function(){e.me._addNewProductRow(this)})}).insert({bottom:new Element("span",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-floppy-remove"})}).observe("click",function(){confirm("You about to clear this entry. All input data for this entry will be lost.\n\nContinue?")&&(e.newRow=e.me._getNewProductRow(),e.currentRow=$(this).up(".new-order-item-input"),e.currentRow.getElementsBySelector(".form-group.has-error .form-control").each(function(e){$(e).retrieve("clearErrFunc")()}),e.currentRow.replace(e.newRow),e.newRow.down("[new-order-item=product]").focus())})})},e.me._getProductRow(e.data,!1).addClassName("new-order-item-input list-group-item-danger").removeClassName("order-item-row")},_getProductRow:function(e,t){var o={};return o.me=this,o.isTitle=t||!1,o.tag=o.isTitle===!0?"strong":"div",o.btns=e.btns?e.btns:new Element("span",{"class":"pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-xs item-del-btn"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){confirm("You remove this entry.\n\nContinue?")&&(o.row=$(this).up(".item_row"),o.row&&(jQuery.isNumeric(o.row.readAttribute("creditNoteItemId"))?o.row.hide():o.row.remove()),o.me._recalculateSummary())})}),o.row=new Element("div",{"class":" list-group-item "+(o.isTitle===!0?"list-group-item-danger":"item_row order-item-row")}).store("data",e).insert({bottom:new Element("div",{"class":"row"}).store("data",e).insert({bottom:new Element(o.tag,{"class":"productName col-xs-8"}).insert({bottom:e.itemDescription?e.itemDescription:e.product.name})}).insert({bottom:new Element(o.tag,{"class":"uprice col-xs-1"}).insert({bottom:e.unitPrice})}).insert({bottom:new Element(o.tag,{"class":"col-xs-1"}).insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"qty col-xs-6"}).update(e.qtyOrdered)}).insert({bottom:new Element("div",{"class":"discount col-xs-6"}).update(e.discount)})})}).insert({bottom:new Element(o.tag,{"class":"tprice col-xs-1"}).insert({bottom:e.totalPrice})}).insert({bottom:new Element(o.tag,{"class":"margin col-xs-1 text-right"}).update(e.margin).setStyle("display: none;")}).insert({bottom:new Element(o.tag,{"class":"btns col-xs-1 text-right"}).update(o.btns)})}),e.product.sku&&o.row.down(".productName").removeClassName("col-xs-8").addClassName("col-xs-6").insert({
before:new Element(o.tag,{"class":"productSku col-xs-2"}).update(o.isTitle===!0?"SKU":new Element("a",{href:"/product/"+e.product.id+".html",target:"_BLANK"}).update(e.product.sku))}),e.scanTable&&o.row.insert({bottom:new Element("div",{"class":"row product-content-row"}).insert({bottom:new Element("span",{"class":"col-sm-2 show-tools"}).insert({bottom:new Element("input",{type:"checkbox",checked:!0,"class":"show-panel-check"}).observe("click",function(){o.btn=this,o.panel=$(o.btn).up(".product-content-row").down(".serial-no-scan-pane"),o.btn.checked?o.panel.show():o.panel.hide()})}).insert({bottom:new Element("a",{href:"javascript: void(0);"}).update(" show serial scan panel?").observe("click",function(){$(this).up(".show-tools").down(".show-panel-check").click()})})}).insert({bottom:new Element("span",{"class":"col-sm-10 serial-no-scan-pane",style:"padding-top: 5px"}).update(e.scanTable)})}),o.row},_getPartsTable:function(){var e={};return e.me=this,e.productListDiv=new Element("div",{"class":"list-group order_change_details_table"}).insert({bottom:e.me._getProductRow({product:{sku:"SKU",name:"Description"},unitPrice:"Unit Price<div><small>(inc GST)</small><div>",qtyOrdered:"Qty",margin:"Margin",discount:"Disc. %",totalPrice:"Total Price<div><small>(inc GST)</small><div>",btns:new Element("div").setStyle("display:none;").insert({bottom:new Element("label",{"for":"hide-margin-checkbox"}).update("Show Margin ")}).insert({bottom:new Element("input",{id:"hide-margin-checkbox",type:"checkbox",checked:!0}).observe("click",function(){jQuery(".margin").toggle()})})},!0)}),e.productListDiv.insert({bottom:e.me._getNewProductRow().addClassName("list-group-item-danger")}),e.productListDiv},_getAddressDiv:function(e,t,o){var n={};return n.me=this,n.address=t||null,n.editable=o||!1,n.newDiv=new Element("div",{"class":"address-div"}).insert({bottom:new Element("strong").update(e)}).insert({bottom:new Element("dl",{"class":"dl-horizontal dl-condensed"}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-user",title:"Customer Name"}))}).insert({bottom:new Element("dd").insert({bottom:new Element("div").insert({bottom:new Element("div",{"class":"col-sm-6"}).update(n.editable!==!0?t.contactName:new Element("input",{"address-editable-field":"contactName","class":"form-control input-sm",placeholder:"The name of contact person",value:n.address.contactName?n.address.contactName:""}))}).insert({bottom:new Element("div",{"class":"col-sm-6"}).update(n.editable!==!0?t.contactNo:new Element("input",{"address-editable-field":"contactNo","class":"form-control input-sm",placeholder:"The contact number of contact person",value:n.address.contactNo?n.address.contactNo:""}))})})}).insert({bottom:new Element("dt").update(new Element("span",{"class":"glyphicon glyphicon-map-marker",title:"Address"}))}).insert({bottom:new Element("dd").insert({bottom:new Element("div").insert({bottom:n.editable!==!0?t.street:new Element("div",{"class":"street col-sm-12"}).update(new Element("input",{"address-editable-field":"street","class":"form-control input-sm",placeholder:"Street Number and Street name",value:n.address.street?n.address.street:""}))})}).insert({bottom:new Element("div").insert({bottom:n.editable!==!0?t.city+" ":new Element("div",{"class":"city col-sm-6"}).update(new Element("input",{"address-editable-field":"city","class":"form-control input-sm",placeholder:"City / Suburb",value:n.address.city?n.address.city:""}))}).insert({bottom:n.editable!==!0?t.region+" ":new Element("div",{"class":"region col-sm-3"}).update(new Element("input",{"address-editable-field":"region","class":"form-control input-sm",placeholder:"State / Province",value:n.address.region?n.address.region:""}))}).insert({bottom:n.editable!==!0?t.postCode:new Element("div",{"class":"postcode col-sm-3"}).update(new Element("input",{"address-editable-field":"postCode","class":"form-control input-sm",placeholder:"PostCode",value:n.address.postCode?n.address.postCode:""}))})}).insert({bottom:new Element("div").insert({bottom:n.editable!==!0?t.country:new Element("div",{"class":"postcode col-sm-4"}).update(new Element("input",{"address-editable-field":"country","class":"form-control input-sm",placeholder:"Country",value:n.address.country?n.address.country:""}))})})})}),n.editable===!0&&n.newDiv.writeAttribute("address-editable",!0),n.newDiv},getCustomerInfoPanel:function(){var e={};return e.me=this,e.customer=e.me._customer,e.newDiv=new Element("div",{"class":"panel panel-danger CustomerInfoPanel"}).insert({bottom:new Element("div",{"class":"panel-heading"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-8"}).insert({bottom:new Element("strong").update((e.me._creditNote&&e.me._creditNote.id?"EDITING":"CREATING")+" CREDIT NOTE FOR:  ")}).insert({bottom:new Element("a",{href:"javascript: void(0);"}).update(e.customer.name).observe("click",function(){e.me._openCustomerDetailsPage(e.customer)})}).insert({bottom:" <"}).insert({bottom:new Element("a",{href:"mailto:"+e.customer.email}).update(e.customer.email)}).insert({bottom:">"}).insert({bottom:e.me._order?new Element("strong").update(" with Order No. "):""}).insert({bottom:e.me._order?new Element("a",{target:"_blank",href:"/orderdetails/"+e.me._order.id+".html"}).update(e.me._order.orderNo):""}).insert({bottom:e.me._order?" with creditable value: ":""}).insert({bottom:e.me._order?new Element("a",{"class":"badge",href:"javascript: void(0)"}).update(e.me.getCurrency(e.me._order.totalAmount-e.me._order.totalCreditNoteValue)).observe("click",function(){jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",frameborder:"0",border:"0",seamless:"seamless",href:"/creditnote.html?blanklayout=1&orderid="+e.me._order.id+".html"})}):""})}).insert({bottom:new Element("div",{"class":"col-sm-4 text-right"}).setStyle("display: none;").insert({bottom:new Element("strong").update("Total Payment Due: ")}).insert({bottom:new Element("span",{"class":"badge","order-price-summary":"total-payment-due"}).update(e.me.getCurrency(0))})})})}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("small").update(new Element("em").update(e.customer.description))})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:e.me._getAddressDiv("Billing Address: ",e.customer.address?e.customer.address.billing:null).addClassName("col-xs-6")}).insert({bottom:e.me._getAddressDiv("Shipping Address: ",e.customer.address?e.customer.address.shipping:null,!0).addClassName("col-xs-6").addClassName("shipping-address")})})}),e.newDiv},_openCustomerDetailsPage:function(e){var t={};return t.me=this,jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",href:"/customer/"+e.id+".html?blanklayout=1",beforeClose:function(){window.location=document.URL}}),t.me},getViewOfCreditNote:function(){var e={};return e.me=this,e.newDiv=new Element("div").insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(e.me.getCustomerInfoPanel())})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).insert({bottom:new Element("div",{"class":"panel panel-danger"}).update(e.me._getPartsTable()).insert({bottom:e.me._getSummaryFooter()})})})}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-sm-12"}).update(e.me._saveBtns())})}).insert({bottom:pageJs._creditNote?new Element("div",{"class":"row"}).setStyle("padding-top: 20px").insert({bottom:new Element("div",{"class":"col-sm-12 comments-div"})}):""}),e.newDiv},_selectCustomer:function(e){var t={};return t.me=this,t.me._customer=e,$$(".CustomerInfoPanel").size()>0&&jQuery(".CustomerInfoPanel").replaceWith(t.me.getCustomerInfoPanel()),$(t.me.getHTMLID("itemDiv")).update(t.me.getViewOfCreditNote()),$$(".init-focus").size()>0&&$$(".init-focus").first().focus(),t.me},_getCustomerRow:function(e,t){var o={};return o.me=this,o.isTitle=t||!1,o.tag=o.isTitle===!0?"th":"td",o.newDiv=new Element("tr",{"class":(o.isTitle===!0?"item_top_row":"btn-hide-row item_row")+(0==e.active?" danger":""),item_id:o.isTitle===!0?"":e.id}).store("data",e).insert({bottom:new Element(o.tag,{"class":"name col-xs-1"}).insert({bottom:o.isTitle===!0?"&nbsp;":new Element("span",{"class":"btn btn-primary btn-xs"}).update("select").observe("click",function(){o.me._selectCustomer(e)})})}).insert({bottom:new Element(o.tag,{"class":"name col-xs-1"}).update(e.name)}).insert({bottom:new Element(o.tag,{"class":"email col-xs-1",style:"text-decoration: underline;"}).update(e.email)}).insert({bottom:new Element(o.tag,{"class":"contact col-xs-1 truncate"}).update(e.contactNo)}).insert({bottom:new Element(o.tag,{"class":"description col-xs-1"}).update(e.description)}).insert({bottom:new Element(o.tag,{"class":"address col-xs-1"}).insert({bottom:o.isTitle===!0?e.addresses:new Element("span",{style:"display: inline-block"}).insert({bottom:new Element("a",{"class":"visible-xs visible-md visible-sm visible-lg",href:"javascript: void(0);"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plane address-shipping",style:"font-size: 1.3em",title:"Shipping"})}).observe("click",function(){o.me.showModalBox("<strong>Shipping Address</strong>",e.address.shipping.full)})})}).insert({bottom:o.isTitle===!0?"":new Element("span",{style:"display: inline-block"}).insert({bottom:new Element("a",{"class":"visible-xs visible-md visible-sm visible-lg",href:"javascript: void(0);"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-usd address-billing",style:"font-size: 1.3em; padding-left:10%;",title:"Billing"})}).observe("click",function(){o.me.showModalBox("<strong>Billing Address</strong>",e.address.shipping.full)})})})}).insert({bottom:new Element(o.tag,{"class":"mageId col-xs-1"}).update(e.mageId)}).insert({bottom:new Element(o.tag,{"class":"cust_active col-xs-1"}).insert({bottom:o.isTitle===!0?e.active:new Element("input",{type:"checkbox",disabled:!0,checked:e.active})})}),o.newDiv},_searchCustomer:function(e){var t={};return t.me=this,t.searchTxt=$F(e).strip(),t.searchPanel=$(e).up("#"+t.me.getHTMLID("searchPanel")),t.me.postAjax(t.me.getCallbackId("searchCustomer"),{searchTxt:t.searchTxt},{onLoading:function(){$(t.searchPanel).down(".list-div")&&$(t.searchPanel).down(".list-div").remove(),$(t.searchPanel).insert({bottom:new Element("div",{"class":"panel-body"}).update(t.me.getLoadingImg())})},onSuccess:function(e,o){$(t.searchPanel).down(".panel-body").remove();try{if(t.result=t.me.getResp(o,!1,!0),!t.result||!t.result.items)return;$(t.searchPanel).insert({bottom:new Element("small",{"class":"table-responsive list-div"}).insert({bottom:new Element("table",{"class":"table table-hover table-condensed"}).insert({bottom:new Element("thead").insert({bottom:t.me._getCustomerRow({email:"Email",name:"Name",contactNo:"Contact Num",description:"Description",addresses:"Addresses",address:{billing:{full:"Billing Address"},shipping:{full:"Shipping Address"}},mageId:"Mage Id",active:"Active?"},!0)})}).insert({bottom:t.listDiv=new Element("tbody")})})}),t.result.items.each(function(e){t.listDiv.insert({bottom:t.me._getCustomerRow(e)})})}catch(n){$(t.searchPanel).insert({bottom:new Element("div",{"class":"panel-body"}).update(t.me.getAlertBox("ERROR",n).addClassName("alert-danger"))})}}}),t.me},_getCustomerListPanel:function(){var e={};return e.me=this,e.newDiv=new Element("div",{id:e.me.getHTMLID("searchPanel"),"class":"panel panel-danger search-panel"}).insert({bottom:new Element("div",{"class":"panel-heading form-inline"}).insert({bottom:new Element("strong").update("Creating a new Credit Note for: ")}).insert({bottom:new Element("span",{"class":"input-group col-sm-6"}).insert({bottom:new Element("input",{"class":"form-control search-txt init-focus",placeholder:"Customer name"}).observe("keydown",function(t){return e.txtBox=this,e.me.keydown(t,function(){void 0!=e.txtBox.up("#"+pageJs._htmlIds.searchPanel).down(".item_row")&&1===e.txtBox.up("#"+pageJs._htmlIds.searchPanel).down("tbody").getElementsBySelector(".item_row").length?e.txtBox.up("#"+pageJs._htmlIds.searchPanel).down("tbody .item_row .btn").click():$(e.me.getHTMLID("searchPanel")).down(".search-btn").click()}),e.me.keydown(t,function(){void 0!=e.txtBox.up("#"+pageJs._htmlIds.searchPanel).down(".item_row")&&1===e.txtBox.up("#"+pageJs._htmlIds.searchPanel).down("tbody").getElementsBySelector(".item_row").length?e.txtBox.up("#"+pageJs._htmlIds.searchPanel).down("tbody .item_row .btn").click():$(e.me.getHTMLID("searchPanel")).down(".search-btn").click()},function(){},Event.KEY_TAB),!1})}).insert({bottom:new Element("span",{"class":"input-group-btn search-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})})}).observe("click",function(){e.btn=this,e.txtBox=$(e.me.getHTMLID("searchPanel")).down(".search-txt"),$F(e.txtBox).blank()?$(e.me.getHTMLID("searchPanel")).down(".table tbody")&&($(e.me.getHTMLID("searchPanel")).down(".table tbody").innerHTML=null):e.me._searchCustomer(e.txtBox)})})}).insert({bottom:new Element("span",{"class":"btn btn-success pull-right btn-sm btn-danger"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){$(e.me.getHTMLID("searchPanel")).down(".search-txt").clear().focus(),$(e.me.getHTMLID("searchPanel")).down(".table tbody").innerHTML=null})})}),e.newDiv},init:function(){var e={};return e.me=this,e.me._creditNote?(e.me._creditNote.order&&e.me._creditNote.order.id&&jQuery.isNumeric(e.me._creditNote.order.id)&&(e.me._order=e.me._creditNote.order),e.me._selectCustomer(e.me._creditNote.customer),e.me._creditNote.items.each(function(t){e.me._selectProduct(t).writeAttribute("creditNoteItemId",t.id)}),jQuery(".new-order-item-input").remove(),jQuery(".btn").remove(),e.me.disableAll(),e.commentsDivWrapper=$(e.me.getHTMLID("itemDiv")).down(".comments-div"),e.commentsDivWrapper&&e.me._creditNote.id&&(e.me._signRandID(e.commentsDivWrapper),e.commentsDivWrapper.store("commentsDivJs",e.commentsDivJs=new CommentsDivJs(e.me,"CreditNote",e.me._creditNote.id,10,e.commentsDivWrapper.id)),e.commentsDivJs.render())):e.me._order?(e.me._selectCustomer(e.me._order.customer),e.me._order.items.each(function(t){e.me._selectProduct(t).writeAttribute("orderItemId",t.id)})):e.me._customer?e.me._selectCustomer(e.me._customer):$(e.me.getHTMLID("itemDiv")).update(e.me._getCustomerListPanel()),$$(".init-focus").size()>0&&$$(".init-focus").first().focus(),jQuery(".select2").select2({minimumResultsForSearch:-1}),e.me.paymentListPanelJs&&e.me.paymentListPanelJs.setAfterAddFunc(function(){e.me.disableAll(!0)}).setAfterDeleteFunc(function(){e.me.disableAll(!0)}).load(),e.me},_getFormGroup:function(e,t){return new Element("div",{"class":"form-group"}).insert({bottom:e?new Element("label",{"class":"control-label"}).update(e):""}).insert({bottom:t.addClassName("form-control")})},_calculateNewProductPrice:function(e){var t={};return t.me=this,t.row=e,t.unitPrice=t.me.getValueFromCurrency($F(t.row.down("[new-order-item=unitPrice]"))),t.discount=$F(t.row.down("[new-order-item=discount]")).strip().replace("%",""),t.qty=$F(t.row.down("[new-order-item=qtyOrdered]")).strip(),t.totalPrice=t.unitPrice*(1-t.discount/100)*t.qty,$(t.row.down("[new-order-item=totalPrice]")).value=t.me.getCurrency(t.totalPrice),e.retrieve("product")&&(t.unitCost=e.retrieve("product").unitCost,t.row.down(".margin")&&$(t.row.down(".margin")).update(t.me.getCurrency(1*t.totalPrice-1.1*t.unitCost*t.qty)+(0===parseInt(t.unitCost)?'<div><small class="label label-danger">No Cost Yet</small</div>':""))),t.me},_bindSubmitNewProductRow:function(e,t){var o={};return o.me=this,o.txtBox=t,o.me.keydown(e,function(){$(o.txtBox).up(".item_row").down(".save-new-product-btn").click()}),o.me},_getShippingCostBox:function(e){var t={};return t.me=this,t.shippingCostBox=new Element("input",{"order-price-summary":"totalShippingCost","class":"form-control input-sm","save-order":"totalShippingCost",placeholder:t.me.getCurrency(0),required:!0,validate_currency:"Invalid number provided!",value:t.me.getCurrency(e?e:0)}).observe("keyup",function(){t.me._recalculateSummary()}),t.shippingCostBox.wrap(new Element("div",{"class":"form-group"}))},_recalculateSummary:function(){var e={};return e.me=this,e.totalPriceIncGSTNoDicount=0,e.totalPriceIncGSTWithDiscount=0,e.totalMargin=0,$$(".item_row.order-item-row").each(function(t){e.rowData=t.retrieve("data"),e.totalPriceIncGSTWithDiscount=1*e.totalPriceIncGSTWithDiscount+1*e.me.getValueFromCurrency(e.rowData.totalPrice),e.totalPriceIncGSTNoDicount=1*e.totalPriceIncGSTNoDicount+e.me.getValueFromCurrency(e.rowData.unitPrice)*e.rowData.qtyOrdered,e.rowData.margin&&(e.totalMargin=1*e.totalMargin+1*e.me.getValueFromCurrency(e.rowData.margin))}),e.totalPriceExcGST=1*e.totalPriceIncGSTWithDiscount/1.1,jQuery('[order-price-summary="totalPriceExcludeGST"]').val(e.me.getCurrency(e.totalPriceExcGST)).html(e.me.getCurrency(e.totalPriceExcGST)),e.totalGST=1*e.totalPriceIncGSTWithDiscount-1*e.totalPriceExcGST,jQuery('[order-price-summary="totalPriceGST"]').val(e.me.getCurrency(e.totalGST)).html(e.me.getCurrency(e.totalGST)),e.totalDiscount=1*e.totalPriceIncGSTNoDicount-1*e.totalPriceIncGSTWithDiscount,jQuery('[order-price-summary="totalDiscount"]').val(e.me.getCurrency(e.totalDiscount)).html(e.me.getCurrency(e.totalDiscount)),jQuery('[order-price-summary="totalPriceIncludeGST"]').val(e.me.getCurrency(e.totalPriceIncGSTWithDiscount)).html(e.me.getCurrency(e.totalPriceIncGSTWithDiscount)),e.totalShipping=jQuery('[order-price-summary="totalShippingCost"]').length>0?e.me.getValueFromCurrency(jQuery('[order-price-summary="totalShippingCost"]').val()):0,e.subTotal=1*e.totalShipping+1*e.totalPriceIncGSTWithDiscount,jQuery('[order-price-summary="subTotal"]').val(e.me.getCurrency(e.subTotal)).html(e.me.getCurrency(e.subTotal)),e.totalPaid=jQuery('[order-price-summary="totalPaidAmount"]').length>0?jQuery('[order-price-summary="totalPaidAmount"]').val():e.me._creditNote&&e.me._creditNote.totalPaid?e.me._creditNote.totalPaid:0,e.totalDue=1*e.subTotal-1*e.totalPaid,e.totalDue<0&&e.me.showModalBox('<h4 class="text-danger">Attention!</h4>','<div><strong>We are paying more than the due amount!</strong></div><div><span class="btn btn-primary" onclick="pageJs.hideModalBox();">OK</span>',!0),jQuery('[order-price-summary="total-payment-due"]').val(e.me.getCurrency(e.totalDue)).html(e.me.getCurrency(e.totalDue)),jQuery('[order-price-summary="total-margin"]').val(e.me.getCurrency(e.totalMargin)).html(e.me.getCurrency(e.totalMargin)),e.me},setPaymentMethods:function(e){return this._paymentMethods=e,this}});