var PageJs=new Class.create;PageJs.prototype=Object.extend(new CRUDPageJs,{_getTitleRowData:function(){return{applyDate:"Apply Date",applyTo:"Apply To",creditNoteNo:"Credit Note No",description:"Description",totalValue:"Total Value",active:"Active",customer:{name:"Name"},order:{orderNo:"Order No"}}},_bindSearchKey:function(){var e={};return e.me=this,$$("#searchBtn").first().observe("click",function(t){$$("#showSearch").first().checked?e.me.getSearchCriteria().getResults(!0,e.me._pagination.pageSize):$$("#showSearch").first().click()}),$("searchDiv").getElementsBySelector("[search_field]").each(function(t){t.observe("keydown",function(t){e.me.keydown(t,function(){$(e.me.searchDivId).down("#searchBtn").click()})})}),e.selectEl=new Element("input",{"class":"select2 form-control","data-placeholder":"search for a Customers",search_field:"cust.id"}).insert({bottom:new Element("option").update("")}),$("searchDiv").down('[search_field="cust.id"]').replace(e.selectEl),jQuery('.select2[search_field="cust.id"]').select2({allowClear:!0,hidden:!0,multiple:!0,ajax:{url:"/ajax/getCustomers",dataType:"json",delay:10,data:function(e){return{searchTxt:e}},results:function(t){return e.result=[],t.resultData.items.each(function(t){e.result.push({id:t.id,text:t.name,data:t})}),{results:e.result}},cache:!0},formatResult:function(e){return e?"<div value="+e.data.id+">"+e.data.name+"</div >":""},escapeMarkup:function(e){return e},minimumInputLength:1}),e.selectEl=new Element("input",{"class":"select2 form-control","data-placeholder":"search for a Products",search_field:"pro.ids"}).insert({bottom:new Element("option").update("")}),$("searchDiv").down('[search_field="pro.ids"]').replace(e.selectEl),jQuery('.select2[search_field="pro.ids"]').select2({allowClear:!0,hidden:!0,multiple:!0,ajax:{url:"/ajax/getProducts",dataType:"json",delay:10,data:function(e){return{searchTxt:e,pageNo:1,pageSize:10}},results:function(t){return e.result=[],t.resultData.items.each(function(t){e.result.push({id:t.id,text:t.name,data:t})}),{results:e.result}},cache:!0},formatResult:function(e){return e?"<div value="+e.data.id+">"+e.data.name+"</div >":""},escapeMarkup:function(e){return e},minimumInputLength:3}),e.selectEl=new Element("select",{"class":"select2 form-control","data-placeholder":"search for a Apply To",search_field:"cn.applyTo",multiple:!0}).insert({bottom:new Element("option").update("")}),e.me._applyToOptions.each(function(t){e.selectEl.insert({bottom:new Element("option",{value:t}).update(t)})}),$("searchDiv").down('[search_field="cn.applyTo"]').replace(e.selectEl),jQuery('.select2[search_field="cn.applyTo"]').select2({allowClear:!0}),this},_openEditPage:function(e){var t={};return t.me=this,jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",frameborder:"0",border:"0",seamless:"seamless",href:"/creditnote/"+(e&&e.id?e.id:"new")+".html",beforeClose:function(){t.iframeJs=$$("iframe.fancybox-iframe").first().contentWindow.pageJs,t.newRow=t.iframeJs&&t.iframeJs._creditNote&&t.iframeJs._creditNote.id?t.me._getResultRow(t.iframeJs._creditNote):null,null!==t.newRow&&(e&&e.id?$(t.me.resultDivId).down(".item_row[item_id="+e.id+"]")&&$(t.me.resultDivId).down(".item_row[item_id="+e.id+"]").replace(t.newRow):$(t.me.resultDivId).insert({top:t.newRow}))}}),t.me},_highlightSelectedRow:function(e){var t={};t.me=this,t.item=e.down(".glyphicon-plus")?"":$(e).up("[item_id]").retrieve("data"),jQuery(".item_row.success").removeClass("success"),t.selectedRow=jQuery("[item_id="+t.item.id+"]").addClass("success")},_displaySelectedAddress:function(e){var t={};return t.me=this,t.item=$(e).up("[item_id]").retrieve("data"),t.type=$(e).down("span").classList.contains("address-shipping"),jQuery(".popover-loaded").popover("hide"),jQuery(".item_row.success").removeClass("success"),t.selectedRow=jQuery("[item_id="+t.item.id+"]").addClass("success"),t.me._signRandID(e),jQuery("#"+e.id).hasClass("popover-loaded")||jQuery("#"+e.id).popover({title:'<div class="row"><div class="col-xs-10">Details for: '+t.item.name+'</div><div class="col-xs-2" style="cursor: pointer" href="javascript:void(0);" onclick="jQuery(\'#'+e.id+"').popover('hide');\"><span class=\"pull-right glyphicon glyphicon-remove\" ></span></div></div>",html:!0,placement:function(){return t.type?"left":"right"},container:"body",trigger:"manual",viewport:{selector:".list-panel",padding:0},content:function(){return t.type?"<p>"+t.item.address.shipping.full+"</p>":"<p>"+t.item.address.billing.full+"</p>"},template:'<div class="popover" role="tooltip" style="max-width: none; z-index: 0;"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}).addClass("popover-loaded"),jQuery("#"+e.id).popover("toggle"),t.me},_getResultRow:function(e,t){var i={};return i.me=this,i.isTitle=t||!1,i.tag=i.isTitle===!0?"th":"td",i.row=new Element("tr",{"class":(i.isTitle===!0?"item_top_row":"btn-hide-row item_row")+(0==e.active?" danger":""),item_id:i.isTitle===!0?"":e.id}).store("data",e).insert({bottom:new Element(i.tag,{"class":"col-xs-1"}).insert({bottom:i.isTitle===!0?e.creditNoteNo:new Element("a",{href:"javascript: void(0);"}).update(e.creditNoteNo).observe("click",function(){i.me._openEditPage(e)})})}).insert({bottom:new Element(i.tag,{"class":"col-xs-1"}).update(i.isTitle===!0?"Customer":e.customer.name)}).insert({bottom:new Element(i.tag,{"class":"col-xs-1"}).update(i.isTitle===!0?e.order.orderNo:new Element("a",{href:"/orderdetails/"+e.order.id+".html",target:"_BLANK"}).update(e.order.orderNo))}).insert({bottom:new Element(i.tag).update(e.description)}).insert({bottom:new Element(i.tag,{"class":"col-xs-1 text-right"}).update(i.isTitle===!0?"Total Value":i.me.getCurrency(e.totalValue))}).insert({bottom:new Element(i.tag,{"class":"col-xs-1 text-right"}).update(i.isTitle===!0?"Total Paid":i.me.getCurrency(e.totalPaid))}).insert({bottom:new Element(i.tag,{"class":"col-xs-1"}).update(e.applyTo)}).insert({bottom:new Element(i.tag,{"class":"col-xs-1"}).update(i.isTitle===!0?e.applyDate:moment(i.me.loadUTCTime(e.applyDate)).format("ll"))}).insert({bottom:new Element(i.tag,{"class":"col-xs-1"}).update(i.isTitle?"Credit NoteItems":e.creditNoteItems?e.creditNoteItems.length:"")}).insert({bottom:new Element(i.tag,{"class":"col-xs-1"}).setStyle("display: none;").insert({bottom:i.isTitle===!0?e.active:new Element("input",{type:"checkbox",disabled:!0,checked:e.active})})}).insert({bottom:new Element(i.tag,{"class":"text-right col-xs-1"}).update(i.isTitle===!0?"":new Element("span",{"class":"btn-group btn-group-xs"}).insert({bottom:new Element("span",{"class":"btn btn-default",title:"Edit"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-pencil"})}).observe("click",function(){i.me._openEditPage(e)})}).insert({bottom:new Element("span",{"class":"btn btn-danger",title:"Delete"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){return confirm("Are you sure you want to deactivate this item?")?void(e.active&&i.me._deactivateItem(this)):!1})}))}),i.row},_getNextPageBtn:function(){var e={};return e.me=this,new Element("tfoot").insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:"8","class":"text-center"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Fetching more results ..."}).update("Show More").observe("click",function(){e.me._pagination.pageNo=1*e.me._pagination.pageNo+1,jQuery(this).button("loading"),e.me.getResults()})})})})},_deactivateItem:function(e){var t={};t.me=this,t.row=$(e).up("[item_id]"),t.item=t.row.retrieve("data"),t.me.postAjax(t.me.getCallbackId("deactivateItems"),{item_id:t.item.id},{onLoading:function(){t.row&&(t.row.toggleClassName("danger"),t.row.hide())},onSuccess:function(e,i){try{if(t.row.toggleClassName("danger"),t.result=t.me.getResp(i,!1,!0),!t.result.item)throw"errror";$$('[item_id="'+t.result.item.id+'"]').first().replace(t.me._getResultRow(t.result.item,!1)),t.me._highlightSelectedRow($$('[item_id="'+t.result.item.id+'"]').first().down(".glyphicon.glyphicon-trash"))}catch(s){t.me.showModalBox('<span class="text-danger">ERROR</span>',s,!0)}}})},getResults:function(e,t){var i={};i.me=this,i.reset=e||!1,i.resultDiv=$(i.me.resultDivId),i.reset===!0&&(i.me._pagination.pageNo=1),i.me._pagination.pageSize=t||i.me._pagination.pageSize,i.me.postAjax(i.me.getCallbackId("getItems"),{pagination:i.me._pagination,searchCriteria:i.me._searchCriteria},{onLoading:function(){jQuery("#"+i.me.searchDivId+" #searchBtn").button("loading"),i.reset===!0&&i.resultDiv.update(new Element("tr").update(new Element("td").update(i.me.getLoadingImg())))},onSuccess:function(e,t){try{if(i.result=i.me.getResp(t,!1,!0),!i.result)return;$(i.me.totalNoOfItemsId).update(i.result.pageStats.totalRows),i.reset===!0&&(i.resultDiv.update(i.me._getResultRow(i.me._getTitleRowData(),!0).wrap(new Element("thead"))),i.result.items&&0!==i.result.items.size()||i.resultDiv.insert({bottom:i.me.getAlertBox("Nothing found.","").addClassName("alert-warning")})),i.resultDiv.getElementsBySelector(".paginWrapper").each(function(e){e.remove()}),i.tbody=$(i.resultDiv).down("tbody"),i.tbody||$(i.resultDiv).insert({bottom:i.tbody=new Element("tbody")}),i.result.items.each(function(e){i.tbody.insert({bottom:i.me._getResultRow(e).addClassName("item_row").writeAttribute("item_id",e.id)})}),i.result.pageStats.pageNumber<i.result.pageStats.totalPages&&i.resultDiv.insert({bottom:i.me._getNextPageBtn().addClassName("paginWrapper")}),jQuery(".total-value").html(i.me.getCurrency(i.result.totalValue)),jQuery(".total-paid").html(i.me.getCurrency(i.result.totalPaid))}catch(s){i.resultDiv.insert({bottom:i.me.getAlertBox("Error",s).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+i.me.searchDivId+" #searchBtn").button("reset")}})},init:function(e,t){var i={};return i.me=this,i.me._order&&jQuery.isNumeric(i.me._order.id)&&$F($$('[search_field="ord.orderNo"]').first()).empty()?(jQuery("#"+i.me.searchDivId).find("#searchDiv").hide().end().find(".new-btn").hide(),$$('[search_field="ord.orderNo"]').first().value=i.me._order.orderNo,$("searchBtn").click()):i.me.getResults(e,t),i.me}});