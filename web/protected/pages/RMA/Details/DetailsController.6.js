var PageJs=new Class.create;
PageJs.prototype=Object.extend(new BPCPageJs,{_customer:null,_item:null,_searchTxtBox:null,_statusOptions:null,_commentsDiv:{pagination:{pageSize:5,pageNo:1},resultDivId:"comments_result_div",types:{purchasing:"",warehouse:""}},_getCommentsRow:function(a){return(new Element("tr",{"class":"comments_row"})).store("data",a).insert({bottom:(new Element("td",{"class":"created",width:"15%"})).update((new Element("small")).update(a.id?this.loadUTCTime(a.created).toLocaleString():a.created))}).insert({bottom:(new Element("td",
{"class":"creator",width:"15%"})).update((new Element("small")).update(a.createdBy.person.fullname))}).insert({bottom:(new Element("td",{"class":"type",width:"10%"})).update((new Element("small")).update(a.type))}).insert({bottom:(new Element("td",{"class":"comments",width:"auto"})).update(a.comments)})},_getComments:function(a,b){var c,d,e,g;c=this;d=a||!1;!0===d&&$(c._commentsDiv.resultDivId).update("");new Ajax.Request("/ajax/getComments",{method:"get",parameters:{entity:"RMA",entityId:c._RMA.id,
orderBy:{created:"desc"},pageNo:c._commentsDiv.pagination.pageNo,pageSize:c._commentsDiv.pagination.pageSize},onLoading:function(){b&&jQuery("#"+b.id).button("loading")},onSuccess:function(a){try{!0===d&&$(c._commentsDiv.resultDivId).update(c._getCommentsRow({type:"Type",createdBy:{person:{fullname:"WHO"}},created:"WHEN",comments:"COMMENTS"}).addClassName("header").wrap(new Element("thead"))),(e=c.getResp(a.responseText,!1,!0))&&e.items&&(0<$$(".new-page-btn-div").size()&&$$(".new-page-btn-div").each(function(a){a.remove()}),
(g=$(c._commentsDiv.resultDivId).down("tbody"))||$(c._commentsDiv.resultDivId).insert({bottom:g=new Element("tbody")}),e.items.each(function(a){g.insert({bottom:c._getCommentsRow(a)})}),e.pageStats.pageNumber<e.pageStats.totalPages&&g.insert({bottom:(new Element("tr",{"class":"new-page-btn-div"})).insert({bottom:(new Element("td",{colspan:4})).insert({bottom:(new Element("span",{id:"comments_get_more_btn","class":"btn btn-primary","data-loading-text":"Getting More ..."})).update("Get More Comments").observe("click",
function(){c._commentsDiv.pagination.pageNo=1*c._commentsDiv.pagination.pageNo+1;c._getComments(!1,this)})})})}))}catch(b){$(c._commentsDiv.resultDivId).insert({bottom:c.getAlertBox("ERROR: ",b).addClassName("alert-danger")})}},onComplete:function(){b&&jQuery("#"+b.id).button("reset")}});return this},_addComments:function(a){var b,c,d,e,g;b=this;c=$(a).up(".new_comments_wrapper").down("[new_comments=comments]");d=$F(c);if(d.blank())return this;b.postAjax(b.getCallbackId("addComments"),{comments:d,
RMA:b._RMA},{onCreate:function(b,c){jQuery("#"+a.id).button("loading")},onSuccess:function(a,d){try{if(e=b.getResp(d,!1,!0))(g=$(b._commentsDiv.resultDivId).down("tbody"))||$(b._commentsDiv.resultDivId).insert({bottom:g=new Element("tbody")}),g.insert({top:b._getCommentsRow(e)}),c.setValue("")}catch(h){alert(h)}},onComplete:function(){jQuery("#"+a.id).button("reset")}});return this},_getEmptyCommentsDiv:function(){var a;a=this;return(new Element("div",{"class":"panel panel-default"})).insert({bottom:(new Element("div",
{"class":"panel-heading"})).update("Comments")}).insert({bottom:(new Element("div",{"class":"table-responsive"})).insert({bottom:new Element("table",{id:a._commentsDiv.resultDivId,"class":"table table-hover table-condensed"})})}).insert({bottom:(new Element("div",{"class":"panel-body new_comments_wrapper"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-2"})).update("<strong>New Comments:</strong>")}).insert({bottom:(new Element("div",{"class":"col-xs-10"})).insert({bottom:(new Element("div",
{"class":"input-group"})).insert({bottom:(new Element("input",{"class":"form-control",type:"text",new_comments:"comments",placeholder:"add more comments to this order"})).observe("keydown",function(b){a.keydown(b,function(){$(b.currentTarget).up(".new_comments_wrapper").down("[new_comments=btn]").click()})})}).insert({bottom:(new Element("span",{"class":"input-group-btn"})).insert({bottom:(new Element("span",{id:"add_new_comments_btn",new_comments:"btn","class":"btn btn-primary","data-loading-text":"saving..."})).update("add").observe("click",
function(){a._addComments(this)})})})})})})})},_submitOrder:function(a,b){var c,d,e,g,f,k;c=this;d=$(a).up(".modal-content");e=d.down(".modal-title");g=d.down(".modal-body");c.postAjax(c.getCallbackId("saveOrder"),b,{onCreate:function(a,b){e.update("Please wait...");g.update('<h4>Submitting the data, please be patient.</h4><div><h3 class="fa fa-spinner fa-spin"></h3></div>')},onSuccess:function(a,b){try{if((f=c.getResp(b,!1,!0))&&f.item&&(c._item=f.item,e.update('<strong class="text-success">Success!</strong>'),
c.hideModalBox(),c.disableAll(),window.location="/rma/"+f.item.id+".html",f.printURL&&(k=window.open(f.printURL,"Printing Order","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no"),!k)))throw'<h4>Your browser has block the popup window, please enable it for further operations.</h4><a href="'+f.printURL+'" target="_BLANK"> click here for now</a>';}catch(d){e.update('<h4 class="text-danger">Error:</h4>'),g.update(d)}},onComplete:function(a,b){}});
return c},disableAll:function(){jQuery("input").attr("disabled",!0);jQuery("textarea").attr("disabled",!0);jQuery(".btn").attr("disabled",!0);jQuery(".form-control").attr("disabled",!0)},_preConfirmSubmit:function(a){var b,c,d,e,g;b=this;c=null;a=!0===a?!0:!1;c=b._collectFormData($(b.getHTMLID("itemDiv")),"save-order");if(null===c)return null;if(c.status.blank())return b.hideModalBox(),b.showModalBox("Warning","You MUST select the <strong>Status</strong> for this RMA"),null;c.printIt=a;c.customer=
{};c.customer.id=b._customer.id;c.RMA=b._RMA;c.order=b._order;if(a=$$(".shipping-address.address-div").first()){a=b._collectFormData(a,"address-editable-field");if(null===a)return b.hideModalBox(),b.showModalBox("Warning","some error in the shipping address"),null;c.shippingAddr=a}c.items=[];$$(".order-item-row").each(function(a){d=a.retrieve("data");c.items.push({orderItemId:a.readAttribute("orderItemId"),RMAItemId:a.readAttribute("RMAItemId"),valid:a.visible(),product:{id:d.product.id},itemDescription:d.itemDescription,
unitPrice:d.unitPrice,qtyOrdered:d.qtyOrdered,totalPrice:d.totalPrice,serials:a.retrieve("serials")})});e=!0;c.items.each(function(a){!0===e&&!0===a.valid&&(e=!1)});if(!0===e)return b.hideModalBox(),b.showModalBox('<strong class="text-danger">Error</strong>',"<strong>At least one RMA Item</strong> is needed!",!0),null;c.items.each(function(a){a.totalPrice=b.getValueFromCurrency(a.totalPrice);a.unitPrice=b.getValueFromCurrency(a.unitPrice)});a=(new Element("div",{"class":"confirm-div"})).insert({bottom:(new Element("div")).insert({bottom:b._getFormGroup("Do you want to send an email to this address:",
new Element("input",{value:b._customer.email,"confirm-po":"po_email",required:!0,placeholder:"The email to send to. WIll NOT update the customer's email with this."}))})}).insert({bottom:(new Element("div")).insert({bottom:(new Element("em")).insert({bottom:(new Element("small")).update("The above email will be used to send the email to. WIll NOT update the customer's email with this.")})})}).insert({bottom:(new Element("div")).insert({bottom:(new Element("span",{"class":"btn btn-primary pull-right"})).update("Yes, send the RMA to this email address").observe("click",
function(){g=$(this).up(".confirm-div").down('[confirm-po="po_email"]');$F(g).blank()?b._markFormGroupError(g,"Email Address Required Here"):/^.+@.+(\..)*$/.test($F(g).strip())?(c.confirmEmail=$F(g).strip(),b._submitOrder($(this),c)):b._markFormGroupError(g,"Please provide an valid email address")})}).insert({bottom:(new Element("span",{"class":"btn btn-info"})).update("No, save RMA but DO NOT send email").observe("click",function(){b._submitOrder($(this),c)})})});b.showModalBox("You're about to save creadit note for : "+
b._customer.name,a);return b},_saveBtns:function(){var a,b;a=this;b=(new Element("div")).insert({bottom:(new Element("div",{"class":"btn-group pull-right  visible-xs visible-sm visible-md visible-lg"})).insert({bottom:(new Element("span",{"class":"btn btn-primary save-btn"})).insert({bottom:(new Element("span")).update(" Save & Email ")}).observe("click",function(){a._preConfirmSubmit()})}).insert({bottom:(new Element("span",{"class":"btn btn-primary dropdown-toggle","data-toggle":"dropdown"})).setStyle("display: none;").insert({bottom:new Element("span",
{"class":"caret"})})}).insert({bottom:(new Element("ul",{"class":"dropdown-menu save-btn-dropdown-menu"})).setStyle("display: none;").insert({bottom:(new Element("li")).insert({bottom:(new Element("a",{href:"javascript: void(0);"})).update("Save Only").observe("click",function(){a._preConfirmSubmit()})})})})}).insert({bottom:(new Element("div",{"class":"btn btn-default"})).setStyle("display: none;").insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove-sign"})}).insert({bottom:(new Element("span")).update(" cancel ")}).observe("click",
function(){a.showModalBox('<strong class="text-danger">Cancelling the current order</strong>','<div>You are about to cancel this new order, all input data will be lost.</div><br /><div>Continue?</div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',!0)})});
b.down(".btn-group").removeClassName("btn-group");return b},_addNewProductRow:function(a){var b,c,d,e,g,f;a=$(a).up(".new-order-item-input");if(b=a.retrieve("product"))if(c=a.down("[new-order-item=unitPrice]"),d=this.getValueFromCurrency($F(c)),null===d.match(/^\d+(\.\d{1,2})?$/))this._markFormGroupError(c,"Invalid value provided!");else if(e=a.down("[new-order-item=qtyOrdered]"),c=this.getValueFromCurrency($F(e)),null===c.match(/^\d+(\.\d{1,2})?$/))this._markFormGroupError(e,"Invalid value provided!");
else if(g=a.down("[new-order-item=discount]"),e=this.getValueFromCurrency($F(g)),null===e.match(/^\d+(\.\d{1,2})?$/))this._markFormGroupError(g,"Invalid value provided!");else if(f=a.down("[new-order-item=totalPrice]"),g=this.getValueFromCurrency($F(f)),null===g.match(/^\d+(\.\d{1,2})?$/))this._markFormGroupError(f,"Invalid value provided!");else return a.getElementsBySelector(".form-group.has-error .form-control").each(function(a){$(a).retrieve("clearErrFunc")()}),f=$F(a.down("[new-order-item=itemDescription]")).replace(/\n/g,
"<br />"),b={product:b,itemDescription:f,unitPrice:this.getCurrency(d),qtyOrdered:c,discount:e,margin:this.getCurrency(parseFloat(g)-parseFloat(1.1*b.unitCost*c)),totalPrice:this.getCurrency(g)},a.up(".list-group").insert({bottom:this._getProductRow(b)}),b=this._getNewProductRow(),a.replace(b).addClassName(),b.down("[new-order-item=product]").focus(),this._recalculateSummary(),this;else b=a.down("[new-order-item=product]"),a.down("[new-order-item=product]")?this._markFormGroupError(b,"Select a product first!"):
this.showModalBox("Product Needed","Select a product first!",!0)},_searchProduct:function(a,b,c){var d,e,g,f,k,h,l,m;d=this;e=!0===$(a).retrieve("showMore")?!0:!1;g=b||1;d._signRandID(a);f=$(a).up(".product-autocomplete")&&$(a).up(".product-autocomplete").down(".search-txt")?$(a).up(".product-autocomplete").down(".search-txt"):$($(a).retrieve("searchBoxId"));d._signRandID(f);k=$F(f);d.postAjax(d.getCallbackId("searchProduct"),{searchTxt:k,pageNo:g},{onLoading:function(){jQuery("#"+a.id).button("loading");
jQuery("#"+f.id).button("loading")},onSuccess:function(b,n){h=!1===e?new Element("div",{"class":"search-product-list"}):$(a).up(".search-product-list");try{l=d.getResp(n,!1,!0);if(!l||!l.items||0===l.items.size())throw"Nothing Found for: "+k;d._signRandID(f);l.items.each(function(a){h.insert({bottom:d._getSearchPrductResultRow(a,f)})});h.addClassName("list-group")}catch(p){h.update(d.getAlertBox("Error: ",p).addClassName("alert-danger"))}"function"===typeof c&&c();l.pagination.pageNumber<l.pagination.totalPages&&
h.insert({bottom:(new Element("a",{"class":"item-group-item"})).insert({bottom:(new Element("span",{"class":"btn btn-primary","data-loading-text":"Getting more ..."})).update("Show Me More")}).observe("click",function(){m=$(this);$(m).store("searchBoxId",f.id);$(m).store("showMore",!0);d._searchProduct(this,1*g+1,function(){$(m).remove()})})});!1===e&&d.showModalBox("Products that has: "+k,h,!1)},onComplete:function(b,c){jQuery("#"+a.id).button("reset");jQuery("#"+f.id).button("reset")}});return d},
_getSearchPrductResultRow:function(a,b){var c,d,e;c=this;return d=(new Element("a",{"class":"list-group-item search-product-result-row",href:"javascript: void(0);"})).store("data",a).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-2"})).insert({bottom:(new Element("div",{"class":"thumbnail"})).insert({bottom:new Element("img",{"data-src":"holder.js/100%x64",alert:"Product Image",src:0===a.images.size()?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+":
a.images[0].asset.url})})})}).insert({bottom:(new Element("div",{"class":"col-xs-10"})).insert({bottom:(new Element("strong")).update(a.name).insert({bottom:(new Element("small",{"class":"btn btn-xs btn-info"})).setStyle("margin-left: 10px;").insert({bottom:new Element("small",{"class":"glyphicon glyphicon-new-window"})}).observe("click",function(a){Event.stop(a);($productId=$(this).up(".search-product-result-row").retrieve("data").id)&&c._openProductDetailPage($productId)})}).insert({bottom:(new Element("small",
{"class":"pull-right"})).update("SKU: "+a.sku)})}).insert({bottom:(new Element("div")).insert({bottom:(new Element("small")).update(a.shortDescription)})}).insert({bottom:(new Element("div")).insert({bottom:(new Element("small",{"class":"col-xs-4"})).insert({bottom:(new Element("div",{"class":"input-group",title:"stock on HAND"})).insert({bottom:(new Element("span",{"class":"input-group-addon"})).update("SOH:")}).insert({bottom:(new Element("strong",{"class":"form-control"})).update(a.stockOnHand)})})}).insert({bottom:(new Element("small",
{"class":"col-xs-4"})).insert({bottom:(new Element("div",{"class":"input-group",title:"stock on ORDER"})).insert({bottom:(new Element("span",{"class":"input-group-addon"})).update("SOO:")}).insert({bottom:(new Element("strong",{"class":"form-control"})).update(a.stockOnOrder)})})}).insert({bottom:(new Element("small",{"class":"col-xs-4"})).insert({bottom:(new Element("div",{"class":"input-group",title:"stock on PO"})).insert({bottom:(new Element("span",{"class":"input-group-addon"})).update("SOP:")}).insert({bottom:(new Element("strong",
{"class":"form-control"})).update(a.stockOnPO)})})})})})}).observe("click",function(){e=$(b).up(".new-order-item-input").store("product",a);b.up(".productName").writeAttribute("colspan",!1).update(a.sku).removeClassName("col-xs-8").addClassName("col-xs-3").insert({bottom:(new Element("small",{"class":"btn btn-xs btn-info"})).setStyle("margin-left: 10px;").insert({bottom:new Element("small",{"class":"glyphicon glyphicon-new-window"})}).observe("click",function(b){Event.stop(b);($productId=a.id)&&c._openProductDetailPage($productId)})}).insert({bottom:(new Element("a",
{href:"javascript: void(0);","class":"text-danger pull-right",title:"click to change the product"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){d=c._getNewProductRow();$(this).up(".new-order-item-input").replace(d);d.down("[new-order-item=product]").select()})}).insert({after:(new Element("div",{"class":"col-xs-7"})).update((new Element("textarea",{"new-order-item":"itemDescription"})).setStyle("width: 100%").update(a.name))});jQuery("#"+
c.modalId).modal("hide");a.prices.size();e.down("[new-order-item=qtyOrdered]").select();c._calculateNewProductPrice(e)})},_selectProduct:function(a){a={product:a.product,itemDescription:a.itemDescription,unitPrice:this.getCurrency(a.unitPrice),qtyOrdered:a.qty?a.qty:a.qtyOrdered,discount:100,margin:0,totalPrice:this.getCurrency(a.unitPrice*(a.qty?a.qty:a.qtyOrdered))};$$(".order_change_details_table").first().insert({bottom:a=this._getProductRow(a)});this._recalculateSummary();return a},_getSummaryFooter:function(){var a,
b,c;a=this;b=(new Element("select",{"class":"select2 form-control input-sm","save-order":"status","data-placeholder":"Select an option"})).insert({bottom:(new Element("option",{value:""})).update("")});a._statusOptions.each(function(d){b.insert({bottom:c=(new Element("option",{value:d})).update(d)});a._RMA&&a._RMA.status==d&&c.writeAttribute("selected",!0)});return(new Element("div",{"class":"panel-footer"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-8"})).insert({bottom:a._getFormGroup("Description:",
(new Element("textarea",{"save-order":"description",rows:1})).update(a._RMA?a._RMA.description:""))}).insert({bottom:a._RMA?"":a._getFormGroup("Comments:",new Element("textarea",{"save-order":"comments",rows:"1"}))})}).insert({bottom:(new Element("div",{"class":"col-sm-4"})).insert({bottom:(new Element("div",{"class":"row"})).setStyle("display:none;").insert({bottom:(new Element("div",{"class":"col-xs-6 text-right"})).update((new Element("strong")).update("Total Excl. GST: "))}).insert({bottom:(new Element("div",
{"class":"col-xs-6","order-price-summary":"totalPriceExcludeGST"})).update(a.getCurrency(0))})}).insert({bottom:(new Element("div",{"class":"row"})).setStyle("display:none;").insert({bottom:(new Element("div",{"class":"col-xs-6 text-right"})).update((new Element("strong")).update("Total GST: "))}).insert({bottom:(new Element("div",{"order-price-summary":"totalPriceGST","class":"col-xs-6"})).update(a.getCurrency(0))})}).insert({bottom:(new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"})).setStyle("display: none;").insert({bottom:(new Element("div",
{"class":"col-xs-6 text-right"})).update((new Element("strong")).update("Total Discount:"))}).insert({bottom:(new Element("div",{"order-price-summary":"totalDiscount","class":"col-xs-6"})).update(a.getCurrency(0))})}).insert({bottom:(new Element("div",{"class":"row"})).setStyle("display:none;").insert({bottom:(new Element("div",{"class":"col-xs-6 text-right"})).update((new Element("strong")).update("Sub Total Incl. GST: "))}).insert({bottom:(new Element("div",{"order-price-summary":"totalPriceIncludeGST",
"class":"col-xs-6"})).update(a.getCurrency(0))})}).insert({bottom:(new Element("div",{"class":"row",style:"border-bottom: 1px solid brown"})).insert({bottom:(new Element("div",{"class":"col-xs-6 text-right"})).update((new Element("strong")).update("Status: "))}).insert({bottom:(new Element("div",{"class":"col-xs-6"})).update((new Element("strong")).update(b))})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-6 text-right"})).update((new Element("strong")).update("Total Qty:"))}).insert({bottom:(new Element("strong",
{"order-price-summary":"totalQty","class":"col-xs-6"})).update(0)})}).insert({bottom:(new Element("div",{"class":"row"})).setStyle("display:none;").insert({bottom:(new Element("div",{"class":"col-xs-6 text-right"})).update((new Element("strong")).update("Total Incl. GST:"))}).insert({bottom:(new Element("strong",{"order-price-summary":"subTotal","class":"col-xs-6"})).update(a.getCurrency(0))})}).insert({bottom:(new Element("div",{"class":"row"})).setStyle("display: none;").insert({bottom:(new Element("h4",
{"class":"col-xs-6 text-right"})).setStyle("color: #d30014 !important").update((new Element("strong")).update("DUE:"))}).insert({bottom:(new Element("h4",{"class":"col-xs-6","order-price-summary":"total-payment-due"})).setStyle("color: #d30014 !important").update(a.getCurrency(0))})}).insert({bottom:(new Element("div",{"class":"row margin"})).setStyle("display: none;").insert({bottom:(new Element("strong",{"class":"col-xs-6 text-right"})).update((new Element("strong")).update("Margin Total Incl. GST:"))}).insert({bottom:(new Element("strong",
{"class":"col-xs-6","order-price-summary":"total-margin"})).update(a.getCurrency(0))})})})})},_getNewProductProductAutoComplete:function(){var a,b,c;a=this;b=a._getFormGroup(null,(new Element("div",{"class":"input-group input-group-sm product-autocomplete"})).insert({bottom:(new Element("input",{"class":"form-control search-txt visible-xs visible-sm visible-md visible-lg init-focus","new-order-item":"product",required:!0,placeholder:"search SKU, NAME and any BARCODE for this product"})).observe("keyup",
function(b){c=this;a.keydown(b,function(){$(c).up(".product-autocomplete").down(".search-btn").click()})}).observe("keydown",function(b){c=this;a.keydown(b,function(){$(c).up(".product-autocomplete").down(".search-btn").click()},function(){},Event.KEY_TAB)})}).insert({bottom:(new Element("span",{"class":"input-group-btn"})).insert({bottom:(new Element("span",{"class":" btn btn-primary search-btn","data-loading-text":"searching..."})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})}).observe("click",
function(){$F($(this).up(".product-autocomplete").down(".search-txt")).blank()?$(this).up(".product-autocomplete").down(".search-txt").focus():a._searchProduct(this)})})}));b.down(".input-group").removeClassName("form-control");return b},_getNewProductRow:function(){var a,b,c,d;a=this;b={product:{name:a._getNewProductProductAutoComplete()},unitPrice:a._getFormGroup(null,(new Element("input",{"class":"input-sm","new-order-item":"unitPrice",required:!0,value:a.getCurrency(0)})).observe("click",function(){$(this).select()}).observe("keydown",
function(b){a._bindSubmitNewProductRow(b,this)}).observe("keyup",function(){a._calculateNewProductPrice($(this).up(".item_row"))})),qtyOrdered:a._getFormGroup(null,(new Element("input",{"class":"input-sm","new-order-item":"qtyOrdered",required:!0,value:"1"})).observe("keyup",function(){a._calculateNewProductPrice($(this).up(".item_row"))}).observe("keydown",function(b){a._bindSubmitNewProductRow(b,this)}).observe("click",function(){$(this).select()})),discount:a._getFormGroup(null,(new Element("input",
{"class":"input-sm","new-order-item":"discount",value:"0"})).setStyle("display: none;").observe("keyup",function(){if($F($(this)).blank()||100<$F($(this)))$(this).value=0,$(this).select();a._calculateNewProductPrice($(this).up(".item_row"))}).observe("keydown",function(b){a._bindSubmitNewProductRow(b,this)}).observe("click",function(){$(this).select()})),totalPrice:a._getFormGroup(null,new Element("input",{"class":"input-sm",disabled:!0,"new-order-item":"totalPrice",required:!0,value:a.getCurrency(0)})),
margin:a.getCurrency(0),btns:(new Element("span",{"class":"btn-group btn-group-sm pull-right"})).insert({bottom:(new Element("span",{"class":"btn btn-primary"})).insert({bottom:new Element("span",{"class":" glyphicon glyphicon-floppy-saved save-new-product-btn"})}).observe("click",function(){a._addNewProductRow(this)})}).insert({bottom:(new Element("span",{"class":"btn btn-default"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-floppy-remove"})}).observe("click",function(){confirm("You about to clear this entry. All input data for this entry will be lost.\n\nContinue?")&&
(c=a._getNewProductRow(),d=$(this).up(".new-order-item-input"),d.getElementsBySelector(".form-group.has-error .form-control").each(function(a){$(a).retrieve("clearErrFunc")()}),d.replace(c),c.down("[new-order-item=product]").focus())})})};return a._getProductRow(b,!1).addClassName("new-order-item-input list-group-item-danger").removeClassName("order-item-row")},_getProductRow:function(a,b){var c,d,e,g,f,k,h;c=this;d=b||!1;e=!0===d?"strong":"div";g=a.btns?a.btns:(new Element("span",{"class":"pull-right"})).insert({bottom:(new Element("span",
{"class":"btn btn-danger btn-xs"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){confirm("You remove this entry.\n\nContinue?")&&((f=$(this).up(".item_row"))&&(jQuery.isNumeric(f.readAttribute("RMAItemId"))?f.hide():f.remove()),c._recalculateSummary())})});f=(new Element("div",{"class":" list-group-item "+(!0===d?"":"item_row order-item-row")})).store("data",a).insert({bottom:(new Element("div",{"class":"row"})).store("data",a).insert({bottom:(new Element(e,
{"class":"productName col-xs-10"})).insert({bottom:a.itemDescription?a.itemDescription:a.product.name})}).insert({bottom:(new Element(e,{"class":"uprice col-xs-1"})).setStyle("display:none;").insert({bottom:a.unitPrice})}).insert({bottom:(new Element(e,{"class":"col-xs-1"})).insert({bottom:(new Element("div")).insert({bottom:(new Element("div",{"class":"qty col-xs-12"})).update(a.qtyOrdered)}).insert({bottom:(new Element("div",{"class":"discount col-xs-6"})).update(a.discount).setStyle("display: none;")})})}).insert({bottom:(new Element(e,
{"class":"tprice col-xs-1"})).setStyle("display: none;").insert({bottom:a.totalPrice})}).insert({bottom:(new Element(e,{"class":"margin col-xs-1 text-right"})).update(a.margin).setStyle("display: none;")}).insert({bottom:(new Element(e,{"class":"btns col-xs-1 text-right"})).update(g)})});a.product.sku&&f.down(".productName").removeClassName("col-xs-10").addClassName("col-xs-7").insert({before:(new Element(e,{"class":"productSku col-xs-3"})).update(a.product.sku).insert({bottom:(new Element("small",
{"class":a.product.id?"btn btn-xs btn-info":"hidden"})).setStyle("margin-left: 10px;").insert({bottom:new Element("small",{"class":"glyphicon glyphicon-new-window"})}).observe("click",function(b){Event.stop(b);($productId=a.product.id)&&c._openProductDetailPage($productId)})})});a.scanTable&&f.insert({bottom:(new Element("div",{"class":"row product-content-row"})).insert({bottom:(new Element("span",{"class":"col-sm-2 show-tools"})).insert({bottom:(new Element("input",{type:"checkbox",checked:!0,"class":"show-panel-check"})).observe("click",
function(){k=this;h=$(k).up(".product-content-row").down(".serial-no-scan-pane");k.checked?h.show():h.hide()})}).insert({bottom:(new Element("a",{href:"javascript: void(0);"})).update(" show serial scan panel?").observe("click",function(){$(this).up(".show-tools").down(".show-panel-check").click()})})}).insert({bottom:(new Element("span",{"class":"col-sm-10 serial-no-scan-pane",style:"padding-top: 5px"})).update(a.scanTable)})});return f},_getPartsTable:function(){var a;a=(new Element("div",{"class":"list-group order_change_details_table"})).insert({bottom:this._getProductRow({product:{sku:"SKU",
name:"Description"},unitPrice:"Unit Price<div><small>(inc GST)</small><div>",qtyOrdered:"Quantity",margin:"Margin",discount:"Disc. %",totalPrice:"Total Price<div><small>(inc GST)</small><div>",btns:(new Element("div")).setStyle("display:none;").insert({bottom:(new Element("label",{"for":"hide-margin-checkbox"})).update("Show Margin ")}).insert({bottom:(new Element("input",{id:"hide-margin-checkbox",type:"checkbox",checked:!0})).observe("click",function(){jQuery(".margin").toggle()})})},!0)});a.insert({bottom:this._getNewProductRow().addClassName("list-group-item-danger")});
return a},_getAddressDiv:function(a,b,c){var d;d=b||null;c=c||!1;a=(new Element("div",{"class":"address-div"})).insert({bottom:(new Element("strong")).update(a)}).insert({bottom:(new Element("dl",{"class":"dl-horizontal dl-condensed"})).insert({bottom:(new Element("dt")).update(new Element("span",{"class":"glyphicon glyphicon-user",title:"Customer Name"}))}).insert({bottom:(new Element("dd")).insert({bottom:(new Element("div")).insert({bottom:(new Element("div",{"class":"col-sm-6"})).update(!0!==
c?b.contactName:new Element("input",{"address-editable-field":"contactName","class":"form-control input-sm",placeholder:"The name of contact person",value:d.contactName?d.contactName:""}))}).insert({bottom:(new Element("div",{"class":"col-sm-6"})).update(!0!==c?b.contactNo:new Element("input",{"address-editable-field":"contactNo","class":"form-control input-sm",placeholder:"The contact number of contact person",value:d.contactNo?d.contactNo:""}))})})}).insert({bottom:(new Element("dt")).update(new Element("span",
{"class":"glyphicon glyphicon-map-marker",title:"Address"}))}).insert({bottom:(new Element("dd")).insert({bottom:(new Element("div")).insert({bottom:!0!==c?b.street:(new Element("div",{"class":"street col-sm-12"})).update(new Element("input",{"address-editable-field":"street","class":"form-control input-sm",placeholder:"Street Number and Street name",value:d.street?d.street:""}))})}).insert({bottom:(new Element("div")).insert({bottom:!0!==c?b.city+" ":(new Element("div",{"class":"city col-sm-6"})).update(new Element("input",
{"address-editable-field":"city","class":"form-control input-sm",placeholder:"City / Suburb",value:d.city?d.city:""}))}).insert({bottom:!0!==c?b.region+" ":(new Element("div",{"class":"region col-sm-3"})).update(new Element("input",{"address-editable-field":"region","class":"form-control input-sm",placeholder:"State / Province",value:d.region?d.region:""}))}).insert({bottom:!0!==c?b.postCode:(new Element("div",{"class":"postcode col-sm-3"})).update(new Element("input",{"address-editable-field":"postCode",
"class":"form-control input-sm",placeholder:"PostCode",value:d.postCode?d.postCode:""}))})}).insert({bottom:(new Element("div")).insert({bottom:!0!==c?b.country:(new Element("div",{"class":"postcode col-sm-4"})).update(new Element("input",{"address-editable-field":"country","class":"form-control input-sm",placeholder:"Country",value:d.country?d.country:""}))})})})});!0===c&&a.writeAttribute("address-editable",!0);return a},getCustomerInfoPanel:function(){var a,b;a=this;b=a._customer;return(new Element("div",
{"class":"panel panel-danger CustomerInfoPanel"})).insert({bottom:(new Element("div",{"class":"panel-heading"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-8"})).insert({bottom:(new Element("strong")).update((a._RMA&&a._RMA.id?"EDITING":"CREATING")+"  RMA FOR:  ")}).insert({bottom:(new Element("a",{href:"javascript: void(0);"})).update(b.name).observe("click",function(){a._openCustomerDetailsPage(b)})}).insert({bottom:" <"}).insert({bottom:(new Element("a",
{href:"mailto:"+b.email})).update(b.email)}).insert({bottom:">"}).insert({bottom:a._order?(new Element("strong")).update(" with Order No. "):""}).insert({bottom:a._order?(new Element("a",{target:"_blank",href:"/orderdetails/"+a._order.id})).update(a._order.orderNo):""})}).insert({bottom:(new Element("div",{"class":"col-sm-4 text-right"})).setStyle("display: none;").insert({bottom:(new Element("strong")).update("Total Payment Due: ")}).insert({bottom:(new Element("span",{"class":"badge","order-price-summary":"total-payment-due"})).update(a.getCurrency(0))})})})}).insert({bottom:(new Element("div",
{"class":"panel-body"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("small")).update((new Element("em")).update(b.description))})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:a._getAddressDiv("Billing Address: ",b.address?b.address.billing:null).addClassName("col-xs-6")}).insert({bottom:a._getAddressDiv("Shipping Address: ",b.address?b.address.shipping:null,!0).addClassName("col-xs-6").addClassName("shipping-address")})})})},_openCustomerDetailsPage:function(a){var b,
c;b=this;jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",href:"/customer/"+a.id+".html?blanklayout=1",beforeClose:function(){(c=$$("iframe.fancybox-iframe").first().contentWindow.pageJs._item)&&c.id&&b._selectCustomer(c)}});return b},getViewOfRMA:function(){return(new Element("div")).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-12"})).update(this.getCustomerInfoPanel())})}).insert({bottom:(new Element("div",
{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-12"})).insert({bottom:(new Element("div",{"class":"panel panel-danger"})).update(this._getPartsTable()).insert({bottom:this._getSummaryFooter()})})})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-12"})).update(this._saveBtns())})}).insert({bottom:this._RMA?(new Element("div",{"class":"row"})).setStyle("padding-top: 20px").insert({bottom:(new Element("div",{"class":"col-sm-12"})).update(this._getEmptyCommentsDiv())}):
""})},_selectCustomer:function(a){this._customer=a;0<$$(".CustomerInfoPanel").size()&&jQuery(".CustomerInfoPanel").replaceWith(this.getCustomerInfoPanel());$(this.getHTMLID("itemDiv")).update(this.getViewOfRMA());0<$$(".init-focus").size()&&$$(".init-focus").first().focus();return this},_getCustomerRow:function(a,b){var c,d,e;c=this;d=b||!1;e=!0===d?"th":"td";return(new Element("tr",{"class":(!0===d?"item_top_row":"btn-hide-row item_row")+(0==a.active?" danger":""),item_id:!0===d?"":a.id})).store("data",
a).insert({bottom:(new Element(e,{"class":"name col-xs-1"})).insert({bottom:!0===d?"&nbsp;":(new Element("span",{"class":"btn btn-primary btn-xs"})).update("select").observe("click",function(){c._selectCustomer(a)})})}).insert({bottom:(new Element(e,{"class":"name col-xs-1"})).update(a.name)}).insert({bottom:(new Element(e,{"class":"email col-xs-1",style:"text-decoration: underline;"})).update(a.email)}).insert({bottom:(new Element(e,{"class":"contact col-xs-1 truncate"})).update(a.contactNo)}).insert({bottom:(new Element(e,
{"class":"description col-xs-1"})).update(a.description)}).insert({bottom:(new Element(e,{"class":"address col-xs-1"})).insert({bottom:!0===d?a.addresses:(new Element("span",{style:"display: inline-block"})).insert({bottom:(new Element("a",{"class":"visible-xs visible-md visible-sm visible-lg",href:"javascript: void(0);"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-plane address-shipping",style:"font-size: 1.3em",title:"Shipping"})}).observe("click",function(){c.showModalBox("<strong>Shipping Address</strong>",
a.address.shipping.full)})})}).insert({bottom:!0===d?"":(new Element("span",{style:"display: inline-block"})).insert({bottom:(new Element("a",{"class":"visible-xs visible-md visible-sm visible-lg",href:"javascript: void(0);"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-usd address-billing",style:"font-size: 1.3em; padding-left:10%;",title:"Billing"})}).observe("click",function(){c.showModalBox("<strong>Billing Address</strong>",a.address.shipping.full)})})})}).insert({bottom:(new Element(e,
{"class":"mageId col-xs-1"})).update(a.mageId)}).insert({bottom:(new Element(e,{"class":"cust_active col-xs-1"})).insert({bottom:!0===d?a.active:new Element("input",{type:"checkbox",disabled:!0,checked:a.active})})})},_searchCustomer:function(a){var b,c,d,e,g;b=this;c=$F(a).strip();d=$(a).up("#"+b.getHTMLID("searchPanel"));b.postAjax(b.getCallbackId("searchCustomer"),{searchTxt:c},{onLoading:function(){$(d).down(".list-div")&&$(d).down(".list-div").remove();$(d).insert({bottom:(new Element("div",
{"class":"panel-body"})).update(b.getLoadingImg())})},onSuccess:function(a,c){$(d).down(".panel-body").remove();try{(e=b.getResp(c,!1,!0))&&e.items&&($(d).insert({bottom:(new Element("small",{"class":"table-responsive list-div"})).insert({bottom:(new Element("table",{"class":"table table-hover table-condensed"})).insert({bottom:(new Element("thead")).insert({bottom:b._getCustomerRow({email:"Email",name:"Name",contactNo:"Contact Num",description:"Description",addresses:"Addresses",address:{billing:{full:"Billing Address"},
shipping:{full:"Shipping Address"}},mageId:"Mage Id",active:"Active?"},!0)})}).insert({bottom:g=new Element("tbody")})})}),e.items.each(function(a){g.insert({bottom:b._getCustomerRow(a)})}))}catch(h){$(d).insert({bottom:(new Element("div",{"class":"panel-body"})).update(b.getAlertBox("ERROR",h).addClassName("alert-danger"))})}}});return b},_getCustomerListPanel:function(){var a,b;a=this;return(new Element("div",{id:a.getHTMLID("searchPanel"),"class":"panel panel-info search-panel"})).insert({bottom:(new Element("div",
{"class":"panel-heading form-inline"})).insert({bottom:(new Element("strong")).update("Creating a new order for: ")}).insert({bottom:(new Element("span",{"class":"input-group col-sm-6"})).insert({bottom:(new Element("input",{"class":"form-control search-txt init-focus",placeholder:"Customer name"})).observe("keydown",function(c){b=this;a.keydown(c,function(){void 0!=b.up("#"+pageJs._htmlIds.searchPanel).down(".item_row")&&1===b.up("#"+pageJs._htmlIds.searchPanel).down("tbody").getElementsBySelector(".item_row").length?
b.up("#"+pageJs._htmlIds.searchPanel).down("tbody .item_row .btn").click():$(a.getHTMLID("searchPanel")).down(".search-btn").click()},function(){},Event.KEY_TAB);a.keydown(c,function(){void 0!=b.up("#"+pageJs._htmlIds.searchPanel).down(".item_row")&&1===b.up("#"+pageJs._htmlIds.searchPanel).down("tbody").getElementsBySelector(".item_row").length?b.up("#"+pageJs._htmlIds.searchPanel).down("tbody .item_row .btn").click():$(a.getHTMLID("searchPanel")).down(".search-btn").click()},function(){});return!1})}).insert({bottom:(new Element("span",
{"class":"input-group-btn search-btn"})).insert({bottom:(new Element("span",{"class":" btn btn-primary"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})})}).observe("click",function(){b=$(a.getHTMLID("searchPanel")).down(".search-txt");$F(b).blank()?$(a.getHTMLID("searchPanel")).down(".table tbody")&&($(a.getHTMLID("searchPanel")).down(".table tbody").innerHTML=null):a._searchCustomer(b)})})}).insert({bottom:(new Element("span",{"class":"btn btn-success pull-right btn-sm btn-danger"})).insert({bottom:new Element("span",
{"class":"glyphicon glyphicon-remove"})}).observe("click",function(){$(a.getHTMLID("searchPanel")).down(".search-txt").clear().focus();$(a.getHTMLID("searchPanel")).down(".table tbody").innerHTML=null})})})},init:function(){var a;a=this;a._RMA?(a._RMA.order&&a._RMA.order.id&&jQuery.isNumeric(a._RMA.order.id)&&(a._order=a._RMA.order),a._selectCustomer(a._RMA.customer)):a._customer?a._selectCustomer(a._customer):a._order?a._selectCustomer(a._order.customer):$(a.getHTMLID("itemDiv")).update(a._getCustomerListPanel());
0<$$(".init-focus").size()&&$$(".init-focus").first().focus();jQuery(".select2").select2({});a._RMA?a._RMA.items.each(function(b){a._selectProduct(b).writeAttribute("RMAItemId",b.id)}):a._order&&a._order.items.each(function(b){a._selectProduct(b).writeAttribute("orderItemId",b.id)});a._RMA&&a._getComments(!0);return a},_getFormGroup:function(a,b){return(new Element("div",{"class":"form-group"})).insert({bottom:a?(new Element("label",{"class":"control-label"})).update(a):""}).insert({bottom:b.addClassName("form-control")})},
_openProductDetailPage:function(a){window.open("/product/"+a+".html","Product Details","width=1300, location=no, scrollbars=yes, menubar=no, status=no, titlebar=no, fullscreen=no, toolbar=no").focus();return this},_calculateNewProductPrice:function(a){var b,c,d;b=this.getValueFromCurrency($F(a.down("[new-order-item=unitPrice]")));c=$F(a.down("[new-order-item=discount]")).strip().replace("%","");d=$F(a.down("[new-order-item=qtyOrdered]")).strip();b=b*(1-c/100)*d;$(a.down("[new-order-item=totalPrice]")).value=
this.getCurrency(b);a.retrieve("product")&&(c=a.retrieve("product").unitCost,a.down(".margin")&&$(a.down(".margin")).update(this.getCurrency(1*b-1.1*c*d)+(0===parseInt(c)?'<div><small class="label label-danger">No Cost Yet</small</div>':"")));return this},_bindSubmitNewProductRow:function(a,b){this.keydown(a,function(){$(b).up(".item_row").down(".save-new-product-btn").click()});return this},_recalculateSummary:function(){var a,b,c,d,e,g,f,k;a=this;e=d=c=b=0;$$(".item_row.order-item-row").each(function(f){g=
f.retrieve("data");c=1*c+1*a.getValueFromCurrency(g.totalPrice);b=1*b+a.getValueFromCurrency(g.unitPrice)*g.qtyOrdered;e+=parseInt(g.qtyOrdered);g.margin&&(d=1*d+1*a.getValueFromCurrency(g.margin))});f=1*c/1.1;jQuery('[order-price-summary="totalPriceExcludeGST"]').val(a.getCurrency(f)).html(a.getCurrency(f));f=1*c-1*f;jQuery('[order-price-summary="totalPriceGST"]').val(a.getCurrency(f)).html(a.getCurrency(f));f=1*b-1*c;jQuery('[order-price-summary="totalDiscount"]').val(a.getCurrency(f)).html(a.getCurrency(f));
jQuery('[order-price-summary="totalPriceIncludeGST"]').val(a.getCurrency(c)).html(a.getCurrency(c));jQuery('[order-price-summary="totalQty"]').val(e).html(e);f=1*(0<jQuery('[order-price-summary="totalShippingCost"]').length?jQuery('[order-price-summary="totalShippingCost"]').val():0)+1*c;jQuery('[order-price-summary="subTotal"]').val(a.getCurrency(f)).html(a.getCurrency(f));k=0<jQuery('[order-price-summary="totalPaidAmount"]').length?jQuery('[order-price-summary="totalPaidAmount"]').val():0;f=1*f-
1*k;0>f&&a.showModalBox('<h4 class="text-danger">Attention!</h4>','<div><strong>The customer has paid more than the due amount?</strong></div><div><span class="btn btn-primary" onclick="pageJs.hideModalBox();">OK</span>',!0);jQuery('[order-price-summary="total-payment-due"]').val(a.getCurrency(f)).html(a.getCurrency(f));jQuery('[order-price-summary="total-margin"]').val(a.getCurrency(d)).html(a.getCurrency(d));return a}});