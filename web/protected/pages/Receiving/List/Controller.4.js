var PageJs=new Class.create;PageJs.prototype=Object.extend(new CRUDPageJs,{_getTitleRowData:function(){return{serialNo:"Serial No.",qty:"Qty",product:"Product",unitPrice:"Unit Cost(Excl. GST)",invoiceNo:"Invoice No.",created:"Received By",purchaseOrder:"Purchase Order"}},_bindSearchKey:function(){var e={};return e.me=this,$("searchPanel").getElementsBySelector("[search_field]").each(function(t){t.observe("keydown",function(t){e.me.keydown(t,function(){$(e.me.searchDivId).down("#searchBtn").click()})})}),e.selectEl=new Element("input",{"class":"select2 form-control","data-placeholder":"search for a Products",search_field:"pro.ids"}).insert({bottom:new Element("option").update("")}),$("searchDiv").down('[search_field="pro.ids"]').replace(e.selectEl),jQuery('.select2[search_field="pro.ids"]').select2({allowClear:!0,hidden:!0,multiple:!0,ajax:{url:"/ajax/getProducts",dataType:"json",delay:10,data:function(e){return{searchTxt:e,pageNo:1,pageSize:10}},results:function(t){return e.result=[],t.resultData.items.each(function(t){e.result.push({id:t.id,text:t.name,data:t})}),{results:e.result}},cache:!0},formatResult:function(e){return e?"<div value="+e.data.id+">"+e.data.name+"</div >":""},escapeMarkup:function(e){return e},minimumInputLength:3}),e.selectEl=new Element("input",{"class":"select2 form-control","data-placeholder":"search for a PO",search_field:"purchaseorderids"}).insert({bottom:new Element("option").update("")}),$("searchDiv").down('[search_field="purchaseorderids"]').replace(e.selectEl),jQuery('.select2[search_field="purchaseorderids"]').select2({allowClear:!0,hidden:!0,multiple:!0,ajax:{url:"/ajax/getPurchaseOrders",dataType:"json",delay:10,data:function(e){return{searchTxt:e,pageNo:1,pageSize:10}},results:function(t){return e.result=[],t.resultData.items.each(function(t){e.result.push({id:t.id,text:t.purchaseOrderNo,data:t})}),{results:e.result}},cache:!0},formatResult:function(e){return e?"<div value="+e.data.id+">"+e.data.purchaseOrderNo+"</div >":""},escapeMarkup:function(e){return e},minimumInputLength:3}),this},_submitDeletion:function(e,t){var n={};n.me=this,n.confirmDiv=$(e).up(".confirm-div"),n.confirmDiv.getElementsBySelector(".msg").each(function(e){e.remove()}),n.me.postAjax(n.me.getCallbackId("deleteItem"),{id:t.id},{onLoading:function(){n.me._signRandID(e),jQuery("#"+e.id).button("loading")},onComplete:function(){jQuery("#"+e.id).button("reset")},onSuccess:function(e,t){try{if(n.result=n.me.getResp(t,!1,!0),!n.result||!n.result.item||!n.result.item.id)return null;$$('.item_row[item_id="'+n.result.item.id+'"]').each(function(e){e.remove()}),n.me.hideModalBox()}catch(r){n.confirmDiv.insert({top:new Element("h4",{"class":"msg"}).update(new Element("span",{"class":"label label-danger"}).update(r))})}}})},_showDeleteConfirmPanel:function(e){var t={};return t.me=this,t.newDiv=new Element("div",{"class":"confirm-div"}).insert({bottom:new Element("div").insert({bottom:new Element("h4").update("You are about to delete this received item, by doing so, it may:")}).insert({bottom:new Element("ul").insert({bottom:new Element("li").update("This <strong>serial number("+e.serialNo+")</strong> will not be searchable or accessible any more in the future.")}).insert({bottom:new Element("li").update("The Status <strong>Purchase Order("+e.purchaseOrder.purchaseOrderNo+")</strong> may change")}).insert({bottom:new Element("li").update("The total <strong>StockOnHand count</strong> will change")}).insert({bottom:new Element("li").update("The total <strong>StockOnHand value</strong> will change")})})}).insert({bottom:new Element("div",{"class":"text-right"}).insert({bottom:new Element("span",{"class":"btn btn-default pull-left"}).update("CANCEL").observe("click",function(){t.me.hideModalBox()})}).insert({bottom:new Element("span",{"class":"btn btn-danger","data-loading-text":"Deleting ..."}).update("Yes, Delete It").observe("click",function(){t.me._submitDeletion(this,e)})})}),t.me.showModalBox('<strong class="text-danger">Confirm Deletion:</strong>',t.newDiv),t.me},_getResultRow:function(e,t){var n={};return n.me=this,n.tag=n.isTitle===!0?"th":"td",n.isTitle=t||!1,n.row=new Element("tr",{"class":n.isTitle===!0?"":"item-data-row"}).store("data",e).insert({bottom:new Element(n.tag,{"class":"col-xs-1"}).update(e.serialNo)}).insert({bottom:new Element(n.tag,{"class":"col-xs-1"}).update(e.qty)}).insert({bottom:new Element(n.tag,{"class":"col-xs-3"}).update(n.isTitle===!0?e.product:new Element("a",{href:"/product/"+e.product.id+".html",target:"_BLANK"}).update(e.product.sku))}).insert({bottom:new Element(n.tag,{"class":"col-xs-1"}).update(n.isTitle===!0?e.unitPrice:n.me.getCurrency(e.unitPrice))}).insert({bottom:new Element(n.tag,{"class":"col-xs-3"}).update(n.isTitle===!0?e.purchaseOrder:new Element("a",{href:"/purchase/"+e.purchaseOrder.id+".html",target:"_BLANK"}).update(e.purchaseOrder.purchaseOrderNo+" ["+e.purchaseOrder.status+"]"))}).insert({bottom:new Element(n.tag,{"class":"col-xs-2"}).update(n.isTitle===!0?e.created:e.createdBy.person.fullname+" @ "+n.me.loadUTCTime(e.created).toLocaleString())}).insert({bottom:new Element(n.tag,{"class":"col-xs-1"}).update(n.isTitle===!0?"":new Element("div",{"class":"btn-group"}).insert({bottom:new Element("span",{"class":"btn btn-xs btn-danger"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(){n.me._showDeleteConfirmPanel(e)})}))}),n.row}});