var PageJs=new Class.create;
PageJs.prototype=Object.extend(new BPCPageJs,{_forceInvNo:!0,_purchaseOrder:null,_getPOListPanel:function(){var a,c;a=this;return(new Element("div",{id:a.getHTMLID("searchPanel"),"class":"panel panel-warning search-panel"})).insert({bottom:(new Element("div",{"class":"panel-heading form-inline"})).insert({bottom:(new Element("strong")).update("Searching for PO: ")}).insert({bottom:(new Element("span",{"class":"input-group col-sm-6"})).insert({bottom:(new Element("input",{required:!0,"class":"form-control search-txt init-focus",
placeholder:"any of PO number, Supplier, Supplier Ref Number ..."})).observe("keydown",function(b){c=this;a.keydown(b,function(){c.hasClassName("search-finished")&&1===$(pageJs._htmlIds.searchPanel).getElementsBySelector(".item_row .btn").size()?$(pageJs._htmlIds.searchPanel).down(".item_row .btn").click():($(a.getHTMLID("searchPanel")).down(".search-btn").click(),c.addClassName("search-finished"))},function(){$(c).removeClassName("search-finished")});return!1})}).insert({bottom:(new Element("span",
{"class":"input-group-btn search-btn"})).insert({bottom:(new Element("span",{"class":" btn btn-primary"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})})}).observe("click",function(){""!==$(a.getHTMLID("searchPanel")).down(".search-txt").value&&a._searchPO($(a.getHTMLID("searchPanel")).down(".search-txt"))})})}).insert({bottom:(new Element("span",{"class":"btn btn-success pull-right btn-sm btn-danger"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove"})}).observe("click",
function(){$(a.getHTMLID("searchPanel")).down(".search-txt").clear();a._searchPO($(a.getHTMLID("searchPanel")).down(".search-txt"))})})})},_searchPO:function(a){var c,b,e,f,d;c=this;b=$F(a).strip();e=$(a).up("#"+c.getHTMLID("searchPanel"));c.postAjax(c.getCallbackId("searchPO"),{searchTxt:b},{onLoading:function(){$(e).down(".list-div")&&$(e).down(".list-div").remove();$(e).insert({bottom:(new Element("div",{"class":"panel-body"})).update(c.getLoadingImg())})},onSuccess:function(a,b){$(e).down(".panel-body").remove();
try{(f=c.getResp(b,!1,!0))&&f.items&&($(e).insert({bottom:(new Element("small",{"class":"table-responsive list-div"})).insert({bottom:(new Element("table",{"class":"table table-hover table-condensed"})).insert({bottom:(new Element("thead")).insert({bottom:c._getPORow({purchaseOrderNo:"PO Number",supplier:{name:"Supplier"},supplierRefNo:"Supplier Ref",orderDate:"Order Date",totalAmount:"Total Amount",totalProductCount:"Total Prodcut Count",status:"Status",active:"Active?"},!0)})}).insert({bottom:d=
new Element("tbody")})})}),f.items.each(function(a){d.insert({bottom:c._getPORow(a)})}))}catch(h){$(e).insert({bottom:(new Element("div",{"class":"panel-body"})).update(c.getAlertBox("ERROR",h).addClassName("alert-danger"))})}}});return c},_getPORow:function(a,c){var b,e,f,d;b=this;e=c||!1;f=!0===e?"th":"td";f=(new Element("tr",{"class":(!0===e?"item_top_row":"item_row")+(0==a.active?" danger":""),item_id:!0===e?"":a.id})).insert({bottom:(new Element(f)).insert({bottom:!0===e?"&nbsp;":(new Element("span",
{"class":"btn btn-primary btn-xs"})).update("select").observe("click",function(){b.selectPO(a)})})}).insert({bottom:(new Element(f)).update(a.purchaseOrderNo)}).insert({bottom:(new Element(f)).update(a.supplier.name)}).insert({bottom:(new Element(f)).update(a.supplierRefNo)}).insert({bottom:(new Element(f)).update(a.orderDate)}).insert({bottom:(new Element(f)).update(a.totalAmount)}).insert({bottom:d=(new Element(f)).update(a.totalProductCount)}).insert({bottom:(new Element(f)).update(a.status)}).insert({bottom:(new Element(f)).insert({bottom:!0===
e?a.active:new Element("input",{type:"checkbox",disabled:!0,checked:a.active})})});!0!==e&&d.update((new Element("a",{href:"/serialnumbers.html?purchaseorderid="+a.id,target:"_BLANK"})).update("<abbr>"+d.innerHTML+"</abbr>"));return f},selectPO:function(a){var c,b,e,f,d,g;c=this;c._purchaseOrder=a;a=c._getViewOfPurchaseOrder();$(c.getHTMLID("itemDiv")).update(a).down("[new-order-item=product]").focus();c._purchaseOrder.purchaseOrderItem.each(function(a){b=$$(".new-order-item-input").first();e={name:"",
id:"",qty:0,barcode:""};f={product:e,btns:(new Element("span",{"class":"pull-right"})).insert({bottom:(new Element("span",{"class":"btn btn-danger btn-xs"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(a){Event.stop(a);confirm("You are about to remove this entry.\n\nContinue?")&&(d=$(this).up(".item_row"),d.remove())})})};b.insert({after:g=c._getProductRow(f,!1)});e=a.product;e.purchaseOrderItem=a.purchaseOrderItem;c._selectProduct(e,g)});return c},
_getViewOfPurchaseOrder:function(){var a,c;a=this._purchaseOrder;c=a.totalAmount?a.totalAmount:0;return(new Element("div")).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-9"})).update(this._getSupplierInfoPanel())}).insert({bottom:(new Element("div",{"class":"col-sm-3"})).update(this._getPaymentPanel())})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-12"})).update(this._getPartsTable())})}).insert({bottom:(new Element("div",
{"class":"row"})).setStyle("padding: 0 15px").insert({bottom:(new Element("div",{"class":"col-sm-1"})).insert({bottom:(new Element("label",{"class":"control-label"})).update("Comment: ")})}).insert({bottom:(new Element("div",{"class":"col-sm-8"})).insert({bottom:(new Element("textarea",{"save-order":"comments",rows:4})).setStyle("width: 100%;")})}).insert({bottom:(new Element("div",{"class":"col-sm-3"})).insert({bottom:(new Element("div")).insert({bottom:(new Element("div",{"class":"row"})).setStyle("border-bottom: 1px #ccc solid; padding: 4px 0;").insert({bottom:(new Element("div",
{"class":"col-xs-8 text-right"})).update("<strong>Total Ordered Value(Inc):</strong>")}).insert({bottom:(new Element("div",{"class":"col-xs-4"})).update(this.getCurrency(c))})}).insert({bottom:(new Element("div",{"class":"row"})).setStyle("border-bottom: 1px #ccc solid; padding: 4px 0;").insert({bottom:(new Element("div",{"class":"col-xs-8  text-right"})).update("<strong>Total Received Value(Ex):</strong>")}).insert({bottom:(new Element("div",{"class":"col-xs-4",summary:"total-recieved-value-ex"})).update(this.getCurrency(a.totalReceivedValue))})}).insert({bottom:(new Element("div",
{"class":"row"})).setStyle("border-bottom: 1px #ccc solid; padding: 4px 0;").insert({bottom:(new Element("div",{"class":"col-xs-8  text-right"})).update("<strong>Total Received Value(Inc):</strong>")}).insert({bottom:(new Element("div",{"class":"col-xs-4",summary:"total-recieved-value"})).update(this.getCurrency(1.1*a.totalReceivedValue))})})}).insert({bottom:this._saveBtns().setStyle("padding: 4px 0;")})})})},_getSupplierInfoPanel:function(){var a,c;a=this._purchaseOrder;c=a.supplier;return(new Element("div",
{"class":"panel panel-warning",id:this.getHTMLID("supplierInfoPanel")})).insert({bottom:(new Element("div",{"class":"panel-heading"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-8"})).insert({bottom:(new Element("span")).update("Receiving items for PO: ").insert({bottom:(new Element("strong")).update(a.purchaseOrderNo+" ")})})}).insert({bottom:(new Element("div",{"class":"col-xs-4 text-right"})).insert({bottom:(new Element("span")).update("Status: ")}).insert({bottom:(new Element("strong")).update(this._purchaseOrder.status)})})})}).insert({bottom:(new Element("div",
{"class":"panel-body",style:"padding: 0 10px"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-3"})).insert({bottom:(new Element("strong")).update("Supplier Name:")}).insert({bottom:(new Element("div",{style:"padding: 2px 8px"})).update(c.name?c.name:"")})}).insert({bottom:(new Element("div",{"class":"col-sm-3"})).insert({bottom:(new Element("strong")).update("Contact Name:")}).insert({bottom:(new Element("div",{style:"padding: 2px 8px"})).update(a.supplierContact?
a.supplierContact:c.contactName)})}).insert({bottom:(new Element("div",{"class":"col-sm-3"})).insert({bottom:(new Element("strong")).update("Contact Number:")}).insert({bottom:(new Element("div",{style:"padding: 2px 8px"})).update(a.supplierContactNumber?a.supplierContactNumber:c.supplierContactNumber)})}).insert({bottom:(new Element("div",{"class":"col-sm-3"})).insert({bottom:(new Element("strong")).update("Contact Email:")}).insert({bottom:(new Element("div",{style:"padding: 2px 8px"})).update(c.email)})})}).insert({bottom:(new Element("div",
{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-sm-3"})).insert({bottom:(new Element("strong")).update("Order Date:")}).insert({bottom:(new Element("div",{style:"padding: 2px 8px"})).update(this._purchaseOrder.orderDate?this.loadUTCTime(this._purchaseOrder.orderDate).toLocaleString():"")})}).insert({bottom:(new Element("div",{"class":"col-sm-3"})).insert({bottom:(new Element("strong")).update("Supplier Ref Number:")}).insert({bottom:(new Element("div",{style:"padding: 2px 8px"})).update(a.supplierRefNo)})})})})},
_getFormGroup:function(a,c){return(new Element("div",{"class":"form-group"})).insert({bottom:a?(new Element("label",{"class":"control-label"})).update(a):""}).insert({bottom:c.addClassName("form-control")})},_getPaymentPanel:function(){var a,c,b;a=this._purchaseOrder;new Element("input",{disabled:!0,"class":"text-right",value:a.shippingCost?a.shippingCost:0});new Element("input",{disabled:!0,"class":"text-right",value:a.handlingCost?a.handlingCost:0});new Element("input",{disabled:!0,"class":"text-right",
value:a.totalAmount?a.totalAmount:0});new Element("input",{disabled:!0,"class":"text-right",value:a.totalPaid?a.totalPaid:0});c=a.totalAmount?a.totalAmount:0;a=a.totalPaid?a.totalPaid:0;b=1*c-1*a;return(new Element("div",{"class":"panel panel-warning",id:this.getHTMLID("paymentPanel")})).insert({bottom:(new Element("div",{"class":"panel-heading text-right"})).insert({bottom:(new Element("div")).insert({bottom:(new Element("strong")).update("Payment Due: ")}).insert({bottom:(new Element("span",{"class":"badge"})).update(this.getCurrency(b))})})}).insert({bottom:(new Element("div",
{"class":"panel-body",style:"padding: 0 10px"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-7 text-right"})).update((new Element("strong")).update("Total Inc GST:"))}).insert({bottom:(new Element("div",{"class":"col-xs-5"})).update(this.getCurrency(c))})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-7 text-right"})).update((new Element("strong")).update("Total Paid:"))}).insert({bottom:(new Element("div",
{"class":"col-xs-5"})).update(this.getCurrency(a))})}).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-7 text-right"})).update((new Element("strong")).update("Total Due:"))}).insert({bottom:(new Element("div",{"class":"col-xs-5"})).update(this.getCurrency(b))})})})},_getPartsTable:function(){var a,c,b;a=(new Element("div",{"class":"list-group",id:this.getHTMLID("partsTable")})).insert({bottom:c=this._getProductRow({product:{sku:"SKU",name:"Product Name",
qty:"Qty",EANcode:"EAN code",UPCcode:"UPC code",wareLocation:"Warehouse Location"}},!0)});c.setStyle({cursor:"pointer"});c.observe("dblclick",function(a){b=!0;$$(".row.product-content-row").each(function(a){a.visible()&&(b=!1)});b?$$(".row.product-content-row").each(function(a){a.show()}):$$(".row.product-content-row").each(function(a){a.hide()});return!1});a.insert({bottom:c=this._getNewProductRow()});return(new Element("div",{"class":"panel panel-warning"})).insert({bottom:a})},_openReceivedItemsListPage:function(a){jQuery.fancybox({width:"95%",
height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",href:"/serialnumbers.html?blanklayout=1&productid="+a+"&purchaseorderid="+this._purchaseOrder.id});return this},_getProductRow:function(a,c){var b,e,f,d,g,k,h,m,l;b=this;e=c||!1;f=(new Element("div",{"class":"form-group"})).insert({bottom:new Element("input",{"class":"form-control input-sm","save-item":"EANcode",placeholder:"EAN code",type:"text",value:a.product.codes?a.product.codes.EAN?a.product.codes.EAN:"":""})}).observe("keydown",
function(a){d=$(this);b.keydown(a,function(){d.up(".product-head-row").down('[save-item="UPCcode"]').select()})}).observe("change",function(a){d=$(this);g=d.up(".item_row.list-group-item").retrieve("data");g.EANcode=$F(d.down("[save-item]"));g.EANcode&&d.up(".item_row.list-group-item").store("data",g)}).observe("click",function(a){Event.stop(a);$(this).select()});k=(new Element("div",{"class":"form-group"})).insert({bottom:new Element("input",{"class":"form-control input-sm","save-item":"UPCcode",
placeholder:"UPC code",type:"text",value:a.product.codes?a.product.codes.UPC?a.product.codes.UPC:"":""})}).observe("keydown",function(a){d=$(this);b.keydown(a,function(){d.up(".item_row").down('[save-item="wareLocation"]').select()})}).observe("change",function(a){d=$(this);g=d.up(".item_row.list-group-item").retrieve("data");g.UPCcode=$F(d.down("[save-item]"));g.UPCcode&&d.up(".item_row.list-group-item").store("data",g)}).observe("click",function(a){Event.stop(a);$(this).select()});h=(new Element("div",
{"class":"form-group"})).insert({bottom:new Element("input",{"class":"form-control input-sm","save-item":"wareLocation",placeholder:"Warehouse Location",type:"text",value:a.product.locations?a.product.warehouseLocation?a.product.warehouseLocation:"":""})}).observe("keydown",function(a){d=$(this);b.keydown(a,function(){d.up(".item_row").down('[scanned-item="serialNo"]').select()})}).observe("change",function(a){d=$(this);g=d.up(".item_row.list-group-item").retrieve("data");g.warehouseLocation=$F(d.down("[save-item]"));
g.UPCcode&&d.up(".item_row.list-group-item").store("data",g)}).observe("click",function(a){Event.stop(a);$(this).select()});!0!==b._canReceive()&&(f.down("input[save-item=EANcode]").disabled=!0,k.down("input[save-item=UPCcode]").disabled=!0,h.down("input[save-item=wareLocation]").disabled=!0,a.btns="");e=(new Element(!0===e?"strong":"div",{"class":"item_row list-group-item",productId:a.product.id})).store("data",a.product).insert({bottom:f=(new Element("div",{"class":e?"row btn-hide-row":"row btn-hide-row product-head-row"})).insert({bottom:(new Element("span",
{"class":" col-sm-2 productName"})).insert({bottom:a.product.name?a.product.name:a.product.barcode})}).insert({bottom:(new Element("span",{"class":"col-sm-1"})).insert({bottom:(new Element("a",{href:"javascript: void(0);"})).insert({bottom:(new Element("span",{"class":"scannedQty"})).update(!0===e?"Qty":a.product.id?a.product.purchaseOrderItem?a.product.purchaseOrderItem.receivedQty:0:"")}).insert({bottom:(new Element("span",{"class":"orderedQty"})).update(a.product.purchaseOrderItem?"/"+a.product.purchaseOrderItem.qty:
"")}).observe("click",function(){a.product.id&&b._purchaseOrder.id&&b._openReceivedItemsListPage(a.product.id)})})}).insert({bottom:(new Element("span",{"class":" col-sm-2 EANcode"})).update(a.product.id?f:a.product.EANcode)}).insert({bottom:(new Element("span",{"class":" col-sm-2 UPCcode"})).update(a.product.id?k:a.product.UPCcode)}).insert({bottom:(new Element("span",{"class":" col-sm-2 wareLocation"})).update(a.product.id?h:a.product.wareLocation)}).insert({bottom:(new Element("span",{"class":"btns col-sm-1"})).update(a.btns?
a.btns:"")})});f.insert({top:(new Element("span",{"class":"col-sm-2 productSku"})).update(a.product.sku?a.product.sku:"")});a.scanTable&&!0===b._canReceive()&&e.insert({bottom:(new Element("div",{"class":"row product-content-row"})).insert({bottom:(new Element("div",{"class":"col-sm-2"})).insert({bottom:(new Element("span",{"class":"col-sm-12"})).insert({bottom:new Element("input",{type:"checkbox","class":"show-checkbox"})}).insert({bottom:(new Element("label")).update(" show input panel")})}).observe("click",
function(){m=$(this).up(".row.product-content-row");l=m.down(".show-checkbox");l.checked=!l.checked;m.down(".scanTable").toggle()})}).insert({bottom:(new Element("div",{"class":"col-sm-10"})).update(a.scanTable.setStyle("display:none;"))})});return e},_getNewProductRow:function(){var a;a={product:{name:this._getNewProductProductAutoComplete()},btns:""};a=this._getProductRow(a,!1).addClassName("new-order-item-input list-group-item-warning").removeClassName("order-item-row btn-hide-row");!0!==this._canReceive()&&
a.hide();return a},_getNewProductProductAutoComplete:function(){var a,c,b;a=this;c=a._getFormGroup(null,(new Element("div",{"class":"input-group input-group-sm product-autocomplete"})).insert({bottom:(new Element("input",{id:a.getHTMLID("barcodeInput"),"class":"form-control search-txt visible-xs visible-sm visible-md visible-lg","new-order-item":"product",required:"Required!",placeholder:"Enter BARCODE for products"})).observe("keydown",function(c){b=this;a.keydown(c,function(){$(b).up(".product-autocomplete").down(".search-btn").click()});
a.keydown(c,function(){$(b).up(".product-autocomplete").down(".search-btn").click()},null,9);return!1})}).insert({bottom:(new Element("span",{"class":"input-group-btn"})).insert({bottom:(new Element("span",{"class":" btn btn-primary search-btn","data-loading-text":"searching..."})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})}).observe("click",function(){a._searchProduct(this)})})}));c.down(".input-group").removeClassName("form-control");return c},_getScanTableROW:function(a,
c){var b;b=!0===c?"th":"td";return(new Element("tr",{"class":!0===c?"":"scanned-item-row"})).store("data",a).insert({bottom:(new Element(b,{"class":"col-sm-1"})).update(a.qty?a.qty:"")}).insert({bottom:(new Element(b)).update(a.serialNo?a.serialNo:"")}).insert({bottom:(new Element(b)).update(a.unitPrice?a.unitPrice:"")}).insert({bottom:(new Element(b)).update(a.invoiceNo?a.invoiceNo:"")}).insert({bottom:(new Element(b)).update(a.comments?a.comments:"")}).insert({bottom:(new Element(b,{"class":"btns"})).update(a.btns?
a.btns:"")})},_updatetotalReceivedValue:function(){var a,c,b,e,f;a=this;c=a._purchaseOrder.totalReceivedValue;$$(".scanned-item-row").each(function(d){b=d.down('[scanned-item="qty"]');e=d.down('[scanned-item="unitPrice"]');!d.hasClassName("new-scan-row")&&b&&e&&(c=1*c+a.getValueFromCurrency($F(e))*$F(b))});f=1.1*c;jQuery('[summary="total-recieved-value-ex"]').html(a.getCurrency(c)).val(a.getCurrency(c));jQuery('[summary="total-recieved-value"]').html(a.getCurrency(f)).val(a.getCurrency(f));return a},
_getScanTable:function(a,c){var b,e,f,d,g,k,h,m,l,p,n,q;b=this;e=(new Element("a")).setStyle("cursor: pointer; text-decoration: underline; margin-left: 5px;").update("Bulk Import").observe("click",function(c){b.serialUploader=new SerialBulkUploaderJs(b,a);b.showModalBox("Bulk Import Serial Numbers",f=b.serialUploader.getInputPanel());f.down(".confimBtn").observe("click",function(){$(this).up(".bulkSerialPanel").retrieve("data")&&null!==$(this).up(".bulkSerialPanel").retrieve("data").length&&jQuery("#"+
b.modalId).modal("hide")});jQuery("#"+b.modalId).on("hide.bs.modal",function(a){d=$(this).down(".bulkSerialPanel").retrieve("data");0!==d.length&&(g=[],$$('.item_row[productid="'+d.product.id+'"]').first().getElementsBySelector('[scanned-item="serialNo"]').each(function(a){""!==a.value&&g.push(a.value)}),d&&0<d.length&&d.each(function(a){0>parseInt(g.indexOf(a.serialNo))&&(k=$$('.item_row[productid="'+d.product.id+'"]').first(),k.down('[scanned-item="qty"]').setValue(a.qty),k.down('[scanned-item="unitPrice"]').setValue(a.unitPrice),
k.down('[scanned-item="serialNo"]').setValue(a.serialNo),k.down('[scanned-item="invoiceNo"]').setValue(a.invoiceNo),k.down('[scanned-item="comments"]').setValue(a.comments),k.down(".scanned-item-save-btn").click())}),jQuery('[role="tooltip"]').tooltip("hide"))});b.product=null});b.scanTableSerialNoTitle=(new Element("span",{"class":"scanTableSerialNoTitle"})).update("Serial No.").insert({bottom:e});e=(new Element("table",{"class":"table scanTable"})).insert({bottom:(new Element("thead")).update(b._getScanTableROW({qty:"Qty",
serialNo:b.scanTableSerialNoTitle,unitPrice:"Unit Price (Ex)",invoiceNo:"Inv. No.",comments:"Comments",btns:""},!0))}).insert({bottom:(new Element("tbody")).insert({bottom:b._getScanTableROW({qty:b._getFormGroup("",(new Element("input",{"class":"form-control input-sm","scanned-item":"qty",type:"text",placeholder:"How many you received.",required:!0,value:1,validate_currency:"Invalid qty"})).observe("keyup",function(){h=$(this).up(".scanned-item-row").down("[scanned-item=serialNo]");1<$F(this)?h.setValue("No S/N, as qty > 1").disabled=
!0:h.setValue("").disabled=!1}).observe("click",function(){$(this).select();h=$(this).up(".scanned-item-row").down("[scanned-item=serialNo]");1<$F(this)?h.setValue("No S/N, as qty > 1").disabled=!0:h.setValue("").disabled=!1}).observe("keydown",function(a){m=$(this);h=m.up(".scanned-item-row").down("[scanned-item=serialNo]");l=m.up(".scanned-item-row").down("[scanned-item=unitPrice]");b.keydown(a,function(){1<$F(m)?(h.setValue("No S/N, as qty > 1").disabled=!0,l.focus(),l.select()):(h.setValue("").disabled=
!1,h.focus(),h.select())})})),serialNo:b._getFormGroup("",new Element("input",{"class":"form-control input-sm","scanned-item":"serialNo",type:"text",placeholder:"Serial Number:",required:!0})),unitPrice:b._getFormGroup("",new Element("input",{"class":"form-control input-sm","scanned-item":"unitPrice",type:"value",placeholder:"Unit Price:",validate_currency:"Invalid currency",value:a.purchaseOrderItem?b.getValueFromCurrency(b.getCurrency(a.purchaseOrderItem.unitPrice)):""})),invoiceNo:b._getFormGroup("",
p=new Element("input",{"class":"form-control","scanned-item":"invoiceNo",type:"text",placeholder:"Inv. No.:"})),comments:b._getFormGroup("",new Element("input",{"class":"form-control input-sm","scanned-item":"comments",type:"text",placeholder:"Comments:"})),btns:(new Element("span",{"class":"btn-group btn-group-sm pull-right"})).insert({bottom:(new Element("span",{"class":"scanned-item-save-btn btn btn-primary"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-floppy-saved"})}).observe("click",
function(){b._saveScanTableRow($(this))})}).insert({bottom:(new Element("span",{"class":"scanned-item-delete-btn btn btn-default"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-floppy-remove"})}).observe("click",function(){confirm("You about to clear this entry. All input data for this entry will be lost.\n\nContinue?")&&(n=$(this).up(".scanned-item-row"),h=n.down("input[scanned-item=serialNo]"),l=n.down("input[scanned-item=unitPrice]"),p=n.down("input[scanned-item=invoiceNo]"),
q=n.down("input[scanned-item=comments]"),h.clear(),l.clear(),p.clear(),q.clear(),h.focus())})})}).addClassName("info")})});b._forceInvNo&&p.writeAttribute("required",!0);return e},_saveScanTableRow:function(a,c,b){var e,f,d,g,k,h;e=this;f=b||!1;d=a||!1;!1===d&&e.showModalBox('<p class="text-danger">Error</p>',"SerialBulkUploader (control), function _saveScanTableRow must have a btn as input");a=c||d.up(".item_row").retrieve("data");null!==a&&!1!==a&&!1!==jQuery.isNumeric(a.id)&&a.sku||e.showModalBox('<p class="text-danger">Error</p>',
"Invalid Product passed in");b=d.up(".scanned-item-row");f=!1!==f?f:e._collectFormData(b,"scanned-item");null!==f&&(g=b.clone(!0),k=(new Element("td")).insert({bottom:(new Element("span",{"class":"scanned-item-delte-btn btn btn-danger btn-xs pull-right"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(a){confirm("You are about to remove this entry.\n\nContinue?")&&(d.up(".item_row").down(".product-head-row .scannedQty").innerHTML=1*d.up(".item_row").down(".product-head-row .scannedQty").innerHTML-
1*f.qty,d.up(".item_row").down(".product-head-row .scannedQty").innerHTML>c.purchaseOrderItem.qty||!d.up(".item_row").down(".product-head-row .scannedQty").innerHTML?d.up(".item_row").down(".product-head-row .scannedQty").setStyle({color:"red"}):d.up(".item_row").down(".product-head-row .scannedQty").setStyle({color:"inherit"}),0==d.up(".item_row").down(".product-head-row .scannedQty").innerHTML&&d.up(".item_row").down(".product-head-row .scannedQty").setStyle({color:"red"}),d.up(".scanned-item-row").remove())})}),
g.removeClassName("info").removeClassName("new-scan-row").addClassName("btn-hide-row"),g.down(".scanned-item-save-btn").remove(),g.down(".btns").replace(k),g.down("input[scanned-item=qty]").disable(),g.down("input[scanned-item=serialNo]").disable(),g.down("input[scanned-item=unitPrice]").observe("click",function(){d.focus();d.select()}).observe("keyup",function(){h=d;h.up(".scanned-item-row").hasClassName("new-scan-row")||e._updatetotalReceivedValue()}),b.insert({after:g}),b.down("input[scanned-item=comments]").clear(),
b.down("input[scanned-item=serialNo]").clear().disabled=!1,b.down("input[scanned-item=qty]").value=1,b.down("input[scanned-item=serialNo]").select(),d.up(".item_row").down(".scannedQty").innerHTML=1*d.up(".item_row").down(".scannedQty").innerHTML+1*f.qty,d.up(".item_row").down(".product-head-row .scannedQty").innerHTML>a.purchaseOrderItem.qty||!d.up(".item_row").down(".product-head-row .scannedQty").innerHTML?d.up(".item_row").down(".product-head-row .scannedQty").setStyle({color:"red"}):d.up(".item_row").down(".product-head-row .scannedQty").setStyle({color:"inherit"}),
e._updatetotalReceivedValue());d.up(".scanTable").down('[scanned-item="serialNo"]').focus();d.up(".scanTable").down('[scanned-item="serialNo"]').select();return e},_searchProduct:function(a){var c,b,e,f,d,g,k,h,m,l;c=this;c._signRandID(a);b=$(a).up(".product-autocomplete").down(".search-txt");if(e=$F(b))return a=$(a).up(".new-order-item-input"),f={name:"",id:"",qty:0,barcode:e},d={product:f,btns:(new Element("span",{"class":"pull-right"})).insert({bottom:(new Element("span",{"class":"btn btn-danger btn-xs"})).insert({bottom:new Element("span",
{"class":"glyphicon glyphicon-trash"})}).observe("click",function(a){Event.stop(a);confirm("You are about to remove this entry.\n\nContinue?")&&(g=$(this).up(".item_row"),g.remove())})})},a.insert({after:k=c._getProductRow(d,!1)}),h=c._getNewProductRow(),a.replace(h),h.down("[new-order-item=product]").focus(),jQuery("#"+c.getHTMLID("barcodeInput")),c.postAjax(c.getCallbackId("searchProduct"),{searchTxt:e},{onLoading:function(){jQuery("#"+c.getHTMLID("barcodeInput")).button("loading")},onSuccess:function(a,
f){m=new Element("div",{style:"overflow: auto; max-height: 400px;"});try{l=c.getResp(f,!1,!0);if(!l||!l.items||0===l.items.size())throw k.down(".productSku").insert({bottom:(new Element("strong",{"class":"text-danger"})).update("No Product Found!")}),k.down(".productName").insert({top:(new Element("span",{"class":""})).update("Barcode: ")}),"Nothing Found for: "+e;if(1<l.items.size())return b=h.down(".search-txt"),m=new Element("div",{style:"overflow: auto; max-height: 400px;","class":"selectProductPanel"}),
l.items.each(function(a){m.insert({bottom:c._getSearchPrductResultRow(a,b,k,h)})}),m.addClassName("list-group"),c.showModalBox("Products that has: "+e,m,!1),c;d.product=l.items[0];c._selectProduct(d.product,k,h)}catch(g){m.update(c.getAlertBox("Error: ",g).addClassName("alert-danger"))}},onComplete:function(a,b){jQuery("#"+c.getHTMLID("barcodeInput")).button("reset")}}),c},_selectProduct:function(a,c){var b={me:this,data:[]};b.product=a;b.lastRow=c;b.btn=$("barcode_input");b.me._signRandID(b.btn);
b.data={product:b.product,btns:(new Element("span",{"class":"pull-right"})).insert({bottom:(new Element("span",{"class":"btn btn-danger btn-xs"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(a){Event.stop(a);confirm("You are about to remove this entry.\n\nContinue?")&&(b.row=$(this).up(".item_row"),b.row.remove())})}),qty:0};b.data.scanTable=b.me._getScanTable(b.data.product,b.data);b.lastRow.replace(b.newRow=b.me._getProductRow(b.data,!1));
b.me._checkProduct(b.product,b.newRow.down(".product-head-row"));b.newRow.down('[save-item="EANcode"]').select();b.me._focusNext(b.newRow,"serialNo","unitPrice");b.me._focusNext(b.newRow,"unitPrice","invoiceNo");b.me._focusNext(b.newRow,"invoiceNo","comments");b.serialNoBox=b.newRow.down("input[scanned-item=serialNo]");b.serialNoBox&&(b.serialNoBox.observe("keydown",function(a){b.me.keydown(a,function(){$F(b.serialNoBox).blank()||$F(b.unitPriceBox).blank()||$F(b.invoiceNoBox).blank()||b.newRow.down(".scanned-item-save-btn span").click()});
return!1}),b.serialNoBox.up(".scanned-item-row").addClassName("new-scan-row"));b.unitPriceBox=b.newRow.down("input[scanned-item=unitPrice]");b.unitPriceBox&&b.unitPriceBox.observe("keydown",function(a){b.me.keydown(a,function(){$F(b.serialNoBox).blank()||$F(b.unitPriceBox).blank()||$F(b.invoiceNoBox).blank()||b.newRow.down(".scanned-item-save-btn span").click()});return!1});b.invoiceNoBox=b.newRow.down("input[scanned-item=invoiceNo]");b.invoiceNoBox&&b.invoiceNoBox.observe("keydown",function(a){b.me.keydown(a,
function(){$F(b.serialNoBox).blank()||$F(b.unitPriceBox).blank()||$F(b.invoiceNoBox).blank()||b.newRow.down(".scanned-item-save-btn span").click()});return!1});b.commentsBox=b.newRow.down("input[scanned-item=comments]");b.commentsBox&&b.commentsBox.observe("keydown",function(a){b.me.keydown(a,function(){$F(b.serialNoBox).blank()||$F(b.unitPriceBox).blank()||$F(b.invoiceNoBox).blank()||b.newRow.down(".scanned-item-save-btn span").click()});return!1});b.me._scanRowAutoSave(b.newRow);return b.me},_scanRowAutoSave:function(a){var c;
c=this;a.down('[scanned-item="comments"]')&&a.down('[scanned-item="comments"]').observe("keydown",function(b){c.keydown(b,function(){a.down(".scanned-item-save-btn").click()});return!1});return c},_focusNext:function(a,c,b){var e;e=this;a.down('[scanned-item="'+c+'"]')&&a.down('[scanned-item="'+c+'"]').observe("keydown",function(c){e.keydown(c,function(){a.down('[scanned-item="'+b+'"]').select()});return!1});return e},_checkProduct:function(a,c){var b,e,f;b=pageJs;e=$("barcode_input");b._signRandID(e);
b.postAjax(b.getCallbackId("checkProduct"),{product:a,purchaseOrder:b._purchaseOrder},{onLoading:function(a,b){jQuery("#"+e.id).button("loading")},onSuccess:function(a,e){try{f=b.getResp(e,!1,!0),0==f.count&&(c.down(".productSku").insert({bottom:(new Element("strong",{style:"color:red"})).update("  (Not found in PO)")}),c.up(".item_row").addClassName("not-in-po"))}catch(k){b.showModalBox("Error!",k,!1)}},onComplete:function(a,b){jQuery("#"+e.id).button("reset")}})},_canReceive:function(){return"RECEIVING"===
this._purchaseOrder.status||"ORDERED"===this._purchaseOrder.status},_saveBtns:function(){var a;a=this;return(new Element("span",{"class":"btn-group pull-right"})).insert({bottom:(new Element("span",{"class":"btn btn-primary","data-loading-text":"saving..."})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok-circle"})}).insert({bottom:(new Element("span")).update(" save ")}).observe("click",function(){a._submitOrder($(this))})}).insert({bottom:(new Element("span",{"class":"btn btn-default"})).insert({bottom:new Element("span",
{"class":"glyphicon glyphicon-remove-sign"})}).insert({bottom:(new Element("span")).update(" cancel ")}).observe("click",function(){a.showModalBox('<strong class="text-danger">Cancelling this PO receiving</strong>','<div>You are about to cancel this receiving process, all input data will be lost.</div><br /><div>Continue?</div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',
!0)})})},_getOutStandingOrderPanel:function(a){var c,b,e;c=(new Element("div")).insert({bottom:(new Element("div")).update("There are outstanding orders that need these parts that you just recieved:")}).insert({bottom:(new Element("table",{"class":"table table-hover table-condensed"})).insert({bottom:(new Element("thead")).insert({bottom:(new Element("tr")).insert({bottom:(new Element("th")).update("Product")}).insert({bottom:(new Element("th")).update("Received Qty")}).insert({bottom:(new Element("th")).update("Orders")})})}).insert({bottom:b=
new Element("tbody")})});a.each(function(a){e=new Element("div",{"class":"row"});a.outStandingOrders.each(function(a){e.insert({bottom:(new Element("div",{"class":"col-sm-3"})).insert({bottom:(new Element("a",{href:"/orderdetails/"+a.id+".html",target:"_BLANK"})).update(a.orderNo)})})});b.insert({bottom:(new Element("tr")).insert({bottom:(new Element("td")).update(a.product.sku)}).insert({bottom:(new Element("td")).update(a.recievedQty)}).insert({bottom:(new Element("td")).update(e)})})});return c},
_submitOrder:function(a){var c,b,e,f,d,g;c=this;b=c._collectFormData($(c.getHTMLID("itemDiv")),"save-order");b.purchaseOrder=c._purchaseOrder;b.products={};b.products.matched=[];b.products.notMatched=[];$(c.getHTMLID("partsTable")).getElementsBySelector("div.item_row").each(function(a){a.hasClassName("new-order-item-input")||(""!==a.retrieve("data").id?(e=[],a.getElementsBySelector(".table.scanTable .scanned-item-row").each(function(a){a.hasClassName("new-scan-row")||e.push(c._collectFormData(a,"scanned-item"))}),
b.products.matched.push({product:a.retrieve("data"),serial:e})):b.products.notMatched.push(a.retrieve("data")))});if(null===b)return c;if(0>=b.products.matched.size()+b.products.notMatched.size())return c.showModalBox('<strong class="text-danger">Error</strong>',"At least one item is needed!",!0),c;c._signRandID(a);c.postAjax(c.getCallbackId("saveOrder"),b,{onLoading:function(b,c){jQuery("#"+a.id).button("loading")},onSuccess:function(a,b){try{(f=c.getResp(b,!1,!0))&&f.item&&f.outStandingOrders&&
(d=(new Element("div")).update("<strong>All items saved successfully! Bill(s) generated as following:</strong>").insert({bottom:g=new Element("ul",{"class":"list-inline"})}),f.invoiceNos&&0<f.invoiceNos.size()&&f.invoiceNos.each(function(a){g.insert({bottom:(new Element("li")).update((new Element("a",{"class":"btn btn-success",href:"/bills/"+f.item.supplier.id+".html?invoiceNo="+a,target:"_BLANK"})).update(a))})}),0<f.outStandingOrders.size()&&d.insert({bottom:c._getOutStandingOrderPanel(f.outStandingOrders)}),
c.showModalBox('<strong class="text-success">Success!</strong>',d,!1,null,{"hide.bs.modal":function(){window.location=document.URL}}),c.refreshParentWindow(f.item))}catch(e){c.showModalBox("Error!",e,!1)}},onComplete:function(b,c){jQuery("#"+a.id).button("reset")}});return c},refreshParentWindow:function(a){var c,b;window.opener&&(c=window.opener,(b=$(c.document.body).down("#"+c.pageJs.resultDivId+" .item_row[item_id="+a.id+"]"))&&b.replace(c.pageJs._getResultRow(a)))},_getSearchPrductResultRow:function(a,
c,b,e){var f,d;f=this;d=e;return d=(new Element("a",{"class":"list-group-item",href:"javascript: void(0);"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-2"})).insert({bottom:(new Element("div",{"class":"thumbnail"})).insert({bottom:new Element("img",{"data-src":"holder.js/100%x64",alert:"Product Image",src:0===a.images.size()?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+":
a.images[0].asset.url})})})}).insert({bottom:(new Element("div",{"class":"col-xs-10"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("strong")).update(a.name).insert({bottom:(new Element("small",{"class":"",style:"padding-left: 10px;"})).update("SKU: "+a.sku)})}).insert({bottom:(new Element("div")).insert({bottom:(new Element("small")).update(a.shortDescription)})})})})}).observe("click",function(){$(c).up(".new-order-item-input").store("product",a);f._selectProduct(a,
b,d);jQuery("#"+f.modalId).modal("hide");$$('[scanned-item="serialNo"]').first().focus()})},init:function(a){a?this.selectPO(a):$(this.getHTMLID("itemDiv")).update(this._getPOListPanel()).down(".init-focus").focus()}});