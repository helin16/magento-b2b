var PageJs=new Class.create;PageJs.prototype=Object.extend(new CRUDPageJs,{_preLoadData:{},_getTitleRowData:function(){return{}},setPreloadData:function(e){var t={};return t.me=this,t.me._preLoadData=e,t.me},_getResultRow:function(e,t){var a={};return a.me=this,a.tag=a.isTitle===!0?"th":"td",a.isTitle=t||!1,a.row=new Element("tr",{"class":a.isTitle===!0?"":"item_row"}).store("data",e).insert({bottom:new Element(a.tag,{"class":"col-sm-2"}).update(a.isTitle===!0?"SKU":new Element("div").insert({bottom:new Element("div").update(new Element("a",{href:"/products/"+e.product.id+".html",target:"_BLANK"}).update(e.product.sku))}).insert({bottom:new Element("small").update(e.product.name)}))}).insert({bottom:new Element(a.tag,{"class":"col-sm-1 text-center"}).update(a.isTitle===!0?"Qty":e.totalQty)}).insert({bottom:new Element(a.tag,{"class":"col-sm-1"}).update(a.isTitle===!0?"Unit Price (Ex GST)":a.me.getCurrency(e.totalPrice/e.totalQty))}).insert({bottom:new Element(a.tag,{"class":"col-sm-1"}).update(a.isTitle===!0?"Total Price (Ex GST)":a.me.getCurrency(e.totalPrice))}).insert({bottom:new Element(a.tag,{"class":"col-sm-2"}).update(a.isTitle===!0?"PurchaseOrders":a.poList=new Element("ul",{"class":"list-inline"}))}).insert({bottom:new Element(a.tag,{"class":"col-sm-5"}).update(a.isTitle===!0?"Serial No.":a.serialNoList=new Element("ul",{"class":"list-inline"}))}),e.items&&a.serialNoList&&e.items.each(function(e){a.serialNoList.insert({bottom:new Element("li").update(e.serialNo)})}),e.purchaseOrders&&a.poList&&e.purchaseOrders.each(function(e){a.poList.insert({bottom:new Element("li").update(new Element("a",{href:"/purchase/"+e.id+".html",target:"_BLANK"}).update(e.purchaseOrderNo))})}),a.row},_getSummaryPanel:function(e,t,a){var r={};return r.newDiv=new Element("div",{"class":"panel panel-default"}).insert({bottom:new Element("div",{"class":"panel-body"}).insert({bottom:new Element("h3").update("Invoice No.: "+t)}).insert({bottom:new Element("div").update("Supplier: "+e.name)}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-2 text-right"}).update("Purchase Order(s): ")}).insert({bottom:new Element("div",{"class":"col-xs-10"}).insert({bottom:r.poList=new Element("ul",{"class":"list-inline"})})})})}),a&&r.poList&&$H(a).each(function(e){r.poList.insert({bottom:new Element("li").update(new Element("a",{href:"/purchase/"+e.value.id+".html",target:"_BLANK"}).update(e.value.purchaseOrderNo))})}),r.newDiv},getResults:function(e,t){var a={};a.me=this,a.reset=e||!1,a.resultDiv=$(a.me.resultDivId),a.data={pagination:a.me._pagination,searchCriteria:{invoiceNo:a.me._preLoadData.invoiceNo,supplierId:a.me._preLoadData.supplierId}},a.me.postAjax(a.me.getCallbackId("getItems"),a.data,{onLoading:function(){a.resultDiv.update(new Element("tr").update(new Element("td").update(a.me.getLoadingImg())))},onSuccess:function(e,t){try{if(a.result=a.me.getResp(t,!1,!0),!a.result)return;$(a.me.totalNoOfItemsId).update(a.result.items.size()),a.resultDiv.update(a.me._getResultRow(a.me._getTitleRowData(),!0).wrap(new Element("thead"))),a.tbody=$(a.resultDiv).down("tbody"),a.tbody||$(a.resultDiv).insert({bottom:a.tbody=new Element("tbody")}),a.totalPrice=0,a.purchaseOrders={},a.result.items.each(function(e){a.totalPrice+=e.totalPrice,a.tbody.insert({bottom:a.me._getResultRow(e).addClassName("item_row").writeAttribute("item_id",e.id)}),e.purchaseOrders.each(function(e){a.purchaseOrders[e.id]=e})}),jQuery(".total-price-ex").html(a.me.getCurrency(a.totalPrice)),jQuery(".total-price-inc").html(a.me.getCurrency(1.1*a.totalPrice)),jQuery(".summaryPanel").html(a.me._getSummaryPanel(a.result.supplier,a.me._preLoadData.invoiceNo,a.purchaseOrders))}catch(r){a.resultDiv.insert({bottom:a.me.getAlertBox("Error",r).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+a.me.searchDivId+" #searchBtn").button("reset")}})}});