var PageJs=new Class.create;PageJs.prototype=Object.extend(new CRUDPageJs,{_getTitleRowData:function(){return{}},_openDetailsPage:function(e){var t={};return t.me=this,jQuery.fancybox({width:"95%",height:"95%",autoScale:!1,autoDimensions:!1,fitToView:!1,autoSize:!1,type:"iframe",href:"/bills/"+e.supplier.id+".html?blanklayout=1&invoiceNo="+e.invoiceNo}),t.me},_getShowInvoiceNoDiv:function(e){var t={};return t.me=this,t.newDiv=new Element("div",{"class":"inovice-input-div"}).insert({bottom:new Element("a",{href:"javascript: void(0);"}).update(e.invoiceNo).observe("click",function(){t.me._openDetailsPage(e)})}).insert({bottom:new Element("span",{"class":"btn btn-default btn-xs pull-right"}).update("edit").observe("click",function(){$(this).up(".inovice-input-div").update(t.newInput=t.me._getInvoiceNoInputBox(e)),t.newInput.select()})}),t.newDiv},_getInvoiceNoInputBox:function(e){var t={};return t.me=this,t.newDiv=new Element("div").insert({bottom:new Element("input",{"class":"form-control input-sm",value:e&&e.invoiceNo?e.invoiceNo:""}).observe("change",function(){return t.inputBox=$(this),t.newInvoiceNo=$F(t.inputBox),t.newInvoiceNo.blank()?void alert("Invoice No. can NOT be empty!"):void t.me.postAjax(t.me.getCallbackId("updateInvoiceNo"),{oldInvoiceNo:e.invoiceNo,newInoviceNo:t.newInvoiceNo,supplierId:e.supplier.id},{onLoading:function(){},onSuccess:function(n,i){try{if(t.result=t.me.getResp(i,!1,!0),!t.result)return;e.invoiceNo=t.newInvoiceNo,$(t.inputBox).up(".inovice-input-div").replace(t.me._getShowInvoiceNoDiv(e))}catch(r){t.me.showModalBox('<strong class="text-danger">Error</strong>',new Element("h3").update(r))}},onComplete:function(){}})})}),t.newDiv},_getResultRow:function(e,t){var n={};return n.me=this,n.tag=n.isTitle===!0?"th":"td",n.isTitle=t||!1,n.row=new Element("tr",{"class":n.isTitle===!0?"":"item_row"}).store("data",e).insert({bottom:new Element(n.tag,{"class":"col-sm-1"}).update(n.isTitle===!0?"Inv. No.":n.me._getShowInvoiceNoDiv(e))}).insert({bottom:new Element(n.tag,{"class":"col-sm-1"}).update(n.isTitle===!0?"Created":moment(n.me.loadUTCTime(e.created)).format("ll"))}).insert({bottom:new Element(n.tag,{"class":"col-sm-2"}).update(n.isTitle===!0?"Supplier":e.supplier.name)}).insert({bottom:new Element(n.tag,{"class":"col-sm-2"}).update(n.isTitle===!0?"Total Qty":e.totalQty)}).insert({bottom:new Element(n.tag,{"class":"col-sm-2"}).update(n.isTitle===!0?"Total Price(ex GST)":n.me.getCurrency(e.totalPrice))}).insert({bottom:new Element(n.tag,{"class":"col-sm-2"}).update(n.isTitle===!0?"Total Price(inc GST)":n.me.getCurrency(1.1*e.totalPrice))}).insert({bottom:new Element(n.tag,{"class":"col-sm-4"}).update(n.isTitle===!0?"Purchase Orders":n.purchaseOrderList=new Element("ul",{"class":"list-inline"}))}),e.purchaseOrders&&n.purchaseOrderList&&e.purchaseOrders.each(function(e){n.purchaseOrderList.insert({bottom:new Element("li").insert({bottom:new Element("a",{target:"_BLANK",href:"/purchase/"+e.id+".html"}).update(e.purchaseOrderNo)})})}),n.row},_initSelect2_Supplier:function(){var e={};return e.me=this,jQuery('.select2[search_field="supplierIds"]').select2({allowClear:!0,hidden:!0,multiple:!0,ajax:{url:"/ajax/getSuppliers",dataType:"json",delay:10,data:function(e){return{searchTxt:e}},results:function(t){return e.result=[],t.resultData.items.each(function(t){e.result.push({id:t.id,text:t.name,data:t})}),{results:e.result}},cache:!0},formatResult:function(e){return e?"<div value="+e.data.id+">"+e.data.name+"</div >":""},escapeMarkup:function(e){return e},minimumInputLength:1}),e.me},_initSelect2_po:function(){var e={};return e.me=this,jQuery('.select2[search_field="purchaseOrderIds"]').select2({allowClear:!0,hidden:!0,multiple:!0,ajax:{url:"/ajax/getAll",dataType:"json",delay:10,data:function(e){return{entityName:"PurchaseOrder",searchTxt:"po.purchaseOrderNo like :poNo",searchParams:{poNo:"%"+e+"%"}}},results:function(t){return e.result=[],t.resultData.items.each(function(t){e.result.push({id:t.id,text:t.purchaseOrderNo,data:t})}),{results:e.result}},cache:!0},formatResult:function(e){return e?"<div value="+e.data.id+">"+e.data.purchaseOrderNo+" ("+e.data.supplier.name+")</div >":""},escapeMarkup:function(e){return e},minimumInputLength:1}),e.me},init:function(){var e={};return e.me=this,e.me._initSelect2_Supplier()._initSelect2_po(),$$("#searchBtn").first().observe("click",function(t){$$("#showSearch").first().checked?e.me.getSearchCriteria().getResults(!0,e.me._pagination.pageSize):$$("#showSearch").first().click()}),e.me}});