var PageJs=new Class.create;
PageJs.prototype=Object.extend(new BPCPageJs,{_getProductRow:function(a,c){var b,f,d,e,k,g,m,l,h,n,p;b=this;f=c||!1;d=(new Element("div",{"class":"form-group"})).insert({bottom:new Element("input",{"class":"form-control",name:"Stock on PO","save-item":"stockOnPO",placeholder:"Stock On PO",type:"number",value:a.product.stockOnPO?a.product.stockOnPO:0})}).observe("keydown",function(a){e=$(this);b.keydown(a,function(){e.up(".product-head-row").down('[save-item="stockOnHand"]').select()})}).observe("click",function(a){$(this).down("input").select()});
k=(new Element("div",{"class":"form-group"})).insert({bottom:new Element("input",{"class":"form-control",name:"Stock on Hand","save-item":"stockOnHand",placeholder:"Stock On Hand",type:"number",value:a.product.stockOnHand?a.product.stockOnHand:0})}).observe("keydown",function(a){e=$(this);b.keydown(a,function(){e.up(".item_row").down('[save-item="totalOnHandValue"]').select()})}).observe("keyup",function(){e=$(this);g=e.up(".item_row").down('[save-item="totalOnHandValue"]');g.value=b.getCurrency(a.product.unitCost*
$F(e.down("input")))}).observe("click",function(a){$(this).down("input").select()});m=(new Element("div",{"class":"form-group"})).insert({bottom:new Element("input",{"class":"form-control","save-item":"totalOnHandValue",placeholder:"Total On Hand Value",type:"value",value:a.product.totalOnHandValue?b.getCurrency(a.product.totalOnHandValue):b.getCurrency(0)})}).observe("keydown",function(a){e=$(this);b.keydown(a,function(){e.up(".item_row").down('[save-item="stockOnOrder"]').select()})}).observe("click",
function(a){$(this).down("input").select()}).observe("change",function(a){$(this).down("input").value=b.getCurrency(b.getValueFromCurrency($(this).down("input").value))});l=(new Element("div",{"class":"form-group"})).insert({bottom:new Element("input",{"class":"form-control",name:"Stock on Order","save-item":"stockOnOrder",placeholder:"Stock On Order",type:"number",value:a.product.stockOnOrder?a.product.stockOnOrder:0})}).observe("keydown",function(a){e=$(this);b.keydown(a,function(){e.up(".item_row").down('[save-item="stockInRMA"]').select()})}).observe("click",
function(a){$(this).down("input").select()});h=(new Element("div",{"class":"form-group"})).insert({bottom:new Element("input",{"class":"form-control",name:"Stock in RMA","save-item":"stockInRMA",placeholder:"Stock In RMA",type:"number",value:a.product.stockInRMA?a.product.stockInRMA:0})}).observe("keydown",function(a){e=$(this);b.keydown(a,function(){e.up(".item_row").down('[save-item="stockInParts"]').select()})}).observe("click",function(a){$(this).down("input").select()});n=(new Element("div",
{"class":"form-group"})).insert({bottom:new Element("input",{"class":"form-control",name:"Stock in Parts","save-item":"stockInParts",placeholder:"Stock In Parts",type:"number",value:a.product.stockInParts?a.product.stockInParts:0})}).observe("keydown",function(a){e=$(this);b.keydown(a,function(){e.up(".item_row").down('[save-item="totalInPartsValue"]').select()})}).observe("keyup",function(){e=$(this);g=e.up(".item_row").down('[save-item="totalInPartsValue"]');0!=$F(e.down("input"))&&0!=a.product.unitCost&&
0!=b.getValueFromCurrency($F(g))&&(g.value=b.getCurrency(a.product.unitCost*$F(e.down("input"))))}).observe("click",function(a){$(this).down("input").select()});p=(new Element("div",{"class":"form-group"})).insert({bottom:new Element("input",{"class":"form-control","save-item":"totalInPartsValue",placeholder:"Total In Parts Value",type:"value",value:a.product.totalInPartsValue?b.getCurrency(a.product.totalInPartsValue):b.getCurrency(0)})}).observe("keydown",function(a){e=$(this);b.keydown(a,function(){$(b.getHTMLID("barcodeInput")).focus()})}).observe("click",
function(a){$(this).down("input").select()}).observe("change",function(a){$(this).down("input").value=b.getCurrency(b.getValueFromCurrency($(this).down("input").value))});f=(new Element(!0===f?"strong":"div",{"class":"item_row list-group-item"})).store("data",a.product).insert({bottom:d=(new Element("div",{"class":f?"row btn-hide-row":"row btn-hide-row product-head-row"})).insert({bottom:(new Element("span",{"class":" col-sm-2 productName"})).insert({bottom:a.product.name?a.product.name:a.product.barcode})}).insert({bottom:(new Element("span",
{"class":" col-sm-1 StockOnPO"})).update(a.product.id?d:a.product.stockOnPO)}).insert({bottom:(new Element("span",{"class":" col-sm-1 StockOnHand"})).update(a.product.id?k:a.product.stockOnHand)}).insert({bottom:(new Element("span",{"class":" col-sm-1 TotalOnHandValue"})).update(a.product.id?m:a.product.totalOnHandValue)}).insert({bottom:(new Element("span",{"class":" col-sm-1 StockOnOrder"})).update(a.product.id?l:a.product.stockOnOrder)}).insert({bottom:(new Element("span",{"class":" col-sm-1 StockInRMA"})).update(a.product.id?
h:a.product.stockInRMA)}).insert({bottom:(new Element("span",{"class":" col-sm-1 StockInParts"})).update(a.product.id?n:a.product.stockInParts)}).insert({bottom:(new Element("span",{"class":" col-sm-1 TotalInPartsValue"})).update(a.product.id?p:a.product.totalInPartsValue)}).insert({bottom:(new Element("span",{"class":"btns col-sm-1"})).update(a.btns?a.btns:"")})});k=a.product.sku?(new Element("a",{href:"/product/"+a.product.id+".html",target:"_BLANK"})).update(a.product.sku):"";d.insert({top:(new Element("span",
{"class":"col-sm-2 productSku"})).update(k)});f.insert({bottom:(new Element("div",{"class":"row product-content-row"})).insert({bottom:(new Element("span",{"class":"col-sm-10 col-sm-offset-2"})).update(a.scanTable)})});return f},_getNewProductRow:function(){var a;a={product:{name:this._getNewProductProductAutoComplete()},btns:""};return this._getProductRow(a,!1).addClassName("new-order-item-input list-group-item-warning").removeClassName("order-item-row btn-hide-row")},_getNewProductProductAutoComplete:function(){var a,
c,b;a=this;c=a._getFormGroup(null,(new Element("div",{"class":"input-group input-group-sm product-autocomplete"})).insert({bottom:(new Element("input",{id:a.getHTMLID("barcodeInput"),"class":"form-control search-txt visible-xs visible-sm visible-md visible-lg","new-order-item":"product",required:"Required!",placeholder:"Enter BARCODE for products"})).observe("keydown",function(c){b=this;a.keydown(c,function(){$(b).up(".product-autocomplete").down(".search-btn").click()});a.keydown(c,function(){$(b).up(".product-autocomplete").down(".search-btn").click()},
null,9);return!1})}).insert({bottom:(new Element("span",{"class":"input-group-btn"})).insert({bottom:(new Element("span",{"class":" btn btn-primary search-btn","data-loading-text":"searching..."})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})}).observe("click",function(){a._searchProduct(this)})})}));c.down(".input-group").removeClassName("form-control");return c},_getFormGroup:function(a,c){return(new Element("div",{"class":"form-group"})).insert({bottom:a?(new Element("label",
{"class":"control-label"})).update(a):""}).insert({bottom:c.addClassName("form-control")})},_searchProduct:function(a){var c,b,f,d,e,k,g,m,l,h,n;b=this;b._signRandID(a);f=$(a).up(".product-autocomplete").down(".search-txt");if(d=$F(f))return a=$(a).up(".new-order-item-input"),c=e={name:"",id:"",qty:0,barcode:d},(new Element("span",{"class":"pull-right"})).insert({bottom:(new Element("span",{"class":"btn btn-danger btn-xs"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",
function(a){Event.stop(a);confirm("You are about to remove this entry.\n\nContinue?")&&(k=$(this).up(".item_row"),k.remove())})}),a.insert({after:g=new Element("div")}),m=b._getNewProductRow(),a.replace(m),jQuery("#"+b.getHTMLID("barcodeInput")),b.postAjax(b.getCallbackId("searchProduct"),{searchTxt:d},{onLoading:function(){jQuery("#"+b.getHTMLID("barcodeInput")).button("loading");g.hide()},onSuccess:function(a,e){l=new Element("div",{style:"overflow: auto; max-height: 400px;"});try{h=b.getResp(e,
!1,!0),h&&h.items&&0!==h.items.size()||(n=(new Element("div")).insert({bottom:(new Element("span")).update("You are searching for <b>"+d+"</b>")}).insert({bottom:(new Element("span",{"class":"btn btn-success btn-md pull-right"})).update("OK").observe("click",function(){b.hideModalBox();$(b.getHTMLID("barcodeInput")).focus()})}),b.showModalBox("Product no found!",n,!1),g.remove()),g.show(),1<h.items.size()?(f=m.down(".search-txt"),l=new Element("div",{style:"overflow: auto; max-height: 400px;","class":"selectProductPanel"}),
h.items.each(function(a){l.insert({bottom:b._getSearchPrductResultRow(a,f,g,m)})}),l.addClassName("list-group"),b.showModalBox("Products that has: "+d,l,!1)):(c=h.items[0],b._checkProductExist(c)?b.showModalBox("Product "+c.name+" already in the list!","<b>SKU</b>: "+c.sku+", <b>Name</b>: "+c.name,!1):b._selectProduct(c,g),$$('[save-item="stockOnPO"]').first().click())}catch(k){l.update(b.getAlertBox("Error: ",k).addClassName("alert-danger"))}},onComplete:function(a,c){jQuery("#"+b.getHTMLID("barcodeInput")).button("reset")}}),
b},_checkProductExist:function(a){var c;c=!1;$(this.getHTMLID("productsTable")).select(".item_row:not(.item-title-row, .new-order-item-input)").each(function(b){c||b.retrieve("data").id!==a.id||(c=!0)});return c},_selectProduct:function(a,c){var b,f;b=[];b=$("barcode_input");this._signRandID(b);b={product:a,btns:(new Element("span",{"class":"pull-right"})).insert({bottom:(new Element("span",{"class":"btn btn-danger btn-xs"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",
function(a){Event.stop(a);confirm("You are about to remove this entry.\n\nContinue?")&&(f=$(this).up(".item_row"),f.remove())})}),qty:0};c.replace(this._getProductRow(b,!1));return this},_getSearchPrductResultRow:function(a,c,b,f){var d;d=this;return f=(new Element("a",{"class":"list-group-item",href:"javascript: void(0);"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("div",{"class":"col-xs-2"})).insert({bottom:(new Element("div",{"class":"thumbnail"})).insert({bottom:new Element("img",
{"data-src":"holder.js/100%x64",alert:"Product Image",src:0===a.images.size()?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+":a.images[0].asset.url})})})}).insert({bottom:(new Element("div",
{"class":"col-xs-10"})).insert({bottom:(new Element("div",{"class":"row"})).insert({bottom:(new Element("strong")).update(a.name).insert({bottom:(new Element("small",{"class":"",style:"padding-left: 10px;"})).update("SKU: "+a.sku)})}).insert({bottom:(new Element("div")).insert({bottom:(new Element("small")).update(a.shortDescription)})})})})}).observe("click",function(){$(c).up(".new-order-item-input").store("product",a);d._checkProductExist(a)?(jQuery("#"+d.modalId).modal("hide"),d.showModalBox("Product "+
a.name+" already in the list!","<b>SKU</b>: "+a.sku+", <b>Name</b>: "+a.name,!1)):(d._selectProduct(a,b),jQuery("#"+d.modalId).modal("hide"),$$('[save-item="stockOnPO"]').first().click())})},_saveBtns:function(){var a;a=this;return(new Element("span",{"class":"btn-group pull-right"})).insert({bottom:(new Element("span",{"class":"btn btn-primary","data-loading-text":"saving..."})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok-circle"})}).insert({bottom:(new Element("span")).update(" save ")}).observe("click",
function(){a._submitQuantities($(this))})}).insert({bottom:(new Element("span",{"class":"btn btn-default"})).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove-sign"})}).insert({bottom:(new Element("span")).update(" cancel ")}).observe("click",function(){a.showModalBox('<strong class="text-danger">Cancelling this Quantity adjustment</strong>','<div>You are about to cancel this quantity adjustment process, all input data will be lost.</div><br /><div>Continue?</div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',
!0)})})},_submitQuantities:function(a){var c,b,f,d,e;c=this;b=c._collectFormData($(c.getHTMLID("itemDiv")),"save-order");b.products=[];$(c.getHTMLID("productsTable")).getElementsBySelector("div.item_row").each(function(a){f=a.retrieve("data");d=c._collectFormData(a,"save-item");f.id&&b.products.push({productId:f.id,stockOnPO:d.stockOnPO,stockOnOrder:d.stockOnOrder,stockOnHand:d.stockOnHand,stockInRMA:d.stockInRMA,stockInParts:d.stockInParts,totalInPartsValue:c.getValueFromCurrency(d.totalInPartsValue),
totalOnHandValue:c.getValueFromCurrency(d.totalOnHandValue)})});if(null===b)return c;if(!b.products.length)return c.showModalBox('<strong class="text-danger">Error</strong>',"At least one item is needed!",!0),c;c._signRandID(a);c.postAjax(c.getCallbackId("saveQuantities"),b,{onLoading:function(b,c){jQuery("#"+a.id).button("loading")},onSuccess:function(a,b){try{!(e=c.getResp(b,!1,!0))||!e.items||0>!e.items.size()||(c.showModalBox('<strong class="text-success">Success!</strong>',"<h3>Saved successfully</h3>",
!0),window.location=document.URL)}catch(d){c.showModalBox("Error!",d,!1)}},onComplete:function(b,c){jQuery("#"+a.id).button("reset")}});return c},_getProductsTable:function(){var a,c;a=(new Element("div",{"class":"list-group",id:this.getHTMLID("productsTable")})).insert({bottom:c=this._getProductRow({product:{sku:"SKU",name:"Product Name",stockOnPO:"S: PO",stockOnHand:"S: Hand",stockOnOrder:"S: Order",stockInRMA:"S: RMA",stockInParts:"S: Parts",totalInPartsValue:"V: Parts",totalOnHandValue:"V: Hand"}},
!0).addClassName("item-title-row")});c.setStyle({cursor:"pointer"});a.insert({bottom:this._getNewProductRow()});return(new Element("div",{"class":"panel panel-warning"})).insert({bottom:a})},init:function(){$(this.getHTMLID("itemDiv")).insert({bottom:this._getProductsTable()}).insert({bottom:(new Element("div",{"class":"row",style:"padding: 0 15px"})).insert({bottom:(new Element("div",{"class":"col-sm-2 pull-right"})).update(this._saveBtns())})});$(this.getHTMLID("itemDiv")).down("#"+this.getHTMLID("barcodeInput")).focus()}});