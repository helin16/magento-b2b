var PageJs=new Class.create;PageJs.prototype=Object.extend(new BPCPageJs,{_htmlIds:{},setHTMLIDs:function(t,e,o,n){return this._htmlIds.itemDiv=t,this._htmlIds.searchPanel=e,this._htmlIds.productsTable=o,this._htmlIds.barcodeInput=n,this},_getProductRow:function(t,e){var o={};return o.me=this,o.isTitle=e||!1,o.stockOnPOEl=new Element("div",{"class":"form-group"}).insert({bottom:new Element("input",{"class":"form-control","save-item":"stockOnPO",placeholder:"Stock On PO",type:"value",value:t.product.stockOnPO?t.product.stockOnPO:0})}).observe("keydown",function(t){o.txtBox=$(this),o.me.keydown(t,function(){o.txtBox.up(".product-head-row").down('[save-item="stockOnHand"]').select()})}).observe("click",function(){$(this).down("input").select()}),o.stockOnHandEl=new Element("div",{"class":"form-group"}).insert({bottom:new Element("input",{"class":"form-control","save-item":"stockOnHand",placeholder:"Stock On Hand",type:"value",value:t.product.stockOnHand?t.product.stockOnHand:0})}).observe("keydown",function(t){o.txtBox=$(this),o.me.keydown(t,function(){o.txtBox.up(".item_row").down('[save-item="totalOnHandValue"]').select()})}).observe("keyup",function(){o.txtBox=$(this),o.valueBox=o.txtBox.up(".item_row").down('[save-item="totalOnHandValue"]'),0!=$F(o.txtBox.down("input"))&&0!=t.product.unitCost&&0!=o.me.getValueFromCurrency($F(o.valueBox))&&(o.valueBox.value=o.me.getCurrency(t.product.unitCost*$F(o.txtBox.down("input"))))}).observe("click",function(){$(this).down("input").select()}),o.totalOnHandValueEl=new Element("div",{"class":"form-group"}).insert({bottom:new Element("input",{"class":"form-control","save-item":"totalOnHandValue",placeholder:"Total On Hand Value",type:"value",value:o.me.getCurrency(t.product.totalOnHandValue?t.product.totalOnHandValue:0)})}).observe("keydown",function(t){o.txtBox=$(this),o.me.keydown(t,function(){o.txtBox.up(".item_row").down('[save-item="stockOnOrder"]').select()})}).observe("click",function(){$(this).down("input").select()}).observe("change",function(){$(this).down("input").value=o.me.getCurrency($(this).down("input").value)}),o.stockOnOrderEl=new Element("div",{"class":"form-group"}).insert({bottom:new Element("input",{"class":"form-control","save-item":"stockOnOrder",placeholder:"Stock On Order",type:"value",value:t.product.stockOnOrder?t.product.stockOnOrder:0})}).observe("keydown",function(t){o.txtBox=$(this),o.me.keydown(t,function(){o.txtBox.up(".item_row").down('[save-item="stockInRMA"]').select()})}).observe("click",function(){$(this).down("input").select()}),o.stockInRMAEl=new Element("div",{"class":"form-group"}).insert({bottom:new Element("input",{"class":"form-control","save-item":"stockInRMA",placeholder:"Stock In RMA",type:"value",value:t.product.stockInRMA?t.product.stockInRMA:0})}).observe("keydown",function(t){o.txtBox=$(this),o.me.keydown(t,function(){o.txtBox.up(".item_row").down('[save-item="stockInParts"]').select()})}).observe("click",function(){$(this).down("input").select()}),o.stockInPartsEl=new Element("div",{"class":"form-group"}).insert({bottom:new Element("input",{"class":"form-control","save-item":"stockInParts",placeholder:"Stock In Parts",type:"value",value:t.product.stockInParts?t.product.stockInParts:0})}).observe("keydown",function(t){o.txtBox=$(this),o.me.keydown(t,function(){o.txtBox.up(".item_row").down('[save-item="totalInPartsValue"]').select()})}).observe("keyup",function(){o.txtBox=$(this),o.valueBox=o.txtBox.up(".item_row").down('[save-item="totalInPartsValue"]'),0!=$F(o.txtBox.down("input"))&&0!=t.product.unitCost&&0!=o.me.getValueFromCurrency($F(o.valueBox))&&(o.valueBox.value=o.me.getCurrency(t.product.unitCost*$F(o.txtBox.down("input"))))}).observe("click",function(){$(this).down("input").select()}),o.totalInPartsValueEl=new Element("div",{"class":"form-group"}).insert({bottom:new Element("input",{"class":"form-control","save-item":"totalInPartsValue",placeholder:"Total In Parts Value",type:"value",value:o.me.getCurrency(t.product.totalInPartsValue?t.product.totalInPartsValue:0)})}).observe("keydown",function(t){o.txtBox=$(this),o.me.keydown(t,function(){$(o.me._htmlIds.barcodeInput).focus()})}).observe("click",function(){$(this).down("input").select()}).observe("change",function(){$(this).down("input").value=o.me.getCurrency($(this).down("input").value)}),o.row=new Element(o.isTitle===!0?"strong":"div",{"class":"item_row list-group-item"}).store("data",t.product).insert({bottom:o.infoRow=new Element("div",{"class":o.isTitle?"row btn-hide-row":"row btn-hide-row product-head-row"}).insert({bottom:new Element("span",{"class":" col-sm-2 productName"}).insert({bottom:t.product.name?t.product.name:t.product.barcode})}).insert({bottom:new Element("span",{"class":" col-sm-1 StockOnPO"}).update(t.product.id?o.stockOnPOEl:t.product.stockOnPO)}).insert({bottom:new Element("span",{"class":" col-sm-1 StockOnHand"}).update(t.product.id?o.stockOnHandEl:t.product.stockOnHand)}).insert({bottom:new Element("span",{"class":" col-sm-1 TotalOnHandValue"}).update(t.product.id?o.totalOnHandValueEl:t.product.totalOnHandValue)}).insert({bottom:new Element("span",{"class":" col-sm-1 StockOnOrder"}).update(t.product.id?o.stockOnOrderEl:t.product.stockOnOrder)}).insert({bottom:new Element("span",{"class":" col-sm-1 StockInRMA"}).update(t.product.id?o.stockInRMAEl:t.product.stockInRMA)}).insert({bottom:new Element("span",{"class":" col-sm-1 StockInParts"}).update(t.product.id?o.stockInPartsEl:t.product.stockInParts)}).insert({bottom:new Element("span",{"class":" col-sm-1 TotalInPartsValue"}).update(t.product.id?o.totalInPartsValueEl:t.product.totalInPartsValue)}).insert({bottom:o.btns=new Element("span",{"class":"btns col-sm-1"}).update(t.btns?t.btns:"")})}),o.infoRow.insert({top:new Element("span",{"class":"col-sm-2 productSku"}).update(t.product.sku?t.product.sku:"")}),o.row.insert({bottom:new Element("div",{"class":"row product-content-row"}).insert({bottom:new Element("span",{"class":"col-sm-10 col-sm-offset-2"}).update(t.scanTable)})}),o.row},_getNewProductRow:function(){var t={};return t.me=this,t.skuAutoComplete=t.me._getNewProductProductAutoComplete(),t.data={product:{name:t.skuAutoComplete},btns:""},t.newRow=t.me._getProductRow(t.data,!1).addClassName("new-order-item-input list-group-item-warning").removeClassName("order-item-row btn-hide-row"),t.newRow},_getNewProductProductAutoComplete:function(){var t={};return t.me=this,t.skuAutoComplete=t.me._getFormGroup(null,new Element("div",{"class":"input-group input-group-sm product-autocomplete"}).insert({bottom:new Element("input",{id:t.me._htmlIds.barcodeInput,"class":"form-control search-txt visible-xs visible-sm visible-md visible-lg","new-order-item":"product",required:"Required!",placeholder:"Enter BARCODE for products"}).observe("keydown",function(e){return t.txtBox=this,t.me.keydown(e,function(){$(t.txtBox).up(".product-autocomplete").down(".search-btn").click()}),t.me.keydown(e,function(){$(t.txtBox).up(".product-autocomplete").down(".search-btn").click()},null,9),!1})}).insert({bottom:new Element("span",{"class":"input-group-btn"}).insert({bottom:new Element("span",{"class":" btn btn-primary search-btn","data-loading-text":"searching..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-search"})}).observe("click",function(){t.me._searchProduct(this)})})})),t.skuAutoComplete.down(".input-group").removeClassName("form-control"),t.skuAutoComplete},_getFormGroup:function(t,e){return new Element("div",{"class":"form-group"}).insert({bottom:t?new Element("label",{"class":"control-label"}).update(t):""}).insert({bottom:e.addClassName("form-control")})},_searchProduct:function(t){var e={};return e.me=this,e.btn=t,e.me._signRandID(e.btn),e.searchTxtBox=$(e.btn).up(".product-autocomplete").down(".search-txt"),e.searchTxt=$F(e.searchTxtBox),e.searchTxt?(e.currentRow=$(t).up(".new-order-item-input"),e.product={name:"",id:"",qty:0,barcode:e.searchTxt},e.data={product:e.product,btns:new Element("span",{"class":"pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-xs"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(t){Event.stop(t),confirm("You are about to remove this entry.\n\nContinue?")&&(e.row=$(this).up(".item_row"),e.row.remove())})})},e.currentRow.insert({after:e.lastRow=new Element("div")}),e.newRow=e.me._getNewProductRow(),e.currentRow.replace(e.newRow),e.inputBox=jQuery("#"+e.me._htmlIds.barcodeInput),e.me.postAjax(e.me.getCallbackId("searchProduct"),{searchTxt:e.searchTxt},{onLoading:function(){jQuery("#"+e.me._htmlIds.barcodeInput).button("loading"),e.lastRow.hide()},onSuccess:function(t,o){e.resultList=new Element("div",{style:"overflow: auto; max-height: 400px;"});try{e.result=e.me.getResp(o,!1,!0),e.result&&e.result.items&&0!==e.result.items.size()||(e.ModalBoxBody=new Element("div").insert({bottom:new Element("span").update("You are searching for <b>"+e.searchTxt+"</b>")}).insert({bottom:new Element("span",{"class":"btn btn-success btn-md pull-right"}).update("OK").observe("click",function(){e.me.hideModalBox(),$(e.me._htmlIds.barcodeInput).focus()})}),e.me.showModalBox("Product no found!",e.ModalBoxBody,!1),e.lastRow.remove()),e.lastRow.show(),e.result.items.size()>1?(e.searchTxtBox=e.newRow.down(".search-txt"),e.resultList=new Element("div",{style:"overflow: auto; max-height: 400px;","class":"selectProductPanel"}),e.result.items.each(function(t){e.resultList.insert({bottom:e.me._getSearchPrductResultRow(t,e.searchTxtBox,e.lastRow,e.newRow)})}),e.resultList.addClassName("list-group"),e.me.showModalBox("Products that has: "+e.searchTxt,e.resultList,!1)):(e.data.product=e.result.items[0],e.me._checkProductExist(e.data.product)?e.me.showModalBox("Product "+e.data.product.name+" already in the list!","<b>SKU</b>: "+e.data.product.sku+", <b>Name</b>: "+e.data.product.name,!1):e.me._selectProduct(e.data.product,e.lastRow),$$('[save-item="stockOnPO"]').first().click())}catch(n){e.resultList.update(e.me.getAlertBox("Error: ",n).addClassName("alert-danger"))}},onComplete:function(){jQuery("#"+e.me._htmlIds.barcodeInput).button("reset")}}),e.me):void 0},_checkProductExist:function(t){var e={};return e.me=this,e.ifExist=!1,$(e.me._htmlIds.productsTable).select(".item_row:not(.item-title-row, .new-order-item-input)").each(function(o){e.ifExist||o.retrieve("data").id!==t.id||(e.ifExist=!0)}),e.ifExist},_selectProduct:function(t,e){var o={};return o.me=this,o.data=[],o.product=t,o.lastRow=e,o.btn=$("barcode_input"),o.me._signRandID(o.btn),o.data={product:o.product,btns:new Element("span",{"class":"pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-danger btn-xs"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-trash"})}).observe("click",function(t){Event.stop(t),confirm("You are about to remove this entry.\n\nContinue?")&&(o.row=$(this).up(".item_row"),o.row.remove())})}),qty:0},o.lastRow.replace(o.newRow=o.me._getProductRow(o.data,!1)),o.me},_getSearchPrductResultRow:function(t,e,o,n){var s={};return s.me=this,s.lastRow=o,s.newRow=n,s.defaultImgSrc="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZWVlIi8+PHRleHQgdGV4dC1hbmNob3I9Im1pZGRsZSIgeD0iMzIiIHk9IjMyIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+NjR4NjQ8L3RleHQ+PC9zdmc+",s.newRow=new Element("a",{"class":"list-group-item",href:"javascript: void(0);"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("div",{"class":"col-xs-2"}).insert({bottom:new Element("div",{"class":"thumbnail"}).insert({bottom:new Element("img",{"data-src":"holder.js/100%x64",alert:"Product Image",src:0===t.images.size()?s.defaultImgSrc:t.images[0].asset.url})})})}).insert({bottom:new Element("div",{"class":"col-xs-10"}).insert({bottom:new Element("div",{"class":"row"}).insert({bottom:new Element("strong").update(t.name).insert({bottom:new Element("small",{"class":"",style:"padding-left: 10px;"}).update("SKU: "+t.sku)})}).insert({bottom:new Element("div").insert({bottom:new Element("small").update(t.shortDescription)})})})})}).observe("click",function(){s.inputRow=$(e).up(".new-order-item-input").store("product",t),s.me._checkProductExist(t)?(jQuery("#"+s.me.modalId).modal("hide"),s.me.showModalBox("Product "+t.name+" already in the list!","<b>SKU</b>: "+t.sku+", <b>Name</b>: "+t.name,!1)):(s.me._selectProduct(t,s.lastRow),jQuery("#"+s.me.modalId).modal("hide"),$$('[save-item="stockOnPO"]').first().click())}),s.newRow},_saveBtns:function(){var t={};return t.me=this,t.newDiv=new Element("span",{"class":"btn-group pull-right"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"saving..."}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-ok-circle"})}).insert({bottom:new Element("span").update(" save ")}).observe("click",function(){t.me._submitQuantities($(this))})}).insert({bottom:new Element("span",{"class":"btn btn-default"}).insert({bottom:new Element("span",{"class":"glyphicon glyphicon-remove-sign"})}).insert({bottom:new Element("span").update(" cancel ")}).observe("click",function(){t.me.showModalBox('<strong class="text-danger">Cancelling this Quantity adjustment</strong>','<div>You are about to cancel this quantity adjustment process, all input data will be lost.</div><br /><div>Continue?</div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',!0)})}),t.newDiv},_submitQuantities:function(t){var e={};return e.me=this,e.btn=t,e.data=e.me._collectFormData($(e.me._htmlIds.itemDiv),"save-order"),e.data.products=[],$(e.me._htmlIds.productsTable).getElementsBySelector("div.item_row").each(function(t){e.product=t.retrieve("data"),e.formData=e.me._collectFormData(t,"save-item"),void 0!==e.product.id&&(e.product.stockOnPO=e.formData.stockOnPO,e.product.stockOnHand=e.formData.stockOnHand,e.product.stockOnOrder=e.formData.stockOnOrder,e.product.stockInRMA=e.formData.stockInRMA,e.product.stockInParts=e.formData.stockInParts,e.product.totalInPartsValue=e.me.getValueFromCurrency(e.formData.totalInPartsValue),e.product.totalOnHandValue=e.me.getValueFromCurrency(e.formData.totalOnHandValue),e.data.products.push(e.product))}),null===e.data?e.me:e.data.products.length?(e.me._signRandID(e.btn),e.me.postAjax(e.me.getCallbackId("saveQuantities"),e.data,{onLoading:function(){jQuery("#"+e.btn.id).button("loading")},onSuccess:function(t,o){try{if(e.result=e.me.getResp(o,!1,!0),!e.result||!e.result.item)return;"RECEIVING"===e.result.item.status?e.me.showModalBox('<strong class="text-success">Success!</strong>','<div>The current receiving process is succussed and saved.</div><br /><div><strong>There are more to go, Another One?</strong></div><div><span class="btn btn-primary" onclick="window.location = document.URL;"><span class="glyphicon glyphicon-ok"></span> YES</span><span class="btn btn-default pull-right" data-dismiss="modal"><span aria-hidden="true"><span class="glyphicon glyphicon-remove-sign"></span> NO</span></span></div>',!0):(e.me.showModalBox('<strong class="text-success">Success!</strong>',"<h3>Saved successfully</h3>",!0),window.location=document.URL)}catch(n){e.me.showModalBox("Error!",n,!1)}},onComplete:function(){jQuery("#"+e.btn.id).button("reset")}}),e.me):(e.me.showModalBox('<strong class="text-danger">Error</strong>',"At least one item is needed!",!0),e.me)},_getProductsTable:function(){var t={};return t.me=this,t.productListDiv=new Element("div",{"class":"list-group",id:t.me._htmlIds.productsTable}).insert({bottom:t.newDiv=t.me._getProductRow({product:{sku:"SKU",name:"Product Name",stockOnPO:"PO",stockOnHand:"Hand",stockOnOrder:"Order",stockInRMA:"RMA",stockInParts:"Parts",totalInPartsValue:"V: Parts",totalOnHandValue:"V: Hand"}},!0).addClassName("item-title-row")}),t.newDiv.setStyle({cursor:"pointer"}),t.productListDiv.insert({bottom:t.me._getNewProductRow()}),new Element("div",{"class":"panel panel-warning"}).insert({bottom:t.productListDiv})},init:function(){var t={};t.me=this,$(t.me._htmlIds.itemDiv).insert({bottom:t.me._getProductsTable()}).insert({bottom:new Element("div",{"class":"row",style:"padding: 0 15px"}).insert({bottom:new Element("div",{"class":"col-sm-2 pull-right"}).update(t.me._saveBtns())})}),$(t.me._htmlIds.itemDiv).down("#"+t.me._htmlIds.barcodeInput).focus()}});