var CRUDPageJs=new Class.create;CRUDPageJs.prototype=Object.extend(new BPCPageJs,{resultDivId:"",searchDivId:"",totalNoOfItemsId:"",_pagination:{pageNo:1,pageSize:30},_searchCriteria:{},setHTMLIds:function(e,t,a){return this.resultDivId=e,this.searchDivId=t,this.totalNoOfItemsId=a,this},getSearchCriteria:function(){var e={};return e.me=this,null===e.me._searchCriteria&&(e.me._searchCriteria={}),e.nothingTosearch=!0,$(e.me.searchDivId).getElementsBySelector("[search_field]").each(function(t){e.me._searchCriteria[t.readAttribute("search_field")]=$F(t),($F(t)instanceof Array&&$F(t).size()>0||"string"==typeof $F(t)&&!$F(t).blank())&&(e.nothingTosearch=!1)}),e.nothingTosearch===!0&&(e.me._searchCriteria=null),this},getResults:function(e,t){var a={};a.me=this,a.reset=e||!1,a.resultDiv=$(a.me.resultDivId),a.reset===!0&&(a.me._pagination.pageNo=1),a.me._pagination.pageSize=t||a.me._pagination.pageSize,a.me.postAjax(a.me.getCallbackId("getItems"),{pagination:a.me._pagination,searchCriteria:a.me._searchCriteria},{onLoading:function(){jQuery("#"+a.me.searchDivId+" #searchBtn").button("loading"),a.reset===!0&&a.resultDiv.update(new Element("tr").update(new Element("td").update(a.me.getLoadingImg())))},onSuccess:function(e,t){try{if(a.result=a.me.getResp(t,!1,!0),!a.result)return;$(a.me.totalNoOfItemsId).update(a.result.pageStats.totalRows),a.reset===!0&&(a.resultDiv.update(a.me._getResultRow(a.me._getTitleRowData(),!0).wrap(new Element("thead"))),a.result.items&&0!==a.result.items.size()||a.resultDiv.insert({bottom:a.me.getAlertBox("Nothing found.","").addClassName("alert-warning")})),a.resultDiv.getElementsBySelector(".paginWrapper").each(function(e){e.remove()}),a.tbody=$(a.resultDiv).down("tbody"),a.tbody||$(a.resultDiv).insert({bottom:a.tbody=new Element("tbody")}),a.result.items.each(function(e){a.tbody.insert({bottom:a.me._getResultRow(e).addClassName("item_row").writeAttribute("item_id",e.id)})}),a.result.pageStats.pageNumber<a.result.pageStats.totalPages&&a.resultDiv.insert({bottom:a.me._getNextPageBtn().addClassName("paginWrapper")})}catch(r){a.resultDiv.insert({bottom:a.me.getAlertBox("Error",r).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+a.me.searchDivId+" #searchBtn").button("reset")}})},_getNextPageBtn:function(){var e={};return e.me=this,new Element("tfoot").insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:"5","class":"text-center"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Fetching more results ..."}).update("Show More").observe("click",function(){e.me._pagination.pageNo=1*e.me._pagination.pageNo+1,jQuery(this).button("loading"),e.me.getResults()})})})})},_saveItem:function(e,t,a){var r={};return r.me=this,r.data=r.me._collectFormData(t,a),null!==r.data?(r.me.postAjax(r.me.getCallbackId("saveItem"),{item:r.data},{onLoading:function(){r.data.id&&t.addClassName("item_row").writeAttribute("item_id",r.data.id),t.hide()},onSuccess:function(e,a){try{if(r.result=r.me.getResp(a,!1,!0),!r.result||!r.result.item)return;r.row=$(r.me.resultDivId).down("tbody").down(".item_row[item_id="+r.result.item.id+"]"),r.newRow=r.me._getResultRow(r.result.item).addClassName("item_row").writeAttribute("item_id",r.result.item.id),r.row?r.row.replace(r.newRow):($(r.me.resultDivId).down("tbody").insert({top:r.newRow}),t.remove(),$(r.me.totalNoOfItemsId).update(1*$(r.me.totalNoOfItemsId).innerHTML+1))}catch(i){r.me.showModalBox('<span class="text-danger">ERROR:</span>',i,!0),t.show()}}}),r.me):void 0},_deleteItem:function(e){var t={};return t.me=this,t.row=$(t.me.resultDivId).down("tbody").down(".item_row[item_id="+e.id+"]"),t.me.postAjax(t.me.getCallbackId("deleteItems"),{ids:[e.id]},{onLoading:function(){t.row&&t.row.hide()},onSuccess:function(e,a){try{if(t.result=t.me.getResp(a,!1,!0),!t.result)return;t.count=1*$(t.me.totalNoOfItemsId).innerHTML-1,$(t.me.totalNoOfItemsId).update(t.count<=0?0:t.count),t.row&&t.row.remove()}catch(r){t.me.showModalBox('<span class="text-danger">ERROR</span>',r,!0),t.row&&t.row.show()}}}),t.me}});