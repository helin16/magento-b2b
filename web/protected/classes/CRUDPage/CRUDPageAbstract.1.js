var CRUDPageJs=new Class.create();CRUDPageJs.prototype=Object.extend(new BPCPageJs(),{resultDivId:"",searchDivId:"",totalNoOfItemsId:"",_pagination:{pageNo:1,pageSize:30},_searchCriteria:{},setHTMLIds:function(c,a,b){this.resultDivId=c;this.searchDivId=a;this.totalNoOfItemsId=b;return this},getSearchCriteria:function(){var a={};a.me=this;if(a.me._searchCriteria===null){a.me._searchCriteria={}}a.nothingTosearch=true;$(a.me.searchDivId).getElementsBySelector("[search_field]").each(function(b){a.me._searchCriteria[b.readAttribute("search_field")]=$F(b);if(($F(b) instanceof Array&&$F(b).size()>0)||(typeof $F(b)==="string"&&!$F(b).blank())){a.nothingTosearch=false}});if(a.nothingTosearch===true){a.me._searchCriteria=null}return this},getResults:function(c,a){var b={};b.me=this;b.reset=(c||false);b.resultDiv=$(b.me.resultDivId);if(b.reset===true){b.me._pagination.pageNo=1}b.me._pagination.pageSize=(a||b.me._pagination.pageSize);b.me.postAjax(b.me.getCallbackId("getItems"),{pagination:b.me._pagination,searchCriteria:b.me._searchCriteria},{onLoading:function(){jQuery("#"+b.me.searchDivId+" #searchBtn").button("loading");if(b.reset===true){b.resultDiv.update(new Element("tr").update(new Element("td").update(b.me.getLoadingImg())))}},onSuccess:function(d,g){try{b.result=b.me.getResp(g,false,true);if(!b.result){return}$(b.me.totalNoOfItemsId).update(b.result.pageStats.totalRows);if(b.reset===true){b.resultDiv.update(b.me._getResultRow(b.me._getTitleRowData(),true).wrap(new Element("thead")))}b.resultDiv.getElementsBySelector(".paginWrapper").each(function(e){e.remove()});b.tbody=$(b.resultDiv).down("tbody");if(!b.tbody){$(b.resultDiv).insert({bottom:b.tbody=new Element("tbody")})}b.result.items.each(function(e){b.tbody.insert({bottom:b.me._getResultRow(e).addClassName("item_row").writeAttribute("item_id",e.id)})});if(b.result.pageStats.pageNumber<b.result.pageStats.totalPages){b.resultDiv.insert({bottom:b.me._getNextPageBtn().addClassName("paginWrapper")})}}catch(f){b.resultDiv.insert({bottom:b.me.getAlertBox("Error",f).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+b.me.searchDivId+" #searchBtn").button("reset")}})},_getNextPageBtn:function(){var a={};a.me=this;return new Element("tfoot").insert({bottom:new Element("tr").insert({bottom:new Element("td",{colspan:"5","class":"text-center"}).insert({bottom:new Element("span",{"class":"btn btn-primary","data-loading-text":"Fetching more results ..."}).update("Show More").observe("click",function(){a.me._pagination.pageNo=a.me._pagination.pageNo*1+1;jQuery(this).button("loading");a.me.getResults()})})})})},_saveItem:function(c,d,b){var a={};a.me=this;a.data=a.me._collectFormData(d,b);if(a.data===null){return}a.me.postAjax(a.me.getCallbackId("saveItem"),{item:a.data},{onLoading:function(){if(a.data.id){d.addClassName("item_row").writeAttribute("item_id",a.data.id)}d.hide()},onSuccess:function(f,h){try{a.result=a.me.getResp(h,false,true);if(!a.result||!a.result.item){return}a.row=$(a.me.resultDivId).down("tbody").down(".item_row[item_id="+a.result.item.id+"]");a.newRow=a.me._getResultRow(a.result.item).addClassName("item_row").writeAttribute("item_id",a.result.item.id);if(!a.row){$(a.me.resultDivId).down("tbody").insert({top:a.newRow});d.remove();$(a.me.totalNoOfItemsId).update($(a.me.totalNoOfItemsId).innerHTML*1+1)}else{a.row.replace(a.newRow)}}catch(g){a.me.showModalBox('<span class="text-danger">ERROR:</span>',g,true);d.show()}}});return a.me},_deleteItem:function(b){var a={};a.me=this;a.row=$(a.me.resultDivId).down("tbody").down(".item_row[item_id="+b.id+"]");a.me.postAjax(a.me.getCallbackId("deleteItems"),{ids:[b.id]},{onLoading:function(){if(a.row){a.row.hide()}},onSuccess:function(c,f){try{a.result=a.me.getResp(f,false,true);if(!a.result){return}a.count=$(a.me.totalNoOfItemsId).innerHTML*1-1;$(a.me.totalNoOfItemsId).update(a.count<=0?0:a.count);if(a.row){a.row.remove()}}catch(d){a.me.showModalBox('<span class="text-danger">ERROR</span>',d,true);if(a.row){a.row.show()}}}});return a.me}});