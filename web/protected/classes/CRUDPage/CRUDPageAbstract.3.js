var CRUDPageJs=new Class.create;
CRUDPageJs.prototype=Object.extend(new BPCPageJs,{resultDivId:"",searchDivId:"",totalNoOfItemsId:"",_pagination:{pageNo:1,pageSize:30},_searchCriteria:{},_nextPageColSpan:5,setHTMLIds:function(c,b,a){this.resultDivId=c;this.searchDivId=b;this.totalNoOfItemsId=a;return this},getSearchCriteria:function(){var c,b;c=this;null===c._searchCriteria&&(c._searchCriteria={});b=!0;$(c.searchDivId).getElementsBySelector("[search_field]").each(function(a){c._searchCriteria[a.readAttribute("search_field")]=$F(a);
if($F(a)instanceof Array&&0<$F(a).size()||"string"===typeof $F(a)&&!$F(a).blank())b=!1});!0===b&&(c._searchCriteria=null);return this},getResults:function(c,b){var a,e,d,f,g;a=this;e=c||!1;d=$(a.resultDivId);!0===e&&(a._pagination.pageNo=1);a._pagination.pageSize=b||a._pagination.pageSize;a.postAjax(a.getCallbackId("getItems"),{pagination:a._pagination,searchCriteria:a._searchCriteria},{onLoading:function(){jQuery("#"+a.searchDivId+" #searchBtn").button("loading");!0===e&&d.update((new Element("tr")).update((new Element("td")).update(a.getLoadingImg())))},
onSuccess:function(b,c){try{if(f=a.getResp(c,!1,!0))$(a.totalNoOfItemsId).update(f.pageStats.totalRows),!0===e&&(d.update(a._getResultRow(a._getTitleRowData(),!0).wrap(new Element("thead"))),f.items&&0!==f.items.size()||d.insert({bottom:a.getAlertBox("Nothing found.","").addClassName("alert-warning")})),d.getElementsBySelector(".paginWrapper").each(function(a){a.remove()}),(g=$(d).down("tbody"))||$(d).insert({bottom:g=new Element("tbody")}),f.items.each(function(b){g.insert({bottom:a._getResultRow(b).addClassName("item_row").writeAttribute("item_id",
b.id)})}),f.pageStats.pageNumber<f.pageStats.totalPages&&d.insert({bottom:a._getNextPageBtn().addClassName("paginWrapper")})}catch(k){d.insert({bottom:a.getAlertBox("Error",k).addClassName("alert-danger")})}},onComplete:function(){jQuery("#"+a.searchDivId+" #searchBtn").button("reset")}})},_getNextPageBtn:function(){var c;c=this;return(new Element("tfoot")).insert({bottom:(new Element("tr")).insert({bottom:(new Element("td",{colspan:c._nextPageColSpan,"class":"text-center"})).insert({bottom:(new Element("span",
{"class":"btn btn-primary","data-loading-text":"Fetching more results ..."})).update("Show More").observe("click",function(){c._pagination.pageNo=1*c._pagination.pageNo+1;jQuery(this).button("loading");c.getResults()})})})})},_saveItem:function(c,b,a){var e,d,f,g,h;e=this;d=e._collectFormData(b,a);if(null!==d)return e.postAjax(e.getCallbackId("saveItem"),{item:d},{onLoading:function(){d.id&&b.addClassName("item_row").writeAttribute("item_id",d.id);b.hide()},onSuccess:function(a,c){try{(f=e.getResp(c,
!1,!0))&&f.item&&(g=$(e.resultDivId).down("tbody").down(".item_row[item_id="+f.item.id+"]"),h=e._getResultRow(f.item).addClassName("item_row").writeAttribute("item_id",f.item.id),g?g.replace(h):($(e.resultDivId).down("tbody").insert({top:h}),b.remove(),$(e.totalNoOfItemsId).update(1*$(e.totalNoOfItemsId).innerHTML+1)))}catch(d){e.showModalBox('<span class="text-danger">ERROR:</span>',d,!0),b.show()}}}),e},_deleteItem:function(c){var b,a,e,d;b=this;a=$(b.resultDivId).down("tbody").down(".item_row[item_id="+
c.id+"]");b.postAjax(b.getCallbackId("deleteItems"),{ids:[c.id]},{onLoading:function(){a&&a.hide()},onSuccess:function(c,g){try{if(e=b.getResp(g,!1,!0))d=1*$(b.totalNoOfItemsId).innerHTML-1,$(b.totalNoOfItemsId).update(0>=d?0:d),a&&a.remove()}catch(h){b.showModalBox('<span class="text-danger">ERROR</span>',h,!0),a&&a.show()}}});return b}});